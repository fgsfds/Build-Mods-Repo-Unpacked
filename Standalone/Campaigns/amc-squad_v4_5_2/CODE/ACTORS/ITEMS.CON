/*
-------------------------------------------------------------------------------
===============================================================================

         -ooo:             +oo-            `+oo.       ./+oooooooooo+/:
        /NMMMN+            NMMNo`         -dMMM/      .mMMNmmmmmmmmmMMNo
       /NMd:mMMo           NMMNMd:      `oNMNMM/      :MMM/.........mMMh
      oNMd. -mMMy`         NMN:mMNs`   -hMm/mMM/      :MMM:         ::-.
    `sMMh`   .dMMh`        NMN .sNMd:`oNMh. mMM/      :MMM:
   `yMMMdhhhhhmMMMd.       NMN   /mMNdMm+`  mMM/      :MMM:         ss+:
  `hMMdhhhhhhhhhmMMm-      NMN    .yMMh.    mMM/      :MMM/.........mMMh
 .dMMs`         .hMMm:     NMN      :/`     mMM/      .mMMNmmmmmmmmmMMNo
 :oo+            `+oo+     +o+              +oo.       ./++ooooooooo+/:

###############################################################################
+ The AMC Squad
+ CON code by James Stanfield, Cedric "Sangman" Haegeman, Dino Bollinger,
+              Mikko Sandt, Cedric "Zaxtor" Lutes and Dan "Danarama" Gaskill
-------------------------------------------------------------------------------
* See AMC_MAIN.CON for a full list of script authors.

Feel free to use any code in the game for your own uses; just make
sure to mention the authors and/or "The AMC Squad" in your credits.
--------------------------------------------------------------------------------
NOTES:

--------------------------------------------------------------------------------
*/


// PICKUP CODE----------------------------ITEMS!-------------------------------------------------

action DECORATION 0

move ITEM_FORWARD 15 -5

var item_num 0 2

defstate SPECIAL_SETTING
ifaction 0
	{
	readarrayfromfile SPECIALIST_EQUIPMENT F_SPECIAL_LOADOUT_AMCTC
	ifand sprite[].cstat 16
		{
		action DECORATION
		ife SPECIALIST_EQUIPMENT[item_num] 0 killit
		}
	else
		{
		ifg SPECIALIST_EQUIPMENT[item_num] 0 { spawn GOLD_AMULET killit }
		action ZERO
		}
	}
ifaction ZERO fall
ends

gamevar drop_counter 0 1
gamevar drop_cooldown 0 1 // prevents dropping all temp weapons if use remains pressed while sliding

defstate set_remainingammo_droppedweapon
	// Save the remaining normal ammo in the YVEL so that we recoup this if we pick it up again
	// However, if there is no normal ammo remaining, set YVELSAVED to -900. If the player then picks up a weapon with this YVEL it means the code needs to switch to an alt ammo type on pickup.
	ifle temp 0
		setav[RETURN].YVELSAVED -900
	else
		setav[RETURN].YVELSAVED temp
ends

defstate drop_tempweapon
	ife cur_weap 0
	{
		ifand gun_firemode 512 xorvar gun_firemode 512
		ifand gun_firemode 32768 xorvar gun_firemode 32768
		ifand gun_firemode 16384
		{
			sizeat 42 36 xorvar gun_firemode 16384
			ifmultiplayer nullop else set scope 0
		}
		set gl_countd 0

		state lower_weapon
	}

	set ammo_forweaponidx 0
	state ammo_getdefs
	set temp ammo_normalammoremaining

	ife temp_weap 1 { espawn MINISHRINKERSPRITE state set_remainingammo_droppedweapon } // cost 200
	ife temp_weap 2 { espawn BARRETTRIFLESPRITE state set_remainingammo_droppedweapon } // cost 300
	ife temp_weap 3 { espawn SMGSPRITE state set_remainingammo_droppedweapon } // cost 75
	ife temp_weap 4 { espawn BLOODSTAFFSPRITE state set_remainingammo_droppedweapon }
	ife temp_weap 5 { espawn LIZMANGUNSPRITE state set_remainingammo_droppedweapon } // cost 75
	ife temp_weap 6 { espawn PIGCOPGUNSPRITE state set_remainingammo_droppedweapon } // cost 75
	ife temp_weap 7 { espawn SKULLDUSTERSPRITE state set_remainingammo_droppedweapon }
	ife temp_weap 8 { espawn FLESHSQUIRTERSPRITE state set_remainingammo_droppedweapon }
	ife temp_weap 9 { espawn STYGIANGUNSPRITE state set_remainingammo_droppedweapon }
	ife temp_weap 10 { espawn SAWNOFFSPRITE state set_remainingammo_droppedweapon } // cost 150
	ife temp_weap 11 { espawn TOMMYGUNSPRITE state set_remainingammo_droppedweapon } // cost 125
	ife temp_weap 12 { espawn RIOTGUNSPRITE state set_remainingammo_droppedweapon } // cost 150
	ife temp_weap 13 { espawn CROSSBOWSPRITE state set_remainingammo_droppedweapon } // cost 50
	ife temp_weap 14 { espawn MIAGUNSPRITE state set_remainingammo_droppedweapon } // cost 150
	ife temp_weap 15 { espawn LASERGUNSPRITE state set_remainingammo_droppedweapon } // cost 100
	ife temp_weap 16 { espawn TMISSILELSPRITE state set_remainingammo_droppedweapon } // cost 200
	ife temp_weap 17 { spawn CHAINSAWSPRITE stopsound CHAINSAW_IDLE } // cost 50
	ife temp_weap 18 { espawn FLAMETHROWERSPRITE state set_remainingammo_droppedweapon } // cost 150
	ife temp_weap 19 spawn SWORDSPRITE // cost 50
	ife temp_weap 20 { ife WEP0_BLOODY 1 spawn BLOODY_MOPSPRITE else spawn MOPSPRITE } // cost 1
	ife temp_weap 21 { espawn FNFALSPRITE state set_remainingammo_droppedweapon } // cost 225
	ife temp_weap 22 { espawn MP40SPRITE state set_remainingammo_droppedweapon } // cost 50
	ife temp_weap 23 { espawn JPLASMASPRITE state set_remainingammo_droppedweapon } // cost 100
	ife temp_weap 24 { espawn LIZMANFGUNSPRITE state set_remainingammo_droppedweapon } // cost 125
	ife temp_weap 25 { espawn M16SPRITE state set_remainingammo_droppedweapon } // cost 125
	ife temp_weap 26 { espawn AK114SPRITE state set_remainingammo_droppedweapon } // cost 150
	ife temp_weap 27 { espawn RIOTGUN_MINIGUN_SPRITE state set_remainingammo_droppedweapon } // cost 400
	ife temp_weap 28 { espawn NAILGUN_SPRITE state set_remainingammo_droppedweapon } // cost 150
	ife temp_weap 29 { espawn RIOTGUN_GRENADEL_SPRITE state set_remainingammo_droppedweapon } // cost 400
	ife temp_weap 30 { espawn DARTGUN_SPRITE state set_remainingammo_droppedweapon } // cost 75
	ife temp_weap 31 { espawn M60_SPRITE state set_remainingammo_droppedweapon } // cost 250
	ife temp_weap 32 { espawn ZMISSILELSPRITE state set_remainingammo_droppedweapon } // cost 250
	ife temp_weap 33 { espawn GOROHEADSPRITE state set_remainingammo_droppedweapon ifrnd 128 sound GIB_LAND2 else sound GIB_LAND1 spawn 16368 }
	ife temp_weap 34 { espawn 16087 state set_remainingammo_droppedweapon } // cost 400
	ife temp_weap 35 { espawn M960_SPRITE state set_remainingammo_droppedweapon } // cost 100
	ife temp_weap 36 spawn 12200
	ife temp_weap 37 spawn 20101
	ife temp_weap 38 { espawn RIPPER_HEART state set_remainingammo_droppedweapon ifrnd 128 sound GIB_LAND2 else sound GIB_LAND1 spawn 16368 }
	ife temp_weap 39 { espawn ZCHAINGUN_SPRITE state set_remainingammo_droppedweapon } // cost 250
	ife temp_weap 40 { espawn RAILGUN_SPRITE state set_remainingammo_droppedweapon } // cost 300
	ife temp_weap 41 { espawn AR65_SPRITE state set_remainingammo_droppedweapon } // cost 200
	ife temp_weap 42 { espawn HELL_NAILER_SPRITE state set_remainingammo_droppedweapon } // cost 125
	ife temp_weap 43 { espawn PROTO_SHRINKER_SPRITE state set_remainingammo_droppedweapon } // cost 200
	ife temp_weap 45 { espawn P90_SPRITE state set_remainingammo_droppedweapon } // cost 100
	ife temp_weap 46 { espawn OGRE_STAFF_SPRITE state set_remainingammo_droppedweapon } // cost 100
	ife temp_weap 47 { espawn ENG_SMG_SPRITE state set_remainingammo_droppedweapon } // cost 300
	ife temp_weap 48 { espawn ROT_BOLT_SPRITE state set_remainingammo_droppedweapon } // cost 300
	ife temp_weap 49 spawn AXE_SPRITE
	ife temp_weap 50 { espawn RW_CROSSBOW_SPRITE state set_remainingammo_droppedweapon } // cost 100
	ife temp_weap 51 spawn VORPAL_SWORD_SPRITE
	ife temp_weap 52 { espawn UDP45_SPRITE state set_remainingammo_droppedweapon } // cost 150
	ife temp_weap 55 { espawn PHPLASMA_SPRITE state set_remainingammo_droppedweapon } // cost 300
	ife temp_weap 56 { espawn MOSSBERG_SPRITE state set_remainingammo_droppedweapon } // cost 75
	set temp_weap 0
	setp[].ammo_amount 0 0
	set normal_ammo 0
ends

appendevent EVENT_LOADACTOR
switch sprite[].picnum
    case HEAVYHBOMB seta[].picnum 3689 break
	case 9098 seta[].picnum 9087 break // failsafe
	case STEROIDS
	case BOOTS
	case HEATSENSOR
	case HEAVYARMOUR
	case AIRTANK
	case HOLODUKE
	case JETPACK
	case FIRSTAID
	// ammo
	case AMMO
	case FREEZEAMMO
	case SHOTGUNAMMO
	case CHAINGUNSPRITE
	case AMMOLOTS
	case CRYSTALAMMO
	case GROWAMMO
	case BATTERYAMMO
	case DEVISTATORAMMO
	case RPGAMMO
	case HBOMBAMMO
	case 3689
	// base weapons
	case RPGSPRITE
	case SHOTGUNSPRITE
	case FIRSTGUNSPRITE
	case TRIPBOMBSPRITE
	case DEVISTATORSPRITE
	case FREEZESPRITE
	case SHRINKERSPRITE
	// temp weapon melee
	case 12200 // SW sword pickup
	case 20101 // Beam sabre
	case MOPSPRITE
	case BLOODY_MOPSPRITE
	case SWORDSPRITE
	case CHAINSAWSPRITE
	case AXE_SPRITE
	case VORPAL_SWORD_SPRITE
	// temp weapon guns
	case RIOTGUN_MINIGUN_SPRITE
	case 16087 // upg riotgun minigun
	case RIOTGUN_GRENADEL_SPRITE
	case NAILGUN_SPRITE
	case DARTGUN_SPRITE
	case M60_SPRITE
	case ZMISSILELSPRITE
	case M960_SPRITE
	case GOROHEADSPRITE
	case RIPPER_HEART
	case M16SPRITE
	case P90_SPRITE
	case MP40SPRITE
	case FNFALSPRITE
	case AK114SPRITE
	case JPLASMASPRITE
	case LIZMANFGUNSPRITE
	case FLAMETHROWERSPRITE
	case MINISHRINKERSPRITE
	case PROTO_SHRINKER_SPRITE
	case BARRETTRIFLESPRITE
	case SMGSPRITE
	case BLOODSTAFFSPRITE
	case LIZMANGUNSPRITE
	case ZCHAINGUN_SPRITE
	case RAILGUN_SPRITE
	case AR65_SPRITE
	case HELL_NAILER_SPRITE
	case PIGCOPGUNSPRITE
	case SKULLDUSTERSPRITE
	case FLESHSQUIRTERSPRITE
	case STYGIANGUNSPRITE
	case SAWNOFFSPRITE
	case TOMMYGUNSPRITE
	case RIOTGUNSPRITE
	case CROSSBOWSPRITE
	case MIAGUNSPRITE
	case LASERGUNSPRITE
	case TMISSILELSPRITE
	case ENG_SMG_SPRITE
	case ROT_BOLT_SPRITE
	case RW_CROSSBOW_SPRITE
	case UDP45_SPRITE
	case PHPLASMA_SPRITE
	case MOSSBERG_SPRITE
	// alt ammo types
	case SILVERAMMO_DRUM
	case FORTYMM_NADES
	case FORTYMM_CASELESS
	case FORTYMM_SLUGS
	case FORTYMM_ELECTRO
	case FORTYMM_CRYO
	case FORTYMM_SHELLS
	case EXPL_SHELLS
	case FLECHETE_SHELLS
	case TESLA_AMMO_SPRITE
	case SILVER_CROSSBOW_BOLTS
	case VOID_CROSSBOW_BOLTS
	case ORANGE_MANA_PICKUP
	case GREEN_MANA_PICKUP
	case BLUE_MANA_PICKUP
	case PURPLE_MANA_PICKUP
	case MICRO_TORPEDO_PACK
	case MAGNUM_SHELLS
	case DRAGONS_SHELLS
	case HEAT_SEEK_CARD_PICKUP
	case ATOMIC_BOMB_PICKUP
	case DUP_MISSILES_PICKUP
	// health items
	case HYPOSPRAY
	case HPOTION
	case HFLASK
	case HCUP
	case TWENTYKIT
	case HPOWDER
	case BRIMSTONE
	case 18424
	case 18682
	case 20158
	case 20159
	case TWENTYFIVEKIT
	case SIXPAK
	case COLA
	case GOLD_AMULET
	case COOKIE
	// pickups
	case MEGASPHERE
	case SWORD_RAMPAGE
	case INVINCIBILITY
	case SPIRIT_ARMOUR
	case FIRE_ARMOUR
	case SUPER_ARMOUR
	case BASIC_ARMOUR
	case REBREATHER
	case FIRESUIT
	case GASMASK
	case FLIPPER
	case O2CANISTER
	case HEAT_SINK_PACK
	case C4_EXPLOSIVE
	case ASTRIKE_MARKER
	case FIREWALL_CHIP
	case COG_PICKUP
	case TOOLBOX_PICKUP
	case 3636 // box of supplies
	case GENERICKEY
		 state GETITEMSETTINGS
	 break
	case 12087 // SW sword planted
	 state GETLOTAG
	 break
	case 16011
	case 29684
	 state GETHITAGLOTAG
	 break
	case SHIELD
		ife sector[].lotag 32767
		ife VOLUME 0
		ife LEVEL 7
			cactor HEAVYARMOUR
		state GETITEMSETTINGS
		break
	endswitch
endevent

defstate check_droptempweapon
	ifl drop_cooldown 1
		ifhitspace
	{
		add drop_counter 2

		// if shift is pressed, immediately allow swap
		ifand BITS_PRESS P_SPRINTING
			set drop_counter 15

		// or if sliding
		ifg knockback_slide 0
			set drop_counter 15

		ifg drop_counter 14
		{
			set player_swap 26

			// Clear special ammo types so we don't accidentally keep it for a weapon that doesn't use it
			ifn temp_weap tweap_index
				setarray AMMO_TYPES[0] 0

			state drop_tempweapon
			set drop_counter 0
			set drop_cooldown 15
			ifactor GOROHEADSPRITE { ifrnd 128 sound GIB_LAND2 else sound GIB_LAND1 }
			else ifactor RIPPER_HEART { ifrnd 128 sound GIB_LAND2 else sound GIB_LAND1 }
            else soundonce ENDSEQVOL2SND1
		}
	}
ends

defstate set_mdflags
seta[].mdflags 16
ife opt_high_vis_items YES { ifand command 16 nullop else xor command 16 }
else ife opt_high_vis_items NO { ifand command 16 xor command 16 }
ends

defstate ITEMSETTINGS
state set_mdflags
ife opt_high_vis_items YES { ifand command 16 nullop else xor command 16 }
else ife opt_high_vis_items NO { ifand command 16 xor command 16 }
ifand sprite[].cstat 16 action DECORATION else
ifand sprite[].cstat 32768 nullop else { fall cstat 0 }
ifn XVELSAVED 0
	{
	ife CHARSELECT 0
		{
		ifand XVELSAVED 1 ifn CHAR 0 killit
		ifand XVELSAVED 2 ifn CHAR 1 killit
		ifand XVELSAVED 4 ifn CHAR 2 killit
		ifand XVELSAVED 8 ifn CHAR 3 killit
		ifand XVELSAVED 16 ifn CHAR 4 killit
		ifand XVELSAVED 32 ifn CHAR 5 killit
		ifand XVELSAVED 64 ifn CHAR 6 killit
		ifand XVELSAVED 128 ifn CHAR 7 killit
		ifand XVELSAVED 256 ifn CHAR 13 killit
		}
	}
ends

defstate RADIO_KEY_SOUNDS
ife CHAR 0 set playsound J_GOTKEY
ife CHAR 1 set playsound Z_GOTKEY
ife CHAR 2 set playsound M_GOTKEY
ife CHAR 3 set playsound R_GOTKEY
ife CHAR 4 set playsound S_GOTKEY
ife CHAR 5 set playsound RN_GOTKEY
ife CHAR 6 set playsound G_GOTKEY
ife CHAR 7 set playsound MS_GOTKEY
ife CHAR 13 set playsound MC_GOTKEY
ife CHAR 17 set playsound KG_GOTKEY
	soundoncevar playsound
	ife fake_shrunk 1 setactorsoundpitch THISACTOR playsound 512
ends

spriteshadow STEROIDS
actor STEROIDS
state set_mdflags
state ITEMSETTINGS


  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk
      nullop
    else
      ifp palive
        ifcount 6
          ifpdistl RETRIEVEDISTANCE // quote check OK
            ifpinventory GET_STEROIDS STEROID_AMOUNT
              ifcanseetarget
				  {
				  ife player[].steroids_amount 0
					  {
					  setp[].inven_icon 2
					  setp[].invdisptime 60
					  }
					set booster_amount STEROID_AMOUNT
					addinventory GET_STEROIDS STEROID_AMOUNT
					setarray picked_up_inven[2] 60
					state PICKUP_DISPLAY
					getav[PLAYER_IDENTITY].c_steroids picked_up_tile
					set item_amount 100

					// info quote depends on character

					switch CHAR
						case C_JAMES
							userquote 1741
							break
						case C_ZAXTOR
							userquote 1742
							break
						case C_MERLIJN
							userquote 1743
							break
						case C_HIGHWIRE
							userquote 1744
							break
						case C_SANG
							userquote 1745
							break
						case C_RUSTY
							userquote 1746
							break
						case C_GEOFFREY
							userquote 1747
							break
						case C_MIKKO
							userquote 1748
							break
						case C_CULTIST
							break
						case C_BOMBSHELL
							break
						case C_MAARTEN
							break
						case C_JANE
							break
						case C_MICKY
							userquote 1749
							break
						case C_SNOWFALL
							userquote 1750
							break
						case C_KAGURA
							userquote 1751
							break
						default
							break
					endswitch


					ifspawnedby STEROIDS
					  state getcode
					else
					  state quikget
				  }
enda

spriteshadow BOOTS
actor BOOTS
    state set_mdflags
    state ITEMSETTINGS
    ifmove RESPAWN_ACTOR_FLAG
        state respawnit
    else ifp pshrunk
        nullop
    else
      ifp palive
        ifcount 6
          ifpdistl RETRIEVEDISTANCE // quote check ok
              ifcanseetarget
    {
        set temp BOOT_AMOUNT
        ife PERSONNEL_RESEARCH[26] 2 // protector drone acid topic?
        {
            ife CHAR 7 set temp 700
			else ife CHAR 11 set temp 500
            else ife CHAR 2 set temp 500
            else set temp 300
        }
        else
        {
            ife CHAR 7 set temp 600
			else ife CHAR 11 set temp 400
            else ife CHAR 2 set temp 400
        }

        // stop here if we have more than max boot amount
        ifge player[].boot_amount temp
            break
        setp[].boot_amount temp

        setarray picked_up_inven[7] 60
        state PICKUP_DISPLAY
        getav[PLAYER_IDENTITY].c_boots picked_up_tile
        set item_amount -1
        setp[].invdisptime 60

		userquote 1704

        ifspawnedby BOOTS
            state getcode
        else
            state quikget
      }
enda

spriteshadow GHOST_GOGGLES
useractor notenemy GHOST_GOGGLES


ifaction 0
	{
	sizeat 40 40
	action ZERO
	readarrayfromfile EQUIPMENT_FOUND F_EQUIPMENT_FOUND_AMCTC
	cstat 0
	}

    ifp pshrunk
      nullop
  else
    ifp palive
      ifcount 6
        ifpdistl RETRIEVEDISTANCE // quote check ok
            ifcanseetarget
			{
			  setarray HELMET_LOADOUT[CHAR] 4
			  addinventory GET_HEATS HEAT_AMOUNT

					ife EQUIPMENT_FOUND[6] 0
						{
						userquote 3038
						setarray EQUIPMENT_FOUND[6] 1
						writearraytofile EQUIPMENT_FOUND F_EQUIPMENT_FOUND_AMCTC
						globalsound FOUND_EQUIPMENT
						palfrom 20 60 60 60
						}
					else
					{
						userquote 1705
					}
						   setarray picked_up_inven[5] 60
						   state PICKUP_DISPLAY
						   set picked_up_tile GHOST_GOGGLES
						   set item_amount 100
						   setp[].invdisptime 60
				  state quikget
			  }

enda

spriteshadow HEATSENSOR
actor HEATSENSOR
state set_mdflags
state ITEMSETTINGS


  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk
      nullop
  else
    ifp palive
      ifcount 6
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifpinventory GET_HEATS HEAT_AMOUNT
            ifcanseetarget
      {
		  ife player[].heat_amount 0
			  {
			  setp[].inven_icon 5
			  setp[].invdisptime 60
			  }
		  addinventory GET_HEATS HEAT_AMOUNT

		   setarray picked_up_inven[5] 60
		   state PICKUP_DISPLAY
		   getav[PLAYER_IDENTITY].c_nvg_normal picked_up_tile
		   set item_amount 100
			userquote 1706

			ifspawnedby HEATSENSOR
			  state getcode
			else
			  state quikget
      }
enda

spriteshadow HEAVYARMOUR
useractor notenemy HEAVYARMOUR
state set_mdflags


state ITEMSETTINGS
sizeat 24 24

  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
    ifp palive
	 ifcount 6
	  ifpdistl RETRIEVEDISTANCE // quote check ok
	   ifl PARMOUR 200
        ifcanseetarget
		{
	    state PICKUP_DISPLAY
		getav[PLAYER_IDENTITY].c_heavy_armour picked_up_tile
		set item_amount 200
        setp[].shield_amount 200
		userquote 1707
        ifspawnedby HEAVYARMOUR state getcode
        else state quikget
		}
enda

spriteshadow SHIELD
actor SHIELD
state set_mdflags
state ITEMSETTINGS

  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifcount 6
          ifpdistl RETRIEVEDISTANCE // quote check ok
            ifl PARMOUR 100
              ifcanseetarget
			   ife CHARSELECT 0
		{
		ife CHEST_LOADOUT[CHAR] 4 // Spirit armour
			{
			ifl PARMOUR 50
			setp[].shield_amount 50
			ifl P_SPIRIT_ARMOUR 75 set P_SPIRIT_ARMOUR 75
			state PICKUP_DISPLAY
			getav[PLAYER_IDENTITY].c_armour picked_up_tile
			set item_amount 50
			state PICKUP_DISPLAY
			set picked_up_tile 117
			set item_amount 75
			}
			else
			{
			setp[].shield_amount 100
			state PICKUP_DISPLAY
			getav[PLAYER_IDENTITY].c_armour picked_up_tile
			set item_amount 100
			}

		userquote 1708
        ifspawnedby SHIELD
          state getcode
        else
          state quikget
      }
enda

spriteshadow AIRTANK
actor AIRTANK
state set_mdflags
state ITEMSETTINGS

  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifcount 6
          ifpdistl RETRIEVEDISTANCE // quote check ok
            ifpinventory GET_SCUBA SCUBA_AMOUNT
              ifcanseetarget
      {
	  ife CHAR 0 addinventory GET_SCUBA 12800 else
        addinventory GET_SCUBA SCUBA_AMOUNT

				   setarray picked_up_inven[6] 60
				   state PICKUP_DISPLAY
				   getav[PLAYER_IDENTITY].c_scuba picked_up_tile
				   set item_amount 100

		userquote 1709
        ifspawnedby AIRTANK
          state getcode
        else
          state quikget
      }
enda

spriteshadow HOLODUKE
actor HOLODUKE
state set_mdflags
ife CHAR 13
 ifspritepal 0
	{
	ife PERSONNEL_RESEARCH[2] 2 spritepal 16 else spritepal 3
	}
state ITEMSETTINGS

  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifcount 6
          ifpdistl RETRIEVEDISTANCE
            ifpinventory GET_HOLODUKE HOLOPLYR_AMOUNT
              ifcanseetarget
      {
		  ife player[].holoduke_amount 0
			  {
			  setp[].inven_icon 3
			  setp[].invdisptime 60
			  }
		  ife CHAR 0 ifg player[].holoduke_amount 899 break
		  ife CHAR 4 ifg player[].holoduke_amount 599 break
		  ife CHAR 6 ifg player[].holoduke_amount 299 break
		  ife CHAR 9 ifg player[].holoduke_amount 599 break
	    ife CHAR 0 addinventory GET_HOLODUKE 900
		else
	    ife CHAR 4
			{
			ifspawnedby LOST addinventory GET_HOLODUKE 200
			else ifspawnedby SPIRIT addinventory GET_HOLODUKE 200
			else addinventory GET_HOLODUKE 600
			}
		else
	    ife CHAR 6 addinventory GET_HOLODUKE 300
		else
	    ife CHAR 9 addinventory GET_HOLODUKE 600
		else
        addinventory GET_HOLODUKE HOLOPLYR_AMOUNT
		getp[].holoduke_amount holoduke_amount
		setarray picked_up_inven[3] 60
		state PICKUP_DISPLAY
		getav[PLAYER_IDENTITY].c_holoduke picked_up_tile
		ife CHAR 2 set item_amount -1 // Merlijn's shield
		else ife CHAR 3 set item_amount 2 // Highwire's radio
		else ife CHAR 5 set item_amount 3 // Rusty's belt
		else ife CHAR 7 set item_amount -1 // Mikko's backpack
		else ife CHAR 13 set item_amount -1 // Micky's turret
		else set item_amount 100
		// info quote depends on character

		switch CHAR
			case C_JAMES
				userquote 1752
				break
			case C_ZAXTOR
				userquote 1753
				break
			case C_MERLIJN
				userquote 1754
				break
			case C_HIGHWIRE
				userquote 1755
				break
			case C_SANG
				userquote 1756
				break
			case C_RUSTY
				userquote 1757
				break
			case C_GEOFFREY
				userquote 1758
				break
			case C_MIKKO
				userquote 1759
				break
			case C_CULTIST
				break
			case C_BOMBSHELL
				break
			case C_MAARTEN
				break
			case C_JANE
				break
			case C_MICKY
				userquote 1760
				break
			case C_SNOWFALL
				userquote 1761
				break
			case C_KAGURA
				userquote 1762
				break
			default
				break
		endswitch

        ifspawnedby HOLODUKE
          state getcode
        else
          state quikget
      }

enda

spriteshadow JETPACK
actor JETPACK
state set_mdflags
state ITEMSETTINGS

  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check OK
          ifcount 6
            ifpinventory GET_JETPACK JETPACK_AMOUNT
              ifcanseetarget
      {
		  ife player[].jetpack_amount 0
			  {
			  setp[].inven_icon 4
			  setp[].invdisptime 60
			  }
	  ife PERSONNEL_RESEARCH[28] 2
			{
			ife CHAR 14 addinventory GET_JETPACK 4000
			else addinventory GET_JETPACK 2400
			}
		else
			{
			ife CHAR 14 addinventory GET_JETPACK 3200
			else addinventory GET_JETPACK JETPACK_AMOUNT
			}

		setarray picked_up_inven[4] 60
		state PICKUP_DISPLAY
		getav[PLAYER_IDENTITY].c_jetpack picked_up_tile
		quote 88
		set item_amount 100

        ifspawnedby JETPACK
          state getcode
        else
          state quikget
      }
enda

defstate display_key
	state getfactornormalizedframerate
	set DISP_KEY -150
	mul DISP_KEY NORMALIZED_FACTOR
	set DISP_KEY_PIC sprite[].picnum
	set DISP_KEY_PAL sprite[].pal

	state PICKUP_DISPLAY
	set picked_up_tile sprite[].picnum
	set item_amount -1
ends

spriteshadow KEY_CARD
useractor notenemy KEY_CARD
sizeat 28 28
state ITEMSETTINGS

  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
      {
		switch sprite[].pal
		case 0
		case 21
		case 23
			 ifpinventory GET_ACCESS 0 break
			addinventory GET_ACCESS 1
			break
		endswitch

        ifspritepal 12 { ifand ACCESSKEY2 1 break else add ACCESSKEY2 1 } else
        ifspritepal 11 { ifand ACCESSKEY2 2 break else add ACCESSKEY2 2 } else
        ifspritepal 15 { ifand ACCESSKEY2 4 break else add ACCESSKEY2 4 } else
        ifspritepal 49 { ifand ACCESSKEY2 8 break else add ACCESSKEY2 8 } else
        ifspritepal 10 { ifand ACCESSKEY2 16 break else add ACCESSKEY2 16 } else
        ifspritepal 36 { ifand ACCESSKEY2 32 break else add ACCESSKEY2 32 } else
		ifspritepal 16 { ifand ACCESSKEY2 64 break else add ACCESSKEY2 64 }

		state display_key

		ifmultiplayer
			ife COOP 1
				{
				state RADIO_KEY_SOUNDS
				qgetsysstr 356 STR_PLAYERNAME
				qstrcat 356 663
				userquote 356
				}

        state getcode
      }
enda


useractor notenemy ACCESSCARD2
enda

spriteshadow 17031
useractor notenemy 17031 // Floppy disk
sizeat 14 14

  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
      {
        ifspritepal 0 { ifand FLOPPY_DISK 1 break else add FLOPPY_DISK 1 } else
        ifspritepal 11 { ifand FLOPPY_DISK 2 break else add FLOPPY_DISK 2 } else
        ifspritepal 21 { ifand FLOPPY_DISK 4 break else add FLOPPY_DISK 4 } else
        ifspritepal 23 { ifand FLOPPY_DISK 8 break else add FLOPPY_DISK 8 }

		state display_key

		ifmultiplayer
			ife COOP 1
				{
				state RADIO_KEY_SOUNDS
				qgetsysstr 356 STR_PLAYERNAME
				qstrcat 356 663
				userquote 356
				}

        state getcode
      }
enda

spriteshadow 25499
useractor notenemy 25499 // sextant
sizeat 24 24
ifrnd 1 spawn GLINT


    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
      {
        ifand WORLD_TRIGGER 32 nullop else xorvar WORLD_TRIGGER 32
		state display_key
        state getcode
      }
enda

spriteshadow 16219
useractor notenemy 16219 // mystic Ashes
sizeat 24 24
ifrnd 1 spawn GLINT


    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
      {
        ifand WORLD_TRIGGER 64 nullop else xorvar WORLD_TRIGGER 64
		ife CHAR 17
			{
			screensound KG_ASHES
			ife gp_subt 0
				{
				set subt_id 13020
				set gp_subt 95
				}
			}
		palfrom 10 64 64 64
		state display_key
        state getcode
      }
enda

spriteshadow 3349
useractor notenemy 3349 // organ sheet music
sizeat 16 16
ifrnd 1 spawn GLINT


    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
      {
        ifand WORLD_TRIGGER 1 nullop else xorvar WORLD_TRIGGER 1
		palfrom 10 64 64 64
		state display_key
        state getcode
      }
enda

spriteshadow SW_OLDKEY
useractor notenemy SW_OLDKEY
state set_mdflags
ifspritepal 23 spritepal 83
sizeat 32 32

  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
      {
        ifspritepal 15 { ifand SW_KEYS 16 break else add SW_KEYS 16 } else
        ifspritepal 12 { ifand SW_KEYS 32 break else add SW_KEYS 32 } else
        ifspritepal 23 { ifand SW_KEYS 64 break else add SW_KEYS 64 addlogvar SW_KEYS } else // failsafe incase I forgot to change an old key somewhere
		ifspritepal 83 { ifand SW_KEYS 64 break else add SW_KEYS 64 } else
        ifspritepal 10 { ifand SW_KEYS 128 break else add SW_KEYS 128 }

		state display_key

		ifmultiplayer
			ife COOP 1
				{
				state RADIO_KEY_SOUNDS
				qgetsysstr 356 STR_PLAYERNAME
				qstrcat 356 663
				userquote 356
				}

        state getcode
      }
enda

spriteshadow SW_TECHCARD
useractor notenemy SW_TECHCARD
state set_mdflags
  ifspritepal 3
  {
     changespritestat THISACTOR 0
     break
  }
sizeat 28 28

  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
      {
        ifspritepal 0 { ifand SW_KEYS 1 break else add SW_KEYS 1 } else
        ifspritepal 10 { ifand SW_KEYS 2 break else add SW_KEYS 2 } else
        ifspritepal 11 { ifand SW_KEYS 4 break else add SW_KEYS 4 } else
        ifspritepal 23 { ifand SW_KEYS 8 break else add SW_KEYS 8 }

		state display_key

		ifmultiplayer
			ife COOP 1
				{
				state RADIO_KEY_SOUNDS
				qgetsysstr 356 STR_PLAYERNAME
				qstrcat 356 663
				userquote 356
				}

        state getcode
      }
enda

spriteshadow BLUEPLUG
useractor notenemy BLUEPLUG
state set_mdflags
  ifspritepal 3
  {
     changespritestat THISACTOR 0
     break
  }
sizeat 28 28

    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
      {
        ifand PLUGKEY 1 break else
	  {
		add PLUGKEY 1
		palfrom 10 64 64 64
		state display_key
		state quikget
 		}
      }
enda

spriteshadow REDPLUG
useractor notenemy REDPLUG
state set_mdflags
  ifspritepal 3
  {
     changespritestat THISACTOR 0
     break
  }
sizeat 28 28

    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
      {
        ifand PLUGKEY 2 break else
	  {
		add PLUGKEY 2
		palfrom 10 64 64 64
		spritepal 21
		state display_key
		state quikget
 		}
      }
enda

spriteshadow YELLOWPLUG
useractor notenemy YELLOWPLUG
state set_mdflags
  ifspritepal 3
  {
     changespritestat THISACTOR 0
     break
  }
sizeat 28 28

    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
      {
        ifand PLUGKEY 4 break else
	  {
		add PLUGKEY 4
		palfrom 10 64 64 64
		spritepal 23
		state display_key
		state quikget
 		}
      }
enda

// ===============================================================HELL GATE KEYS=========================================

defstate HELLGKEYP
state set_mdflags
ifspritepal 3 break else
ifspritepal 8 break else
ifspritepal 27
	{
		ifactor BLOODCHALICE
			{
	        	ifand HELLGKEYS 1
				{
				spritepal 8
				seta[].shade -127
				}
				else
		  		{
				spritepal 27
				seta[].shade 15
	 			}
			}
		ifactor SOULBOX
			{
	        	ifand HELLGKEYS 2
				{
				spritepal 8
				seta[].shade -127
				}
				else
		  		{
				spritepal 27
				seta[].shade 15
	 			}
			}
		ifactor SKULLCROWN
			{
	        	ifand HELLGKEYS 4
				{
				spritepal 8
				seta[].shade -127
				}
				else
		  		{
				spritepal 27
				seta[].shade 15
	 			}
			}
		ifactor DARKBOOK
			{
	        	ifand HELLGKEYS 8
				{
				spritepal 8
				seta[].shade -127
				}
				else
		  		{
				spritepal 27
				seta[].shade 15
	 			}
			}
		ifactor BROKENTORCH
			{
	        	ifand HELLGKEYS 16
				{
				spritepal 8
				seta[].shade -127
				}
				else
		  		{
				spritepal 27
				seta[].shade 15
	 			}
			}
	}
else
	{

	ifrnd 1 spawn GLINT

	sizeat 20 20

	    ifp pshrunk nullop
	    else
	      ifp palive
	        ifpdistl RETRIEVEDISTANCE // quote check ok
	          ifcount 6
	            ifcanseetarget
	      {
		ifactor BLOODCHALICE
			{
	        	ifand HELLGKEYS 1 break else
		  		{
				add HELLGKEYS 1
				palfrom 10 64 64 64
				spritepal 23
				state display_key
				state quikget
	 			}
			}
		ifactor SOULBOX
			{
	        	ifand HELLGKEYS 2 break else
		  		{
				add HELLGKEYS 2
				palfrom 10 64 64 64
				spritepal 11
				state display_key
				state quikget
	 			}
			}
		ifactor SKULLCROWN
			{
	        	ifand HELLGKEYS 4 break else
		  		{
				add HELLGKEYS 4
				palfrom 10 64 64 64
				spritepal 15
				state display_key
				state quikget
	 			}
			}
		ifactor DARKBOOK
			{
	        	ifand HELLGKEYS 8 break else
		  		{
				add HELLGKEYS 8
				palfrom 10 64 64 64
				spritepal 21
				state display_key
				state quikget
	 			}
			}
		ifactor BROKENTORCH
			{
	        	ifand HELLGKEYS 16 break else
		  		{
				add HELLGKEYS 16
				palfrom 10 64 64 64
				spritepal 12
				state display_key
				state quikget
	 			}
			}
	      }
	}
ends


spritenopal BLOODCHALICE
spriteshadow BLOODCHALICE

spritenopal SOULBOX
spriteshadow SOULBOX

spritenopal SKULLCROWN
spriteshadow SKULLCROWN

spritenopal DARKBOOK
spriteshadow DARKBOOK

spritenopal BROKENTORCH
spriteshadow BROKENTORCH

useractor notenemy BLOODCHALICE state HELLGKEYP enda
useractor notenemy SOULBOX state HELLGKEYP enda
useractor notenemy SKULLCROWN state HELLGKEYP enda
useractor notenemy DARKBOOK state HELLGKEYP enda
useractor notenemy BROKENTORCH state HELLGKEYP enda


defstate OLDKEYSTATE
state set_mdflags
ifspritepal 0
{

ifaction 0
	{
	cstat 0
	sizeat 32 32
	state set_mdflags
	set command 256
	action ZERO
	}

ifrnd 1 spawn GLINT


  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
      {
        ifactor FLAMEKEY { ifand OLDKEYS 1 break else { add OLDKEYS 1 } } else
        ifactor SPIDERKEY { ifand OLDKEYS 2 break else { add OLDKEYS 2 } } else
        ifactor DAGGERKEY { ifand OLDKEYS 4 break else { add OLDKEYS 4 } } else
        ifactor MOONKEY { ifand OLDKEYS 8 break else { add OLDKEYS 8 } } else
        ifactor SKULLKEY { ifand OLDKEYS 16 break else { add OLDKEYS 16 } } else
		ifactor EYEKEY { ifand OLDKEYS 32 break else { add OLDKEYS 32 } } else
		ifactor DIAMOND_KEY { ifand NORMAL_KEYS 1 break else { add NORMAL_KEYS 1 } } else
		ifactor CLUB_KEY { ifand NORMAL_KEYS 2 break else { add NORMAL_KEYS 2 } } else
		ifactor SPADE_KEY { ifand NORMAL_KEYS 4 break else { add NORMAL_KEYS 4 } } else
		ifactor HEART_KEY { ifand NORMAL_KEYS 8 break else { add NORMAL_KEYS 8 } } else
		ifactor NORMAL_KEY5 { ifand NORMAL_KEYS 16 break else { add NORMAL_KEYS 16 } }

			palfrom 10 64 64 64
			spritepal 15
			state display_key

		ifmultiplayer
			ife COOP 1
				{
				state RADIO_KEY_SOUNDS
				qgetsysstr 356 STR_PLAYERNAME
				qstrcat 356 663
				userquote 356
				}

        state getcode
      }
}
ends

spriteshadow FLAMEKEY
useractor notenemy FLAMEKEY state OLDKEYSTATE enda

spriteshadow SPIDERKEY
useractor notenemy SPIDERKEY state OLDKEYSTATE enda

spriteshadow DAGGERKEY
useractor notenemy DAGGERKEY state OLDKEYSTATE enda

spriteshadow MOONKEY
useractor notenemy MOONKEY state OLDKEYSTATE enda

spriteshadow SKULLKEY
useractor notenemy SKULLKEY state OLDKEYSTATE enda

spriteshadow EYEKEY
useractor notenemy EYEKEY state OLDKEYSTATE enda

spriteshadow DIAMOND_KEY
useractor notenemy DIAMOND_KEY state OLDKEYSTATE enda

spriteshadow CLUB_KEY
useractor notenemy CLUB_KEY state OLDKEYSTATE enda

spriteshadow SPADE_KEY
useractor notenemy SPADE_KEY state OLDKEYSTATE enda

spriteshadow HEART_KEY
useractor notenemy HEART_KEY state OLDKEYSTATE enda

spriteshadow NORMAL_KEY5
useractor notenemy NORMAL_KEY5 state OLDKEYSTATE enda

spriteshadow RUNEKEY
useractor notenemy RUNEKEY
state set_mdflags
  ifspritepal 3
  {
     changespritestat THISACTOR 0
     break
  }
  sizeat 28 28

  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
      {
        ifspritepal 0 { ifand RUNEKEYS 1 break else xorvar RUNEKEYS 1 } else
        ifspritepal 21 { ifand RUNEKEYS 2 break else xorvar RUNEKEYS 2 } else
        ifspritepal 23 { ifand RUNEKEYS 4 break else xorvar RUNEKEYS 4 } else
        ifspritepal 12 { ifand RUNEKEYS 8 break else xorvar RUNEKEYS 8 } else
        ifspritepal 11 { ifand RUNEKEYS 16 break else xorvar RUNEKEYS 16 } else
        ifspritepal 49 { ifand RUNEKEYS 32 break else xorvar RUNEKEYS 32 }

		ifmultiplayer
			ife COOP 1
				{
				state RADIO_KEY_SOUNDS
				qgetsysstr 356 STR_PLAYERNAME
				qstrcat 356 663
				userquote 356
				}
		state display_key

        state getcode

      }
enda

// BLUE = Egypt Loke 1
// RED = Egypt Loke 2
// YELLOW = James Catacombs
// GREEN = James Catacombs
// PURPLE = James Catacombs
// LIGHT BLUE = Micky SS
// BROWN = Micky SS
// ORANGE = Egypt loke 3

// Grey =

spritenopal SCARABKEY
spriteshadow SCARABKEY

useractor notenemy SCARABKEY
state set_mdflags
  ifspritepal 3
  {
     changespritestat THISACTOR 0
     break
  }
sizeat 16 16

ifaction 0
{
state set_mdflags
 set command 32768
}


  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
      {
        ifspritepal 0 { ifand SCARABKEYS 1 break else xorvar SCARABKEYS 1 } else
        ifspritepal 21 { ifand SCARABKEYS 2 break else xorvar SCARABKEYS 2 } else
        ifspritepal 23 { ifand SCARABKEYS 4 break else xorvar SCARABKEYS 4 } else
        ifspritepal 11 { ifand SCARABKEYS 8 break else xorvar SCARABKEYS 8 } else
        ifspritepal 49 { ifand SCARABKEYS 16 break else xorvar SCARABKEYS 16 } else
        ifspritepal 35 { ifand SCARABKEYS 32 break else xorvar SCARABKEYS 32 } else
        ifspritepal 15 { ifand SCARABKEYS 64 break else xorvar SCARABKEYS 64 } else
        ifspritepal 37 { ifand SCARABKEYS 128 break else xorvar SCARABKEYS 128 } else
        ifspritepal 12 { ifand SCARABKEYS 256 break else xorvar SCARABKEYS 256 }

		state display_key

		ifmultiplayer
			ife COOP 1
				{
				state RADIO_KEY_SOUNDS
				qgetsysstr 356 STR_PLAYERNAME
				qstrcat 356 663
				userquote 356
				}
        state getcode
      }
enda

spriteshadow SWIPE_CARD

useractor notenemy SWIPE_CARD
state set_mdflags
  ifspritepal 3
  {
     changespritestat THISACTOR 0
     break
  }
cstat 0
sizeat 22 22

  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
			 ifvarn SWIPECARDS 64
      {
        ifspritepal 0 { ifand SWIPECARDS 1 break else xorvar SWIPECARDS 1 } else
        ifspritepal 21 { ifand SWIPECARDS 2 break else xorvar SWIPECARDS 2 } else
        ifspritepal 23 { ifand SWIPECARDS 4 break else xorvar SWIPECARDS 4 } else
        ifspritepal 12 { ifand SWIPECARDS 8 break else xorvar SWIPECARDS 8 } else
        ifspritepal 11 { ifand SWIPECARDS 16 break else xorvar SWIPECARDS 16 } else
        ifspritepal 49 { ifand SWIPECARDS 32 break else xorvar SWIPECARDS 32 } else
		ifspritepal 15 { ifand SWIPECARDS 128 break else xorvar SWIPECARDS 128 }

		ifmultiplayer
			ife COOP 1
				{
				state RADIO_KEY_SOUNDS
				qgetsysstr 356 STR_PLAYERNAME
				qstrcat 356 663
				userquote 356
				}
		state display_key
        state getcode

      }
enda

spriteshadow SWIPE_MASTER

useractor notenemy SWIPE_MASTER
state set_mdflags
cstat 0
sizeat 22 22

  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
      {
        setvar SWIPECARDS 64

		ifmultiplayer
			ife COOP 1
				{
				state RADIO_KEY_SOUNDS
				qgetsysstr 356 STR_PLAYERNAME
				qstrcat 356 663
				userquote 356
				}
			userquote 317
			spritepal 10
			state display_key

        state getcode

      }
enda

spriteshadow 21232
useractor notenemy 21232
state set_mdflags
ifaction 0
{
ife HITAGSAVED 1 cstat 32768
action FORM
}

ife HITAGSAVED 1
	{
		ifp palive
	     ifpdistl 2048
		  {
		  set player_use 0
		   ifhitspace
		      {
			  sound PUT_ON_EQUIP
			 ifaction ZERO break
			 ifn LOTAGSAVED 0
					{
					operateactivators LOTAGSAVED THISACTOR
					operaterespawns LOTAGSAVED
					operatemasterswitches LOTAGSAVED
					}
			   cstat 0
			   action ZERO
			   }
		  }

	}
else
	{
		ifp pshrunk nullop
		else
		  ifp palive
			ifpdistl 1024
		  {
			  ifn LOTAGSAVED 0
					{
					operateactivators LOTAGSAVED THISACTOR
					operaterespawns LOTAGSAVED
					operatemasterswitches LOTAGSAVED
					}
				state display_key
				state getcode
		  }
	}
enda

spriteshadow ABYSS_KEY
useractor notenemy ABYSS_KEY
state set_mdflags
  ifspritepal 3
  {
     changespritestat THISACTOR 0
     break
  }
fall

ifaction 0
	{
	sizeat 32 32
	state set_mdflags
	 set command 32768
	}

  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
      {
        ifspritepal 0 { ifand ABYSS_KEYS 1 break else xorvar ABYSS_KEYS 1 } else
        ifspritepal 21 { ifand ABYSS_KEYS 2 break else xorvar ABYSS_KEYS 2 } else
        ifspritepal 23 { ifand ABYSS_KEYS 4 break else xorvar ABYSS_KEYS 4 } else
        ifspritepal 11 { ifand ABYSS_KEYS 8 break else xorvar ABYSS_KEYS 8 } else
        ifspritepal 49 { ifand ABYSS_KEYS 16 break else xorvar ABYSS_KEYS 16 }

		state display_key

		ifmultiplayer
			ife COOP 1
				{
				state RADIO_KEY_SOUNDS
				qgetsysstr 356 STR_PLAYERNAME
				qstrcat 356 663
				userquote 356
				}

        state getcode

      }
enda

// weapons and ammo

spriteshadow AMMO
actor AMMO
state set_mdflags
state ITEMSETTINGS

  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifcount 6
          ifpdistl RETRIEVEDISTANCE // quote check ok
            ifcanseetarget
      {
	    ife CHAR 17
			{
			ifg KAGURA_CHARGE 9 break
			ifg KAGURA_CHARGE 9 { screensound YO_CHARGE set KAGURA_CHARGE 10 } else
			add KAGURA_CHARGE 2
			addphealth 5
			}
			else
		ife CHAR 2
			{
			ife merlijn_shield merlijn_shield_cap break else
			add merlijn_shield 5
			}
			else
			{
			getp[].ammo_amount 1 temp
			getp[].max_ammo_amount 1 temp2
			ife temp temp2 break
			add temp ammo_amount[1]
			ife SKILL_LEVEL 1 add temp ammo_amount[1]
			ifg temp temp2 set temp temp2
			setp[].ammo_amount 1 temp
			}

		setarray picked_up_gun[1] 30
		set weap_show 130
		state PICKUP_DISPLAY
		set picked_up_tile W_AMMO_TILE[1]
		set item_amount ammo_amount[1]


        ifspawnedby AMMO
          state getcode
        else
          state quikget
      }
enda

spriteshadow FREEZEAMMO
actor FREEZEAMMO
state set_mdflags
ife CHAR 4 set command 262144 // if Sang, set as magic item so it floats and glows
else set command 0
state ITEMSETTINGS

  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifcount 6
          ifpdistl RETRIEVEDISTANCE // quote check ok
            ifcanseetarget
      {
		ife CHAR 2
			{
			ife merlijn_shield merlijn_shield_cap break else
			add merlijn_shield 20
			}
		else
			{
			getp[].ammo_amount 9 temp
			getp[].max_ammo_amount 9 temp2
			ife temp temp2 break
			add temp ammo_amount[9]
			ife SKILL_LEVEL 1 add temp ammo_amount[9]
			ifg temp temp2 set temp temp2
			setp[].ammo_amount 9 temp
			}

		setarray picked_up_gun[9] 30
		set weap_show 130
		state PICKUP_DISPLAY
		set picked_up_tile W_AMMO_TILE[9]
		set item_amount ammo_amount[9]

        ifspawnedby FREEZEAMMO
          state getcode
        else
          state quikget
      }
enda

spriteshadow SHOTGUNAMMO
actor SHOTGUNAMMO
state set_mdflags
ife CHAR 4 set command 262144 // if Sang, set as magic item so it floats and glows
else set command 0
state ITEMSETTINGS

  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifcount 6
          ifpdistl RETRIEVEDISTANCE // quote check ok
            ifcanseetarget
      {
	    ife CHAR 17
		 ife SPECIALIST_EQUIPMENT[103] 2
			{
			ifg KAGURA_CHARGE 9 break
			ifg KAGURA_CHARGE 9 { screensound YO_CHARGE set KAGURA_CHARGE 10 } else
			add KAGURA_CHARGE 1
			addphealth 3
			}
		ife CHAR 2
			{
			ife merlijn_shield merlijn_shield_cap break else
			add merlijn_shield 10
			}
		else
			{
				set ammo_forweaponidx 2
				set ammo_to_add ammo_amount[2]
				ife SKILL_LEVEL 1
					mul ammo_to_add 2
				state do_addammo
			}

		setarray picked_up_gun[2] 30
		set weap_show 130
		state PICKUP_DISPLAY
		set picked_up_tile W_AMMO_TILE[2]
		set item_amount ammo_amount[2]

        ifspawnedby SHOTGUNAMMO
          state getcode
        else
          state quikget
      }
enda

actor AMMOLOTS
state set_mdflags
state ITEMSETTINGS

  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifcount 6
          ifpdistl RETRIEVEDISTANCE // quote check ok
            ifcanseetarget
      {
		ife CHAR 2
			{
			ife merlijn_shield merlijn_shield_cap break else
			add merlijn_shield 10
			}
		else
		{
		getp[].ammo_amount 1 temp
		getp[].max_ammo_amount 1 temp2
		ife temp temp2 break
		add temp ammo_amount[1]
		ifg temp temp2 set temp temp2
		ife SKILL_LEVEL 1 add temp ammo_amount[1]
		setp[].ammo_amount 1 temp
		}
		setarray picked_up_gun[1] 30
		set weap_show 130
		state PICKUP_DISPLAY
		set picked_up_tile W_AMMO_TILE[1]
		set item_amount ammo_amount[1]

        ifspawnedby AMMOLOTS
          state getcode
        else
          state quikget
      }
enda

spriteshadow CRYSTALAMMO
useractor notenemy CRYSTALAMMO
state set_mdflags

state ITEMSETTINGS
sizeat 32 32

ifaction 0 { seta[].shade -127 spriteflags 68 }
ifspritepal 0 nullop else { ifmultiplayer nullop else killit }


    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
      {

		getp[].ammo_amount 6 temp
		getp[].max_ammo_amount 6 temp2
		ife temp temp2 break
		add temp ammo_amount[6]
		ife SKILL_LEVEL 1 add temp ammo_amount[6]
		ifg temp temp2 set temp temp2
		setp[].ammo_amount 6 temp

		setarray picked_up_gun[6] 30
		set weap_show 130
		state PICKUP_DISPLAY
		set picked_up_tile W_AMMO_TILE[6]
		set item_amount ammo_amount[6]

        ifspawnedby CRYSTALAMMO
          state getcode
        else
          state quikget
      }
enda

spriteshadow GROWAMMO
actor GROWAMMO
state set_mdflags
state ITEMSETTINGS

  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
      {
	  ifand weap_special[6] 512 // no expander variant, give the player shrinker ammo instead
		{
		getp[].ammo_amount 6 temp
		getp[].max_ammo_amount 6 temp2
		ife temp temp2 break
		add temp ammo_amount[6]
		ife SKILL_LEVEL 1 add temp ammo_amount[6]
		ifg temp temp2 set temp temp2
		setp[].ammo_amount 6 temp

		setarray picked_up_gun[6] 30
		set weap_show 130
		state PICKUP_DISPLAY
		set picked_up_tile W_AMMO_TILE[6]
		set item_amount ammo_amount[6]
		}
		else
		{
		getp[].ammo_amount 11 temp
		getp[].max_ammo_amount 11 temp2
		ife temp temp2 break
		add temp ammo_amount[11]
		ifg temp temp2 set temp temp2
		setp[].ammo_amount 11 temp

		setarray picked_up_gun[6] 30
		set weap_show 130
		state PICKUP_DISPLAY
		set picked_up_tile W_AMMO_TILE[11]
		set item_amount ammo_amount[11]
		}

        ifspawnedby GROWAMMO
          state getcode
        else
          state quikget
      }
enda

spriteshadow BATTERYAMMO
actor BATTERYAMMO
state set_mdflags
state ITEMSETTINGS

  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
      {
		ife CHAR 2
			{
			ife merlijn_shield merlijn_shield_cap break else
			add merlijn_shield 15
			}
		else
			{
			getp[].ammo_amount 3 temp
			getp[].max_ammo_amount 3 temp2
			ife temp temp2 break
			add temp ammo_amount[3]
			ife SKILL_LEVEL 1 add temp ammo_amount[3]
			ifg temp temp2 set temp temp2
			setp[].ammo_amount 3 temp
			}

		setarray picked_up_gun[3] 30
		set weap_show 130
		state PICKUP_DISPLAY
		set picked_up_tile W_AMMO_TILE[3]
		set item_amount ammo_amount[3]

        ifspawnedby BATTERYAMMO
          state getcode
        else
          state quikget
      }
enda

spriteshadow DEVISTATORAMMO
actor DEVISTATORAMMO
state set_mdflags
state ITEMSETTINGS

  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
				  {
					getp[].ammo_amount 7 temp4
					getp[].max_ammo_amount 7 temp5
					ife temp4 temp5 break
					add temp4 ammo_amount[7]
					ife SKILL_LEVEL 1 add temp ammo_amount[7]
					ifg temp4 temp5 set temp4 temp5
					setp[].ammo_amount 7 temp4

					setarray picked_up_gun[7] 30
					set weap_show 130
					state PICKUP_DISPLAY
					set picked_up_tile W_AMMO_TILE[7]
					set item_amount ammo_amount[7]

					ifspawnedby DEVISTATORAMMO
					  state getcode
					else
					  state quikget
				  }
enda

spriteshadow RPGAMMO
actor RPGAMMO
state set_mdflags
ife CHAR 4 set command 262144 // if Sang, set as magic item so it floats and glows
else set command 0
state ITEMSETTINGS

  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else ifp palive
      ifpdistl RETRIEVEDISTANCE // quote check ok
        ifcount 6
          ifcanseetarget
      {
		getp[].ammo_amount 4 temp
		getp[].max_ammo_amount 4 temp2
		ife temp temp2 break
		add temp ammo_amount[4]
		ife SKILL_LEVEL 1 add temp ammo_amount[4]
		ifg temp temp2 set temp temp2
		setp[].ammo_amount 4 temp

		setarray picked_up_gun[4] 30
		set weap_show 130
		state PICKUP_DISPLAY
		set picked_up_tile W_AMMO_TILE[4]
		set item_amount ammo_amount[4]

        ifspawnedby RPGAMMO
          state getcode
        else
          state quikget
      }
enda

spriteshadow HBOMBAMMO
actor HBOMBAMMO
state set_mdflags
state ITEMSETTINGS

  ifmove RESPAWN_ACTOR_FLAG state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
      {
        ifgotweaponce 0
          break

        addweapon HANDBOMB_WEAPON 3

		setarray picked_up_gun[5] 30
		  set weap_show 130
		state PICKUP_DISPLAY
		set picked_up_tile W_AMMO_TILE[5]
		set item_amount 3

        ifspawnedby HBOMBAMMO
          state getweaponcode
        else
          state quikweaponget
      }
enda

// PIPEBOMB REPLACEMENT

spriteshadow 3689
useractor notenemy 3689
  state set_mdflags
state ITEMSETTINGS
cstat 256


ifaction ZERO sizeat 12 12 else
sizeat 32 32

  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
  ifp pshrunk nullop
  else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
			{
			addweapon HANDBOMB_WEAPON 1
			getp[].curr_weapon temp

			setarray picked_up_gun[5] 30
			  set weap_show 130

		state PICKUP_DISPLAY
		set picked_up_tile WEAPON_TILE[5]
		set item_amount 1


        ifspawnedby 3689
          state getcode
        else
          state quikget
			}


ifhitweapon
{
spawn EXPLOSION2
globalsound PIPEBOMB_EXPLODE
hitradius PIPEBOMBRADIUS 80 90 100 HANDBOMB_WEAPON_STRENGTH
killit
}

enda

spriteshadow RPGSPRITE
actor RPGSPRITE
  state set_mdflags
state ITEMSETTINGS

  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
      {
        ifgotweaponce 0
          break

       addweaponvar RPG_WEAPON ammo_amount[4]
		setarray picked_up_gun[4] 30
		  set weap_show 130
		state PICKUP_DISPLAY
		set picked_up_tile WEAPON_TILE[4]
		set item_amount ammo_amount[4]

        ifspawnedby RPGSPRITE
          state getweaponcode
        else
          state quikweaponget
      }
enda

spriteshadow SHOTGUNSPRITE
actor SHOTGUNSPRITE
  state set_mdflags
state ITEMSETTINGS

  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
      {

	 ife CHAR 13
	  ife SPECIALIST_EQUIPMENT[58] 2 // picking up the akimbo shotguns?
		{
		getp[].gotweapon 2 temp
		ifn temp 0 set PLAYER_VOICEOVER 44
		ife cur_weap 2 { ifand guns_akimbo 8 nullop else { xorvar gun_firemode_two 64 state lower_weapon } }
			ife temp 1 { ifand guns_akimbo 8 nullop else xorvar guns_akimbo 8 }
		}

	 ife CHAR 14
		{
		getp[].gotweapon 2 temp
		ife cur_weap 2 { ifand guns_akimbo 8 nullop else { xorvar gun_firemode_two 64 state lower_weapon } }
			ife temp 1 { ifand guns_akimbo 8 nullop else xorvar guns_akimbo 8 }
		}

		// Merlijn Recycle code
         ife player[].gotweapon 2 1 ife CHAR 2
			{
			// preventing farming by spawning by console or weapons machine
			ifspawnedby APLAYER break
			ifspawnedby 10570 break
		  state PICKUP_DISPLAY
		  set picked_up_tile 33
		  set item_amount 20
			ife POLYMERS 0 readgamevar POLYMERS
			add POLYMERS 20
			userquote 14010
			savegamevar POLYMERS
          state quikweaponget
			}

          ifgotweaponce 0
            break
          ife CHAR 1 { addweapon SHOTGUN_WEAPON 5 set item_amount 10 } else
		  ife CHAR 6 { addweapon SHOTGUN_WEAPON 6 set item_amount 6 } else
		  {
			addweaponvar SHOTGUN_WEAPON ammo_amount[2]
			set temp gun_ammopools[2]
			ifn temp -1
			{
				add temp ammo_amount[2]
				getp[].max_ammo_amount 2 temp2
				clamp temp 0 temp2
				setarray gun_ammopools[2] temp
			}

			set item_amount ammo_amount[2]
		  }
		setarray picked_up_gun[2] 30
		set weap_show 130
		state PICKUP_DISPLAY
		set picked_up_tile WEAPON_TILE[2]
        ifspawnedby SHOTGUNSPRITE
          state getweaponcode
        else
          state quikweaponget
      }
enda



// ***********************************************************************************************************************************
// temp WEAPONS===============================================================================================================

define RIOTGUN_MINIGUN_MK1_MAXAMOUNT 600
define RIOTGUN_MINIGUN_MK2_MAXAMOUNT 800

// Code for standard temporary weapons
defstate tweap_pickup_code
    // default ammocount
    ife tweap_init 0
    {
        ife YVELSAVED 0
            set YVELSAVED tweap_pickup_amount
		else ife YVELSAVED -900 // the dropped weapon had no NORMAL ammo remaining, but it DID have alt ammo remaining
		{
			// Don't add NORMAL ammo. It will stay at 0, and code executing in the player will catch that we need to swap.
			set YVELSAVED 0
		}
        set tweap_init 1
    }

    ifaction ZERO { ifpdistg RETRIEVEDISTANCE action 0 }

    // ZVEL == 1 --> AMC Base Pickup
    ife ZVELSAVED 1
    {
        ife WEAPONS_FOUND[tweap_index] 1 nullop else killit
        set ZVELSAVED 0
    }

    ifmove RESPAWN_ACTOR_FLAG
        state respawnit
    else ifp pshrunk
        nullop
    else
    ifaction 0
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
    {
        ife WEAPONS_FOUND[tweap_index] 0
        {
            setarray WEAPONS_FOUND[tweap_index] 1
			
			// ife we pick up the riotgun and the battlelord chaingun research was already researched, then unlock the riotgun minigun
			ife tweap_index 12
				ife WEAPONS_RESEARCH[RS_W_BATLCHAINGUN] 2
				ife WEAPONS_RESEARCH[RS_W_RIOTGUNMINI] 0
			{
				ifand new_research 1 nullop else xorvar new_research 1
				setarray WEAPONS_RESEARCH[RS_W_RIOTGUNMINI] 3
			}
            // unlock the MIA Gun research if you pick it up and finish the level
            ife tweap_index 14
                ife WEAPONS_RESEARCH[3] 0
					{
					set DISP_RES -240
					set DISP_RES_PAL 2
					set DISP_RES_PIC MIAGUNSPRITE
					ifand new_research 1 nullop else xorvar new_research 1
                    setarray WEAPONS_RESEARCH[3] 1
					}
			// unlock the Engineer SMG research if you pick it up and finish the level
            ife tweap_index 47
                ife WEAPONS_RESEARCH[12] 0
					{
					set DISP_RES -240
					set DISP_RES_PAL 2
					set DISP_RES_PIC ENG_SMG_SPRITE
					ifand new_research 1 nullop else xorvar new_research 1
                    setarray WEAPONS_RESEARCH[12] 1
					}
            set array_save 1
        }

        // special cases: replace temp weapon with character gun
        set temp5 0
        switch tweap_index
            case 10 // Sawn-off
                ife CHAR 9 // Cultist
                {
                    set temp5 1
                    addweapon SHOTGUN_WEAPON 8
                    state quikweaponget
                }
                break
            case 11 // Tommygun
                ife CHAR 9 // Cultist
                {
                    set temp5 1
                    addweapon CHAINGUN_WEAPON 50
                    state quikweaponget
                }
                break
            case 13 // crossbow
            case 50 // RW crossbow
                ife CHAR 11 // Maarten
                {
                    set temp5 1
                    addweapon SHOTGUN_WEAPON 8
                    state quikweaponget
                }
                break
        endswitch

        ife temp5 1
            nullop
        // if we have no temporary weapon
        else ife temp_weap 0
        {
            // weapon-specific stuff
            switch tweap_index
                case 6 // pigcop shotgun
                    sound SHOTGUN_COCK2
                    break
                case 10 // Sawnoff
                    sound GET_GUN
                    set temp_wep_mag 2
                    state lower_weapon
                    break
                case 12 // Riot Gun
                    sound RIOTGUN_COCK
                    break
                case 26 // AK 104
                    set temp_wep_mag YVELSAVED
                    ifg temp_wep_mag 30 set temp_wep_mag 30
                    break
                case 31 // M60
                    // mag size
                    ifl YVELSAVED 100 set temp_wep_mag YVELSAVED
                    else set temp_wep_mag 100
                    break
                case 35 // Calico M960
                    // mag size
                    ifl YVELSAVED 50 set temp_wep_mag YVELSAVED else
                    set temp_wep_mag 50
                    break
				case 44
					sound PUT_ON_EQUIP
					palfrom 64 0 0 0
					set JUGGERN_SUIT 1
					set just_changed 1
					break
                case 56 // mossberg shotgun
                    sound MOSSB_PUMP
                    break
            endswitch

            set temp_weap tweap_index
            setp[].ammo_amount 0 YVELSAVED
            set item_amount YVELSAVED
			set normal_ammo YVELSAVED

            setarray picked_up_gun[0] 30
            setarray picked_up_inven[1] 60
            set weap_show 130
            state PICKUP_DISPLAY
            set picked_up_tile tweap_picnum

            state quikweaponget
        }
        // if we have another temporary weapon
        else ifn temp_weap tweap_index
        {
            set player_swap 0
            set swap_tile tweap_picnum
            state check_droptempweapon
        }
        // if it's equal, try to add ammo instead
        else
        {
			set ammo_forweaponidx 0
			state ammo_getdefs

            ifl ammo_normalammoremaining tweap_max_amount
            {
                switch tweap_index
                    case 12
                        sound RIOTGUN_COCK
                        break
                    default
                        sound GET_GUN
                        break
                endswitch

                set item_amount YVELSAVED
                set temp2 tweap_max_amount
                sub temp2 ammo_normalammoremaining
                ifl temp2 item_amount
                    set item_amount temp2

                add ammo_normalammoremaining item_amount
                setp[].ammo_amount 0 ammo_normalammoremaining
				set normal_ammo ammo_normalammoremaining

                setarray picked_up_gun[0] 30
                set weap_show 130
                state PICKUP_DISPLAY
                set picked_up_tile tweap_picnum

                state quikweaponget
            }
        }
    }
ends


// Code for temporary weapons that don't refill ammo
defstate tweap_pickup_code_noammorefill

    // default ammocount
    ife tweap_init 0
    {
        ife YVELSAVED 0
        set YVELSAVED tweap_pickup_amount
        set tweap_init 1
    }

    // this prevents immediately picking up the weapon if it spawns on top of the player
    ifaction ZERO { ifpdistg RETRIEVEDISTANCE action 0 }

    // ZVEL == 1 --> AMC Base Pickup
    ife ZVELSAVED 1
    {
        ife WEAPONS_FOUND[tweap_index] 1 nullop else killit
        set ZVELSAVED 0
    }

    ifmove RESPAWN_ACTOR_FLAG
        state respawnit
    else ifp pshrunk
        nullop
    else
    ifaction 0
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
    {
        ife WEAPONS_FOUND[tweap_index] 0 { setarray WEAPONS_FOUND[tweap_index] 1 set array_save 1 }

        ife temp_weap 0
        {
            // weapon-specific stuff
            switch tweap_index
                case 17 //chainsaw
                    soundonce CHAINSAW_UP
                    ifrnd 128 quote 230 else quote 231
                    break
                case 20 // bloody mop
                    ife tweap_picnum BLOODY_MOPSPRITE
                        set WEP0_BLOODY 2
                    break
            endswitch

            set temp_weap tweap_index
            setp[].ammo_amount 0 YVELSAVED

            ife tweap_no_disp_ammo 1
                set item_amount -1
            else
                set item_amount YVELSAVED

            setarray picked_up_gun[0] 30
            setarray picked_up_inven[1] 60
            set weap_show 130
            state PICKUP_DISPLAY
            set picked_up_tile tweap_picnum

            state quikweaponget
        }
        else
        {
            ife temp_weap tweap_index
            {
                // check if weapon should be swapped with itself -- non-refillable weapons with ammo
                ife tweap_do_self_swap 1
                {
                    set player_swap 0
                    set swap_tile tweap_picnum
                    state check_droptempweapon
                }
            }
            else
            {
                // swap with different weapon
                ife tweap_index 20 // bloody mop
                  ife tweap_picnum BLOODY_MOPSPRITE
                    set WEP0_BLOODY 1

                set player_swap 0
                set swap_tile tweap_picnum
                state check_droptempweapon
            }
        }
    }
ends

// temp weapon 1 - Mini Shrinker
spriteshadow MINISHRINKERSPRITE
useractor notenemy MINISHRINKERSPRITE
    sizeat 24 24
    state ITEMSETTINGS
    set tweap_index 1
    set tweap_picnum sprite[].picnum
    set tweap_pickup_amount 10
    set tweap_max_amount 10
    state tweap_pickup_code
enda

// temp weapon 2 - Barrett Sniper Rifle
spriteshadow BARRETTRIFLESPRITE
useractor notenemy BARRETTRIFLESPRITE
    ife tweap_init 0
    {
        sizeat 22 22
        set tweap_index 2
        set tweap_picnum sprite[].picnum
        set tweap_pickup_amount 10
        set tweap_max_amount 20
    }
    state ITEMSETTINGS
    state tweap_pickup_code
enda

// temp weapon 3 - Akimbo SMGs
spriteshadow SMGSPRITE
useractor notenemy SMGSPRITE

    ife tweap_init 0
    {
        sizeat 22 22
        set tweap_index 3
        set tweap_picnum sprite[].picnum
        set tweap_pickup_amount 50
        set tweap_max_amount 200
    }

    state ITEMSETTINGS
    state tweap_pickup_code
enda

// temp weapon 4 - Blood Staff
spriteshadow BLOODSTAFFSPRITE
useractor notenemy BLOODSTAFFSPRITE
    ife tweap_init 0
    {
        sizeat 24 24
        set tweap_index 4
        set tweap_picnum sprite[].picnum
        set tweap_pickup_amount 200
        set tweap_max_amount 616
        set tweap_do_self_swap 1
        set tweap_no_disp_ammo 0
    }
    state ITEMSETTINGS
    state tweap_pickup_code_noammorefill
enda

// temp weapon 5 - Enforcer Chaingun
spriteshadow LIZMANGUNSPRITE
useractor notenemy LIZMANGUNSPRITE
    ife tweap_init 0
    {
        sizeat 26 26
        set tweap_index 5
        set tweap_picnum sprite[].picnum
        set tweap_pickup_amount 50
        set tweap_max_amount 200
    }
    state ITEMSETTINGS
    state tweap_pickup_code
enda

// temp weapon 6 - Police Shotgun
spriteshadow PIGCOPGUNSPRITE
useractor notenemy PIGCOPGUNSPRITE
    ife tweap_init 0
    {
        sizeat 26 26
        set tweap_index 6
        set tweap_picnum sprite[].picnum
        set tweap_pickup_amount 5
        set tweap_max_amount 25
    }
    state ITEMSETTINGS
    state tweap_pickup_code
enda

// temp weapon 7 - Skull Duster
spriteshadow SKULLDUSTERSPRITE
useractor notenemy SKULLDUSTERSPRITE
    ife tweap_init 0
    {
        sizeat 24 24
        set tweap_index 7
        set tweap_picnum sprite[].picnum
        set tweap_pickup_amount 200
        set tweap_max_amount 616
        set tweap_do_self_swap 1
        set tweap_no_disp_ammo 0
    }
    state ITEMSETTINGS
    state tweap_pickup_code_noammorefill
enda

// temp weapon 8 - Flesh Squirter
spriteshadow FLESHSQUIRTERSPRITE
useractor notenemy FLESHSQUIRTERSPRITE
    ife tweap_init 0
    {
        sizeat 20 20
        set tweap_index 8
        set tweap_picnum sprite[].picnum
        set tweap_pickup_amount 100
        set tweap_max_amount 616
        set tweap_do_self_swap 1
        set tweap_no_disp_ammo 0
    }
    state ITEMSETTINGS
    state tweap_pickup_code_noammorefill
enda

// temp weapon 9 - Stygian Warcannon
spriteshadow STYGIANGUNSPRITE
useractor notenemy STYGIANGUNSPRITE
    ife tweap_init 0
    {
        sizeat 26 26
        set tweap_index 9
        set tweap_picnum sprite[].picnum
        set tweap_pickup_amount 75
        set tweap_max_amount 616
        set tweap_do_self_swap 1
        set tweap_no_disp_ammo 0
    }
    state ITEMSETTINGS
    state tweap_pickup_code_noammorefill
enda

// temp weapon 10 - Sawn-off Shotgun
spriteshadow SAWNOFFSPRITE
useractor notenemy SAWNOFFSPRITE
    ife tweap_init 0
    {
        sizeat 20 20
        set tweap_index 10
        set tweap_picnum sprite[].picnum
        set tweap_pickup_amount 10
        set tweap_max_amount 50
    }
    state ITEMSETTINGS
    state tweap_pickup_code
enda

// temp weapon 11 - Tommy Gun
spriteshadow TOMMYGUNSPRITE
useractor notenemy TOMMYGUNSPRITE
    ife tweap_init 0
    {
        sizeat 26 26
        set tweap_index 11
        set tweap_picnum sprite[].picnum
        set tweap_pickup_amount 50
        set tweap_max_amount 200
    }

    state ITEMSETTINGS
    state tweap_pickup_code
enda

// temp weapon 12 - Riot Gun Sprite
spriteshadow RIOTGUNSPRITE
useractor notenemy RIOTGUNSPRITE
    ife tweap_init 0
    {
        sizeat 30 30
        set tweap_index 12
        set tweap_picnum sprite[].picnum
        set tweap_pickup_amount 12
        set tweap_max_amount 48
    }
    state ITEMSETTINGS
    state tweap_pickup_code
enda

// temp weapon 13 - Crossbow
spriteshadow CROSSBOWSPRITE
useractor notenemy CROSSBOWSPRITE
    ife tweap_init 0
    {
        sizeat 24 24
        set tweap_index 13
        set tweap_picnum sprite[].picnum
        set tweap_pickup_amount 10
        set tweap_max_amount 50
    }

	ifn EXTRASAVED -2 // not the tutorial item
	  ifn EXTRASAVED -3
	{
		state ITEMSETTINGS
		state tweap_pickup_code
	}
	else ife EXTRASAVED -3 // spawn crossbow when used
	{
		ifpdistl 1526
		  ifp pfacing
		  ifp palive
		{
			set player_use 0
			ife use_action_allowed 1
			{
				set hit_key 30
				espawn CROSSBOWSPRITE
				seta[RETURN].x player[].posx
				seta[RETURN].y player[].posy
				seta[RETURN].z player[].posz
				state setIgnoreUse
			}

		}
	}
enda

// temp weapon 14 - "Missing in Action" Gun
spriteshadow MIAGUNSPRITE
useractor notenemy MIAGUNSPRITE
    ife tweap_init 0
    {
        sizeat 20 20
        set tweap_index 14
        set tweap_picnum sprite[].picnum
        set tweap_pickup_amount 10
        set tweap_max_amount 10
    }
    state ITEMSETTINGS
    ife ZVELSAVED 2 // check to see if the player's researched this
    {
        readarrayfromfile WEAPONS_RESEARCH F_WEAPONS_AMCTC
        ife WEAPONS_RESEARCH[3] 2 nullop else killit
        set ZVELSAVED 0
    }
    state tweap_pickup_code
enda

// temp weapon 15 - Laser Gun
spriteshadow LASERGUNSPRITE
useractor notenemy LASERGUNSPRITE
    ife tweap_init 0
    {
        sizeat 18 18
        set tweap_index 15
        set tweap_picnum sprite[].picnum
        set tweap_pickup_amount 10
        set tweap_max_amount 50
    }
    state ITEMSETTINGS
    state tweap_pickup_code
enda

// temp weapon 16 - RPG Missile Launcher
spriteshadow TMISSILELSPRITE
useractor notenemy TMISSILELSPRITE
    ife tweap_init 0
    {
        sizeat 18 18
        set tweap_index 16
        set tweap_picnum sprite[].picnum
        set tweap_pickup_amount 5
        set tweap_max_amount 20
    }
    state ITEMSETTINGS
    state tweap_pickup_code
enda

// temp weapon 17 - Chainsaw
spriteshadow CHAINSAWSPRITE
useractor notenemy CHAINSAWSPRITE
    ife tweap_init 0
    {
        sizeat 32 32
        set tweap_index 17
        set tweap_picnum sprite[].picnum
        set tweap_pickup_amount 200
        set tweap_max_amount 200
        set tweap_do_self_swap 0
        set tweap_no_disp_ammo 1
    }
    state ITEMSETTINGS
    state tweap_pickup_code_noammorefill
enda

// temp weapon 18 - Flamethrower
spriteshadow FLAMETHROWERSPRITE
useractor notenemy FLAMETHROWERSPRITE
    ife tweap_init 0
    {
        sizeat 26 26
        set tweap_index 18
        set tweap_picnum sprite[].picnum
        set tweap_pickup_amount 50
        set tweap_max_amount 300
    }
    state ITEMSETTINGS
    ife ZVELSAVED 2 // check to see if the player's researched this
    {
        readarrayfromfile WEAPONS_RESEARCH F_WEAPONS_AMCTC
        ife WEAPONS_RESEARCH[5] 2 nullop else killit
        set ZVELSAVED 0
    }
    state tweap_pickup_code
enda

// temp weapon 19 - Katana
spriteshadow SWORDSPRITE
useractor notenemy SWORDSPRITE
    ife tweap_init 0
    {
        sizeat 22 22
        set tweap_index 19
        set tweap_picnum sprite[].picnum
        set tweap_pickup_amount 1
        set tweap_max_amount 1
        set tweap_do_self_swap 0
        set tweap_no_disp_ammo 1
    }
    state ITEMSETTINGS
    state tweap_pickup_code_noammorefill
enda

// temp weapon 20 - Mop
spriteshadow MOPSPRITE
useractor notenemy MOPSPRITE
    ife tweap_init 0
    {
        sizeat 32 32
        set tweap_index 20
        set tweap_picnum sprite[].picnum
        set tweap_pickup_amount 1
        set tweap_max_amount 1
        set tweap_do_self_swap 0
        set tweap_no_disp_ammo 1
    }
    state ITEMSETTINGS
    state tweap_pickup_code_noammorefill
enda

// temp weapon 20 - Bloody Mop
spriteshadow BLOODY_MOPSPRITE
useractor notenemy BLOODY_MOPSPRITE
    ife tweap_init 0
    {
        sizeat 32 32
        set tweap_index 20
        set tweap_picnum sprite[].picnum
        set tweap_pickup_amount 1
        set tweap_max_amount 1
        set tweap_do_self_swap 0
        set tweap_no_disp_ammo 1
    }
    state ITEMSETTINGS
    state tweap_pickup_code_noammorefill
enda

// temp weapon 21 - FN FAL
spriteshadow FNFALSPRITE
useractor notenemy FNFALSPRITE
    ife tweap_init 0
    {
        sizeat 20 20
        set tweap_index 21
        set tweap_picnum sprite[].picnum
        set tweap_pickup_amount 50
        set tweap_max_amount 150
    }
    state ITEMSETTINGS
    state tweap_pickup_code
enda

// temp weapon 22 - MP40
spriteshadow MP40SPRITE
useractor notenemy MP40SPRITE
    ife tweap_init 0
    {
        sizeat 20 20
        set tweap_index 22
        set tweap_picnum sprite[].picnum
        set tweap_pickup_amount 50
        set tweap_max_amount 300
    }
    state ITEMSETTINGS
    state tweap_pickup_code
enda

// temp weapon 23 - IW PLASMA RIFLE
spriteshadow JPLASMASPRITE
useractor notenemy JPLASMASPRITE
    ife tweap_init 0
    {
        sizeat 24 24
        set tweap_index 23
        set tweap_picnum sprite[].picnum
        set tweap_pickup_amount 50
        set tweap_max_amount 300
    }
    state ITEMSETTINGS
    ife ZVELSAVED 2 // check to see if the player's researched this
    {
        readarrayfromfile WEAPONS_RESEARCH F_WEAPONS_AMCTC
        ife WEAPONS_RESEARCH[1] 2 nullop else killit
        set ZVELSAVED 0
    }
    state tweap_pickup_code
enda

// temp weapon 24 - Firelaser Enforcer Chaingun
spriteshadow LIZMANFGUNSPRITE
useractor notenemy LIZMANFGUNSPRITE
    ife tweap_init 0
    {
        sizeat 22 22
        set tweap_index 24
        set tweap_picnum sprite[].picnum
        set tweap_pickup_amount 50
        set tweap_max_amount 200
    }
    state ITEMSETTINGS
    ife ZVELSAVED 2 // check to see if the player's researched this
    {
        readarrayfromfile WEAPONS_RESEARCH F_WEAPONS_AMCTC
        ife WEAPONS_RESEARCH[2] 2 nullop else killit
        set ZVELSAVED 0
    }
    state tweap_pickup_code
enda

// temp weapon 25 - M16
spriteshadow M16SPRITE
useractor notenemy M16SPRITE
    ife tweap_init 0
    {
        sizeat 22 22
        set tweap_index 25
        set tweap_picnum sprite[].picnum
        set tweap_pickup_amount 50
        set tweap_max_amount 250
    }
    state ITEMSETTINGS
    state tweap_pickup_code
enda

// temp weapon 26 - AK104
spriteshadow AK114SPRITE
useractor notenemy AK114SPRITE
    ife tweap_init 0
    {
        sizeat 20 20
        set tweap_index 26
        set tweap_picnum sprite[].picnum
        set tweap_pickup_amount 50
        set tweap_max_amount 300
    }
    state ITEMSETTINGS
    state tweap_pickup_code
enda

// temp weapon 27 - RIOTGUN MINIGUN MK1
spriteshadow RIOTGUN_MINIGUN_SPRITE
useractor notenemy RIOTGUN_MINIGUN_SPRITE
    ife tweap_init 0
    {
        sizeat 26 26
        set tweap_index 27
        set tweap_picnum sprite[].picnum
        set tweap_pickup_amount 200
        set tweap_max_amount RIOTGUN_MINIGUN_MK1_MAXAMOUNT

        ife YVELSAVED 0
            set YVELSAVED tweap_pickup_amount
    }
    state ITEMSETTINGS
    ife ZVELSAVED 2 // check to see if the player's researched this
    {
        readarrayfromfile WEAPONS_RESEARCH F_WEAPONS_AMCTC
        ife WEAPONS_RESEARCH[6] 2 nullop else killit
        set ZVELSAVED 0
    }

    // Pick up MK1 while having MK2, add ammo, don't replace
    ifaction 0
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
              ife temp_weap 34
    {
        getp[].ammo_amount 0 temp
          ifl temp RIOTGUN_MINIGUN_MK2_MAXAMOUNT
				{
					sound RIOTGUN_COCK
					set item_amount YVELSAVED
					set temp2 RIOTGUN_MINIGUN_MK2_MAXAMOUNT // this is actually the max ammo of the other gun...
					sub temp2 temp
					ifl temp2 item_amount
						set item_amount temp2

					add temp item_amount
					setp[].ammo_amount 0 temp

					setarray picked_up_gun[0] 30
					setarray picked_up_inven[1] 60
					set weap_show 130
					state PICKUP_DISPLAY
					set picked_up_tile RIOTGUN_MINIGUN_MK2_SPRITE
					state quikweaponget
				}
        break
    }

    // standard code
    state tweap_pickup_code
enda

// temp weapon 28 - Nailgun
spriteshadow NAILGUN_SPRITE
useractor notenemy NAILGUN_SPRITE
    ife tweap_init 0
    {
        sizeat 22 22
        set tweap_index 28
        set tweap_picnum sprite[].picnum
        set tweap_pickup_amount 50
        set tweap_max_amount 300
    }
    state ITEMSETTINGS
    state tweap_pickup_code
enda

// temp weapon 29 - RIOTGUN GRENADE LAUNCHER
spriteshadow RIOTGUN_GRENADEL_SPRITE
useractor notenemy RIOTGUN_GRENADEL_SPRITE
    ife tweap_init 0
    {
        sizeat 26 26
        set tweap_index 29
        set tweap_picnum sprite[].picnum
        set tweap_pickup_amount 12
        set tweap_max_amount 60
    }
    state ITEMSETTINGS
    ife ZVELSAVED 2 // check to see if the player's researched this
    {
        readarrayfromfile WEAPONS_RESEARCH F_WEAPONS_AMCTC
        ife WEAPONS_RESEARCH[7] 2 nullop else killit
        set ZVELSAVED 0
    }
    state tweap_pickup_code
enda

// temp weapon 30 - Dart/Torpedo Gun
spriteshadow DARTGUN_SPRITE
useractor notenemy DARTGUN_SPRITE
    ife tweap_init 0
    {
        sizeat 20 20
        set tweap_index 30
        set tweap_picnum sprite[].picnum
        set tweap_pickup_amount 50
        set tweap_max_amount 300
    }
    state ITEMSETTINGS
    state tweap_pickup_code
enda

// temp weapon 31 - M60
spriteshadow M60_SPRITE
useractor notenemy M60_SPRITE
    ife tweap_init 0
    {
        sizeat 22 22
        set tweap_index 31
        set tweap_picnum sprite[].picnum
        set tweap_pickup_amount 100
        set tweap_max_amount 300
    }
    state ITEMSETTINGS
    state tweap_pickup_code
enda

// temp weapon 32 - ZILLA MISSILE LAUNCHER
spriteshadow ZMISSILELSPRITE
useractor notenemy ZMISSILELSPRITE
    ife tweap_init 0
    {
        sizeat 20 20
        set tweap_index 32
        set tweap_picnum sprite[].picnum
        set tweap_pickup_amount 10
        set tweap_max_amount 50
    }
    state ITEMSETTINGS
    state tweap_pickup_code
enda

// temp weapon 33 - GUARDIAN HEAD
spriteshadow GOROHEADSPRITE
useractor notenemy GOROHEADSPRITE
    ife tweap_init 0
    {
        sizeat 32 32
        set tweap_index 33
        set tweap_picnum sprite[].picnum
        set tweap_pickup_amount 50
        set tweap_max_amount 300
    }
    state ITEMSETTINGS
    state tweap_pickup_code
enda

// SPECIAL CASE
// temp weapon 34 - RIOTGUN MINIGUN MK2
spriteshadow RIOTGUN_MINIGUN_MK2_SPRITE
useractor notenemy RIOTGUN_MINIGUN_MK2_SPRITE
    ife tweap_init 0
    {
        sizeat 26 26
        set tweap_index 34
        set tweap_picnum sprite[].picnum
        set tweap_pickup_amount 200
        set tweap_max_amount RIOTGUN_MINIGUN_MK2_MAXAMOUNT

        ife YVELSAVED 0
            set YVELSAVED tweap_pickup_amount
    }
    state ITEMSETTINGS
    ife ZVELSAVED 2 // check to see if the player's researched this
    {
        readarrayfromfile WEAPONS_RESEARCH F_WEAPONS_AMCTC
        ife WEAPONS_RESEARCH[8] 2 nullop else killit
        set ZVELSAVED 0
    }

    ifaction 0
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
              ife temp_weap 27
    {
        getp[].ammo_amount 0 temp
          ifl temp RIOTGUN_MINIGUN_MK2_MAXAMOUNT
        {
            sound RIOTGUN_COCK
            set temp_weap 34
            set item_amount YVELSAVED
            set temp2 RIOTGUN_MINIGUN_MK2_MAXAMOUNT
            sub temp2 temp
            ifl temp2 item_amount
                set item_amount temp2

            add temp item_amount
            setp[].ammo_amount 0 temp

            setarray picked_up_gun[0] 30
            setarray picked_up_inven[1] 60
            set weap_show 130
            state PICKUP_DISPLAY
            set picked_up_tile sprite[].picnum
            state quikweaponget
        }
        break
    }
    state tweap_pickup_code
enda

// temp weapon 35 - Calico M960 (get your ass to Mars)
spriteshadow M960_SPRITE
useractor notenemy M960_SPRITE
    ife tweap_init 0
    {
        sizeat 24 24
        set tweap_index 35
        set tweap_picnum sprite[].picnum
        set tweap_pickup_amount 100
        set tweap_max_amount 400
    }
    state ITEMSETTINGS
    state tweap_pickup_code
enda

// temp weapon 36 - Shadow Realm Katana
spriteshadow SRSWORDSPRITE
useractor notenemy SRSWORDSPRITE
    ife tweap_init 0
    {
        sizeat 22 22
        set tweap_index 36
        set tweap_picnum sprite[].picnum
        set tweap_pickup_amount 1
        set tweap_max_amount 1
        set tweap_do_self_swap 0
        set tweap_no_disp_ammo 1
    }
    state ITEMSETTINGS
    state tweap_pickup_code_noammorefill
enda

// special case, do not change
// temp weapon 36 - Shadow Realm Sword planted
spriteshadow SRSWORD_PLANTED
useractor notenemy SRSWORD_PLANTED
    ifspritepal 24 break
    sizeat 20 20
    state ITEMSETTINGS

    ifaction ZERO { ifpdistg RETRIEVEDISTANCE action 0 }

    ifmove RESPAWN_ACTOR_FLAG
        state respawnit
    else
        ifp pshrunk nullop
    else
    ifaction 0
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
    {
        set player_use 0
        ife temp_weap 0
        ifhitspace
        {
            set temp_weap 36
            setp[].ammo_amount 0 1
            setarray picked_up_gun[0] 30
            set weap_show 130
            state PICKUP_DISPLAY
            set picked_up_tile 12200
            set item_amount -1
            operateactivators LOTAGSAVED THISACTOR
            operaterespawns LOTAGSAVED
            operatemasterswitches LOTAGSAVED
            sound DRAW_SWORD2
            addphealth 100
            state quikweaponget
        }
        else ifn temp_weap 36
        {
            set player_swap 0
            set swap_tile 12200
            ifhitspace
            {
                add drop_counter 2
                ifg drop_counter 14
                {
                    userquote 516
                    set player_swap 26
                    state drop_tempweapon
                    soundonce ENDSEQVOL2SND1
                    set drop_counter 0
                }
                operateactivators LOTAGSAVED THISACTOR
                operaterespawns LOTAGSAVED
                operatemasterswitches LOTAGSAVED
            }
        }
    }
enda

// SPECIAL CASE
// temp weapon 37 - Beam Sabre
spriteshadow BEAMSABRESPRITE
useractor notenemy BEAMSABRESPRITE
    ifspritepal 24 break
    sizeat 14 14
    state ITEMSETTINGS

    // once every 2 seconds
    ifpdistg RETRIEVEDISTANCE
    {
        set temp totalclock
        mod temp 240
        ife temp 0 spawn GLINT
    }

    // don't pick up when spawned on top of player
    ifaction ZERO { ifpdistg RETRIEVEDISTANCE action 0 }

    ifmove RESPAWN_ACTOR_FLAG
        state respawnit
    else
        ifp pshrunk nullop
    else
    ifaction 0
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
    {
        set player_use 0
        ife temp_weap 0
        {
            set temp_weap 37
            setp[].ammo_amount 0 1
            setarray picked_up_gun[0] 30
            set weap_show 130
            state PICKUP_DISPLAY
            set picked_up_tile sprite[].picnum
            set item_amount -1
            operateactivators LOTAGSAVED THISACTOR
            operaterespawns LOTAGSAVED
            operatemasterswitches LOTAGSAVED
            sound DRAW_SWORD2
            state quikweaponget
        }
        else ifn temp_weap 37
        {
            set player_swap 0
            set swap_tile sprite[].picnum
            ifhitspace
            {
                add drop_counter 2
                ifg drop_counter 14
                {
                    userquote 516
                    set player_swap 26
                    state drop_tempweapon
                    soundonce ENDSEQVOL2SND1
                    set drop_counter 0
                }
            operateactivators LOTAGSAVED THISACTOR
            operaterespawns LOTAGSAVED
            operatemasterswitches LOTAGSAVED
            }
        }
    }
enda

// temp weapon 38 - Ripper Heart
spriteshadow RIPPER_HEART
useractor notenemy RIPPER_HEART
    ife tweap_init 0
    {
        sizeat 32 32
        set tweap_index 38
        set tweap_picnum sprite[].picnum
        set tweap_pickup_amount 1
        set tweap_max_amount 1
        set tweap_no_disp_ammo 1
        set tweap_do_self_swap 0
    }
    state ITEMSETTINGS
    state tweap_pickup_code_noammorefill
enda

// temp weapon 39 - Zombie Chaingun
spriteshadow ZCHAINGUN_SPRITE
useractor notenemy ZCHAINGUN_SPRITE
    ife tweap_init 0
    {
        sizeat 24 24
        set tweap_index 39
        set tweap_picnum sprite[].picnum
        set tweap_pickup_amount 50
        set tweap_max_amount 300
    }
    state ITEMSETTINGS
    state tweap_pickup_code
enda

// temp weapon 40 - Railgun
spriteshadow RAILGUN_SPRITE
useractor notenemy RAILGUN_SPRITE
    ife tweap_init 0
    {
        sizeat 16 16
        set tweap_index 40
        set tweap_picnum sprite[].picnum
        set tweap_pickup_amount 10
        set tweap_max_amount 30
    }
    state ITEMSETTINGS
    state tweap_pickup_code
enda

// temp weapon 41 - AR65
spriteshadow AR65_SPRITE
useractor notenemy AR65_SPRITE
    ife tweap_init 0
    {
        sizeat 26 26
        set tweap_index 41
        set tweap_picnum sprite[].picnum
        set tweap_pickup_amount 120
        set tweap_max_amount 300
    }
    state ITEMSETTINGS
    state tweap_pickup_code
enda

// temp weapon 42 - Hell Nailer
spriteshadow HELL_NAILER_SPRITE
useractor notenemy HELL_NAILER_SPRITE
    ife tweap_init 0
    {
        sizeat 32 32
        set tweap_index 42
        set tweap_picnum sprite[].picnum
        set tweap_pickup_amount 200
        set tweap_max_amount 616
    }
    state ITEMSETTINGS
    state tweap_pickup_code
enda

// temp weapon 43 - Proto Shrinker
spriteshadow PROTO_SHRINKER_SPRITE
useractor notenemy PROTO_SHRINKER_SPRITE
    // Note: did not have this line originally:
    // ife WEAPONS_FOUND[tweap_index] 0 { setarray WEAPONS_FOUND[tweap_index] 1 set array_save 1 }
    // ZVEL AMC pickup code

    ife tweap_init 0
    {
        sizeat 26 26
        set tweap_index 43
        set tweap_picnum sprite[].picnum
        set tweap_pickup_amount 10
        set tweap_max_amount 10
    }
    state ITEMSETTINGS
    state tweap_pickup_code
enda

// temp weapon 45 - P90
spriteshadow P90_SPRITE
useractor notenemy P90_SPRITE
    ife tweap_init 0
    {
        sizeat 20 20
        set tweap_index 45
        set tweap_picnum sprite[].picnum
        set tweap_pickup_amount 50
        set tweap_max_amount 300
    }
    state ITEMSETTINGS
    state tweap_pickup_code
enda

// temp weapon 46 - Ogre Staff
spriteshadow OGRE_STAFF_SPRITE
useractor notenemy OGRE_STAFF_SPRITE
    ife tweap_init 0
    {
        sizeat 16 16
        set tweap_index 46
        set tweap_picnum sprite[].picnum
        set tweap_pickup_amount 100
        set tweap_max_amount 200
    }
    state ITEMSETTINGS
    state tweap_pickup_code
enda


// temp weapon 47 - Engineer SMG
spriteshadow ENG_SMG_SPRITE
useractor notenemy ENG_SMG_SPRITE
    ife tweap_init 0
    {
        sizeat 24 24
        set tweap_index 47
        set tweap_picnum sprite[].picnum
        set tweap_pickup_amount 100
        set tweap_max_amount 300
    }
    state ITEMSETTINGS
    state tweap_pickup_code
enda

// temp weapon 48 - Rotary Bolt Launcher
spriteshadow ROT_BOLT_SPRITE
useractor notenemy ROT_BOLT_SPRITE
    ife tweap_init 0
    {
        sizeat 24 24
        set tweap_index 48
        set tweap_picnum sprite[].picnum
        set tweap_pickup_amount 6
        set tweap_max_amount 30
    }
    state ITEMSETTINGS
    state tweap_pickup_code
enda

// temp weapon 49 - Axe
spriteshadow AXE_SPRITE
useractor notenemy AXE_SPRITE
    ife tweap_init 0
    {
        sizeat 18 18
        set tweap_index 49
        set tweap_picnum sprite[].picnum
        set tweap_pickup_amount 1
        set tweap_max_amount 1
        set tweap_do_self_swap 0
        set tweap_no_disp_ammo 1
    }
    state ITEMSETTINGS
    state tweap_pickup_code_noammorefill
enda

// temp weapon 50 - Ringworld Crossbow
spriteshadow RW_CROSSBOW_SPRITE
useractor notenemy RW_CROSSBOW_SPRITE
    ife tweap_init 0
    {
        sizeat 26 26
        set tweap_index 50
        set tweap_picnum sprite[].picnum
        set tweap_pickup_amount 10
        set tweap_max_amount 50
    }

	ifn EXTRASAVED -2 // not the tutorial item
	  ifn EXTRASAVED -3
	{
		state ITEMSETTINGS
		state tweap_pickup_code
	}
	else ife EXTRASAVED -3 // spawn crossbow when used
	{
		ifpdistl 1526
		  ifp pfacing
		  ifp palive
		{
			set player_use 0
			ife use_action_allowed 1
			{
				set hit_key 30
				espawn RW_CROSSBOW_SPRITE
				state setIgnoreUse
			}
		}
	}
enda

// temp weapon 51 - Vorpal Sword
spriteshadow VORPAL_SWORD_SPRITE
useractor notenemy VORPAL_SWORD_SPRITE
    ife tweap_init 0
    {
        sizeat 18 18
        set tweap_index 51
        set tweap_picnum sprite[].picnum
        set tweap_pickup_amount 1
        set tweap_max_amount 1
        set tweap_do_self_swap 0
        set tweap_no_disp_ammo 1
    }
    state ITEMSETTINGS
    state tweap_pickup_code_noammorefill
enda

// temp weapon 52 - UDP45
spriteshadow UDP45_SPRITE
useractor notenemy UDP45_SPRITE
    ife tweap_init 0
    {
        sizeat 20 20
        set tweap_index 52
        set tweap_picnum sprite[].picnum
        set tweap_pickup_amount 50
        set tweap_max_amount 300
    }
    state ITEMSETTINGS
    state tweap_pickup_code
enda

// temp weapon 55 - Phased plasma rifle
spriteshadow PHPLASMA_SPRITE
useractor notenemy PHPLASMA_SPRITE
    ife tweap_init 0
    {
        sizeat 36 36
        set tweap_index 55
        set tweap_picnum sprite[].picnum
        set tweap_pickup_amount 50
        set tweap_max_amount 400
    }
    state ITEMSETTINGS
    state tweap_pickup_code
enda

// temp weapon 56 - Mossberg Shotgun
spriteshadow MOSSBERG_SPRITE
useractor notenemy MOSSBERG_SPRITE
    ife tweap_init 0
    {
        sizeat 26 26
        set tweap_index 56
        set tweap_picnum sprite[].picnum
        set tweap_pickup_amount 5
        set tweap_max_amount 25
    }
    state ITEMSETTINGS
    state tweap_pickup_code
enda									   	
// ---------------------------------------------------------------------------------------------
// SPECIAL AMMO PICKUP

spriteshadow SILVERAMMO_DRUM
useractor notenemy SILVERAMMO_DRUM
    sizeat 24 24

ife ZVELSAVED 2 // check to see if the player's researched this
	{
	ife EQUIPMENT_RESEARCH[3] 2 nullop else killit
	set ZVELSAVED 0
	}

ifaction 0
{

action ZERO
}

state ITEMSETTINGS
  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
			 ifl silver_ammo 200
				{
				ife EQUIPMENT_RESEARCH[3] 0 { setarray EQUIPMENT_RESEARCH[3] 3 ifand new_research 2 nullop else xorvar new_research 2 set array_save 1 }
				add silver_ammo 50
				ifg silver_ammo 200 set silver_ammo 200

				state PICKUP_DISPLAY
				set picked_up_tile SILVERAMMO_DRUM
				set item_amount 50
			userquote 1736
			ifspawnedby SILVERAMMO_DRUM
			  state getcode
			else
			  state quikget
				}
enda

// incendiary ammo =========================

spriteshadow INCEND_AMMO_DRUM
useractor notenemy INCEND_AMMO_DRUM
    sizeat 24 24

ife ZVELSAVED 2 // check to see if the player's researched this
	{
	ife EQUIPMENT_RESEARCH[23] 2 nullop else killit
	set ZVELSAVED 0
	}

ifaction 0
{

action ZERO
}

state ITEMSETTINGS
  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
			 ifl incend_ammo 150
				{
				ife EQUIPMENT_RESEARCH[23] 0 { setarray EQUIPMENT_RESEARCH[23] 3 ifand new_research 2 nullop else xorvar new_research 2 set array_save 1 }
				add incend_ammo 50
				ifg incend_ammo 150 set incend_ammo 150

				state PICKUP_DISPLAY
				set picked_up_tile INCEND_AMMO_DRUM
				set item_amount 50
			userquote 1735
			ifspawnedby INCEND_AMMO_DRUM
			  state getcode
			else
			  state quikget
				}
enda

spriteshadow FORTYMM_NADES
useractor notenemy FORTYMM_NADES
sizeat 23 23


ife ZVELSAVED 2 // check to see if the player's researched this
	{
	ife EQUIPMENT_RESEARCH[13] 2 nullop else killit
	set ZVELSAVED 0
	}

state ITEMSETTINGS
  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
			 ifl fortymm_grenades 40
			{
			ife EQUIPMENT_RESEARCH[13] 0 { setarray EQUIPMENT_RESEARCH[13] 3 ifand new_research 2 nullop else xorvar new_research 2 set array_save 1 }

			ife CHAR 0 ife SPECIALIST_EQUIPMENT[77] 2 addammo 4 2 else
			ife CHAR 9 addammo 4 2 else
			add fortymm_grenades 2
			clamp fortymm_grenades 0 40

			state PICKUP_DISPLAY
			set picked_up_tile FORTYMM_NADES
			set item_amount 2
			userquote 1734
	        ifspawnedby FORTYMM_NADES
	          state getcode
	        else
	          state quikget
			}
enda

spriteshadow FORTYMM_CASELESS
useractor notenemy FORTYMM_CASELESS
sizeat 23 23


ife ZVELSAVED 2 // check to see if the player's researched this
	{
	ife EQUIPMENT_RESEARCH[14] 2 nullop else killit
	set ZVELSAVED 0
	}

state ITEMSETTINGS
  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
			 ifl fortymm_caseless 20
			{
			ife EQUIPMENT_RESEARCH[14] 0 { setarray EQUIPMENT_RESEARCH[14] 3 ifand new_research 2 nullop else xorvar new_research 2 set array_save 1 }
			add fortymm_caseless 2
			ifg fortymm_caseless 20 set fortymm_caseless 20

			state PICKUP_DISPLAY
			set picked_up_tile FORTYMM_CASELESS
			set item_amount 2
			userquote 1733
	        ifspawnedby FORTYMM_CASELESS
	          state getcode
	        else
	          state quikget
			}
enda

spriteshadow FORTYMM_SLUGS
useractor notenemy FORTYMM_SLUGS
sizeat 23 23


ife ZVELSAVED 2 // check to see if the player's researched this
	{
	ife EQUIPMENT_RESEARCH[17] 2 nullop else killit
	set ZVELSAVED 0
	}

state ITEMSETTINGS
  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
			 ifl fortymm_slug 20
			{
			ife EQUIPMENT_RESEARCH[17] 0 { setarray EQUIPMENT_RESEARCH[17] 3 ifand new_research 2 nullop else xorvar new_research 2 set array_save 1 }
			add fortymm_slug 2
			ifg fortymm_slug 20 set fortymm_slug 20

			state PICKUP_DISPLAY
			set picked_up_tile FORTYMM_SLUGS
			set item_amount 2
			userquote 1732
	        ifspawnedby FORTYMM_SLUGS
	          state getcode
	        else
	          state quikget
			}
enda

spriteshadow FORTYMM_ELECTRO
useractor notenemy FORTYMM_ELECTRO
sizeat 23 23


ife ZVELSAVED 2 // check to see if the player's researched this
	{
	ife EQUIPMENT_RESEARCH[21] 2 nullop else killit
	set ZVELSAVED 0
	}

state ITEMSETTINGS
  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
			 ifl fortymm_electro 20
			{
			ife EQUIPMENT_RESEARCH[21] 0 { setarray EQUIPMENT_RESEARCH[21] 3 ifand new_research 2 nullop else xorvar new_research 2 set array_save 1 }
			add fortymm_electro 2
			ifg fortymm_electro 20 set fortymm_electro 20

			state PICKUP_DISPLAY
			set picked_up_tile FORTYMM_ELECTRO
			set item_amount 2
			userquote 1731
	        ifspawnedby FORTYMM_ELECTRO
	          state getcode
	        else
	          state quikget
			}
enda

spriteshadow FORTYMM_CRYO
useractor notenemy FORTYMM_CRYO
sizeat 23 23


ife ZVELSAVED 2 // check to see if the player's researched this
	{
	ife EQUIPMENT_RESEARCH[22] 2 nullop else killit
	set ZVELSAVED 0
	}

state ITEMSETTINGS
  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
			 ifl fortymm_electro 20
			{
			ife EQUIPMENT_RESEARCH[22] 0 { setarray EQUIPMENT_RESEARCH[22] 3 ifand new_research 2 nullop else xorvar new_research 2 set array_save 1 }
			add fortymm_cryo 2
			ifg fortymm_cryo 20 set fortymm_cryo 20

			state PICKUP_DISPLAY
			set picked_up_tile FORTYMM_CRYO
			set item_amount 2
			userquote 1730
	        ifspawnedby FORTYMM_CRYO
	          state getcode
	        else
	          state quikget
			}
enda

spriteshadow FORTYMM_SHELLS
useractor notenemy FORTYMM_SHELLS
sizeat 40 40


ife ZVELSAVED 2 // check to see if the player's researched this
	{
	ife EQUIPMENT_RESEARCH[15] 2 nullop else killit
	set ZVELSAVED 0
	}

state ITEMSETTINGS
  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
			 ifl fortymm_shells 16
			{
			ife EQUIPMENT_RESEARCH[15] 0 { setarray EQUIPMENT_RESEARCH[15] 3 ifand new_research 2 nullop else xorvar new_research 2 set array_save 1 }
			add fortymm_shells 8
			ifg fortymm_shells 16 set fortymm_shells 16

			state PICKUP_DISPLAY
			set picked_up_tile FORTYMM_SHELLS
			set item_amount 7
			userquote 1729
	        ifspawnedby FORTYMM_SHELLS
	          state getcode
	        else
	          state quikget
			}
enda

spriteshadow EXPL_SHELLS
useractor notenemy EXPL_SHELLS
sizeat 32 32


ife ZVELSAVED 2 // check to see if the player's researched this
	{
	ife EQUIPMENT_RESEARCH[1] 2 nullop else killit
	set ZVELSAVED 0
	}


state ITEMSETTINGS
  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
			 ifl explosive_shells 20
			{
			ife EQUIPMENT_RESEARCH[1] 0 { setarray EQUIPMENT_RESEARCH[1] 3 ifand new_research 2 nullop else xorvar new_research 2 set array_save 1 }
			add explosive_shells 10
			ifg explosive_shells 40 set explosive_shells 40

			state PICKUP_DISPLAY
			set picked_up_tile EXPL_SHELLS
			set item_amount 10
			userquote 1728
	        ifspawnedby EXPL_SHELLS
	          state getcode
	        else
	          state quikget
			}
enda

spriteshadow FLECHETE_SHELLS
useractor notenemy FLECHETE_SHELLS
sizeat 32 32


ife ZVELSAVED 2 // check to see if the player's researched this
	{
	ife EQUIPMENT_RESEARCH[2] 2 nullop else killit
	set ZVELSAVED 0
	}

state ITEMSETTINGS
  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
			 ifl flechete_shells 40
			{
			ife EQUIPMENT_RESEARCH[2] 0 { setarray EQUIPMENT_RESEARCH[2] 3 ifand new_research 2 nullop else xorvar new_research 2 set array_save 1 }
			add flechete_shells 10
			ifg flechete_shells 40 set flechete_shells 40

			state PICKUP_DISPLAY
			set picked_up_tile FLECHETE_SHELLS
			set item_amount 10
			userquote 1727
	        ifspawnedby FLECHETE_SHELLS
	          state getcode
	        else
	          state quikget
			}
enda

spriteshadow TESLA_AMMO_SPRITE
useractor notenemy TESLA_AMMO_SPRITE
sizeat 24 24


ife ZVELSAVED 2 // check to see if the player's researched this
	{
	ife EQUIPMENT_RESEARCH[4] 2 nullop else killit
	set ZVELSAVED 0
	}

ifaction 0
{
geta[].mdflags temp
orvar temp 16
seta[].mdflags temp

action ZERO
}

state ITEMSETTINGS
  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
			 ifl tesla_ammo 200
			{
			ife EQUIPMENT_RESEARCH[4] 0 { setarray EQUIPMENT_RESEARCH[4] 3 ifand new_research 2 nullop else xorvar new_research 2 set array_save 1 }
			add tesla_ammo 50
			ifg tesla_ammo 200 set tesla_ammo 200

			state PICKUP_DISPLAY
			set picked_up_tile TESLA_AMMO_SPRITE
			set item_amount 50
			userquote 1726
	        ifspawnedby TESLA_AMMO_SPRITE
	          state getcode
	        else
	          state quikget
			}
enda

appendevent EVENT_LOADACTOR
	// These pickups are introduced in EP4, extra is set to -2 on the pickups on Welys (EP4 base level)
	// To display without picking up and explain what they do
	switch sprite[].picnum
		case SILVER_CROSSBOW_BOLTS
		case VOID_CROSSBOW_BOLTS
		case ORANGE_MANA_PICKUP
		case GREEN_MANA_PICKUP
		case BLUE_MANA_PICKUP
		case PURPLE_MANA_PICKUP
		case CROSSBOWSPRITE
		case RW_CROSSBOW_SPRITE
			geta[].extra EXTRASAVED
			break
	endswitch
endevent

spriteshadow SILVER_CROSSBOW_BOLTS
useractor notenemy SILVER_CROSSBOW_BOLTS
sizeat 32 32


ife ZVELSAVED 2 // check to see if the player's researched this
	{
	ife EQUIPMENT_RESEARCH[6] 2 nullop else killit
	set ZVELSAVED 0
	}


	ifn EXTRASAVED -2 // not the tutorial display item on Welys
	  ifn EXTRASAVED -3
	{
		state ITEMSETTINGS
	  ifmove RESPAWN_ACTOR_FLAG
		state respawnit
	  else
		ifp pshrunk nullop
		else
		  ifp palive
			ifpdistl RETRIEVEDISTANCE // quote check ok
			  ifcount 6
				ifcanseetarget
				 ifl silver_bolts bolt_cap
				{
			ife EQUIPMENT_RESEARCH[6] 0 { setarray EQUIPMENT_RESEARCH[6] 3 ifand new_research 2 nullop else xorvar new_research 2 set array_save 1 }
			add silver_bolts 10
			ifg silver_bolts bolt_cap set silver_bolts bolt_cap

			state PICKUP_DISPLAY
			set picked_up_tile SILVER_CROSSBOW_BOLTS
			set item_amount 10
			userquote 1725
			ifspawnedby SILVER_CROSSBOW_BOLTS
			  state getcode
			else
			  state quikget
				}
	}
	else ife EXTRASAVED -3 // spawn crossbow when used
	{
		ifpdistl 1526
		  ifp pfacing
		  ifp palive
		{
			set player_use 0
			ife use_action_allowed 1
			{
				set hit_key 30
				espawn SILVER_CROSSBOW_BOLTS
				state setIgnoreUse
			}
		}
	}
enda

spriteshadow VOID_CROSSBOW_BOLTS
useractor notenemy VOID_CROSSBOW_BOLTS
	sizeat 32 32

	ifn EXTRASAVED -2 // not the tutorial display item on Welys
	  ifn EXTRASAVED -3
	{
		state ITEMSETTINGS
		  ifmove RESPAWN_ACTOR_FLAG
			state respawnit
		  else
			ifp pshrunk nullop
			else
			  ifp palive
				ifpdistl RETRIEVEDISTANCE // quote check ok
				  ifcount 6
					ifcanseetarget
					 ifl void_bolts bolt_cap
					{
				// ife EQUIPMENT_RESEARCH[6] 0 { setarray EQUIPMENT_RESEARCH[6] 3 ifand new_research 2 nullop else xorvar new_research 2 set array_save 1 }
				add void_bolts 5
				ifg void_bolts bolt_cap set void_bolts bolt_cap

				state PICKUP_DISPLAY
				set picked_up_tile VOID_CROSSBOW_BOLTS
				set item_amount 5
				userquote 1724
				ifspawnedby VOID_CROSSBOW_BOLTS
				  state getcode
				else
				  state quikget
					}
	}
	else ife EXTRASAVED -3 // spawn crossbow when used
	{
		ifpdistl 1526
		  ifp pfacing
		  ifp palive
		{
			set player_use 0
			ife use_action_allowed 1
			{
				set hit_key 30
				espawn VOID_CROSSBOW_BOLTS
				state setIgnoreUse
			}
		}
	}
enda

spritenopal ORANGE_MANA_PICKUP
spritenoshade ORANGE_MANA_PICKUP
spriteshadow ORANGE_MANA_PICKUP

useractor notenemy ORANGE_MANA_PICKUP

	ifaction 0
		{
		sizeat 24 24
		action ZERO
		cstat 0 set
		command 32768
		geta[].mdflags temp
		orvar temp 16
		seta[].mdflags temp
		}

	ifn EXTRASAVED -2 // not the tutorial display item on Welys
	  ifn EXTRASAVED -3
	{
		state ITEMSETTINGS
		  ifmove RESPAWN_ACTOR_FLAG
			state respawnit
		  else
			ifp pshrunk nullop
			else
			  ifp palive
				ifpdistl RETRIEVEDISTANCE // quote check ok
				  ifcount 6
					ifcanseetarget
					 ifl p_orange_mana max_orange_mana
						{
					add p_orange_mana 4
					clamp p_orange_mana 0 max_orange_mana

					state PICKUP_DISPLAY
					set picked_up_tile ORANGE_MANA_PICKUP
					set item_amount 4
					userquote 1723
					ifspawnedby ORANGE_MANA_PICKUP
					  state getcode
					else
					  state quikget
						}
	}
	else ife EXTRASAVED -3
	{
		ifpdistl 1526
		  ifp pfacing
		  ifp palive
		{
			set player_use 0
			ife use_action_allowed 1
			{
				set hit_key 30
				espawn ORANGE_MANA_PICKUP
				state setIgnoreUse
			}
		}
	}
enda

spritenopal GREEN_MANA_PICKUP
spritenoshade GREEN_MANA_PICKUP
spriteshadow GREEN_MANA_PICKUP

useractor notenemy GREEN_MANA_PICKUP

	ifaction 0
	{
		sizeat 24 24
		action ZERO
		cstat 0 set
		command 32768
		geta[].mdflags temp
		orvar temp 16
		seta[].mdflags temp
	}

	ifn EXTRASAVED -2 // not the tutorial display item on Welys
	  ifn EXTRASAVED -3
	{
		state ITEMSETTINGS

	  ifmove RESPAWN_ACTOR_FLAG
		state respawnit
	  else
		ifp pshrunk nullop
		else
		  ifp palive
			ifpdistl RETRIEVEDISTANCE // quote check ok
			  ifcount 6
				ifcanseetarget
				 ifl p_green_mana max_green_mana
		{
				add p_green_mana 8
				clamp p_green_mana 0 max_green_mana

				state PICKUP_DISPLAY
				set picked_up_tile GREEN_MANA_PICKUP
				set item_amount 8
				userquote 1722
				ifspawnedby GREEN_MANA_PICKUP
				  state getcode
				else
				  state quikget
		}
	}
	else ife EXTRASAVED -3
	{
		ifpdistl 1526
		  ifp pfacing
		  ifp palive
		{
			set player_use 0
			ife use_action_allowed 1
			{
				set hit_key 30
				espawn GREEN_MANA_PICKUP
				state setIgnoreUse
			}
		}
	}
enda

spritenopal BLUE_MANA_PICKUP
spritenoshade BLUE_MANA_PICKUP
spriteshadow BLUE_MANA_PICKUP

useractor notenemy BLUE_MANA_PICKUP

	ifaction 0
		{
		sizeat 24 24
		action ZERO
		cstat 0 set
		command 32768
		geta[].mdflags temp
		orvar temp 16
		seta[].mdflags temp
		}

	ifn EXTRASAVED -2 // not the tutorial display item on Welys
	  ifn EXTRASAVED -3
	{
		state ITEMSETTINGS
		  ifmove RESPAWN_ACTOR_FLAG
			state respawnit
		  else
			ifp pshrunk nullop
			else
			  ifp palive
				ifpdistl RETRIEVEDISTANCE // quote check ok
				  ifcount 6
					ifcanseetarget
					 ifl p_blue_mana max_blue_mana
						{
					add p_blue_mana 16
					clamp p_blue_mana 0 max_blue_mana

					state PICKUP_DISPLAY
					set picked_up_tile BLUE_MANA_PICKUP
					set item_amount 16
					userquote 1721
					ifspawnedby BLUE_MANA_PICKUP
					  state getcode
					else
					  state quikget
						}
	}
	else ife EXTRASAVED -3
	{
		ifpdistl 1526
		  ifp pfacing
		  ifp palive
		{
			set player_use 0
			ife use_action_allowed 1
			{
				set hit_key 30
				espawn BLUE_MANA_PICKUP
				state setIgnoreUse
			}
		}
	}
enda

spritenopal PURPLE_MANA_PICKUP
spritenoshade PURPLE_MANA_PICKUP
spriteshadow PURPLE_MANA_PICKUP

useractor notenemy PURPLE_MANA_PICKUP

	ifaction 0
		{
		sizeat 24 24
		action ZERO
		cstat 0 set
		command 32768
		geta[].mdflags temp
		orvar temp 16
		seta[].mdflags temp
		}


	ifn EXTRASAVED -2 // not the tutorial display item on Welys
	  ifn EXTRASAVED -3
	{
		state ITEMSETTINGS
		  ifmove RESPAWN_ACTOR_FLAG
			state respawnit
		  else
			ifp pshrunk nullop
			else
			  ifp palive
				ifpdistl RETRIEVEDISTANCE // quote check ok
				  ifcount 6
					ifcanseetarget
					 ifl p_purple_mana max_purple_mana
						{
					add p_purple_mana 2
					clamp p_purple_mana 0 max_purple_mana

					state PICKUP_DISPLAY
					set picked_up_tile PURPLE_MANA_PICKUP
					set item_amount 2
					userquote 1720
					ifspawnedby PURPLE_MANA_PICKUP
					  state getcode
					else
					  state quikget
						}
	}
	else ife EXTRASAVED -3
	{
		ifpdistl 1526
		  ifp pfacing
		  ifp palive
		{
			set player_use 0
			ife use_action_allowed 1
			{
				set hit_key 30
				espawn PURPLE_MANA_PICKUP
				state setIgnoreUse
			}
		}
	}
enda

spriteshadow MICRO_TORPEDO_PACK
useractor notenemy MICRO_TORPEDO_PACK
sizeat 20 20


ife ZVELSAVED 2 // check to see if the player's researched this
	{
	ife EQUIPMENT_RESEARCH[8] 2 nullop else killit
	set ZVELSAVED 0
	}


state ITEMSETTINGS
  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
			 ifl micro_torpedo 25
			{
			ife EQUIPMENT_RESEARCH[8] 0 { setarray EQUIPMENT_RESEARCH[8] 3 ifand new_research 2 nullop else xorvar new_research 2 set array_save 1 }
			add micro_torpedo 5
			ifg micro_torpedo 25 set micro_torpedo 25

			state PICKUP_DISPLAY
			set picked_up_tile MICRO_TORPEDO_PACK
			set item_amount 5

		userquote 1719
        ifspawnedby MICRO_TORPEDO_PACK
          state getcode
        else
          state quikget
			}
enda

spriteshadow MAGNUM_SHELLS
useractor notenemy MAGNUM_SHELLS
sizeat 32 32


ife ZVELSAVED 2 // check to see if the player's researched this
	{
	ife EQUIPMENT_RESEARCH[9] 2 nullop else killit
	set ZVELSAVED 0
	}

state ITEMSETTINGS
  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
			 ifl magnum_shells 40
			{
			ife EQUIPMENT_RESEARCH[9] 0 { setarray EQUIPMENT_RESEARCH[9] 3 ifand new_research 2 nullop else xorvar new_research 2 set array_save 1 }
			add magnum_shells 10
			ifg magnum_shells 40 set magnum_shells 40

			state PICKUP_DISPLAY
			set picked_up_tile MAGNUM_SHELLS
			set item_amount 10
			userquote 1718
	        ifspawnedby MAGNUM_SHELLS
	          state getcode
	        else
	          state quikget
			}
enda

spriteshadow DRAGONS_SHELLS
useractor notenemy DRAGONS_SHELLS
sizeat 32 32


ife ZVELSAVED 2 // check to see if the player's researched this
	{
	ife EQUIPMENT_RESEARCH[20] 2 nullop else killit
	set ZVELSAVED 0
	}

state ITEMSETTINGS
  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
			 ifl dragon_shells 20
			{
			ife EQUIPMENT_RESEARCH[20] 0 { setarray EQUIPMENT_RESEARCH[20] 3 ifand new_research 2 nullop else xorvar new_research 2 set array_save 1 }
			add dragon_shells 10
			ifg dragon_shells 20 set dragon_shells 20

			state PICKUP_DISPLAY
			set picked_up_tile DRAGONS_SHELLS
			set item_amount 10

			userquote 1717
	        ifspawnedby DRAGONS_SHELLS
	          state getcode
	        else
	          state quikget
			}
enda

spriteshadow HEAT_SEEK_CARD_PICKUP
useractor notenemy HEAT_SEEK_CARD_PICKUP
sizeat 40 40


ife ZVELSAVED 2 // check to see if the player's researched this
	{
	ife EQUIPMENT_RESEARCH[10] 2 nullop else killit
	set ZVELSAVED 0
	}


state ITEMSETTINGS
  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
			 ifl heat_seek_card 5
			{
			ife EQUIPMENT_RESEARCH[10] 0 { setarray EQUIPMENT_RESEARCH[10] 3 ifand new_research 2 nullop else xorvar new_research 2 set array_save 1 }
			ife PERSONNEL_RESEARCH[15] 2 // has advanced heat seeking card project?
				{
				add heat_seek_card 10
				ifg heat_seek_card 10 set heat_seek_card 10
				}
			else
				{
				add heat_seek_card 5
				ifg heat_seek_card 5 set heat_seek_card 5
				}

			state PICKUP_DISPLAY
			set picked_up_tile HEAT_SEEK_CARD_PICKUP
			set item_amount 5
		userquote 1716
        ifspawnedby HEAT_SEEK_CARD_PICKUP
          state getcode
        else
          state quikget
			}
enda

spriteshadow ATOMIC_BOMB_PICKUP
useractor notenemy ATOMIC_BOMB_PICKUP
sizeat 40 40


ife ZVELSAVED 2 // check to see if the player's researched this
	{
	ife EQUIPMENT_RESEARCH[11] 2 nullop else killit
	set ZVELSAVED 0
	}


state ITEMSETTINGS
  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
			 ifl atomic_bomb 1
			{
			ife EQUIPMENT_RESEARCH[11] 0 { setarray EQUIPMENT_RESEARCH[11] 3 ifand new_research 2 nullop else xorvar new_research 2 set array_save 1 }
			add atomic_bomb 1
			ifg atomic_bomb 1 set atomic_bomb 1

			state PICKUP_DISPLAY
			set picked_up_tile ATOMIC_BOMB_PICKUP
			set item_amount 1
		userquote 1715
        ifspawnedby ATOMIC_BOMB_PICKUP
          state getcode
        else
          state quikget
			}
enda

spriteshadow DUP_MISSILES_PICKUP
useractor notenemy DUP_MISSILES_PICKUP
sizeat 40 40


state ITEMSETTINGS
  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE
          ifcount 6
            ifcanseetarget
			 ifl DUP_missile_ammo 10
			{
			ife EQUIPMENT_RESEARCH[12] 0 { setarray EQUIPMENT_RESEARCH[12] 3 ifand new_research 2 nullop else xorvar new_research 2 set array_save 1 }
			add DUP_missile_ammo 10
			ifg DUP_missile_ammo 10 set heat_seek_card 10

			state PICKUP_DISPLAY
			set picked_up_tile DUP_MISSILES_PICKUP
			set item_amount 10

        ifspawnedby DUP_MISSILES_PICKUP
          state getcode
        else
          state quikget
			}
enda

// Multiplayer backpack

spriteshadow 176
useractor notenemy 176
sizeat 28 28


   ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
              ifcanseetarget
				{
				addphealth 20
				// Add player's pistol ammo
				getp[].ammo_amount 1 temp
				add temp temp3
				getp[].max_ammo_amount 1 temp2
				ifg temp temp2 set temp temp2
				setp[].ammo_amount 1 temp
				// Add player's shotgun ammo
				set ammo_forweaponidx 2
				set ammo_to_add temp4
				state do_addammo
				// Add player's chaingun ammo
				getp[].ammo_amount 3 temp
				add temp temp5
				getp[].max_ammo_amount 3 temp2
				ifg temp temp2 set temp temp2
				setp[].ammo_amount 3 temp
				// Add player's RPG ammo
				getp[].ammo_amount 4 temp
				add temp temp6
				getp[].max_ammo_amount 4 temp2
				ifg temp temp2 set temp temp2
				setp[].ammo_amount 4 temp
				// Add player's grenade ammo
				getp[].ammo_amount 5 temp
				add temp temp7
				getp[].max_ammo_amount 5 temp2
				ifg temp temp2 set temp temp2
				setp[].ammo_amount 5 temp

				  ife CHAR 0 globalsound JGETITEM
				  else ife CHAR 2 globalsound MGETITEM
				  else ife CHAR 3 globalsound RGETITEM
				  else ife CHAR 4 globalsound SGETITEM
				  else ife CHAR 5 globalsound RNGETITEM
				  else ife CHAR 6 globalsound GGETITEM
				  else ife CHAR 7 globalsound MSGETITEM
				  else ife CHAR 9 globalsound SGETITEM
				  else ife CHAR 13 globalsound RGETITEM
				  else globalsound ZAX_GET
				  palfrom 16 0 32
				  killit

				}


enda

defstate potion_heal
set temp5 pmax_health
ifactor HPOTION divvar temp5 10
ifactor HFLASK divvar temp5 4
ifactor HCUP divvar temp5 5
getp[].i temp2
geta[temp2].extra temp3
add temp3 temp5
ifg temp3 pmax_health set temp3 pmax_health
seta[temp2].extra temp3
ends

spriteshadow 18424
spriteshadow 18682

defstate HEAL_DISP_AMOUNT
			ifactor SIXPAK set item_amount 30
			ifactor COLA set item_amount 10
			ifactor 20158 set item_amount 10
			ifactor 20159 set item_amount 30
			ifactor TWENTYKIT set item_amount 20
			ifactor HYPOSPRAY set item_amount 20
			ifactor HPOTION set item_amount -1
			ifactor HFLASK set item_amount -1
			ifactor HPOWDER set item_amount 15
			ifactor HCUP set item_amount -1
			ifactor BRIMSTONE set item_amount 25
			ifactor 18424 set item_amount 10
			ifactor 18682 set item_amount 15
			ifactor TWENTYFIVEKIT set item_amount 25
			ife CHAR 16 set item_amount 5
ends

var firstaid_temp 0 1

defstate CUSTOMHEALOBJECT
ifn CURSED 0 break
state ITEMSETTINGS
ifactor 18682 ifaction 0 { sizeat 26 26 action ZERO cstat 0 }
else ifactor HCUP ifaction 0 { sizeat 28 28 action ZERO cstat 0 }
else ifactor TWENTYFIVEKIT ifaction 0 { sizeat 40 40 action ZERO cstat 0 }
else ifactor HFLASK ifaction 0 { sizeat 20 20 action ZERO cstat 0 }
else ifactor HYPOSPRAY { sizeat 24 24 action ZERO cstat 0 }
else ifaction 0 { sizeat 32 32 action ZERO cstat 0 }

ifaction ZERO
ifactor BRIMSTONE
	{
	sizeat 22 22
	 geta[].mdflags temp
	 orvar temp 16
	 seta[].mdflags temp
	 set command 32768

	geta[].shade temp
	ife temp 0 set temp2 1 else ife temp 20 set temp2 0
	ife temp2 1
		{
		add temp 1 seta[].shade temp
		}
	ife temp2 0
		{
		sub temp 1 seta[].shade temp
		}
	}

    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
		   ifcanseetarget
		   {
            ifl PHEALTH pmax_health
			{
			state PICKUP_DISPLAY
			geta[].picnum picked_up_tile
			setarray picked_up_inven[1] 60

			state HEAL_DISP_AMOUNT

					ife CHAR 16 { userquote 8602 addphealth 5 }
					else
						{
						ifactor SIXPAK { userquote 63 addphealth 30 }
						ifactor COLA { userquote 61 addphealth 10 }
						ifactor TWENTYKIT { userquote 62 addphealth 20 }
						ifactor HYPOSPRAY { userquote 151 addphealth 20 }
						ifactor HPOTION { userquote 152 state potion_heal }
						ifactor HFLASK { userquote 153 state potion_heal }
						ifactor HCUP { userquote 137 state potion_heal }
					  ifactor HPOWDER { userquote 154 addphealth 15 }
					  ifactor BRIMSTONE { userquote 180 addphealth 25 }
					  ifactor 18424 { userquote 141 addphealth 10 }
					  ifactor 18682 { userquote 142 addphealth 15 }
					  ifactor 20158 { userquote 144 addphealth 10 }
					  ifactor 20159 { userquote 145 addphealth 30 }
					  ifactor TWENTYFIVEKIT { userquote 143 addphealth 25 }
					  }
				ifg PHEALTH pmax_health
				{
				getp[].i temp
					seta[temp].extra pmax_health
				}
				palfrom 20 0 60 0
			     state getcode
			}
			else
			ife PERSONNEL_RESEARCH[12] 2 // add to firstaid if health is full and proper research is done
			{
				getp[].firstaid_amount firstaid_temp

				ife firstaid_temp 0 setp[].invdisptime 60

				ife firstaid_temp pmax_firstaid_total
					break

				state PICKUP_DISPLAY

				state HEAL_DISP_AMOUNT

				geta[].picnum picked_up_tile
				setarray picked_up_inven[1] 60
				ife CHAR 16 add firstaid_temp 5
				else
					{
					ifactor SIXPAK add firstaid_temp 30
					ifactor COLA add firstaid_temp 10
					ifactor TWENTYKIT add firstaid_temp 20
					ifactor HYPOSPRAY add firstaid_temp 20
					ifactor HPOTION add firstaid_temp 15
					ifactor HFLASK add firstaid_temp 30
					ifactor HCUP add firstaid_temp 20
					ifactor HPOWDER add firstaid_temp 15
					ifactor BRIMSTONE add firstaid_temp 25
					ifactor 18424 add firstaid_temp 10
					ifactor 18682 add firstaid_temp 15
					ifactor 20158 add firstaid_temp 10
					ifactor 20159 add firstaid_temp 30
					ifactor TWENTYFIVEKIT add firstaid_temp 25
					}
				clamp firstaid_temp 0 pmax_firstaid_total
				setp[].firstaid_amount firstaid_temp
				ife player[].inven_icon 0 setp[].inven_icon 1
				userquote 3050
					 state getcode
			}
			else
				break
      }
ends

spriteshadow HYPOSPRAY
useractor notenemy HYPOSPRAY state CUSTOMHEALOBJECT enda

spriteshadow HPOTION
useractor notenemy HPOTION state CUSTOMHEALOBJECT enda

spriteshadow HFLASK
useractor notenemy HFLASK state CUSTOMHEALOBJECT enda

spritenoshade HCUP
spriteshadow HCUP
useractor notenemy HCUP seta[].shade 0 state CUSTOMHEALOBJECT enda

spriteshadow TWENTYKIT
useractor notenemy TWENTYKIT state CUSTOMHEALOBJECT enda

spriteshadow HPOWDER
useractor notenemy HPOWDER state CUSTOMHEALOBJECT enda

spriteshadow BRIMSTONE
spritenopal BRIMSTONE
spritenoshade BRIMSTONE
useractor notenemy BRIMSTONE state CUSTOMHEALOBJECT enda

spriteshadow 18424
useractor notenemy 18424 state CUSTOMHEALOBJECT enda

spriteshadow 18682
useractor notenemy 18682 state CUSTOMHEALOBJECT enda

spriteshadow 20158
useractor notenemy 20158 state CUSTOMHEALOBJECT enda

spriteshadow 20159
useractor notenemy 20159 state CUSTOMHEALOBJECT enda

spriteshadow TWENTYFIVEKIT
useractor notenemy TWENTYFIVEKIT state CUSTOMHEALOBJECT enda

spriteshadow SIXPAK
actor SIXPAK state CUSTOMHEALOBJECT enda

spriteshadow COLA
actor COLA state CUSTOMHEALOBJECT enda

spriteshadow REBREATHER
useractor notenemy REBREATHER // air filter
state ITEMSETTINGS
ifaction 0 { sizeat 24 24 action ZERO cstat 0 }



  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
              ifcanseetarget
      {
	ife AIR_FILTER 1 break
	else
		{
		set AIR_FILTER 1

			state PICKUP_DISPLAY
			geta[].picnum picked_up_tile
			setarray picked_up_inven[1] 60
			set item_amount -1
		userquote 1714
        ifspawnedby REBREATHER
          state getcode
        else
          state quikget
		}
      }
enda


spriteshadow HEAT_SINK_PACK
useractor notenemy HEAT_SINK_PACK // heat sinks
state ITEMSETTINGS

ifaction 0 { sizeat 24 24 action ZERO cstat 0 }



  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
              ifcanseetarget
      {
	ife HEAT_SINKS 10 break
	else
		{
		add HEAT_SINKS 3
		ifg HEAT_SINKS 10 set HEAT_SINKS 10
		ife EQUIPMENT_RESEARCH[19] 0 { setarray EQUIPMENT_RESEARCH[19] 3 ifand new_research 2 nullop else xorvar new_research 2 set array_save 1 }

			state PICKUP_DISPLAY
			geta[].picnum picked_up_tile
			setarray picked_up_inven[1] 60
			set item_amount 3

		userquote 1713
        ifspawnedby HEAT_SINK_PACK
          state getcode
        else
          state quikget
		}
      }
enda

spriteshadow ROPE_PICKUP
useractor notenemy ROPE_PICKUP // Rope
state ITEMSETTINGS
ifaction 0 { sizeat 24 24 action ZERO cstat 0 }



  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
              ifcanseetarget
      {
	ife ROPE 1 break
	else
		{
		set ROPE 1

			state PICKUP_DISPLAY
			geta[].picnum picked_up_tile
			setarray picked_up_inven[1] 60
			set item_amount -1
			userquote 1712

        ifspawnedby ROPE_PICKUP
          state getcode
        else
          state quikget
		}
      }
enda


action SUIT_IDLE 0 1 5 0 0
action SUIT_WORN 0 1 5 0 0

damageeventtile FIRESUIT

spriteshadow FIRESUIT
useractor notenemy FIRESUIT

ifaction 0
	{
	set actor_type TYPE_ARMOURED
	sizeat 24 24
	ifspritepal 3 { action SUIT_WORN cstat 32768 }
	else ifspritepal 5 { action SUIT_WORN cstat 32768 }
	else { action SUIT_IDLE cstat 257 }
	}



  ifspritepal 5
	{
	   ifp palive
        ifpdistl 2048
		ife FIRE_SUIT 1
              ifcanseetarget
					{
					soundonce EQUIPMENT_OFF
					set FIRE_SUIT 0
					state fade_out_black
					cstat 257
					set just_changed 1
					killit
					}
	}

    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
              ifcanseetarget
				  {
				  set player_use 0
				  ifhitspace
				  ifcount 13
					{
					ifaction SUIT_WORN
					 ife FIRE_SUIT 1
						{
						soundonce EQUIPMENT_OFF
						set FIRE_SUIT 0
						state fade_out_black
						cstat 257
						action SUIT_IDLE
						set just_changed 1
						}
					else
					ifaction SUIT_IDLE
					 ife FIRE_SUIT 0
						{
						soundonce PUT_ON_EQUIP
						set FIRE_SUIT 1
						userquote 209
						state fade_out_black
						cstat 32768
						action SUIT_WORN
						set just_changed 1
						}
					resetcount
					}
				  }
enda

defstate SPACESUIT_BEEPS
		ife LIFE_SUPPORT 7200
			{
			sound LIFE_SUPPORT_BEEP
			setactorsoundpitch THISACTOR LIFE_SUPPORT_BEEP -256
			}
			ife LIFE_SUPPORT 3200 sound LIFE_SUPPORT_BEEP
			ife LIFE_SUPPORT 1800 sound LIFE_SUPPORT_BEEP
			ife LIFE_SUPPORT 1440 { set PLAYER_VOICEOVER 35 sound LIFE_SUPPORT_BEEP }
			ife LIFE_SUPPORT 720 sound LIFE_SUPPORT_BEEP
			ife LIFE_SUPPORT 360
			{
			sound LIFE_SUPPORT_BEEP
			setactorsoundpitch THISACTOR LIFE_SUPPORT_BEEP 128
			}
			ife LIFE_SUPPORT 180
			{
			sound LIFE_SUPPORT_BEEP
			setactorsoundpitch THISACTOR LIFE_SUPPORT_BEEP 256
			}
			ife LIFE_SUPPORT 90
			{
			sound LIFE_SUPPORT_BEEP
			setactorsoundpitch THISACTOR LIFE_SUPPORT_BEEP 512
			}
			ife LIFE_SUPPORT 60
			{
			sound LIFE_SUPPORT_BEEP
			setactorsoundpitch THISACTOR LIFE_SUPPORT_BEEP 512
			}
			ife LIFE_SUPPORT 30
			{
			sound LIFE_SUPPORT_BEEP
			setactorsoundpitch THISACTOR LIFE_SUPPORT_BEEP 512
			}
ends

spriteshadow SPACESUIT_REFILL
useractor notenemy SPACESUIT_REFILL

ifaction 0
	{
	sizeat 32 32
	action ZERO
	}


  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
              ifcanseetarget
      {
		ife PERSONNEL_RESEARCH[27] 2 // o2 cap increase
			{
			ifg LIFE_SUPPORT 21599 break
			else
				{
				ifspritepal 0 add LIFE_SUPPORT 5400
				else ifspritepal 11 add LIFE_SUPPORT 2700
				else ifspritepal 23 add LIFE_SUPPORT 1350
				else ifspritepal 21 add LIFE_SUPPORT 600
				ifl LIFE_SUPPORT 1800 ifrnd 32 set PLAYER_VOICEOVER 36
				soundonce LIFE_SUPPORT_BEEP
				state PICKUP_DISPLAY
				geta[].picnum picked_up_tile
				setarray picked_up_inven[1] -1
				set item_amount -1
				ifspawnedby SPACESUIT_REFILL
				  state getcode
				else
				  state quikget
				}
			}
		else
			{
			ifg LIFE_SUPPORT 14399 break
			else
				{
				ifspritepal 0 add LIFE_SUPPORT 5400
				else ifspritepal 11 add LIFE_SUPPORT 2700
				else ifspritepal 23 add LIFE_SUPPORT 1350
				else ifspritepal 21 add LIFE_SUPPORT 600
				ifl LIFE_SUPPORT 1800 ifrnd 32 set PLAYER_VOICEOVER 36
				soundonce LIFE_SUPPORT_BEEP
				state PICKUP_DISPLAY
				geta[].picnum picked_up_tile
				setarray picked_up_inven[1] -1
				set item_amount -1
				ifspawnedby SPACESUIT_REFILL
				  state getcode
				else
				  state quikget
				}
			}
      }

enda

spriteshadow SPACESUIT
useractor notenemy SPACESUIT
state ITEMSETTINGS

ifaction 0
	{
	sizeat 22 22
	set ally_mag 14400
	ifspritepal 3 { action SUIT_WORN cstat 32768 }
	else ifspritepal 5 { action SUIT_WORN cstat 32768 }
	else ifspritepal 9 { action FIVE_ANG }
	else { action SUIT_IDLE cstat 257 }
	}



  ifspritepal 5
	{
	   ifp palive
        ifpdistl 2048
		ife SPACE_SUIT 1
              ifcanseetarget
			   ifn CHAR 12
			    ifn CHAR 13
				 ifn CHAR 14
					{
					soundonce EQUIPMENT_OFF
					stopsound LIFE_SUPPORT_ACT
					set SPACE_SUIT 0
					set ally_mag LIFE_SUPPORT
					state fade_out_black
					cstat 257
					set just_changed 1
					killit
					}
	}

    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
		 ifp pfacing
          ifcount 6
              ifcanseetarget
			   ifn CHAR 12
			    ifn CHAR 13
				 ifn CHAR 14
				  {
				  set player_use 0
				  ifhitspace
				  ifcount 13
					{
					ifaction SUIT_WORN
					 ife SPACE_SUIT 1
						{
						soundonce EQUIPMENT_OFF
						stopsound LIFE_SUPPORT_ACT
						set ally_mag LIFE_SUPPORT
						set SPACE_SUIT 0
						state fade_out_black
						cstat 257
						action SUIT_IDLE
						set just_changed 1
						}
					else
					ifaction SUIT_IDLE
					 ife SPACE_SUIT 0
						{
						soundonce PUT_ON_EQUIP
						set LIFE_SUPPORT ally_mag
						set SPACE_SUIT 1
						userquote 209
						state fade_out_black
						cstat 32768
						action SUIT_WORN
						set just_changed 1
						}
					resetcount
					}
				  }
enda

spriteshadow GASMASK
useractor notenemy GASMASK
state ITEMSETTINGS
ifaction 0 { sizeat 40 40 action ZERO cstat 0 }


  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
              ifcanseetarget
      {
	ifg GAS_MASK 0 break
	else
		{
		set GAS_MASK 1
		state PICKUP_DISPLAY
		geta[].picnum picked_up_tile
		setarray picked_up_inven[1] 60
		set item_amount -1
		userquote 1711
        ifspawnedby GASMASK
          state getcode
        else
          state quikget
		}
      }
enda

spriteshadow FLIPPER
useractor notenemy FLIPPER
state ITEMSETTINGS
ifaction 0
	{
	sizeat 40 40
	action ZERO
	readarrayfromfile EQUIPMENT_FOUND F_EQUIPMENT_FOUND_AMCTC
	cstat 0
	}


  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE
          ifcount 6
              ifcanseetarget
      {

			ife EQUIPMENT_FOUND[5] 0
				{
				userquote 3038
				setarray EQUIPMENT_FOUND[5] 1
				writearraytofile EQUIPMENT_FOUND F_EQUIPMENT_FOUND_AMCTC
				globalsound FOUND_EQUIPMENT
				palfrom 20 60 60 60
				}

	ifg GOT_FLIPPER 0 break
	else
		{
		set GOT_FLIPPER 1
		state PICKUP_DISPLAY
		geta[].picnum picked_up_tile
		setarray picked_up_inven[1] 60
		set item_amount -1
        ifspawnedby FLIPPER
          state getcode
        else
          state quikget
		}
      }
enda

spriteshadow JUMPBOOTS_PICKUP
useractor notenemy JUMPBOOTS_PICKUP
state ITEMSETTINGS
ifaction 0 { sizeat 40 40 action ZERO cstat 0 }


  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
              ifcanseetarget
      {
	ifg JUMP_BOOTS 0 break
	else
		{
		set JUMP_BOOTS 1
		state PICKUP_DISPLAY
		geta[].picnum picked_up_tile
		setarray picked_up_inven[1] 60
		set item_amount -1

		userquote 1710
        ifspawnedby JUMPBOOTS_PICKUP
          state getcode
        else
          state quikget
		}
      }
enda

spriteshadow O2CANISTER
useractor notenemy O2CANISTER
state ITEMSETTINGS
ifaction 0 { sizeat 32 32 action ZERO cstat 0 }



  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE
          ifcount 6
              ifcanseetarget
      {
		getp[].scuba_amount temp
		ifl temp 1 break
		else
			{
			add temp 1280
			ife CHAR 0 { ifg temp 12800 set temp 12800 } else
				{ ifg temp 6400 set temp 6400 }
				setp[].scuba_amount temp
					state PICKUP_DISPLAY
					geta[].picnum picked_up_tile
					setarray picked_up_inven[1] 60
					set item_amount -1

					ifspawnedby O2CANISTER
					  state getcode
					else
					  state quikget
			}
      }
enda

spriteshadow 16835
spriteshadow 16836
spriteshadow 16837
spriteshadow 16838

useractor notenemy 16835 // Egyptian jumping sandals
ifaction 0
	{
	sizeat 24 24
	action ZERO
	cstat 0 set
	command 32768
	geta[].mdflags temp
	orvar temp 16
	seta[].mdflags temp
	}

    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE
          ifcount 6
              ifcanseetarget
				{
				ifand EGYPT_ARTIFACTS 1 break
				spritepal 12
				state display_key
				xorvar EGYPT_ARTIFACTS 1
				globalsound QUEST_ITEM
				palfrom 30 63 63 63
				killit
				}
enda

useractor notenemy 16836 // Egyptian mask
ifaction 0
	{
	sizeat 24 24
	action ZERO
	cstat 0 set
	command 32768
	geta[].mdflags temp
	orvar temp 16
	seta[].mdflags temp
	}



    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE
          ifcount 6
              ifcanseetarget
				{
				ifand EGYPT_ARTIFACTS 2 break
				spritepal 12
				state display_key
				xorvar EGYPT_ARTIFACTS 2
				globalsound QUEST_ITEM
				palfrom 30 63 63 63
				killit
				}
enda

useractor notenemy 16837 // Egyptian strength bracelets
ifaction 0
	{
	sizeat 24 24
	action ZERO
	cstat 0 set
	command 32768
	geta[].mdflags temp
	orvar temp 16
	seta[].mdflags temp
	}



    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE
          ifcount 6
              ifcanseetarget
				{
				ifand EGYPT_ARTIFACTS 4 break
				spritepal 12
				state display_key
				xorvar EGYPT_ARTIFACTS 4
				globalsound QUEST_ITEM
				palfrom 30 63 63 63
				killit
				}
enda

useractor notenemy 16838 // Egptian slow  feather
ifaction 0
	{
	sizeat 24 24
	action ZERO
	cstat 0 set
	command 32768
	geta[].mdflags temp
	orvar temp 16
	seta[].mdflags temp
	}



    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE
          ifcount 6
              ifcanseetarget
				{
				ifand EGYPT_ARTIFACTS 8 break
				spritepal 12
				state display_key
				xorvar EGYPT_ARTIFACTS 8
				globalsound QUEST_ITEM
				palfrom 30 63 63 63
				killit
				}
enda

spriteshadow 23711
spriteshadow 23719
spriteshadow 23723
spriteshadow 23703

useractor notenemy 23711
ifaction 0
	{
	sizeat 24 24
	action ZERO
	cstat 0 set
	command 32768
	geta[].mdflags temp
	orvar temp 16
	seta[].mdflags temp
	}



    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE
          ifcount 6
              ifcanseetarget
			   {
			   ifand EGYPT_KEYS 1 break
				spritepal 15
				state display_key
				xorvar EGYPT_KEYS 1
				globalsound QUEST_ITEM
				palfrom 30 63 63 63
				killit
			   }
enda

useractor notenemy 23719
ifaction 0
	{
	sizeat 24 24
	action ZERO
	cstat 0 set
	command 32768
	geta[].mdflags temp
	orvar temp 16
	seta[].mdflags temp
	}



    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE
          ifcount 6
              ifcanseetarget
			{
			ifand EGYPT_KEYS 2 break
			spritepal 15
			state display_key
			xorvar EGYPT_KEYS 2
			globalsound QUEST_ITEM
			palfrom 30 63 63 63
			killit
			}
enda

useractor notenemy 23723
ifaction 0
	{
	sizeat 24 24
	action ZERO
	cstat 0 set
	command 32768
	geta[].mdflags temp
	orvar temp 16
	seta[].mdflags temp
	}



    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE
          ifcount 6
              ifcanseetarget
			{
			ifand EGYPT_KEYS 4 break
			spritepal 15
			state display_key
			xorvar EGYPT_KEYS 4
			globalsound QUEST_ITEM
			palfrom 30 63 63 63
			killit
			}
enda

useractor notenemy 23703
ifaction 0
	{
	sizeat 24 24
	action ZERO
	cstat 0 set
	command 32768
	geta[].mdflags temp
	orvar temp 16
	seta[].mdflags temp
	}



    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE
          ifcount 6
              ifcanseetarget
			{
			ifand EGYPT_KEYS 8 break
			spritepal 15
			state display_key
			xorvar EGYPT_KEYS 8
			globalsound QUEST_ITEM
			palfrom 30 63 63 63
			killit
			}
enda

spriteshadow 22377
useractor notenemy 22377 // 1st half of temple key
ifaction 0
	{
	sizeat 16 16
	action ZERO
	cstat 0
	}

    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
              ifcanseetarget
					{
					ifand temple_key 1 break
					state display_key
					ifand temple_key 2 { set temple_key 4 }
					else xorvar temple_key 1
					globalsound QUEST_ITEM
					palfrom 30 63 63 63
					killit
					}
enda

spriteshadow 22378
useractor notenemy 22378 // 2nd half of temple key
ifaction 0
	{
	sizeat 16 16
	action ZERO
	cstat 0
	}



    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
              ifcanseetarget
				{
				ifand temple_key 2 break
				state display_key
				ifand temple_key 1 { set temple_key 4 }
				else xorvar temple_key 2
				globalsound QUEST_ITEM
				palfrom 30 63 63 63
				killit
				}
enda

spritenoshade C4_EXPLOSIVE
spriteshadow C4_EXPLOSIVE
useractor notenemy C4_EXPLOSIVE
state ITEMSETTINGS
ifaction 0 { sizeat 16 16 action ZERO }
cstat 0
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
              ifcanseetarget
			   ifl GOT_EXPLOSIVE 5
				  {
					 add GOT_EXPLOSIVE 1
						state PICKUP_DISPLAY
						geta[].picnum picked_up_tile
						setarray picked_up_inven[1] 60
						set item_amount -1
						spritepal 21
						state display_key
						userquote 1740
					  state quikget
				  }
enda

spriteshadow ASTRIKE_MARKER
useractor notenemy ASTRIKE_MARKER
state ITEMSETTINGS
ifaction 0 { sizeat 24 24 action ZERO }

cstat 0

    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE
          ifcount 6
              ifcanseetarget
			   ifl AIRSTRIKE_MARKER 4
      {
	     add AIRSTRIKE_MARKER 1

		 spritepal 21
		 state display_key
          state quikget

      }
enda

spriteshadow FIREWALL_CHIP
useractor notenemy FIREWALL_CHIP
	state ITEMSETTINGS
	ifaction 0 { sizeat 16 16 action ZERO }

	cstat 0

	ifp pshrunk nullop
	else
	  ifp palive
	  ifpdistl RETRIEVEDISTANCE
	  ifcount 6
	  ifcanseetarget
	  ife GOT_FIREWALL 0
	{
		set GOT_FIREWALL 1
		state PICKUP_DISPLAY
		geta[].picnum picked_up_tile
		setarray picked_up_inven[1] 60
		set item_amount -1
		state quikget
	}
enda

spriteshadow GENERICKEY
useractor notenemy GENERICKEY
  ifspritepal 3
  {
     changespritestat THISACTOR 0
     break
  }
state ITEMSETTINGS
ifaction 0 { sizeat 24 24 action ZERO }

cstat 0


    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
              ifcanseetarget
			   ifl GENERIC_KEYS 5
      {
	     add GENERIC_KEYS 1

		ifmultiplayer
			ife COOP 1
				{
				state RADIO_KEY_SOUNDS
				qgetsysstr 356 STR_PLAYERNAME
				qstrcat 356 663
				userquote 356
				}

			spritepal 12
			state display_key

         state quikget

      }
enda

spriteshadow COG_PICKUP
useractor notenemy COG_PICKUP
state ITEMSETTINGS

ifspritepal 3 nullop else set command 256

ifaction 0
{
sizeat 46 46
geta[].mdflags temp
orvar temp 16
seta[].mdflags temp
cstat 0
action ZERO
}


    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
              ifcanseetarget
			   ifl COGS 3
      {
	     add COGS 1

			state PICKUP_DISPLAY
			geta[].picnum picked_up_tile
			setarray picked_up_inven[1] 60
			set item_amount -1
			spritepal 15
			state display_key
			userquote 1739

          state quikget
      }
enda

spriteshadow TOOLBOX_PICKUP
useractor notenemy TOOLBOX_PICKUP

state ITEMSETTINGS
ifaction 0 { sizeat 32 32 action ZERO cstat 0 }


    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
              ifcanseetarget
			   ife TOOLBOX 0
      {
	   set TOOLBOX 1

		state PICKUP_DISPLAY
		geta[].picnum picked_up_tile
		setarray picked_up_inven[1] 60
		set item_amount -1
		userquote 1738
		spritepal 15
		state display_key
        state quikget
      }
enda

spriteshadow COPPER_AMULET
spritenoshade COPPER_AMULET
spritenopal COPPER_AMULET

useractor notenemy COPPER_AMULET
state ITEMSETTINGS

ifaction 0
	{
	sizeat 30 30
	seta[].shade -127
	geta[].mdflags temp
	orvar temp 16
	seta[].mdflags temp
	set command 65792
	cstat 0
	action ZERO
	}

set temp2 pmax_health
mulvar temp2 2

    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifl PHEALTH temp2
              ifcanseetarget
				  {
				  setav[PLAYER_IDENTITY].fire_damage 0
				  setav[PLAYER_IDENTITY].ice_damage 0
				  setav[PLAYER_IDENTITY].spirit_damage 0
				  setav[PLAYER_IDENTITY].energy_damage 0


				  getp[].max_player_health temp
				  set temp2 temp
				  add temp2 10
				  setp[].max_player_health temp2
				  addphealth 10
				  add temp 1
				  setp[].max_player_health temp
				  set pmax_hp_countd -300
				  add TREASURE_FOUND 1
				  state PICKUP_DISPLAY
				  geta[].picnum picked_up_tile
				  setarray picked_up_inven[1] 60
				  set item_amount -1
				  userquote 1700
				  state quikget
				  }
enda

spriteshadow SILVER_AMULET
spritenoshade SILVER_AMULET
spritenopal SILVER_AMULET

useractor notenemy SILVER_AMULET
state ITEMSETTINGS

ifaction 0
	{
	sizeat 30 30
	seta[].shade -127
	geta[].mdflags temp
	orvar temp 16
	seta[].mdflags temp
	set command 65792
	cstat 0
	action ZERO
	}

set temp2 pmax_health
mulvar temp2 2

    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifl PHEALTH temp2
              ifcanseetarget
				  {
				  setav[PLAYER_IDENTITY].fire_damage 0
				  setav[PLAYER_IDENTITY].ice_damage 0
				  setav[PLAYER_IDENTITY].spirit_damage 0
				  setav[PLAYER_IDENTITY].energy_damage 0

				  getp[].max_player_health temp
				  set temp2 temp
				  add temp2 20
				  setp[].max_player_health temp2
				  addphealth 20
				  add temp 3
				  setp[].max_player_health temp
				  set pmax_hp_countd -300
				  add TREASURE_FOUND 2
				  state PICKUP_DISPLAY
				  geta[].picnum picked_up_tile
				  setarray picked_up_inven[1] 60
				  set item_amount -1
				  userquote 1701
				  state quikget
				  }
enda

spriteshadow GOLD_AMULET

actor GOLD_AMULET
state ITEMSETTINGS

ifaction 0
	{
	sizeat 30 30
	seta[].shade -127
	geta[].mdflags temp
	orvar temp 16
	seta[].mdflags temp
	set command 65792
	cstat 0
	action ZERO
	}

set temp pmax_health
mulvar temp 2

    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifl PHEALTH temp
              ifcanseetarget
				  {
				  setav[PLAYER_IDENTITY].fire_damage 0
				  setav[PLAYER_IDENTITY].ice_damage 0
				  setav[PLAYER_IDENTITY].spirit_damage 0
				  setav[PLAYER_IDENTITY].energy_damage 0
				  addphealth 30
				  getp[].max_player_health temp
				  add temp 5
				  setp[].max_player_health temp
				  set pmax_hp_countd -300
				  add TREASURE_FOUND 3
					state PICKUP_DISPLAY
					geta[].picnum picked_up_tile
					setarray picked_up_inven[1] 60
					set item_amount -1
					userquote 1702
					state quikget
				  }
enda

spriteshadow PLATINUM_AMULET
spritenoshade PLATINUM_AMULET
spritenopal PLATINUM_AMULET

useractor notenemy PLATINUM_AMULET
state ITEMSETTINGS

ifaction 0
	{
	sizeat 30 30
	seta[].shade -127
	geta[].mdflags temp
	orvar temp 16
	seta[].mdflags temp
	set command 65792
	cstat 0
	action ZERO
	}

set temp2 pmax_health
mulvar temp2 2

    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifl PHEALTH temp2
              ifcanseetarget
				  {
				  setav[PLAYER_IDENTITY].fire_damage 0
				  setav[PLAYER_IDENTITY].ice_damage 0
				  setav[PLAYER_IDENTITY].spirit_damage 0
				  setav[PLAYER_IDENTITY].energy_damage 0

				  getp[].max_player_health temp
				  set temp2 temp
				  add temp2 40
				  setp[].max_player_health temp2
				  addphealth 40
				  add temp 10
				  setp[].max_player_health temp
				  set pmax_hp_countd -300
				  add TREASURE_FOUND 5
				  state PICKUP_DISPLAY
				  geta[].picnum picked_up_tile
				  setarray picked_up_inven[1] 60
				  set item_amount -1
				  userquote 1703
				  state quikget
				  }
enda

spriteshadow COOKIE
useractor notenemy COOKIE
state ITEMSETTINGS

sizeat 32 32

set temp pmax_health
mulvar temp 2

    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifl PHEALTH temp
              ifcanseetarget
				  {
				  getp[].max_player_health temp
				  set temp2 temp
				  add temp2 30
				  setp[].max_player_health temp2
				  addphealth 30
				  setp[].max_player_health temp
				  set pmax_hp_countd -450

						state PICKUP_DISPLAY
						add TREASURE_FOUND 2
						geta[].picnum picked_up_tile
						setarray picked_up_inven[1] 60
						set item_amount 30
						ife CHAR 14
						 ife TIMEZONE 6
							 {
							set FORTUNE_TIMER 300
							set FORTUNE_QUOTE 6540
							}
						 else
							 {
							set FORTUNE_TIMER 300
							set FORTUNE_QUOTE 6500
							randvar temp4 31
							add FORTUNE_QUOTE temp4
							}
					  state quikget
				  }
enda

spriteshadow 3707

move FLOAT_DOWN 0 25

useractor notenemy 3707 // Supply drop
fall
sizeat 20 20

ifaction 0
	{
	ifspawnedby APLAYER
		{
		sub SUPPLY_LEVEL 30
		savegamevar SUPPLY_LEVEL
		getsector[].ceilingz temp
		setactor[].z temp
		}
	move FLOAT_DOWN getv
	action ZERO
	}

ifaction ZERO
	{
	iffloordistl 16
		{
		sound WOODBREAK
		sound WOODBREAK shoot WOODSCRAP shoot WOODSCRAP shoot WOODSCRAP shoot WOODSCRAP shoot WOODSCRAP shoot WOODSCRAP
		spawn 3636 // supply box
		killit
		}
	}

enda

spritenoshade 3063

useractor notenemy 3063 // supply beacon ===========================================================================
sleeptime 0
fall
ifaction 0
	{
	sizeat 20 20
	spritepal 103
	action ZERO
	}

ifaction ZERO
	{
	ifcount 60
		{
		sound BEACON_BEEP
		spawn 3060
		resetcount
		}
	ifpdistl 1536
		{
		spritepal 0
		sound BEACON_BEEP
		setactorsoundpitch THISACTOR BEACON_BEEP 512
		action FORM
		}
	}

ifaction FORM
	{
	ifpdistg 8192
		{
		ifcansee nullop
		else killit
		}
	}

enda


spritenoshade 3709

useractor notenemy 3709
sleeptime 0
fall
ifaction 0
	{
	sound ALARM2
	ifspawnedby APLAYER
		{
		sub SUPPLY_LEVEL 30
		savegamevar SUPPLY_LEVEL
		}
	espawn 3060
	seta[RETURN].pal 2
	sizeat 16 16
	action ZERO
	}

ifaction ZERO
	{
	 ifactioncount 2
		{
		add INTERNALCOUNT 1
		ifge INTERNALCOUNT 150 killit
		set xydist sprite[].x
		randvarvar temp 4096
		add temp 512
		add xydist temp
		randvar angvar 2047

		rotatepoint sprite[].x sprite[].y xydist sprite[].y angvar temp2 y
		// temp2 and y are the new x and y coords
		updatesector temp2 y mysector
		ifn mysector -1
			{
				ifand sector[mysector].ceilingstat 1
				{
					getceilzofslope mysector temp2 y z // z is the return var
					updatesectorz temp2 y z mysector
					ifn mysector -1
					{
							globalsound ERPG_SHOOT
							espawn BOSS2_RAIN_XHAIR
							seta[RETURN].x temp2
							seta[RETURN].y y
							seta[RETURN].z sector[mysector].floorz
							seta[RETURN].sectnum mysector
					}
				}
			}
		resetactioncount
		}
	}
enda

spritenopal 3060
spritenoshade 3060

useractor notenemy 3060 // map beacon light
ifaction 0
	{
	cstat 130
	geta[].z temp
	sub temp 1024
	seta[].z temp
	sizeat 16 16
	ifspawnedby 3063 spritepal 1
	seta[].shade -64
	seta[].blend 255
	action ONE
	}

ifaction ONE
	{
	geta[].xrepeat temp
	add temp 2
	seta[].xrepeat temp
	seta[].yrepeat temp

	geta[].shade temp2
	add temp2 2
	seta[].shade temp2
	ifg temp2 30 killit
	}

enda

spriteshadow 3636

useractor notenemy 3636 // supply run box of supplies

spriteflags 69
sizeat 32 32

state ITEMSETTINGS

  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl 2048
          ifcount 6
              ifcanseetarget
      {
	soundonce EQUIPMENT_OFF
		spawn SHIELD
		spawn SIXPAK
		spawn COLA
		spawn SHOTGUNAMMO
		spawn SHOTGUNAMMO
		spawn AMMO
		spawn AMMO
		spawn AMMO
		spawn BATTERYAMMO
		spawn BATTERYAMMO
		spawn RPGAMMO
		spawn CRYSTALAMMO
		spawn DEVISTATORAMMO
		spawn FREEZEAMMO
		spawn GROWAMMO
		spawn TRIPBOMBSPRITE
		spawn TRIPBOMBSPRITE
		spawn TRIPBOMBSPRITE
          killit
      }

enda

spritenoshade MEGASPHERE
spritenopal MEGASPHERE
spriteshadow MEGASPHERE

useractor notenemy MEGASPHERE
sizeat 32 32

state ITEMSETTINGS

ifaction 0
{
seta[].blend 255
seta[].shade -127
seta[].cstat 2
 state set_mdflags
 set command 32768
}

  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
		   ifl PHEALTH 255
		    ifl PARMOUR 255
              ifcanseetarget
      {
	  getp[].max_player_health temp
	  ifl temp 200 setp[].max_player_health 200
	  geta[PLAYER_IDENTITY].extra temp2
	  add temp2 200

	  clamp temp2 0 player[].max_player_health
	  seta[PLAYER_IDENTITY].extra temp2
	  stopsound PLYR_GOTHEALTHATLOW
	  set PLAYER_VOICEOVER 51
	  userquote 150
	  set player_ability_1 0
	  set player_ability_2 0
	  set player_ability_3 0

	  set pmax_hp_countd -900
	  setp[].max_player_health temp
	  setp[].shield_amount 200

			state PICKUP_DISPLAY
			geta[].picnum picked_up_tile
			setarray picked_up_inven[1] 60
			set item_amount -1

        ifspawnedby MEGASPHERE
          state getcode
        else
          state quikget
      }
enda

spritenoshade SWORD_RAMPAGE
useractor notenemy SWORD_RAMPAGE
spriteflags 69
sizeat 24 24

state ITEMSETTINGS

	ifaction 0
	{
	 state set_mdflags
	 set command 32768
	}

  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
              ifcanseetarget
      {
	    palfrom 40 40 40 40

	    set SWORD_RAMP 780
        quote 249
		set PLAYER_VOICEOVER 51
		addphealth 50
		state drop_tempweapon
		ife temp_weap 0
				{
				set temp_weap 19
				setp[].ammo_amount 0 1
				setp[].curr_weapon 0
				}
				else spawn SWORDSPRITE

        ifspawnedby SWORD_RAMPAGE
          state getcode
        else
          state quikget
      }
enda

useractor notenemy INVINCIBILITY
ifaction 0
	{
	spriteflags 69
	sizeat 40 40
	state set_mdflags
	set command 256
	action ZERO
	}

state ITEMSETTINGS

  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
              ifcanseetarget
      {
	    palfrom 40 40 40 40
		set PLAYER_VOICEOVER 51
		addphealth 50
	    set INVINC 780
        quote 1606

        ifspawnedby INVINCIBILITY
          state getcode
        else
          state quikget
      }
enda

spriteshadow SPIRIT_ARMOUR
spritenopal SPIRIT_ARMOUR
spritenoshade SPIRIT_ARMOUR
useractor notenemy SPIRIT_ARMOUR

ifaction 0
	{
	sizeat 44 44
	state set_mdflags
	set command 256
	action ZERO
	}

state ITEMSETTINGS

  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
              ifcanseetarget
			   ifl P_SPIRIT_ARMOUR 100
				  {
				   set P_SPIRIT_ARMOUR 100
					quote 195

						state PICKUP_DISPLAY
						geta[].picnum picked_up_tile
						setarray picked_up_inven[1] 60
						set item_amount -1

					ifspawnedby SPIRIT_ARMOUR
					  state getcode
					else
					  state quikget
				  }
enda

spriteshadow FIRE_ARMOUR
useractor notenemy FIRE_ARMOUR

ifaction 0
	{
	sizeat 44 44
	state set_mdflags
	set command 256
	action ZERO
	}

state ITEMSETTINGS


  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
              ifcanseetarget
			   ifl P_FIRE_ARMOUR 100
				  {
				   set P_FIRE_ARMOUR 100
				   setactorvar[PLAYER_IDENTITY].fire_damage 0
				   quote 244

						state PICKUP_DISPLAY
						geta[].picnum picked_up_tile
						setarray picked_up_inven[1] 60
						set item_amount -1

					ifspawnedby FIRE_ARMOUR
					  state getcode
					else
					  state quikget
				  }
enda

spriteshadow SUPER_ARMOUR
useractor notenemy SUPER_ARMOUR
ifaction 0
	{
	sizeat 44 44
	state set_mdflags
	set command 256
	action ZERO
	}

state ITEMSETTINGS


  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
              ifcanseetarget
      {
	   set P_FIRE_ARMOUR 200
	   set P_SPIRIT_ARMOUR 200
	   setp[].shield_amount 200
        quote 245

			state PICKUP_DISPLAY
			geta[].picnum picked_up_tile
			setarray picked_up_inven[1] 60
			set item_amount -1

        ifspawnedby SUPER_ARMOUR
          state getcode
        else
          state quikget
      }
enda

spriteshadow BASIC_ARMOUR
useractor notenemy BASIC_ARMOUR
ifaction 0
	{
	sizeat 48 48
	state set_mdflags
	set command 256
	action ZERO
	}

state ITEMSETTINGS


  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
              ifcanseetarget
      {
	   ifl P_FIRE_ARMOUR 50 add P_FIRE_ARMOUR 50
	   ifl P_SPIRIT_ARMOUR 50 add P_SPIRIT_ARMOUR 50
	   ifl PARMOUR 50 setp[].shield_amount 50

			state PICKUP_DISPLAY
			geta[].picnum picked_up_tile
			setarray picked_up_inven[1] 60
			set item_amount -1

			userquote 1708

        ifspawnedby BASIC_ARMOUR
          state getcode
        else
          state quikget
      }
enda

spriteshadow FIRSTAID
actor FIRSTAID
  state set_mdflags
	state ITEMSETTINGS

  ifmove RESPAWN_ACTOR_FLAG state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
              ifcanseetarget
			  {
				getp[].firstaid_amount temp
				ife temp 0
					{
					setp[].inven_icon 1
					setp[].invdisptime 60
					}
				ifl temp pmax_firstaid_onpickup
				{
					add temp pmax_firstaid_onpickup
					clamp temp 0 pmax_firstaid_onpickup
					setp[].firstaid_amount temp

					setarray picked_up_inven[1] 60
					state PICKUP_DISPLAY
					getav[PLAYER_IDENTITY].c_medikit picked_up_tile
					set item_amount 100
					userquote 1737
					ifspawnedby FIRSTAID
					  state getcode
					else
					  state quikget
				}
			}
enda

spriteshadow FIRSTGUNSPRITE
actor FIRSTGUNSPRITE
  state set_mdflags
state ITEMSETTINGS
ifspawnedby 18069 fall
ifspawnedby 18074 fall

  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
      {
	    ife CHAR 17
		 ifgotweaponce 0
			{
			ifg KAGURA_CHARGE 9 break
			ifg KAGURA_CHARGE 9 { screensound YO_CHARGE set KAGURA_CHARGE 10 } else
			add KAGURA_CHARGE 5
			addphealth 10
			}
			else
        ifgotweaponce 0
          break

	 ife CHAR 0
		{
		ife cur_weap 1 { ifand guns_akimbo 4 nullop else { xorvar gun_firemode 64 state lower_weapon } }
			ife player[].gotweapon 1 1 { ifand guns_akimbo 4 nullop else xorvar guns_akimbo 4 }
		}
	else
	 ife CHAR 1
	  ife SPECIALIST_EQUIPMENT[82] 2
		{
		ife cur_weap 1 { ifand guns_akimbo 4 nullop else { xorvar gun_firemode 64 state lower_weapon } }
			ife player[].gotweapon 1 1 { ifand guns_akimbo 4 nullop else xorvar guns_akimbo 4 }
		}
	else
	ife CHAR 5
		{
		ife SPECIALIST_EQUIPMENT[29] 2 nullop else
			{
		ife cur_weap 1 { ifand guns_akimbo 4 nullop else { set PLAYER_VOICEOVER 44 xorvar gun_firemode 64 state lower_weapon } }
			ife player[].gotweapon 1 1 { ifand guns_akimbo 4 nullop else xorvar guns_akimbo 4 }
			}
		}
	else
	ife CHAR 6
		{
		ife cur_weap 1 { ifand guns_akimbo 4 nullop else { xorvar gun_firemode 64 state lower_weapon } }
		ife player[].gotweapon 1 1 { ifand guns_akimbo 4 nullop else xorvar guns_akimbo 4 }
		}
	else
	ife CHAR 14
		{
		ife cur_weap 1 { ifand guns_akimbo 4 nullop else { xorvar gun_firemode 64 state lower_weapon } }
		ife player[].gotweapon 1 1 { ifand guns_akimbo 4 nullop else xorvar guns_akimbo 4 }
		}

        addweaponvar PISTOL_WEAPON ammo_amount[1]


		setarray picked_up_gun[1] 30
		set weap_show 130
		state PICKUP_DISPLAY
		set picked_up_tile WEAPON_TILE[1]
		ife CHAR 2
			set item_amount -1
			else
		set item_amount ammo_amount[1]

        ifspawnedby FIRSTGUNSPRITE
          state getweaponcode
        else
          state quikweaponget
      }
enda

spriteshadow TRIPBOMBSPRITE
actor TRIPBOMBSPRITE
  state set_mdflags
state ITEMSETTINGS


  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
      {
        ifgotweaponce 0
          break

        addweapon TRIPBOMB_WEAPON 1
		set picked_up_tile WEAPON_TILE[8]
		setarray picked_up_gun[8] 30
		  set weap_show 130

			ifspawnedby TRIPBOMBSPRITE
			    state getcode
			   else
			    state quikget
      }
enda

spriteshadow CHAINGUNSPRITE
actor CHAINGUNSPRITE
  state set_mdflags

state ITEMSETTINGS

  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
      {

		// Merlijn Recycle code
         ife player[].gotweapon 3 1 ife CHAR 2
			{
			// preventing farming by spawning by console or weapons machine
			ifspawnedby APLAYER break
			ifspawnedby 10570 break
		  state PICKUP_DISPLAY
		  set picked_up_tile 33
		  set item_amount 25
			ife POLYMERS 0 readgamevar POLYMERS
			add POLYMERS 25
			userquote 14011
			savegamevar POLYMERS
          state quikweaponget
			}

        ifgotweaponce 0
          break

	  ife CHAR 0
		ifn SPECIALIST_EQUIPMENT[55] 2
		 ifn SPECIALIST_EQUIPMENT[15] 2
		  ifn SPECIALIST_EQUIPMENT[8] 2
			{
			ifand guns_akimbo 2 nullop else
				{
				ife player[].gotweapon 3 1
					{
					globalsound GET_GUN
					xorvar guns_akimbo 2
					xorvar gun_firemode 1024
					ife cur_weap 3 { state lower_weapon set PLAYER_VOICEOVER 44 }
					}
				}
			set item_amount 50
			addweapon CHAINGUN_WEAPON 50
			}
		else
	  ife CHAR 1
		ifn SPECIALIST_EQUIPMENT[70] 2
			{
			ifand guns_akimbo 16 nullop else
				{
				ife player[].gotweapon 3 1
					{
					globalsound GET_GUN
					xorvar guns_akimbo 16
					xorvar gun_firemode 1024
					ife cur_weap 3 { state lower_weapon set PLAYER_VOICEOVER 44 }
					}
				}
			addweaponvar CHAINGUN_WEAPON ammo_amount[3]
			set item_amount ammo_amount[3]
			}
		else
		   ife CHAR 4
			ifn SPECIALIST_EQUIPMENT[6] 2
			 ifn SPECIALIST_EQUIPMENT[16] 2
			  ifn SPECIALIST_EQUIPMENT[34] 2
			   ifn SPECIALIST_EQUIPMENT[71] 2
		    	ifn SPECIALIST_EQUIPMENT[74] 2
				ifn SPECIALIST_EQUIPMENT[92] 2
				{
				ifand guns_akimbo 2 nullop else
					{
					ife player[].gotweapon 3 1
						{
						ife cur_weap 3 { state lower_weapon set PLAYER_VOICEOVER 44 }
						xorvar guns_akimbo 2
						xorvar gun_firemode 1024
						}
					}
				ifand guns_akimbo 4 nullop else xorvar guns_akimbo 4
				set item_amount ammo_amount[3]
				addweaponvar CHAINGUN_WEAPON ammo_amount[3]
				}
			else
			{
			addweaponvar CHAINGUN_WEAPON ammo_amount[3]
			set item_amount ammo_amount[3]
			}

		ifand weap_special[3] 2
			{
			ife CHAR 0 ife SPECIALIST_EQUIPMENT[77] 2 addammo 4 2 else
			ife CHAR 9 addammo 4 2 else
			add fortymm_grenades 2
			}
		ifand weap_special[3] 8 add fortymm_caseless 2

		  setarray picked_up_gun[3] 30
		  set weap_show 130
		state PICKUP_DISPLAY
		set picked_up_tile WEAPON_TILE[3]

        ifspawnedby CHAINGUNSPRITE
          state getweaponcode
        else
          state quikweaponget
      }
enda

spriteshadow SHRINKERSPRITE
actor SHRINKERSPRITE
  state set_mdflags
state ITEMSETTINGS

  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
      {
        ifgotweaponce 0
          break

		addweaponvar SHRINKER_WEAPON ammo_amount[6]
        set item_amount ammo_amount[6]

		setarray picked_up_gun[6] 30
		set weap_show 130
		state PICKUP_DISPLAY
		set picked_up_tile WEAPON_TILE[6]

        ifspawnedby SHRINKERSPRITE
          state getweaponcode
        else
          state quikweaponget
      }
enda

spriteshadow FREEZESPRITE
actor FREEZESPRITE
  state set_mdflags
state ITEMSETTINGS

  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
        {

		// Merlijn Recycle code
         ife player[].gotweapon 9 1 ife CHAR 2
			{
			// preventing farming by spawning by console or weapons machine
			ifspawnedby APLAYER break
			ifspawnedby 10570 break
		  state PICKUP_DISPLAY
		  set picked_up_tile 33
		  set item_amount 40
			ife POLYMERS 0 readgamevar POLYMERS
			add POLYMERS 40
			userquote 14012
			savegamevar POLYMERS
          state quikweaponget
			}

        ifgotweaponce 0
          break
	    addweaponvar FREEZE_WEAPON ammo_amount[9]
	    set item_amount ammo_amount[9]
		setarray picked_up_gun[9] 30
		set weap_show 130
		state PICKUP_DISPLAY
		set picked_up_tile WEAPON_TILE[9]

		ifand weap_special[9] 2 add fortymm_grenades 2
		ifand weap_special[9] 8 add fortymm_caseless 2

        ifspawnedby FREEZESPRITE
          state getweaponcode
        else
          state quikweaponget
        }
enda

spriteshadow DEVISTATORSPRITE
actor DEVISTATORSPRITE
  state set_mdflags
state ITEMSETTINGS

  ifmove RESPAWN_ACTOR_FLAG state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
      {
        ifgotweaponce 0 break
      addweaponvar DEVISTATOR_WEAPON ammo_amount[7]
	  set item_amount ammo_amount[7]

		setarray picked_up_gun[7] 30
		  set weap_show 130
		state PICKUP_DISPLAY
		set picked_up_tile WEAPON_TILE[7]

		ifand weap_special[7] 2 add fortymm_grenades 2
		ifand weap_special[7] 8 add fortymm_caseless 2

        ifspawnedby DEVISTATORSPRITE
          state getweaponcode
        else
          state quikweaponget
      }
enda



// Treasure!

defstate TREASURE
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
				{
				ifactor 7859 { ifrnd 32 set PLAYER_VOICEOVER 38 globalsound CASHREG } else
				ifactor 7862 { ifrnd 32 set PLAYER_VOICEOVER 38 globalsound CASHREG } else
				ifactor 7863 { ifrnd 32 set PLAYER_VOICEOVER 38 globalsound CASHREG } else
				globalsound FOUND_TREASURE
				palfrom 20 60 60 60
				add TREASURE_FOUND 2
				ifactor 7859 userquote 1022 else
				ifactor 7862 userquote 1022 else
				ifactor 7863 userquote 1022 else
				userquote 1021
				killit
				}
ends

spriteshadow 7856
useractor notenemy 7856 sizeat 32 32 state TREASURE enda
spriteshadow 7857
useractor notenemy 7857 sizeat 32 32 state TREASURE enda
spriteshadow 7858
useractor notenemy 7858 sizeat 32 32 state TREASURE enda
spriteshadow 7860
useractor notenemy 7860 sizeat 32 32 state TREASURE enda
spriteshadow 7861
useractor notenemy 7861 sizeat 32 32 state TREASURE enda

spriteshadow 7859
useractor notenemy 7859 sizeat 25 25 state TREASURE enda // Dollar
spriteshadow 7862
useractor notenemy 7862 sizeat 25 25 state TREASURE enda // Sterling
spriteshadow 7863
useractor notenemy 7863 sizeat 25 25 state TREASURE enda // Yuan

spriteshadow 10234
useractor notenemy 10234 // Shotgun ammo belt
sizeat 18 18


ifaction 0
	{
	readarrayfromfile EQUIPMENT_FOUND F_EQUIPMENT_FOUND_AMCTC
	ife EQUIPMENT_FOUND[1] 1 { spawn SHOTGUNAMMO killit }
	action ZERO
	}

    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
			{
			userquote 3038
			setarray EQUIPMENT_FOUND[1] 1
			writearraytofile EQUIPMENT_FOUND F_EQUIPMENT_FOUND_AMCTC
			globalsound FOUND_EQUIPMENT

			state PICKUP_DISPLAY
			set picked_up_tile sprite[].picnum
			set item_amount -1

			palfrom 20 60 60 60
			killit
			}
enda

spriteshadow 12233
useractor notenemy 12233 // Combat Shovel
sizeat 24 24


ifaction 0
	{
	readarrayfromfile EQUIPMENT_FOUND F_EQUIPMENT_FOUND_AMCTC
	ife EQUIPMENT_FOUND[2] 1 killit
	action ZERO
	}

    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
			{
			userquote 3038
			setarray EQUIPMENT_FOUND[2] 1
			writearraytofile EQUIPMENT_FOUND F_EQUIPMENT_FOUND_AMCTC
			globalsound FOUND_EQUIPMENT

			state PICKUP_DISPLAY
			set picked_up_tile sprite[].picnum
			set item_amount -1

			palfrom 20 60 60 60
			killit
			}
enda


spriteshadow 20066
useractor notenemy 20066 // Frying pan
sizeat 32 32

    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
			{
			set player_use 0
			ifhitspace
				{
				set hit_key 30
				state PICKUP_DISPLAY
				sound PAN_IMPACT
				set picked_up_tile sprite[].picnum
				set item_amount -1
				set GOT_KNIFE 5
				killit
				}
			}
enda

spriteshadow 22758
useractor notenemy 22758 // Ballistic mask
sizeat 24 24


ifaction 0
	{
	readarrayfromfile EQUIPMENT_FOUND F_EQUIPMENT_FOUND_AMCTC
	ife EQUIPMENT_FOUND[3] 1 killit
	action ZERO
	}

    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
			{
			userquote 3038
			setarray EQUIPMENT_FOUND[3] 1
			writearraytofile EQUIPMENT_FOUND F_EQUIPMENT_FOUND_AMCTC
			globalsound FOUND_EQUIPMENT

			state PICKUP_DISPLAY
			set picked_up_tile sprite[].picnum
			set item_amount -1

			palfrom 20 60 60 60
			killit
			}
enda


spriteshadow RIOT_SHIELD
useractor notenemy RIOT_SHIELD // Riot shield
ifaction 0
	{
	sizeat 24 20
	cstat 16
	readarrayfromfile EQUIPMENT_FOUND F_EQUIPMENT_FOUND_AMCTC
	action ZERO
	}

    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
			 ifl riot_shield 150
			{
			ife EQUIPMENT_FOUND[4] 0
				{
				userquote 3038
				setarray EQUIPMENT_FOUND[4] 1
				writearraytofile EQUIPMENT_FOUND F_EQUIPMENT_FOUND_AMCTC
				globalsound FOUND_EQUIPMENT
				palfrom 20 60 60 60
				}

			state PICKUP_DISPLAY
			sound PUT_ON_EQUIP
			set picked_up_tile sprite[].picnum
			set item_amount 150
			set riot_shield 150
			set shield_type 0
			set shield_up 1
			killit
			}
enda

spriteshadow AMC_RIOT_SHIELD
useractor notenemy AMC_RIOT_SHIELD // AMC Riot shield
ifaction 0
	{
	sizeat 24 20
	cstat 16
	readarrayfromfile EQUIPMENT_FOUND F_EQUIPMENT_FOUND_AMCTC
	ife EQUIPMENT_FOUND[4] 0 killit
	action ZERO
	}

    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
			 ifl riot_shield 150
			{
			state PICKUP_DISPLAY
			sound PUT_ON_EQUIP
			set picked_up_tile sprite[].picnum
			set item_amount 150
			set riot_shield 150
			set shield_type 0
			set shield_up 1
			killit
			}
enda

spriteshadow 23920
useractor notenemy 23920 // Wooden shield
ifaction 0
	{
	sizeat 26 26
	readarrayfromfile EQUIPMENT_FOUND F_EQUIPMENT_FOUND_AMCTC
	action ZERO
	}

    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
			 ifl riot_shield 125
			{
			ife EQUIPMENT_FOUND[7] 0
				{
				userquote 3038
				setarray EQUIPMENT_FOUND[7] 1
				writearraytofile EQUIPMENT_FOUND F_EQUIPMENT_FOUND_AMCTC
				globalsound FOUND_EQUIPMENT
				palfrom 20 60 60 60
				}

			state PICKUP_DISPLAY
			sound PUT_ON_EQUIP
			set picked_up_tile sprite[].picnum
			set item_amount 125
			set riot_shield 125
			set shield_type 1
			set shield_up 1
			killit
			}
enda

spriteshadow 23921
useractor notenemy 23921 // Engineer shield

ifaction 0
	{
	cstat 0
	sizeat 26 26
	readarrayfromfile EQUIPMENT_FOUND F_EQUIPMENT_FOUND_AMCTC
	action ZERO
	}

    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
			 ifl riot_shield 200
			{
			ife EQUIPMENT_FOUND[8] 0
				{
				userquote 3038
				setarray EQUIPMENT_FOUND[8] 1
				writearraytofile EQUIPMENT_FOUND F_EQUIPMENT_FOUND_AMCTC
				globalsound FOUND_EQUIPMENT
				palfrom 20 60 60 60
				}

			state PICKUP_DISPLAY
			sound PUT_ON_EQUIP
			set picked_up_tile 23921
			set item_amount 200
			set riot_shield 200
			set shield_type 2
			set shield_up 1
			killit
			}
enda

spriteshadow 10235
useractor notenemy 10235 // Golden Lighter
sizeat 10 10


ifrnd 1 spawn GLINT

ifaction 0
	{
	readarrayfromfile ARTIFACTS_FOUND F_ARTIFACTS_FOUND_AMCTC
	ife ARTIFACTS_FOUND[1] 1 { spawn GOLD_AMULET killit }
	action ZERO
	}


    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
			{
			userquote 3037
			setarray ARTIFACTS_FOUND[1] 1
			writearraytofile ARTIFACTS_FOUND F_ARTIFACTS_FOUND_AMCTC
			globalsound FOUND_ARTIFACT
			add TREASURE_FOUND 1
			palfrom 20 60 60 60

			state PICKUP_DISPLAY
			set picked_up_tile sprite[].picnum
			set item_amount -1

			killit
			}
enda

spriteshadow 10233
useractor notenemy 10233 // boots of lightstep
sizeat 20 20


ifrnd 1 spawn GLINT

ifaction 0
	{
	readarrayfromfile ARTIFACTS_FOUND F_ARTIFACTS_FOUND_AMCTC
	ife ARTIFACTS_FOUND[2] 1 { spawn PLATINUM_AMULET killit }
	action ZERO
	}


    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
			{
			userquote 3037
			setarray ARTIFACTS_FOUND[2] 1
			writearraytofile ARTIFACTS_FOUND F_ARTIFACTS_FOUND_AMCTC
			globalsound FOUND_ARTIFACT
			add TREASURE_FOUND 1
			palfrom 20 60 60 60

			state PICKUP_DISPLAY
			set picked_up_tile sprite[].picnum
			set item_amount -1

			killit
			}
enda

spriteshadow 10232
useractor notenemy 10232 // enchanted nails
sizeat 32 32


ifrnd 1 spawn GLINT

ifaction 0
	{
	readarrayfromfile ARTIFACTS_FOUND F_ARTIFACTS_FOUND_AMCTC
	ife ARTIFACTS_FOUND[3] 1 { spawn GOLD_AMULET killit }
	action ZERO
	}


    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
			{
			userquote 3037
			setarray ARTIFACTS_FOUND[3] 1
			writearraytofile ARTIFACTS_FOUND F_ARTIFACTS_FOUND_AMCTC
			globalsound FOUND_ARTIFACT
			add TREASURE_FOUND 1
			palfrom 20 60 60 60

			state PICKUP_DISPLAY
			set picked_up_tile sprite[].picnum
			set item_amount -1

			killit
			}
enda

spriteshadow 13542
useractor notenemy 13542 // tree book
sizeat 32 32


ifrnd 1 spawn GLINT

ifaction 0
	{
	readarrayfromfile ARTIFACTS_FOUND F_ARTIFACTS_FOUND_AMCTC
	ife ARTIFACTS_FOUND[4] 1 { spawn COOKIE killit }
	action ZERO
	}


    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
			{
			userquote 3037
			setarray ARTIFACTS_FOUND[4] 1
			writearraytofile ARTIFACTS_FOUND F_ARTIFACTS_FOUND_AMCTC
			globalsound FOUND_ARTIFACT
			add TREASURE_FOUND 1
			palfrom 20 60 60 60

			state PICKUP_DISPLAY
			set picked_up_tile sprite[].picnum
			set item_amount -1

			killit
			}
enda

spriteshadow 19199

useractor notenemy 19199 // Spirit Shawl
sizeat 32 32

ifrnd 1 spawn GLINT

ifaction 0
	{
	readarrayfromfile ARTIFACTS_FOUND F_ARTIFACTS_FOUND_AMCTC
	ife ARTIFACTS_FOUND[5] 1 { spawn GOLD_AMULET killit }
	action ZERO
	}


    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
			{
			userquote 3037
			setarray ARTIFACTS_FOUND[5] 1
			writearraytofile ARTIFACTS_FOUND F_ARTIFACTS_FOUND_AMCTC
			globalsound FOUND_ARTIFACT
			add TREASURE_FOUND 1
			palfrom 20 60 60 60

			state PICKUP_DISPLAY
			set picked_up_tile sprite[].picnum
			set item_amount -1

			killit
			}
enda

spriteshadow 19198

useractor notenemy 19198 // Mako ring
sizeat 22 22


ifrnd 1 spawn GLINT

ifaction 0
	{
	readarrayfromfile ARTIFACTS_FOUND F_ARTIFACTS_FOUND_AMCTC
	ife ARTIFACTS_FOUND[6] 1 { spawn PLATINUM_AMULET killit }
	action ZERO
	}


    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
			{
			userquote 3037
			setarray ARTIFACTS_FOUND[6] 1
			writearraytofile ARTIFACTS_FOUND F_ARTIFACTS_FOUND_AMCTC
			globalsound FOUND_ARTIFACT
			add TREASURE_FOUND 1
			palfrom 20 60 60 60

			state PICKUP_DISPLAY
			set picked_up_tile sprite[].picnum
			set item_amount -1

			killit
			}
enda

spriteshadow 22762

useractor notenemy 22762 // Life Ring
sizeat 10 10


ifrnd 1 spawn GLINT

ifaction 0
	{
	readarrayfromfile ARTIFACTS_FOUND F_ARTIFACTS_FOUND_AMCTC
	ife ARTIFACTS_FOUND[7] 1 { spawn PLATINUM_AMULET killit }
	action ZERO
	}


    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
			{
			userquote 3037
			setarray ARTIFACTS_FOUND[7] 1
			writearraytofile ARTIFACTS_FOUND F_ARTIFACTS_FOUND_AMCTC
			globalsound FOUND_ARTIFACT
			add TREASURE_FOUND 1
			palfrom 20 60 60 60

			state PICKUP_DISPLAY
			set picked_up_tile sprite[].picnum
			set item_amount -1

			killit
			}
enda

spriteshadow 29350

useractor notenemy 29350 // Elemental shield
sizeat 26 26

ifrnd 1 spawn GLINT

ifaction 0
	{
	readarrayfromfile ARTIFACTS_FOUND F_ARTIFACTS_FOUND_AMCTC
	ife ARTIFACTS_FOUND[9] 1 { spawn SILVER_AMULET killit }
	action ZERO
	}

    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
			{
			userquote 3037
			setarray ARTIFACTS_FOUND[9] 1
			writearraytofile ARTIFACTS_FOUND F_ARTIFACTS_FOUND_AMCTC
			globalsound FOUND_ARTIFACT
			add TREASURE_FOUND 1
			palfrom 20 60 60 60

			state PICKUP_DISPLAY
			set picked_up_tile sprite[].picnum
			set item_amount -1

			killit
			}
enda

// Specialist weapons ===========================================

defstate display_spec_gun
	state getfactornormalizedframerate
	set DISP_GUN -150
	mul DISP_GUN NORMALIZED_FACTOR
	set DISP_GUN_PIC sprite[].picnum

	state PICKUP_DISPLAY
	set picked_up_tile sprite[].picnum
	set item_amount -1
ends

spriteshadow 6383

useractor notenemy 6383 // Ice spell for Sang
sizeat 24 24

set item_num 17
state SPECIAL_SETTING

    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
			ifaction ZERO
			{
			userquote 3204
			set DISP_GUN_CHAR MI_SANG
			state display_spec_gun
			setarray SPECIALIST_EQUIPMENT[17] 1
			writearraytofile SPECIALIST_EQUIPMENT F_SPECIAL_LOADOUT_AMCTC
			globalsound FOUND_EQUIPMENT
			add TREASURE_FOUND 1
			killit
			}

enda

spriteshadow 23870

useractor notenemy 23870 // Seraph Shotgun
sizeat 18 18

set item_num 86
state SPECIAL_SETTING

    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
			 ifaction ZERO
			{
			userquote 3204
			set DISP_GUN_CHAR MI_SANG
			state display_spec_gun
			setarray SPECIALIST_EQUIPMENT[86] 1
			writearraytofile SPECIALIST_EQUIPMENT F_SPECIAL_LOADOUT_AMCTC
			globalsound FOUND_EQUIPMENT
			add TREASURE_FOUND 1
			killit
			}

enda

spriteshadow 22603

useractor notenemy 22603 // Manacle
sizeat 24 24

set item_num 80
state SPECIAL_SETTING

    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
			 ifaction ZERO
			{
			userquote 3204
			set DISP_GUN_CHAR MI_SANG
			state display_spec_gun
			setarray SPECIALIST_EQUIPMENT[80] 1
			writearraytofile SPECIALIST_EQUIPMENT F_SPECIAL_LOADOUT_AMCTC
			globalsound FOUND_EQUIPMENT
			add TREASURE_FOUND 1
			killit
			}

enda

spriteshadow 13354

useractor notenemy 13354 // MS Corp silenced SMG for Mikko
sizeat 18 18

set item_num 21
state SPECIAL_SETTING

    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
			ifaction ZERO
			{
			userquote 3207
			set DISP_GUN_CHAR MI_MIKKO
			state display_spec_gun
			setarray SPECIALIST_EQUIPMENT[21] 1
			writearraytofile SPECIALIST_EQUIPMENT F_SPECIAL_LOADOUT_AMCTC
			globalsound FOUND_EQUIPMENT
			add TREASURE_FOUND 1
			killit
			}

enda

spriteshadow 13376

useractor notenemy 13376 // Remington 1858 for Rusty (Jekyl's pistol)
sizeat 24 24

set item_num 24
state SPECIAL_SETTING

    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
			ifaction ZERO
			{
			userquote 3205
			set DISP_GUN_CHAR MI_RUSTY
			state display_spec_gun
			setarray SPECIALIST_EQUIPMENT[24] 1
			writearraytofile SPECIALIST_EQUIPMENT F_SPECIAL_LOADOUT_AMCTC
			globalsound FOUND_EQUIPMENT
			add TREASURE_FOUND 1
			killit
			}

enda

spriteshadow 13385

useractor notenemy 13385 // Browning Auto-5 for James
sizeat 20 20

set item_num 25
state SPECIAL_SETTING

    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
			 ifaction ZERO
			{
			userquote 3200
			set DISP_GUN_CHAR MI_JAMES
			state display_spec_gun
			setarray SPECIALIST_EQUIPMENT[25] 1
			writearraytofile SPECIALIST_EQUIPMENT F_SPECIAL_LOADOUT_AMCTC
			globalsound FOUND_EQUIPMENT
			add TREASURE_FOUND 1
			killit
			}

enda

spriteshadow 13403

useractor notenemy 13403 // Long axe for Merlijn
sizeat 16 16

set item_num 26
state SPECIAL_SETTING

    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
			 ifaction ZERO
			{
			userquote 3202
			set DISP_GUN_CHAR MI_MERLIJN
			state display_spec_gun
			setarray SPECIALIST_EQUIPMENT[26] 1
			writearraytofile SPECIALIST_EQUIPMENT F_SPECIAL_LOADOUT_AMCTC
			globalsound FOUND_EQUIPMENT
			add TREASURE_FOUND 1
			killit
			}

enda

spriteshadow 13423

useractor notenemy 13423 // Micro-uzi for Rusty
sizeat 22 22

set item_num 29
state SPECIAL_SETTING

    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
           ifcanseetarget
		    ifaction ZERO
			{
			userquote 3205
			set DISP_GUN_CHAR MI_RUSTY
			state display_spec_gun
			setarray SPECIALIST_EQUIPMENT[29] 1
			writearraytofile SPECIALIST_EQUIPMENT F_SPECIAL_LOADOUT_AMCTC
			globalsound FOUND_EQUIPMENT
			add TREASURE_FOUND 1
			killit
			}

enda

spriteshadow 13424

useractor notenemy 13424 // MS Corp assault Shotgun for Mikko
sizeat 24 24

set item_num 30
state SPECIAL_SETTING

    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
           ifcanseetarget
		    ifaction ZERO
			{
			userquote 3207
			set DISP_GUN_CHAR MI_MIKKO
			state display_spec_gun
			setarray SPECIALIST_EQUIPMENT[30] 1
			writearraytofile SPECIALIST_EQUIPMENT F_SPECIAL_LOADOUT_AMCTC
			globalsound FOUND_EQUIPMENT
			add TREASURE_FOUND 1
			killit
			}

enda

spriteshadow 6386
useractor notenemy 6386 // Fire spell for Sang
sizeat 24 24

set item_num 31
state SPECIAL_SETTING

    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
           ifcanseetarget
			ifaction ZERO
			{
			userquote 3204
			set DISP_GUN_CHAR MI_SANG
			state display_spec_gun
			setarray SPECIALIST_EQUIPMENT[31] 1
			writearraytofile SPECIALIST_EQUIPMENT F_SPECIAL_LOADOUT_AMCTC
			globalsound FOUND_EQUIPMENT
			add TREASURE_FOUND 1
			killit
			}

enda

spriteshadow 15911
useractor notenemy 15911 // MDF Battle Rifle for Mikko
sizeto 24 24

set item_num 47
state SPECIAL_SETTING

    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
           ifcansee
			ifaction ZERO
			{
			userquote 3207
			set DISP_GUN_CHAR MI_MIKKO
			state display_spec_gun
			setarray SPECIALIST_EQUIPMENT[47] 1
			writearraytofile SPECIALIST_EQUIPMENT F_SPECIAL_LOADOUT_AMCTC
			globalsound FOUND_EQUIPMENT
			add TREASURE_FOUND 1
			killit
			}

enda

spriteshadow 19878
useractor notenemy 19878 // Tec-pistol for Micky
sizeto 28 28

set item_num 73
state SPECIAL_SETTING

    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
           ifcansee
		    ifaction ZERO
			{
			userquote 3208
			set DISP_GUN_CHAR MI_MICKY
			state display_spec_gun
			setarray SPECIALIST_EQUIPMENT[73] 1
			writearraytofile SPECIALIST_EQUIPMENT F_SPECIAL_LOADOUT_AMCTC
			globalsound FOUND_EQUIPMENT
			add TREASURE_FOUND 1
			killit
			}

enda

spriteshadow 22528
useractor notenemy 22528 // Particle beam for Micky
sizeto 22 22

set item_num 76
state SPECIAL_SETTING

    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
           ifcansee
			ifaction ZERO
			{
			userquote 3208
			set DISP_GUN_CHAR MI_MICKY
			state display_spec_gun
			setarray SPECIALIST_EQUIPMENT[76] 1
			writearraytofile SPECIALIST_EQUIPMENT F_SPECIAL_LOADOUT_AMCTC
			globalsound FOUND_EQUIPMENT
			add TREASURE_FOUND 1
			killit
			}

enda

spriteshadow 17982
useractor notenemy 17982 // Longslide pistol for Micky
sizeto 24 24

set item_num 60
state SPECIAL_SETTING

    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
           ifcansee
		    ifaction ZERO
			{
			userquote 3208
			set DISP_GUN_CHAR MI_MICKY
			state display_spec_gun
			setarray SPECIALIST_EQUIPMENT[60] 1
			writearraytofile SPECIALIST_EQUIPMENT F_SPECIAL_LOADOUT_AMCTC
			globalsound FOUND_EQUIPMENT
			add TREASURE_FOUND 1
			killit
			}

enda

spriteshadow 15898
useractor notenemy 15898 // M4-15 for James
sizeto 18 22

set item_num 84
state SPECIAL_SETTING

    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
           ifcansee
			ifaction ZERO
			{
			userquote 3200
			set DISP_GUN_CHAR MI_JAMES
			state display_spec_gun
			setarray SPECIALIST_EQUIPMENT[84] 1
			writearraytofile SPECIALIST_EQUIPMENT F_SPECIAL_LOADOUT_AMCTC
			globalsound FOUND_EQUIPMENT
			add TREASURE_FOUND 1
			killit
			}

enda

spriteshadow 29104
useractor notenemy 29104 // Eviscerator for Geoffrey - swamp
sizeto 22 22

set item_num 97
state SPECIAL_SETTING

    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
           ifcansee
			ifaction ZERO
			{
			userquote 3206
			set DISP_GUN_CHAR MI_GEOFFREY
			state display_spec_gun
			setarray SPECIALIST_EQUIPMENT[97] 1
			writearraytofile SPECIALIST_EQUIPMENT F_SPECIAL_LOADOUT_AMCTC
			globalsound FOUND_EQUIPMENT
			add TREASURE_FOUND 1
			killit
			}

enda

spriteshadow 22617
useractor notenemy 22617 // GP-63 for Geoffrey
sizeto 24 24

set item_num 81
state SPECIAL_SETTING

    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
           ifcansee
			ifaction ZERO
			{
			userquote 3206
			set DISP_GUN_CHAR MI_GEOFFREY
			state display_spec_gun
			setarray SPECIALIST_EQUIPMENT[81] 1
			writearraytofile SPECIALIST_EQUIPMENT F_SPECIAL_LOADOUT_AMCTC
			globalsound FOUND_EQUIPMENT
			add TREASURE_FOUND 1
			killit
			}

enda

spriteshadow 29080
useractor notenemy 29080 // Cutlass for Geoffrey - axon library
sizeto 24 24

set item_num 95
state SPECIAL_SETTING

    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
           ifcansee
			ifaction ZERO
			{
			userquote 3206
			set DISP_GUN_CHAR MI_GEOFFREY
			state display_spec_gun
			setarray SPECIALIST_EQUIPMENT[95] 1
			writearraytofile SPECIALIST_EQUIPMENT F_SPECIAL_LOADOUT_AMCTC
			globalsound FOUND_EQUIPMENT
			add TREASURE_FOUND 1
			killit
			}

enda

spriteshadow 22595
useractor notenemy 22595 // Auto-shotty for Geoffrey
sizeto 24 24

set item_num 79
state SPECIAL_SETTING

    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
           ifcansee
		    ifaction ZERO
			{
			userquote 3206
			set DISP_GUN_CHAR MI_GEOFFREY
			state display_spec_gun
			setarray SPECIALIST_EQUIPMENT[79] 1
			writearraytofile SPECIALIST_EQUIPMENT F_SPECIAL_LOADOUT_AMCTC
			globalsound FOUND_EQUIPMENT
			add TREASURE_FOUND 1
			killit
			}

enda

spriteshadow 22538
useractor notenemy 22538 // 40MM launcher for James
sizeto 24 24

set item_num 77
state SPECIAL_SETTING

    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
           ifcansee
		    ifaction ZERO
			{
			userquote 3200
			set DISP_GUN_CHAR MI_JAMES
			state display_spec_gun
			setarray SPECIALIST_EQUIPMENT[77] 1
			writearraytofile SPECIALIST_EQUIPMENT F_SPECIAL_LOADOUT_AMCTC
			globalsound FOUND_EQUIPMENT
			add TREASURE_FOUND 1
			killit
			}

enda

spriteshadow 22571
useractor notenemy 22571 // G36 for James
sizeto 20 20

set item_num 78
state SPECIAL_SETTING

    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
           ifcansee
		    ifaction ZERO
			{
			userquote 3200
			set DISP_GUN_CHAR MI_JAMES
			state display_spec_gun
			setarray SPECIALIST_EQUIPMENT[78] 1
			writearraytofile SPECIALIST_EQUIPMENT F_SPECIAL_LOADOUT_AMCTC
			globalsound FOUND_EQUIPMENT
			add TREASURE_FOUND 1
			killit
			}

enda

spriteshadow 29118
useractor notenemy 29118 // Dark matter XM8 for James
sizeto 22 22

set item_num 98
state SPECIAL_SETTING

    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
           ifcansee
		    ifaction ZERO
			{
			userquote 3200
			set DISP_GUN_CHAR MI_JAMES
			state display_spec_gun
			setarray SPECIALIST_EQUIPMENT[98] 1
			writearraytofile SPECIALIST_EQUIPMENT F_SPECIAL_LOADOUT_AMCTC
			globalsound FOUND_EQUIPMENT
			add TREASURE_FOUND 1
			killit
			}

enda

spriteshadow 22692
useractor notenemy 22692 // MSC-12 for Mikko
sizeto 18 18

set item_num 85
state SPECIAL_SETTING

ifaction ZERO
	{
	ifl INTERNALCOUNT 48 add INTERNALCOUNT 1
	ife INTERNALCOUNT 48
		{
		move STOP spin
		}
	else move ITEM_FORWARD getv geth
	}

    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
           ifcansee
		    ifaction ZERO
			{
			userquote 3207
			set DISP_GUN_CHAR MI_MIKKO
			state display_spec_gun
			setarray SPECIALIST_EQUIPMENT[85] 1
			writearraytofile SPECIALIST_EQUIPMENT F_SPECIAL_LOADOUT_AMCTC
			globalsound FOUND_EQUIPMENT
			add TREASURE_FOUND 1
			killit
			}

enda

spriteshadow 16573
useractor notenemy 16573 // Meson cannon for Micky
sizeto 24 24

set item_num 54
state SPECIAL_SETTING

    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
            ifcansee
			 ifaction ZERO
			{
			userquote 3208
			set DISP_GUN_CHAR MI_MICKY
			state display_spec_gun
			setarray SPECIALIST_EQUIPMENT[54] 1
			writearraytofile SPECIALIST_EQUIPMENT F_SPECIAL_LOADOUT_AMCTC
			globalsound FOUND_EQUIPMENT
			add TREASURE_FOUND 1
			killit
			}

enda

spriteshadow 16107
useractor notenemy 16107 // UMP45 for James
sizeto 24 24

set item_num 55
state SPECIAL_SETTING

    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
            ifcansee
			 ifaction ZERO
			{
			userquote 3200
			set DISP_GUN_CHAR MI_JAMES
			state display_spec_gun
			setarray SPECIALIST_EQUIPMENT[55] 1
			writearraytofile SPECIALIST_EQUIPMENT F_SPECIAL_LOADOUT_AMCTC
			globalsound FOUND_EQUIPMENT
			add TREASURE_FOUND 1
			killit
			}

enda

spriteshadow 29080
useractor notenemy 29089 // Annihilator for Zaxtor
sizeto 16 16

set item_num 93
state SPECIAL_SETTING

    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
            ifcansee
			 ifaction ZERO
			{
			userquote 3201
			set DISP_GUN_CHAR MI_ZAXTOR
			state display_spec_gun
			setarray SPECIALIST_EQUIPMENT[93] 1
			writearraytofile SPECIALIST_EQUIPMENT F_SPECIAL_LOADOUT_AMCTC
			globalsound FOUND_EQUIPMENT
			add TREASURE_FOUND 1
			killit
			}

enda

spriteshadow 29125
useractor notenemy 29125 // elemental launcher for Zaxtor - library
sizeto 24 24

set item_num 99
state SPECIAL_SETTING

    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
           ifcanseetarget
		    ifaction ZERO
			{
			userquote 3201
			set DISP_GUN_CHAR MI_ZAXTOR
			state display_spec_gun
			setarray SPECIALIST_EQUIPMENT[99] 1
			writearraytofile SPECIALIST_EQUIPMENT F_SPECIAL_LOADOUT_AMCTC
			globalsound FOUND_EQUIPMENT
			add TREASURE_FOUND 1
			killit
			}

enda

spriteshadow 29145
useractor notenemy 29145 // KRISS for Sang - Cliffship
sizeto 24 24

set item_num 92
state SPECIAL_SETTING

    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
            ifcansee
			 ifaction ZERO
			{
			userquote 3204
			set DISP_GUN_CHAR MI_SANG
			state display_spec_gun
			setarray SPECIALIST_EQUIPMENT[92] 1
			writearraytofile SPECIALIST_EQUIPMENT F_SPECIAL_LOADOUT_AMCTC
			globalsound FOUND_EQUIPMENT
			add TREASURE_FOUND 1
			killit
			}

enda

spriteshadow 24051
useractor notenemy 24051 // Flam4 for Kagura
sizeto 18 18

set item_num 90
state SPECIAL_SETTING

    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
            ifcansee
			 ifaction ZERO
			{
			userquote 3210
			set DISP_GUN_CHAR MI_KAGURA
			state display_spec_gun
			setarray SPECIALIST_EQUIPMENT[90] 1
			writearraytofile SPECIALIST_EQUIPMENT F_SPECIAL_LOADOUT_AMCTC
			globalsound FOUND_EQUIPMENT
			add TREASURE_FOUND 1
			killit
			}

enda

spriteshadow 29727
useractor notenemy 29727 // Kuwabara for Kagura
sizeto 18 18

set item_num 104
state SPECIAL_SETTING

    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
            ifcansee
			 ifaction ZERO
			{
			userquote 3210
			set DISP_GUN_CHAR MI_KAGURA
			state display_spec_gun
			setarray SPECIALIST_EQUIPMENT[104] 1
			writearraytofile SPECIALIST_EQUIPMENT F_SPECIAL_LOADOUT_AMCTC
			globalsound FOUND_EQUIPMENT
			add TREASURE_FOUND 1
			killit
			}

enda

spriteshadow 18086
useractor notenemy 18086 // Nemesis Staff for Sang
sizeto 22 22

set item_num 57
state SPECIAL_SETTING

    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
            ifcansee
			 ifaction ZERO
			{
			userquote 3204
			set DISP_GUN_CHAR MI_SANG
			state display_spec_gun
			setarray SPECIALIST_EQUIPMENT[57] 1
			writearraytofile SPECIALIST_EQUIPMENT F_SPECIAL_LOADOUT_AMCTC
			globalsound FOUND_EQUIPMENT
			add TREASURE_FOUND 1
			killit
			}

enda

spriteshadow 18011
useractor notenemy 18011 // AWMSniper for Mikko
sizeto 16 22

set item_num 59
state SPECIAL_SETTING

    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
            ifcansee
			ifaction ZERO
			{
			userquote 3207
			set DISP_GUN_CHAR MI_MIKKO
			state display_spec_gun
			setarray SPECIALIST_EQUIPMENT[59] 1
			writearraytofile SPECIALIST_EQUIPMENT F_SPECIAL_LOADOUT_AMCTC
			globalsound FOUND_EQUIPMENT
			add TREASURE_FOUND 1
			killit
			}

enda

spriteshadow 14977
useractor notenemy 14977 // Beretta for James
sizeto 22 22

set item_num 88
state SPECIAL_SETTING

    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
            ifcansee
			 ifaction ZERO
			{
			userquote 3200
			set DISP_GUN_CHAR MI_JAMES
			state display_spec_gun
			setarray SPECIALIST_EQUIPMENT[88] 1
			writearraytofile SPECIALIST_EQUIPMENT F_SPECIAL_LOADOUT_AMCTC
			globalsound FOUND_EQUIPMENT
			add TREASURE_FOUND 1
			killit
			}

enda

spriteshadow 22645
useractor notenemy 22645 // MP5K for Zaxtor
sizeto 22 22

set item_num 82
state SPECIAL_SETTING

    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
            ifcansee
			 ifaction ZERO
			{
			userquote 3201
			set DISP_GUN_CHAR MI_ZAXTOR
			state display_spec_gun
			setarray SPECIALIST_EQUIPMENT[82] 1
			writearraytofile SPECIALIST_EQUIPMENT F_SPECIAL_LOADOUT_AMCTC
			globalsound FOUND_EQUIPMENT
			add TREASURE_FOUND 1
			killit
			}

enda

spriteshadow 9163
useractor notenemy 9163 // DZ Firestorm for Zaxtor
sizeto 24 24

set item_num 52
state SPECIAL_SETTING

    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
            ifcansee
			 ifaction ZERO
			{
			userquote 3201
			set DISP_GUN_CHAR MI_ZAXTOR
			state display_spec_gun
			setarray SPECIALIST_EQUIPMENT[52] 1
			writearraytofile SPECIALIST_EQUIPMENT F_SPECIAL_LOADOUT_AMCTC
			globalsound FOUND_EQUIPMENT
			add TREASURE_FOUND 1
			killit
			}

enda

spriteshadow 15918
useractor notenemy 15918 // Exp crossbow for James
sizeto 16 16

set item_num 49
state SPECIAL_SETTING

    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
            ifcansee
			 ifaction ZERO
			{
			userquote 3200
			set DISP_GUN_CHAR MI_JAMES
			state display_spec_gun
			setarray SPECIALIST_EQUIPMENT[49] 1
			writearraytofile SPECIALIST_EQUIPMENT F_SPECIAL_LOADOUT_AMCTC
			globalsound FOUND_EQUIPMENT
			add TREASURE_FOUND 1
			killit
			}

enda

spriteshadow 16079
useractor notenemy 16079 // KSG-12 for James
sizeto 24 24

set item_num 53
state SPECIAL_SETTING

    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
            ifcansee
			 ifaction ZERO
				{
				userquote 3200
				set DISP_GUN_CHAR MI_JAMES
				state display_spec_gun
				setarray SPECIALIST_EQUIPMENT[53] 1
				writearraytofile SPECIALIST_EQUIPMENT F_SPECIAL_LOADOUT_AMCTC
				globalsound FOUND_EQUIPMENT
				add TREASURE_FOUND 1
				killit
				}

enda

spriteshadow 29851
useractor notenemy 29851 // Quietus Blade

ifaction 0
	{
	readarrayfromfile SPECIALIST_EQUIPMENT F_SPECIAL_LOADOUT_AMCTC
	sizeto 20 20
	state set_mdflags
	set command 32768
	ifn SPECIALIST_EQUIPMENT[105] 0
		{
		ife SPECIALIST_EQUIPMENT[105] 1 { spawn GOLD_AMULET killit }
		else ife SPECIALIST_EQUIPMENT[105] 2 { spawn GOLD_AMULET killit }
		else ifand SPECIALIST_EQUIPMENT[105] 32 { spawn GOLD_AMULET killit }
		}
	action ZERO
	}

    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
            ifcansee
			 ifaction ZERO
			{
			ifand SPECIALIST_EQUIPMENT[105] 32 nullop else
				{
				userquote 3220
				set temp SPECIALIST_EQUIPMENT[105]
				xor temp 32
				setarray SPECIALIST_EQUIPMENT[105] temp
				}
			ifand SPECIALIST_EQUIPMENT[105] 32
			 ifand SPECIALIST_EQUIPMENT[105] 64
			  ifand SPECIALIST_EQUIPMENT[105] 128
				{
				userquote 3221
				setarray SPECIALIST_EQUIPMENT[105] 1
				}
			writearraytofile SPECIALIST_EQUIPMENT F_SPECIAL_LOADOUT_AMCTC
			globalsound FOUND_EQUIPMENT
			add TREASURE_FOUND 1
			palfrom 20 60 60 60

			state PICKUP_DISPLAY
			set picked_up_tile sprite[].picnum
			set item_amount -1

			killit
			}

enda

spriteshadow 29852
useractor notenemy 29852 // Quietus Pommel

ifaction 0
	{
	readarrayfromfile SPECIALIST_EQUIPMENT F_SPECIAL_LOADOUT_AMCTC
	sizeto 20 20
	state set_mdflags
	set command 32768
	ifn SPECIALIST_EQUIPMENT[105] 0
		{
		ife SPECIALIST_EQUIPMENT[105] 1 { spawn GOLD_AMULET killit }
		else ife SPECIALIST_EQUIPMENT[105] 2 { spawn GOLD_AMULET killit }
		else ifand SPECIALIST_EQUIPMENT[105] 64 { spawn GOLD_AMULET killit }
		}
	action ZERO
	}

    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
            ifcansee
			 ifaction ZERO
			{
			ifand SPECIALIST_EQUIPMENT[105] 64 nullop else
				{
				userquote 3220
				set temp SPECIALIST_EQUIPMENT[105]
				xor temp 64
				setarray SPECIALIST_EQUIPMENT[105] temp
				}
			ifand SPECIALIST_EQUIPMENT[105] 32
			 ifand SPECIALIST_EQUIPMENT[105] 64
			  ifand SPECIALIST_EQUIPMENT[105] 128
				{
				userquote 3221
				setarray SPECIALIST_EQUIPMENT[105] 1
				}
			writearraytofile SPECIALIST_EQUIPMENT F_SPECIAL_LOADOUT_AMCTC
			globalsound FOUND_EQUIPMENT
			add TREASURE_FOUND 1
			palfrom 20 60 60 60

			state PICKUP_DISPLAY
			set picked_up_tile sprite[].picnum
			set item_amount -1

			killit
			}

enda

spriteshadow 29853
useractor notenemy 29853 // Quietus handle

ifaction 0
	{
	readarrayfromfile SPECIALIST_EQUIPMENT F_SPECIAL_LOADOUT_AMCTC
	sizeto 20 20
	state set_mdflags
	set command 32768
	ifn SPECIALIST_EQUIPMENT[105] 0
		{
		ife SPECIALIST_EQUIPMENT[105] 1 { spawn GOLD_AMULET killit }
		else ife SPECIALIST_EQUIPMENT[105] 2 { spawn GOLD_AMULET killit }
		else ifand SPECIALIST_EQUIPMENT[105] 128 { spawn GOLD_AMULET killit }
		}
	action ZERO
	}

    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
            ifcansee
			 ifaction ZERO
			{
			ifand SPECIALIST_EQUIPMENT[105] 128 nullop else
				{
				userquote 3220
				set temp SPECIALIST_EQUIPMENT[105]
				xor temp 128
				setarray SPECIALIST_EQUIPMENT[105] temp
				}
			ifand SPECIALIST_EQUIPMENT[105] 32
			 ifand SPECIALIST_EQUIPMENT[105] 64
			  ifand SPECIALIST_EQUIPMENT[105] 128
				{
				userquote 3221
				setarray SPECIALIST_EQUIPMENT[105] 1
				}
			writearraytofile SPECIALIST_EQUIPMENT F_SPECIAL_LOADOUT_AMCTC
			globalsound FOUND_EQUIPMENT
			add TREASURE_FOUND 1
			palfrom 20 60 60 60

			state PICKUP_DISPLAY
			set picked_up_tile sprite[].picnum
			set item_amount -1

			killit
			}

enda

spriteshadow 15991
useractor notenemy 15991 // Tibet Seige cannon for Merlijn
sizeto 24 24

set item_num 50
state SPECIAL_SETTING

    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
           ifcansee
			ifaction ZERO
			{
			userquote 3202
			set DISP_GUN_CHAR MI_MERLIJN
			state display_spec_gun
			setarray SPECIALIST_EQUIPMENT[50] 1
			writearraytofile SPECIALIST_EQUIPMENT F_SPECIAL_LOADOUT_AMCTC
			globalsound FOUND_EQUIPMENT
			add TREASURE_FOUND 1
			killit
			}

enda

spriteshadow 16015
useractor notenemy 16015 // Super Galil for Zaxtor
sizeto 24 24

set item_num 70
state SPECIAL_SETTING

    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
            ifcansee
			 ifaction ZERO
			{
			userquote 3201
			set DISP_GUN_CHAR MI_ZAXTOR
			state display_spec_gun
			setarray SPECIALIST_EQUIPMENT[70] 1
			writearraytofile SPECIALIST_EQUIPMENT F_SPECIAL_LOADOUT_AMCTC
			globalsound FOUND_EQUIPMENT
			add TREASURE_FOUND 1
			killit
			}

enda

spriteshadow 19917
useractor notenemy 19917 // Cycloid plasma gun for Zaxtor
sizeto 20 20

set item_num 75
state SPECIAL_SETTING

    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
            ifcansee
			 ifaction ZERO
			{
			userquote 3201
			set DISP_GUN_CHAR MI_ZAXTOR
			state display_spec_gun
			setarray SPECIALIST_EQUIPMENT[75] 1
			writearraytofile SPECIALIST_EQUIPMENT F_SPECIAL_LOADOUT_AMCTC
			globalsound FOUND_EQUIPMENT
			add TREASURE_FOUND 1
			killit
			}

enda

spriteshadow 20806
useractor notenemy 20806 // Tesla AR rifle for Snowfall
sizeto 26 26

set item_num 91
state SPECIAL_SETTING

    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
            ifcansee
			 ifaction ZERO
			{
			userquote 3209
			set DISP_GUN_CHAR MI_SNOWFALL
			state display_spec_gun
			setarray SPECIALIST_EQUIPMENT[91] 1
			writearraytofile SPECIALIST_EQUIPMENT F_SPECIAL_LOADOUT_AMCTC
			globalsound FOUND_EQUIPMENT
			add TREASURE_FOUND 1
			killit
			}

enda

spriteshadow 29096
useractor notenemy 29096 // ARX rifle for Snowfall - cliffship
sizeto 26 26

set item_num 96
state SPECIAL_SETTING

    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
            ifcansee
			 ifaction ZERO
			{
			userquote 3209
			set DISP_GUN_CHAR MI_SNOWFALL
			state display_spec_gun
			setarray SPECIALIST_EQUIPMENT[96] 1
			writearraytofile SPECIALIST_EQUIPMENT F_SPECIAL_LOADOUT_AMCTC
			globalsound FOUND_EQUIPMENT
			add TREASURE_FOUND 1
			killit
			}

enda

spriteshadow 16069
useractor notenemy 16069 // Guandao for Merlijn
sizeto 24 24

set item_num 51
state SPECIAL_SETTING

    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
           ifcanseetarget
		    ifaction ZERO
			{
			userquote 3202
			set DISP_GUN_CHAR MI_MERLIJN
			state display_spec_gun
			setarray SPECIALIST_EQUIPMENT[51] 1
			writearraytofile SPECIALIST_EQUIPMENT F_SPECIAL_LOADOUT_AMCTC
			globalsound FOUND_EQUIPMENT
			add TREASURE_FOUND 1
			killit
			}

enda

// WEAPON CASE =================================================================================================================================================

defstate case_store_initpos
    // get initpos
	geta[].x XREPEAT_SAVED
	geta[].y YREPEAT_SAVED

    // move the case position further back
    cos temp sprite[].ang
    div temp 96
    sub XREPEAT_SAVED temp

    sin temp sprite[].ang
    div temp 96
    sub YREPEAT_SAVED temp
ends

defstate case_restore_initpos
    seta[].x XREPEAT_SAVED
	seta[].y YREPEAT_SAVED
ends

defstate item_case
ifaction 0
{
ifn LOTAGSAVED 0
{
checkactivatormotion LOTAGSAVED
 ife RETURN 1
	{
    state case_store_initpos
	action ZERO
	set INTERNALCOUNT 0
	}
}
else
ifpdistl 1536
 ifp pfacing
  ifp palive
	{
	set player_use 0
	 ifhitspace
	  ifcount 13
		{
        state case_store_initpos
		ifactor 29684 sound WOOD_SCRAPE
		action ZERO
		set INTERNALCOUNT 0
		}
	}
}

ife INTERNALCOUNT 0
 ifaction ONE
  ifactor 16011
{
    state case_restore_initpos
    set INTERNALCOUNT -1
}

ifaction ZERO
{
add INTERNALCOUNT 1
move FORWARD geth
ifn LOTAGSAVED 0 nullop else
	{
	lockplayer 20
	state lower_weapon
	}
 ifg INTERNALCOUNT 25
	{
	lockplayer 0
	move STOP
	ifactor 29684
		{
		stopsound WOOD_SCRAPE
		soundonce WOODDOOR4
		}
	else
	soundonce OPEN_AMMO_B
	action ONE
	ifn cheated 0 spawn SMALLSMOKE
	else espawnvar HITAGSAVED
	set INTERNALCOUNT 0
	}
}
ends

useractor notenemy 16011 state item_case enda // modern case
useractor notenemy 29684 state item_case enda // ancient case

// BOTTLE CAPS =================================================================================================================================================

useractor notenemy 21238 // Pepsi Bottle Cap

ifaction 0
{
readgamevar FAITHFUL_LICENSE
ifspritepal 3
	{
	ifand FAITHFUL_LICENSE 2 action FORM else killit
	}
else
	{
	ifand FAITHFUL_LICENSE 16 killit
	action ZERO
	}
}

ifaction ZERO
{
		 ifpdistl RETRIEVEDISTANCE // quote check ok
		  ifp pfacing
		   ifp palive
			{
			set player_use 0
			 ifhitspace
				{
				state PICKUP_DISPLAY
				sound FOUND_TREASURE
				geta[].picnum picked_up_tile
				setarray picked_up_inven[1] 60
				set item_amount -1
				xorvar FAITHFUL_LICENSE 16
				savegamevar FAITHFUL_LICENSE
				killit
				}
			}
}

enda

useractor notenemy 21239 // Cola Bottle Cap

ifaction 0
{
readgamevar FAITHFUL_LICENSE
ifspritepal 3
	{
	ifand FAITHFUL_LICENSE 4 action FORM else killit
	}
else
	{
	ifand FAITHFUL_LICENSE 32 killit
	action ZERO
	}
}


ifaction ZERO
{
		 ifpdistl RETRIEVEDISTANCE // quote check ok
		  ifp pfacing
		   ifp palive
			{
			set player_use 0
			 ifhitspace
				{
				state PICKUP_DISPLAY
				sound FOUND_TREASURE
				geta[].picnum picked_up_tile
				setarray picked_up_inven[1] 60
				set item_amount -1
				xorvar FAITHFUL_LICENSE 32
				savegamevar FAITHFUL_LICENSE
				killit
				}
			}
}

enda

useractor notenemy 21240 // Capitol Bottle cap

ifaction 0
{
readgamevar FAITHFUL_LICENSE
ifspritepal 3
	{
	ifand FAITHFUL_LICENSE 8 action FORM else killit
	}
else
	{
	ifand FAITHFUL_LICENSE 64 killit
	action ZERO
	}
}
ifaction ZERO
{
		 ifpdistl RETRIEVEDISTANCE // quote check ok
		  ifp pfacing
		   ifp palive
			{
			set player_use 0
			 ifhitspace
				{
				state PICKUP_DISPLAY
				sound FOUND_TREASURE
				geta[].picnum picked_up_tile
				setarray picked_up_inven[1] 60
				set item_amount -1
				xorvar FAITHFUL_LICENSE 64
				savegamevar FAITHFUL_LICENSE
				killit
				}
			}
}

enda

// POLYMERS CANISTER =================================================================================================================================================

useractor notenemy POLY_CANISTER
sizeat 20 20

enda

// MAGIC ORB =================================================================================================================================================

spritenoshade MAGIC_ORB
spriteshadow MAGIC_ORB

useractor notenemy MAGIC_ORB

sizeto 12 12

ifaction 0
	{
	ife ORBS_FOUND 0 readgamevar ORBS_FOUND
	state set_mdflags
	set command 32768
	set INTERNALCOUNT 0
	action ZERO
	}

      ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
				{
				globalsound MAG_SPH
				addvar ORBS_FOUND 1
				savegamevar ORBS_FOUND
				palfrom 20 60 60 60
				add TREASURE_FOUND 5
				userquote 1054
				geta[].picnum picked_up_tile
				setarray picked_up_inven[1] 60
				set item_amount -1
				killit
				}
enda

// PICKUP CODE----------------------------ITEMS!-------------------------------------------------

var DECORATION_ID -1 2
defstate decoration_item
ifaction 0
{
readarrayfromfile DECORATIONS F_DECORATIONS_AMCTC
action ZERO
}

ifaction ZERO
	{
	ifspritepal 3
		{
		ife DECORATIONS[DECORATION_ID] 0 killit
		else action FORM
		}
	else
		{
		ife DECORATIONS[DECORATION_ID] 1 killit
		else
		 ifpdistl RETRIEVEDISTANCE // quote check ok
		  ifp pfacing
		   ifp palive
			{
			set player_use 0
			 ifhitspace
				{
				state PICKUP_DISPLAY
				quote 1220
				sound FOUND_TREASURE
					ifactor 20100 set picked_up_tile 3587 else
					ifactor 20120 set picked_up_tile 3587 else
					ifactor 20128 set picked_up_tile 3587 else
					ifactor 20148 set picked_up_tile 3587 else
					ifactor 20170 set picked_up_tile 3587 else
					ifactor 20171 set picked_up_tile 3587 else
					ifactor 20172 set picked_up_tile 3587 else
					ifactor 20328
						{
						operaterespawns 159
						add TREASURE_FOUND 50
						set picked_up_tile 3587
						}
						else
					geta[].picnum picked_up_tile
					setarray picked_up_inven[1] 60
					set item_amount -1
				setarray DECORATIONS[DECORATION_ID] 1
				writearraytofile DECORATIONS F_DECORATIONS_AMCTC
				killit
				}
			}
		}
	}
ends

spriteshadow 20132
useractor notenemy 20132

ifaction 0
{
seta[].blend 255
readarrayfromfile DECORATIONS F_DECORATIONS_AMCTC
ife DECORATIONS[8] 0 killit
action ZERO
}

enda

spriteshadow 20134
useractor notenemy 20134

ifaction 0
{
seta[].blend 255
readarrayfromfile DECORATIONS F_DECORATIONS_AMCTC
ife DECORATIONS[14] 0 killit
action ZERO
}

ifaction ZERO
	{
	ifpdistl 1024
	 ifp pfacing
	  ifp palive
		{
		set player_use 0
		 ifhitspace
		  ifcount 13
			{
			sound LIGHT_SWITCH
			ifspritepal 0 spritepal 21
			else ifspritepal 21 spritepal 11
			else ifspritepal 11 spritepal 23
			else ifspritepal 23 spritepal 49
			else ifspritepal 49 spritepal 0
			resetcount
			}
		}
	}

enda

useractor notenemy 20095 set DECORATION_ID 1 state decoration_item enda
useractor notenemy 20096 set DECORATION_ID 2 state decoration_item enda
useractor notenemy 20097 set DECORATION_ID 3 state decoration_item enda
useractor notenemy 20098 set DECORATION_ID 4 state decoration_item enda
useractor notenemy 20099 set DECORATION_ID 5 state decoration_item enda
useractor notenemy 20100 set DECORATION_ID 6 state decoration_item enda
useractor notenemy 20120 set DECORATION_ID 7 state decoration_item enda
useractor notenemy 20121 set DECORATION_ID 8 state decoration_item enda
useractor notenemy 20122 set DECORATION_ID 9 state decoration_item enda
useractor notenemy 20128 set DECORATION_ID 10 state decoration_item enda
useractor notenemy 20129 set DECORATION_ID 11 state decoration_item enda
useractor notenemy 20130 set DECORATION_ID 12 state decoration_item enda
useractor notenemy 20131 set DECORATION_ID 13 state decoration_item enda
useractor notenemy 20133 set DECORATION_ID 14 state decoration_item enda
useractor notenemy 20138 set DECORATION_ID 15 state decoration_item enda
useractor notenemy 20141 set DECORATION_ID 16 state decoration_item enda
useractor notenemy 20142 set DECORATION_ID 17 state decoration_item enda
useractor notenemy 20143 set DECORATION_ID 18 state decoration_item enda
useractor notenemy 20148 set DECORATION_ID 19 state decoration_item enda
useractor notenemy 20161 set DECORATION_ID 20 state decoration_item enda
useractor notenemy 20170 set DECORATION_ID 21 state decoration_item enda
useractor notenemy 20171 set DECORATION_ID 22 state decoration_item enda
useractor notenemy 20172 set DECORATION_ID 23 state decoration_item enda
useractor notenemy 20328 set DECORATION_ID 24 state decoration_item enda
useractor notenemy 20173 set DECORATION_ID 25 state decoration_item enda
useractor notenemy 20176 sizeat 16 16 set DECORATION_ID 26 state decoration_item enda
useractor notenemy 20177 sizeat 16 16 set DECORATION_ID 27 state decoration_item enda
useractor notenemy 20178 sizeat 16 16 set DECORATION_ID 28 state decoration_item enda
useractor notenemy 20179 sizeat 16 16 set DECORATION_ID 29 state decoration_item enda
useractor notenemy 20180 sizeat 16 16 set DECORATION_ID 30 state decoration_item enda

useractor notenemy 22502 set DECORATION_ID 31 state decoration_item enda
useractor notenemy 22503 set DECORATION_ID 32 state decoration_item enda
useractor notenemy 22504 set DECORATION_ID 33 state decoration_item enda
useractor notenemy 22505 set DECORATION_ID 34 state decoration_item enda
useractor notenemy 22506 set DECORATION_ID 35 state decoration_item enda
useractor notenemy 22507 set DECORATION_ID 36 state decoration_item enda
useractor notenemy 22508 set DECORATION_ID 37 state decoration_item enda
useractor notenemy 22509 set DECORATION_ID 38 state decoration_item enda
useractor notenemy 22512 set DECORATION_ID 39 state decoration_item enda
useractor notenemy 22513 set DECORATION_ID 40 state decoration_item enda
useractor notenemy 22514 set DECORATION_ID 41 state decoration_item enda
useractor notenemy 22515 set DECORATION_ID 42 state decoration_item enda
useractor notenemy 22516 set DECORATION_ID 43 state decoration_item enda
useractor notenemy 22517 set DECORATION_ID 44 state decoration_item enda
useractor notenemy 22518 set DECORATION_ID 45 state decoration_item enda

useractor notenemy 17632 set DECORATION_ID 46 state decoration_item enda
useractor notenemy 17633 set DECORATION_ID 47 state decoration_item enda
useractor notenemy 17634 set DECORATION_ID 48 state decoration_item enda
useractor notenemy 17635 set DECORATION_ID 49 state decoration_item enda
