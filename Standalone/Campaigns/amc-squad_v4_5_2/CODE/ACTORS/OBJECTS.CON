/*
-------------------------------------------------------------------------------
===============================================================================

         -ooo:             +oo-            `+oo.       ./+oooooooooo+/:
        /NMMMN+            NMMNo`         -dMMM/      .mMMNmmmmmmmmmMMNo
       /NMd:mMMo           NMMNMd:      `oNMNMM/      :MMM/.........mMMh
      oNMd. -mMMy`         NMN:mMNs`   -hMm/mMM/      :MMM:         ::-.
    `sMMh`   .dMMh`        NMN .sNMd:`oNMh. mMM/      :MMM:
   `yMMMdhhhhhmMMMd.       NMN   /mMNdMm+`  mMM/      :MMM:         ss+:
  `hMMdhhhhhhhhhmMMm-      NMN    .yMMh.    mMM/      :MMM/.........mMMh
 .dMMs`         .hMMm:     NMN      :/`     mMM/      .mMMNmmmmmmmmmMMNo
 :oo+            `+oo+     +o+              +oo.       ./++ooooooooo+/:

###############################################################################
+ The AMC Squad
+ CON code by James Stanfield, Cedric "Sangman" Haegeman, Dino Bollinger,
+              Mikko Sandt, Cedric "Zaxtor" Lutes and Dan "Danarama" Gaskill
-------------------------------------------------------------------------------
* See AMC_MAIN.CON for a full list of script authors.

Feel free to use any code in the game for your own uses; just make
sure to mention the authors and/or "The AMC Squad" in your credits.
--------------------------------------------------------------------------------
NOTES:

--------------------------------------------------------------------------------
*/


damageeventtilerange 263 275
damageeventtile 293
damageeventtile 297
damageeventtile W_TECHWALL15
damageeventtile 301
damageeventtilerange 305 306
damageeventtilerange 4120 4127
damageeventtilerange 4130 4134
damageeventtile 875
damageeventtile 4136
damageeventtile 4138
damageeventtile 4140
damageeventtile 4142
damageeventtile 8616
damageeventtile 8618
damageeventtile 5645
damageeventtilerange 4800 4803
damageeventtile 10507
damageeventtile 3896 // register cash draw
damageeventtile 3470 // vending machine
damageeventtile 4199 // milk
damageeventtile 407 // fan
damageeventtile 595 // grate
damageeventtilerange 7194 7196
damageeventtile 10579
damageeventtilerange 7208 7210 // dis base monitors
damageeventtile 12325
damageeventtile 12329
damageeventtile 13941
damageeventtile 19694
damageeventtile 18622
damageeventtile 20359
damageeventtile 14276 // vending machine
damageeventtile 14278 // vending machine
damageeventtile 9490 // gun cabinet
damageeventtilerange 5644 5649 // SW cars
damageeventtile 5692 // SW car back
damageeventtilerange 12411 12415 // russian cars
damageeventtilerange 17009 17012 // computer monitors
damageeventtilerange 17014 17016 // computer
damageeventtile 22418 // vending machine
damageeventtile 22420 // vending machine
damageeventtilerange 16609 16610
damageeventtile SCREENBREAK20
damageeventtilerange 5785 5786
damageeventtilerange 5884 5886
damageeventtile 26940

// breakable light textures
damageeventtile 9558
damageeventtile 12299
damageeventtile 13300
damageeventtile 34357
damageeventtile 34359
damageeventtile 34361

gamevar DAMAGE_TILE 0 0

defstate TILE_DAMAGE_STUFF
	switch temp
		case 875 sound VENT_BUST sound GLASS_HEAVYBREAK lotsofglass 5 debris SCRAP1 8 set DAMAGE_TILE 20360 break
		case W_TECHWALL2 sound VENT_BUST debris SCRAP1 8 set DAMAGE_TILE 362 break
		case W_TECHWALL3 sound VENT_BUST debris SCRAP1 8 set DAMAGE_TILE 360 break
		case W_TECHWALL4 sound VENT_BUST debris SCRAP1 8 set DAMAGE_TILE 361 break
		case W_TECHWALL5 sound VENT_BUST debris SCRAP1 8 set DAMAGE_TILE 4135 break
		case W_TECHWALL6 sound VENT_BUST debris SCRAP1 8 set DAMAGE_TILE 4137 break
		case W_TECHWALL7 sound VENT_BUST debris SCRAP1 8 set DAMAGE_TILE 4139 break
		case W_TECHWALL8 sound VENT_BUST debris SCRAP1 8 set DAMAGE_TILE 4141 break
		case W_TECHWALL9 sound VENT_BUST debris SCRAP1 8 set DAMAGE_TILE 4143 break
		case W_TECHWALL10 sound VENT_BUST debris SCRAP1 8 set DAMAGE_TILE 4145 break
		case W_TECHWALL1
		case W_TECHWALL11
		case W_TECHWALL12
		case W_TECHWALL13
		case W_TECHWALL14 sound VENT_BUST debris SCRAP1 8 set DAMAGE_TILE 363 break
		case W_TECHWALL15 sound VENT_BUST debris SCRAP1 8 set DAMAGE_TILE 4147 break
		case W_TECHWALL16 sound VENT_BUST debris SCRAP1 8 set DAMAGE_TILE 4144 break
		case 7194
		case 7195
		case 7196
			sound GLASS_BREAKING lotsofglass 15 set DAMAGE_TILE 7337 break
		case 10579 sound GLASS_BREAKING lotsofglass 15 set DAMAGE_TILE 10580 break
		case 8616
		case 17012 sound VENT_BUST debris SCRAP1 8 set DAMAGE_TILE 17017 break
		case 8618
		case 17014
		case 17015 sound VENT_BUST debris SCRAP1 8 set DAMAGE_TILE 17018 break
		case 19694 sound GLASS_BREAKING lotsofglass 15 set DAMAGE_TILE 19968 break
		case 5645 sound VENT_BUST debris SCRAP1 8 set DAMAGE_TILE 5638 break
		case 407 sound VENT_BUST debris SCRAP1 8 set DAMAGE_TILE 411 break
		case 3894 sound VENT_BUST debris SCRAP1 8 set DAMAGE_TILE 3895 break
		case 595 sound VENT_BUST set DAMAGE_TILE 596 break
		case 13941 sound GLASS_BREAKING lotsofglass 20 set DAMAGE_TILE 13942 break
		case 12413 sound VENT_BUST debris SCRAP1 8 set DAMAGE_TILE 13943 break
		case 12414 sound VENT_BUST debris SCRAP1 8 set DAMAGE_TILE 13944 break
		case 17016 sound VENT_BUST debris SCRAP1 8 set DAMAGE_TILE 17019 break
	   case 18622
	   case 20359
		sound GLASS_BREAKING
		lotsofglass 25
	    set DAMAGE_TILE 20358
	    break
		case SCREENBREAK1
		case SCREENBREAK2
		case SCREENBREAK3
		case SCREENBREAK4
		case SCREENBREAK5
		case SCREENBREAK6
		case SCREENBREAK7
		case SCREENBREAK8
		case SCREENBREAK9
		case SCREENBREAK10
		case SCREENBREAK11
		case SCREENBREAK12
		case SCREENBREAK13
		case SCREENBREAK14
		case SCREENBREAK15
		case SCREENBREAK16
		case SCREENBREAK17
		case SCREENBREAK18
		case SCREENBREAK19
		case SCREENBREAK20
	   case 16609
	   case 16610
	   case 5785
	   case 5786
	   case 5884
	   case 5885
	   case 5886
	   case 4800
	   case 4801
	   case 4802
	   case 4803
		sound GLASS_BREAKING
		lotsofglass 15
		ifrnd 96 set DAMAGE_TILE 357
		else ifrnd 96 set DAMAGE_TILE 358
		else set DAMAGE_TILE 359
		break
	   case 7208
	   case 7209
	   case 7210
		sound GLASS_BREAKING
		lotsofglass 15
		set DAMAGE_TILE 20357
		break
	   case 10507 sound GLASS_BREAKING lotsofglass 15 set DAMAGE_TILE 20356 break
	   case 9490 sound GLASS_BREAKING lotsofglass 15 set DAMAGE_TILE 4738 break
	   case 5644 sound GLASS_BREAKING sound VENT_BUST debris SCRAP1 8 lotsofglass 10 set DAMAGE_TILE 5643 break
	   case 5646 sound GLASS_BREAKING sound VENT_BUST debris SCRAP1 8 lotsofglass 10 set DAMAGE_TILE 5639 break
	   case 5647 sound GLASS_BREAKING sound VENT_BUST debris SCRAP1 8 lotsofglass 10 set DAMAGE_TILE 5640 break
	   case 5648 sound GLASS_BREAKING sound VENT_BUST debris SCRAP1 8 lotsofglass 10 set DAMAGE_TILE 5642 break
	   case 5649 sound GLASS_BREAKING sound VENT_BUST debris SCRAP1 8 lotsofglass 10 set DAMAGE_TILE 5641 break
	   case 5692 sound GLASS_BREAKING sound VENT_BUST debris SCRAP1 8 lotsofglass 10 set DAMAGE_TILE 5691 break
	   case 12415 sound GLASS_BREAKING sound VENT_BUST debris SCRAP1 8 lotsofglass 10 set DAMAGE_TILE 13940 break
	   case 12411 sound GLASS_BREAKING sound VENT_BUST debris SCRAP1 8 lotsofglass 10 set DAMAGE_TILE 13946 break
	   case 12412 sound GLASS_BREAKING sound VENT_BUST debris SCRAP1 8 lotsofglass 10 set DAMAGE_TILE 13945 break
	   case 14276 sound GLASS_BREAKING sound VENT_BUST debris SCRAP1 8 lotsofglass 10 set DAMAGE_TILE 14277 break
	   case 14278 sound GLASS_BREAKING sound VENT_BUST debris SCRAP1 8 lotsofglass 10 set DAMAGE_TILE 14279 break
	   case 17009
	   case 17010
	   case 17011 sound GLASS_BREAKING sound VENT_BUST debris SCRAP1 8 lotsofglass 10 set DAMAGE_TILE 17017 break
	   case 3470 sound GLASS_BREAKING sound VENT_BUST debris SCRAP1 8 lotsofglass 10 set DAMAGE_TILE 3471 break
	   case 4199 sound GLASS_BREAKING sound VENT_BUST debris SCRAP1 8 lotsofglass 10 set DAMAGE_TILE 4203 break
	   case 22418 sound GLASS_BREAKING sound VENT_BUST debris SCRAP1 8 lotsofglass 10 set DAMAGE_TILE 22419 break
	   case 22420 sound GLASS_BREAKING sound VENT_BUST debris SCRAP1 8 lotsofglass 10 set DAMAGE_TILE 22421 break
	   case 3896 sound VENT_BUST debris SCRAP1 8 set DAMAGE_TILE 3897 break
	   case 12329 sound VENT_BUST debris SCRAP1 8 set DAMAGE_TILE 12332 break
	   case 12325 sound VENT_BUST debris SCRAP1 8 set DAMAGE_TILE 12328 break
	   case 26940 sound GLASS_BREAKING sound VENT_BUST debris SCRAP1 8 lotsofglass 10 set DAMAGE_TILE 26941 break
	   // custom shootable lights
	   case 9558
	   case 12299
	   case 13300
	   case 34357
	   case 34359
	   case 34361
	   ifn sector[SECT_NUM].hitag 0 
			{
			sound GLASS_BREAKING 
			lotsofglass 10 
			setarray LIGHT_OPEN[sector[SECT_NUM].hitag] 2 
			ife temp 9558 set DAMAGE_TILE 9559
			ife temp 12299 set DAMAGE_TILE 12300
			ife temp 13300 set DAMAGE_TILE 13286
			ife temp 34357 set DAMAGE_TILE 34358 
			ife temp 34359 set DAMAGE_TILE 34360 
			ife temp 34361 set DAMAGE_TILE 34362 
			}
			else set DAMAGE_TILE -1
		break
	   default set DAMAGE_TILE -1 break
	endswitch
ends

defstate explosion_shake
	dist xydist THISACTOR player[].i
	shiftvarr xydist 8
	clamp xydist 0 96
	ifl xydist 64
		{
		set temp 50
		sub temp xydist
		set screen_shake temp
		div temp 6
		set shake_strength temp
		clamp shake_strength 0 12
		}
ends

onevent EVENT_DAMAGEFLOOR
	set SECT_NUM RETURN
	gets[RETURN].floorpicnum temp
	state TILE_DAMAGE_STUFF
	ifn DAMAGE_TILE -1 sets[RETURN].floorpicnum DAMAGE_TILE
endevent

onevent EVENT_DAMAGECEILING
	set SECT_NUM RETURN
	gets[RETURN].ceilingpicnum temp
	state TILE_DAMAGE_STUFF
	ifn DAMAGE_TILE -1 sets[RETURN].ceilingpicnum DAMAGE_TILE
endevent

onevent EVENT_DAMAGEWALL
	getwall[RETURN].picnum temp
	getwall[RETURN].nextsector SECT_NUM
	state TILE_DAMAGE_STUFF
	ifn DAMAGE_TILE -1 setwall[RETURN].picnum DAMAGE_TILE
endevent

action ANULLACTION 0

move MOUSEVELS 32

define SPACESHUTTLE 487
move SHUTTLEVELS 16
actor SPACESHUTTLE TOUGH
//  ifmove 0          //  Init once
//    move SHUTTLEVELS getv geth
enda


actor SATELLITE TOUGH
  //  ifmove 0 move SHUTTLEVELS getv geth
  //  ifcount 120 move SHUTTLEVELS getv geth randomangle
enda

action BLIMPWAITTORESPAWN

defstate blimphitstate
  cstat 0
  spawn FIRSTGUNSPRITE
  spawn EXPLOSION2

  debris SCRAP1 40      // Weapons and ammo!
  debris SCRAP2 32
  debris SCRAP3 32
  debris SCRAP4 32
  debris SCRAP5 32

  sound PIPEBOMB_EXPLODE
  ifrespawn
  {
    action BLIMPWAITTORESPAWN
    count 0
    cstat 32768
  }
  else
    killit
ends

actor BLIMP 1

  ifaction BLIMPWAITTORESPAWN
  {
    ifcount BLIMPRESPAWNTIME
    {
      action 0
      cstat 0
    }
    break
  }

  ifhitweapon
  {
    ifwasweapon RADIUSEXPLOSION
      state blimphitstate
    ifwasweapon RPG
      state blimphitstate
    strength 1
  }
enda

defstate burningbarrelcode
  fall

  ifcount 32
  {
	  ifactorsound THISACTOR SOFTFIRE_AMBIENCE nullop else sound SOFTFIRE_AMBIENCE
		resetcount
		ifp palive
		  ifpdistl 1480
			ifp phigher
		{
			set fire_damage 2
			state playerincurfiredamage
		}
  }
  ifhitweapon
  {
    sound VENT_BUST
    debris SCRAP1 10
    ifrnd 128
      spawn BURNING
    else
      spawn BURNING2
    killit
  }
ends

actor FIREBARREL
  state burningbarrelcode
enda
actor FIREVASE
  state burningbarrelcode
enda

defstate rats
  ifrnd 128
    spawn ARAT
  ifrnd 128
    spawn ARAT
  ifrnd 128
    spawn ARAT
  ifrnd 128
    spawn ARAT
  ifrnd 128
    spawn ARAT
  ifrnd 128
    spawn ARAT
  ifrnd 128
    spawn ARAT
  ifrnd 128
    spawn ARAT
ends

defstate roaches
  ifrnd 128
    spawn ROACH
  ifrnd 128
    spawn ROACH
  ifrnd 128
    spawn ROACH
  ifrnd 128
    spawn ROACH
  ifrnd 128
    spawn ROACH
  ifrnd 128
    spawn ROACH
  ifrnd 128
    spawn ROACH
  ifrnd 128
    spawn ROACH
ends


action RUBCANDENT 1 1 1 1 1

actor RUBBERCAN WEAK
  ifaction RUBCANDENT
  {
    ifactioncount 16
    {
      strength 0
      action ANULLACTION
      break
    }
  }
  else
    ifhitweapon
  {
    ifwasweapon RADIUSEXPLOSION
    {
      state rats
	  state roaches
      ifrnd 48
        spawn BURNING
      debris SCRAP3 12
      killit
    }
    else
      action RUBCANDENT
  }
enda


defstate MARTINIDRINK
ifpdistl 812
ifp palive
   ifp pfacing
   {
   set player_use 0
	    ifhitspace
		{
		quote 134
		set hit_key 30
		sound DRINKSOME
	  	palfrom 16 0 32
		ife CHAR 3 addphealth 5 else
		ife CHAR 9
			{
			getp[].shield_amount temp
			add temp 2
			clamp temp 0 200
			setp[].shield_amount temp
			addphealth 5
			}
			else
		addphealth 2
	      ife CHAR 0 add INEBRIATION 100
		ife CHAR 1 add INEBRIATION 150
	      ife CHAR 2 add INEBRIATION 50
	      ife CHAR 3 add INEBRIATION 25
	      ife CHAR 4 add INEBRIATION 75
		ife CHAR 5 add INEBRIATION 150
	    ife CHAR 6 add INEBRIATION 100
		ife CHAR 7 add INEBRIATION 100
		ife CHAR 9 add INEBRIATION 0
		ife CHAR 10 add INEBRIATION 50
		ife CHAR 11 add INEBRIATION 50
		ife CHAR 12 add INEBRIATION 125
		ife CHAR 13 add INEBRIATION 200
		ife CHAR 14 add INEBRIATION 25
		ifactor 5881 cactor 10993
		else ifactor 5882 cactor 10994
		else
		killit
		}
  }

ifhitweapon
{
lotsofglass 6
sound GLASS_HEAVYBREAK
killit
}

ends

defstate eat_sushi_object
cstat 257
ifpdistl 812
ifp palive
   ifp pfacing
   {
   set player_use 0
	    ifhitspace
		{
		ife CHAR 0 { set PLAYER_VOICEOVER 16 break }
			else
			{
				quote 139
				sound EATSOME
				palfrom 16 0 32
				addphealth 2
				ifactor 16928 cactor 16934
				else ifactor 16929 cactor 16934
				else ifactor 16930 cactor 16934
				else ifactor 16945 cactor 16946
				else ifactor 27006 cactor 27007
				else ifactor 27008 cactor 27009
				else killit
			}
		}
   }
ends

defstate eatfoodobject
ifpdistl 812
ifp palive
   ifp pfacing
   {
   set player_use 0
	    ifhitspace
		{
		quote 139
		sound EATSOME
		ifspritepal 3
			{
			palfrom 16 16
			ifrnd 128
				{
				ife CHAR 10 sound VOMIT_F // Bombshell
				else ife CHAR 12 sound VOMIT_F // Jane
				else ife CHAR 17 sound VOMIT_F // Kagura
				else ife CHAR 20 sound VOMIT_F // Cassandra
				else sound VOMIT
				wackplayer
				spawn PUKE
				}
			addphealth -2
			}
		else
			{
			palfrom 16 0 32
			addphealth 2
			}
		ifactor 4547 cactor 4546
		else ifactor 16928 cactor 16934
		else ifactor 16929 cactor 16934
		else ifactor 16930 cactor 16934
		else ifactor 27003 cactor 27004
		else killit
		}
   }
ends

defstate drinkobject
ifpdistl 812
ifp palive
   ifp pfacing
   {
   set player_use 0
    ifhitspace
		{
		quote 140
		sound DRINKSOME
	  	palfrom 16 0 32
		ife CHAR 0 addphealth 4 else ife CHAR 5 addphealth 4 else addphealth 2
		ifactor COFFEEMUG cactor 4267 else
		killit
		}
	}
ends

defstate jibfood
  state squish_sounds
  guts JIBS6 3
  killit
ends

defstate break_glass
      lotsofglass 5
      sound GLASS_BREAKING
ends

defstate break_metal
	debris SCRAP1 2
	debris SCRAP2 2
	sound VENT_BUST
ends

defstate break_wood
sound WOODBREAK shoot WOODSCRAP shoot WOODSCRAP shoot WOODSCRAP shoot WOODSCRAP
ends

defstate breakobject
  ifaction 0
  {
    action ANULLACTION
    cstator 257
    ifactor ROBOTMOUSE
      clipdist 64

  }
  else
    ifactor ROBOTMOUSE
  {
      ifdead
      {
        ifcount 32
        {
          killit
        }
        break
      }
      ifcount 64 ifrnd 6
      {
        ifrnd 128
          move MOUSEVELS randomangle geth
        resetcount
      }
  }

  ifhitweapon
  {
  ifspritepal 3 break
    ifdead
    {
	switch sprite[].picnum
      case 4535
      case 4540
      case 4541
      case 4542
      case 4543
      case 4544
      case 4545
      case 4546
      case 23540
      case 4554
	  case 4555
        state jibfood
		break
	case DOLPHIN1
        guts JIBS2 1
        guts JIBS3 2
        guts JIBS4 3
        guts JIBS5 2
        state jibfood
		break
	case SNAKEP
        guts JIBS2 1
        guts JIBS3 2
        guts JIBS4 3
        guts JIBS5 2
        state human_jibs
		break
	case 19539
		spritepal 7
		debris SCRAP3 10
		sound THUD
		break
	case SHOPPINGCART
        debris SCRAP1 5
        debris SCRAP2 5
        debris SCRAP3 5
        sound VENT_BUST
		break
    case 4560
        soundonce DEAD_DOG
        guts JIBS2 1
        guts JIBS3 2
        guts JIBS6 3
		break
	case DONUTS
	case 4440
        ifactor 4440 debris SCRAP1 1
        spritepal 7
        guts JIBS6 2
		break
	case MAILBAG
        mail 30
        debris SCRAP3 5
        debris SCRAP4 3
		break
	case TEDDYBEAR
		debris SCRAP3 5
        spritepal 1
        debris SCRAP3 6
		break
	case HATRACK
		shoot WOODSCRAP
		shoot WOODSCRAP
		shoot WOODSCRAP
		sound WOODBREAK
		break
	case 14130
	case 28627
	case 28628
        debris SCRAP3 1
        debris SCRAP4 2
		espawn BROWNSTAIN
		sound THUD
		seta[RETURN].pal 27
		break
	case 14132
        debris SCRAP3 1
        debris SCRAP4 2
		espawn BROWNSTAIN
		spawn BURNING2
		sound THUD
		seta[RETURN].pal 4
		break
	case COFFEEMUG
	case COFFEEMACHINE
	case COFFEEMACHINE2
	case COFFEEMACHINE3
		spawn BROWNSTAIN
		break
	case 4374
	case 4375
		sound WOODBREAK
		break
	case BROOM
	case 10513
	case 8045
	case MOP
		ifactor MOP spawn BROWNSTAIN
		shoot WOODSCRAP
		shoot WOODSCRAP
		shoot WOODSCRAP
		sound WOODBREAK
		break
	case CLOCK
		cactor BROKENCLOCK
		break
	case JOLLYMEAL
		ifrnd 4 spawn PLATINUM_AMULET
		else ifrnd 16 spawn GOLD_AMULET
		else ifrnd 64 spawn SILVER_AMULET
		else spawn COPPER_AMULET
        debris SCRAP3 1
        debris SCRAP4 2
		break
    case GUMBALLMACHINE
        sound GLASS_BREAKING
        cactor GUMBALLMACHINEBROKE
        strength 1
        debris SCRAP4 2
        lotsofglass 10
        break
    case GUMBALLMACHINEBROKE
        sound GLASS_BREAKING
        debris SCRAP3 3
        debris SCRAP4 2
        lotsofglass 10
        break
    case BURGER_STAND
        debris SCRAP3 14
        debris SCRAP1 13
        debris SCRAP4 12
        debris SCRAP2 12
        debris SCRAP5 11
        break
	case 4377
		debris SCRAP3 4
        debris SCRAP1 3
        debris SCRAP4 2
        debris SCRAP2 2
        debris SCRAP5 1
		break
	case 4396
		paper 10
		break
	case 25574
		shoot METAL_RING
		shoot METAL_RING
		shoot METAL_RING
	    shoot WOODSCRAP
	    shoot WOODSCRAP
	    shoot WOODSCRAP
	    shoot WOODSCRAP
	    shoot WOODSCRAP
	    shoot WOODSCRAP
	    sound WOODBREAK
		break
	case GUNPOWDERBARREL
        spawn EXPLOSION2
        sound PIPEBOMB_EXPLODE
		shoot METAL_RING
		shoot METAL_RING
		shoot METAL_RING
	    shoot WOODSCRAP
	    shoot WOODSCRAP
	    shoot WOODSCRAP
	    shoot WOODSCRAP
	    shoot WOODSCRAP
	    shoot WOODSCRAP
	    sound WOODBREAK
        hitradius 2048 WEAKEST WEAK MEDIUMSTRENGTH TOUGH
        ifpdistl 2048 wackplayer
		break
	case 4388
        ifrnd 96 spawn PUKE
        debris SCRAP1 2
        debris SCRAP3 3
        debris SCRAP4 2
		break
	case ROBOTMOUSE
        debris SCRAP2 10
        spritepal 1
        debris SCRAP3 4
		break
	case 4404
	case 4510
	case 4512
	case 4514
	case 4511
	case 4513
	case 4515
	case MAN
	case MAN2
        debris SCRAP2 10
        debris SCRAP1 5
        debris SCRAP3 3
        lotsofglass 10
        break
	default
        ifrnd 128 sound GLASS_BREAKING
        else sound GLASS_HEAVYBREAK
		break
	endswitch
    killit
    }
    else // if NOT dead
      ifactor DOLPHIN1
    {
      guts JIBS6 1
      soundonce DOLPHINSND
      ifstrength TOUGH
      {
        cactor DOLPHIN2
        state squish_sounds
      }
    }
    else
      ifactor DOLPHIN2
    {
      guts JIBS6 1
      soundonce DOLPHINSND
    }
    else
      ifactor 4560
    {
      guts JIBS6 1
      soundonce WHINING_DOG
    }
  }
  else
  switch sprite[].picnum
  case CLOCK
  case 4396
  case 4554
  case 4555
  case 4531
  case 4535
  case DOLPHIN1
  case DOLPHIN2
		break
 default
	ifonwater nullop else fall
	break
   endswitch
ends

defstate COFFEEMACHINEW
ifpdistl 812
ifp palive
   ifp pfacing
   {
   set player_use 0
    ifhitspace
	ifcount 30
	{
	quote 140
	sound DRINKSOME
  	palfrom 16 0 32
	ife CHAR 0 addphealth 4
		else ife CHAR 5
				{
				getp[].firstaid_amount temp
				ifactor COFFEEMACHINE2 add temp 15 else
				ifactor COFFEEMACHINE3 add temp 10 else
				add temp 20
				setp[].firstaid_amount temp
				cactor COFFEEMACHINE4
				}
				else
			addphealth 2
	ifactor COFFEEMACHINE cactor COFFEEMACHINE2 else
	ifactor COFFEEMACHINE2 cactor COFFEEMACHINE3 else
	ifactor COFFEEMACHINE3 cactor COFFEEMACHINE4
	resetcount
	}
  }
ends

action ABURGERROTS 0 1 5
useractor notenemy BURGER_STAND 200 ABURGERROTS state breakobject enda

useractor notenemy MOP WEAK state breakobject
       ifp palive
        ifpdistl RETRIEVEDISTANCE // quote check ok
          ifcount 6
            ifcanseetarget
			ife temp_weap 0
			{
			set player_use 0
			    ifhitspace
			      {
					setarray picked_up_gun[0] 30
					set weap_show 130
					state PICKUP_DISPLAY
					set picked_up_tile MOPSPRITE
					set item_amount -1
					set temp_weap 20
					sound WOOD_IMPACT
					setp[].curr_weapon 0
					setp[].ammo_amount 0 1
			        cactor 12083
			      }
			}

 enda

useractor notenemy 8046 cstator 257 ifhitweapon { sound GLASS_HEAVYBREAK lotsofglass 5 killit } enda
useractor notenemy 8047 cstator 257 ifhitweapon { sound GLASS_HEAVYBREAK lotsofglass 5 killit } enda
useractor notenemy 8048 cstator 257 ifhitweapon { sound GLASS_HEAVYBREAK lotsofglass 5 killit } enda
useractor notenemy 8049 cstator 257 ifhitweapon { sound GLASS_HEAVYBREAK lotsofglass 5 killit } enda

useractor notenemy 10507 cstator 257 ifhitweapon { sound GLASS_BREAKING lotsofglass 5 seta[].picnum 20356 } enda

useractor notenemy 18622 cstator 257 ifhitweapon { sound GLASS_BREAKING lotsofglass 20 state break_glass seta[].picnum 20358 } enda
useractor notenemy 20359 cstator 257 ifhitweapon { sound GLASS_BREAKING lotsofglass 20 state break_glass seta[].picnum 20358 } enda

useractor notenemy 9506 cstator 257 ifhitweapon { sound GLASS_BREAKING lotsofglass 20 state break_glass spritepal 7 state jibfood } enda

useractor notenemy 8126 cstator 257 ifhitweapon { sound GLASS_BREAKING lotsofglass 5 state break_glass killit } enda
useractor notenemy 8127 cstator 257 ifhitweapon { sound GLASS_BREAKING lotsofglass 5 state break_glass espawn 2284 seta[RETURN].pal 17 killit } enda
useractor notenemy 8128 cstator 257 ifhitweapon { sound GLASS_BREAKING lotsofglass 5 state break_glass killit } enda
useractor notenemy 8129 cstator 257 ifhitweapon { sound GLASS_BREAKING lotsofglass 5 state break_glass espawn 2284 seta[RETURN].pal 17 killit } enda
useractor notenemy 8130 cstator 257 ifhitweapon { sound GLASS_BREAKING lotsofglass 5 state break_glass killit } enda
useractor notenemy 8131 cstator 257 ifhitweapon { sound GLASS_BREAKING lotsofglass 5 state break_glass espawn 2284 seta[RETURN].pal 17 killit } enda
useractor notenemy 8132 cstator 257 ifhitweapon { sound GLASS_BREAKING lotsofglass 10 state break_glass espawn 2284 seta[RETURN].pal 17 killit } enda
useractor notenemy 8133 cstator 257 ifhitweapon { sound GLASS_BREAKING lotsofglass 10 state break_glass espawn 2284 seta[RETURN].pal 6 killit } enda
useractor notenemy 8134 cstator 257 ifhitweapon { sound GLASS_BREAKING lotsofglass 5 state break_glass espawn 2284 seta[RETURN].pal 6 killit } enda

useractor notenemy GLASS ifspritepal 3 { ifhitweapon { sound GLASS_BREAKING lotsofglass 15 killit } } enda

useractor notenemy 14128 WEAK
state breakobject

ife P_GENDER MALE
 ifpdistl 1024
  ifp pfacing
   ifp palive
	{
	set player_use 0
	ifhitspace
		{
		sound PRESSURIZE
		setactorsoundpitch THISACTOR PRESSURIZE 512
		addphealth 5
		setp[].weapon_pos 10
		killit
		}
	}

enda

useractor notenemy 28590 WEAK state breakobject enda
useractor notenemy 28613 WEAK state breakobject enda
useractor notenemy 28615 WEAK state breakobject enda
useractor notenemy 28618 WEAK state breakobject enda
useractor notenemy 28622 WEAK state breakobject enda
useractor notenemy 28622 WEAK state breakobject enda
useractor notenemy 28623 WEAK state breakobject enda
useractor notenemy 28624 WEAK state breakobject enda

useractor notenemy 28627 WEAK state breakobject enda
useractor notenemy 28628 WEAK state breakobject enda

useractor notenemy 33130 WEAK state breakobject enda

useractor notenemy 33132 WEAK state breakobject enda
useractor notenemy 33133 WEAK state breakobject enda

useractor notenemy 14130 WEAK state breakobject enda
useractor notenemy 14132 WEAK state breakobject enda

useractor notenemy 14170 WEAK state breakobject enda

spriteshadow 3525
useractor notenemy 3525 WEAK state breakobject enda

useractor notenemy 8045 WEAK state breakobject enda

useractor notenemy 10513 WEAK state breakobject enda
useractor notenemy BROOM WEAK state breakobject enda

useractor notenemy 4495 WEAK state breakobject enda

useractor notenemy DESKLAMP WEAK state breakobject enda

// useractor notenemy DUKECUTOUT WEAK state breakobject enda

useractor notenemy HATRACK WEAK state breakobject enda

useractor notenemy 25574 TOUGH state breakobject enda

useractor notenemy GUNPOWDERBARREL TOUGH
	ifonwater
		{
		seta[].mdflags 16
		set command 32768
	    }
	state breakobject
enda

useractor notenemy COFFEEMACHINE WEAK state breakobject state COFFEEMACHINEW enda

useractor notenemy COFFEEMACHINE2 WEAK state breakobject state COFFEEMACHINEW enda

useractor notenemy COFFEEMACHINE3 WEAK state breakobject state COFFEEMACHINEW enda

useractor notenemy COFFEEMACHINE4 WEAK state breakobject enda

useractor notenemy TEDDYBEAR WEAK state breakobject enda

useractor notenemy 4396 WEAK state breakobject enda

spriteshadow ROBOTMOUSE

useractor notenemy ROBOTMOUSE 45

  ifpdistl 4096
   ife ally_mag 0
	{
	soundonce ROBO_HI
	set ally_mag 1
	}

	ife ally_mag 1
	{
	ifpdistl 1536
	  ifp pfacing
	   ifp palive
		{
		set player_use 0
		 ifhitspace
			{
			set hit_key 30
			soundonce ROBO_HOW
			set ally_mag 2
			}
		}
	}

	ifpdistg 4096
	 ife ally_mag 2
		{
		soundonce ROBO_BYE
		set ally_mag 0
		}

state breakobject
enda

useractor notenemy MAN 200 state breakobject enda

useractor notenemy MAN2 200 sizeat 25 25 state breakobject enda

useractor notenemy WOMAN 200 sizeat 27 27 state breakobject enda

useractor notenemy 4510 200 state breakobject enda

useractor notenemy 4512 200 state breakobject enda

useractor notenemy 4514 200 state breakobject enda

useractor notenemy 4511 200 state breakobject enda

useractor notenemy 4513 200 state breakobject enda

useractor notenemy 4515 200 state breakobject enda

useractor notenemy 4404 200 state breakobject enda

useractor notenemy 4516 TOUGH state breakobject enda

useractor notenemy 4520 WEAK state breakobject enda

useractor notenemy 4402 200 state breakobject enda

useractor notenemy 4560 TOUGH state breakobject enda

useractor notenemy PLEASEWAIT state breakobject enda

useractor notenemy 4530 WEAK state breakobject enda

useractor notenemy 4531 WEAK state breakobject enda

useractor notenemy 4532 WEAK state breakobject enda

useractor notenemy 4533 WEAK state breakobject enda

useractor notenemy 4534 WEAK state breakobject enda

useractor notenemy 4535 WEAK state breakobject enda

useractor notenemy 4536 WEAK state breakobject enda

useractor notenemy 4537 WEAK state breakobject enda

useractor notenemy 4538 WEAK state breakobject enda

useractor notenemy 4539 WEAK state breakobject enda

useractor notenemy 23540 WEAK state breakobject state eatfoodobject enda

useractor notenemy 19539 WEAK state breakobject state eatfoodobject enda

useractor notenemy 4540 WEAK sizeat 25 25 state breakobject state eatfoodobject enda

useractor notenemy 4541 WEAK sizeat 25 25 state breakobject state eatfoodobject enda

useractor notenemy 4542 WEAK sizeat 25 25 state breakobject state eatfoodobject enda

useractor notenemy 4543 WEAK sizeat 25 25 state breakobject state eatfoodobject enda

useractor notenemy 4544 WEAK sizeat 25 25 state breakobject state eatfoodobject enda

useractor notenemy 4545 WEAK sizeat 25 25 state breakobject state eatfoodobject enda

useractor notenemy 25578 WEAK sizeat 25 25 state breakobject state eatfoodobject enda

useractor notenemy 25579 WEAK sizeat 25 25 state breakobject state eatfoodobject enda

useractor notenemy 25580 WEAK sizeat 25 25 state breakobject state eatfoodobject enda

useractor notenemy 25581 WEAK sizeat 25 25 state breakobject state eatfoodobject enda

useractor notenemy 25582 WEAK sizeat 25 25 state breakobject state eatfoodobject enda

useractor notenemy 4546 WEAK sizeat 25 25 state breakobject enda

useractor notenemy 4547 WEAK sizeat 25 25 state breakobject state eatfoodobject enda

useractor notenemy 4548 WEAK sizeat 25 25 state breakobject state drinkobject enda

useractor notenemy 33123 WEAK sizeat 25 25 state breakobject state drinkobject enda

useractor notenemy 4549 WEAK sizeat 25 25 state breakobject enda

useractor notenemy JOLLYMEAL WEAK sizeat 18 18 state breakobject enda

useractor notenemy GUMBALLMACHINE WEAK state breakobject enda

useractor notenemy GUMBALLMACHINEBROKE WEAK state breakobject enda

useractor notenemy 4377 TOUGH state breakobject enda

useractor notenemy CLOCK WEAK state breakobject enda

useractor notenemy MAILBAG WEAK state breakobject enda

useractor notenemy 4555 WEAK state breakobject enda

useractor notenemy 4554 WEAK state breakobject enda

useractor notenemy 4550 WEAK state breakobject enda

useractor notenemy DOLPHIN1 DOLPHINSTRENGTH state breakobject enda

useractor notenemy DOLPHIN2 DOLPHINSTRENGTH state breakobject enda

useractor notenemy SNAKEP MEDIUMSTRENGTH state breakobject enda

useractor notenemy DONUTS WEAK state breakobject state eatfoodobject enda

useractor notenemy 4374 WEAK state breakobject enda

useractor notenemy 4375 WEAK state breakobject enda

useractor notenemy 4373 WEAK state breakobject enda

useractor notenemy 4440 WEAK state breakobject state eatfoodobject enda

useractor notenemy 4388 WEAK state breakobject enda

useractor notenemy 4453 WEAK state breakobject enda

useractor notenemy 4464 WEAK state breakobject enda

useractor notenemy SHOPPINGCART WEAK state breakobject enda

useractor notenemy COFFEEMUG WEAK state breakobject state drinkobject enda

// empty mug
useractor notenemy 4267 WEAK state breakobject enda

// sports bottle
useractor notenemy 11959 WEAK sizeat 25 25 state drinkobject enda

// Ali cafeteria stuff

useractor notenemy 26882 WEAK cstator 256 ifhitweapon state jibfood state eatfoodobject enda

useractor notenemy 26883 WEAK cstator 256 ifhitweapon { spritepal 28 state jibfood } state eatfoodobject enda

useractor notenemy 26885 WEAK
cstator 256
ifhitweapon
	{
	spritepal 28
	debris SCRAP3 10
	sound THUD
	killit
	}
enda

useractor notenemy 26886 WEAK
cstator 256
ifhitweapon
	{
	spritepal 28
	debris SCRAP3 10
	sound THUD
	killit
	}
enda

useractor notenemy 26887 WEAK cstator 256 ifhitweapon { state break_glass killit } enda
useractor notenemy 26888 WEAK cstator 256 ifhitweapon { state break_glass killit } enda

useractor notenemy 10993 WEAK cstator 256 ifhitweapon { state break_glass killit } enda
useractor notenemy 10994 WEAK cstator 256 ifhitweapon { state break_glass killit } enda

// this actor is already defined above as food, what was it supposed to be?
// useractor notenemy 26882 WEAK cstator 256 ifhitweapon { state break_glass state break_glass state break_glass killit } enda

useractor notenemy 11972 WEAK cstator 256 ifhitweapon { state break_glass killit } state drinkobject enda

useractor notenemy 26894 WEAK cstator 256 ifhitweapon { state break_glass killit } state drinkobject enda
useractor notenemy 26895 WEAK cstator 256 ifhitweapon { state break_glass killit } state drinkobject enda

useractor notenemy 26896 WEAK cstator 256 ifhitweapon { state break_glass killit } enda
useractor notenemy 26897 WEAK cstator 256 ifhitweapon { state break_glass killit } state drinkobject enda

useractor notenemy 26899 WEAK cstator 256 ifhitweapon { state break_metal killit } enda
useractor notenemy 26900 WEAK cstator 256 ifhitweapon { state break_metal killit } enda
useractor notenemy 26901 WEAK cstator 256 ifhitweapon { state break_metal killit } enda
useractor notenemy 26902 WEAK cstator 256 ifhitweapon { spritepal 28 state break_glass state jibfood } state eatfoodobject enda

useractor notenemy 26904 WEAK cstator 256 ifhitweapon { spritepal 2 state break_metal spritepal 0 state break_glass killit } enda
useractor notenemy 26905 WEAK cstator 256 ifhitweapon { state break_metal killit } enda

spriteflags 5658 131072

useractor notenemy 5658 100
cstator 256
ifhitweapon
	{
	ifdead
		{
		state termspawnlegparts
		state termspawnlegparts
		espawn BIG_SMOKE2
		geta[].z temp
		sub temp 4096
		seta[RETURN].z temp
		ife CHAR 2 ifrnd 96 spawn SHOTGUNAMMO
		state break_metal
		state break_metal
		cactor 5699
		}
	}
enda

useractor notenemy 26908 WEAK
cstator 256
ifhitweapon
	{
	spritepal 28
	debris SCRAP3 3
	sound THUD
	killit
	}
state drinkobject
enda

useractor notenemy 26911 WEAK cstator 256 ifhitweapon { spritepal 28 state jibfood } state eatfoodobject enda
useractor notenemy 26912 WEAK cstator 256 ifhitweapon { spritepal 28 state jibfood } state eatfoodobject enda
useractor notenemy 26913 WEAK cstator 256 ifhitweapon { spritepal 28 state jibfood } state eatfoodobject enda
useractor notenemy 26914 WEAK cstator 256 ifhitweapon { spritepal 28 state jibfood } state eatfoodobject enda
useractor notenemy 26915 WEAK cstator 256 ifhitweapon { spritepal 2 state jibfood } state eatfoodobject enda
useractor notenemy 26916 WEAK cstator 256 ifhitweapon { spritepal 2 state jibfood } state eatfoodobject enda

useractor notenemy 26923 WEAK cstator 256 ifhitweapon { state break_glass state break_glass state break_glass killit } enda

useractor notenemy 26924 WEAK cstator 256 ifhitweapon { spritepal 28 state break_glass state jibfood } state eatfoodobject enda
useractor notenemy 26925 WEAK cstator 256 ifhitweapon { spritepal 28 state break_glass state jibfood } state eatfoodobject enda
useractor notenemy 26926 WEAK cstator 256 ifhitweapon { spritepal 28 state break_glass state jibfood } state eatfoodobject enda

useractor notenemy 26927 WEAK cstator 256 ifhitweapon { spritepal 2 state jibfood } state eatfoodobject enda
useractor notenemy 26928 WEAK cstator 256 ifhitweapon { spritepal 1 state jibfood } state eatfoodobject enda
useractor notenemy 26929 WEAK cstator 256 ifhitweapon { spritepal 28 state jibfood } state eatfoodobject enda
useractor notenemy 26930 WEAK cstator 256 ifhitweapon { spritepal 28 state jibfood } state eatfoodobject enda

useractor notenemy 26931 WEAK cstator 256 ifhitweapon { spritepal 8 state break_glass state jibfood } state eatfoodobject enda
useractor notenemy 26932 WEAK cstator 256 ifhitweapon { spritepal 2 state break_glass state jibfood } state eatfoodobject enda
useractor notenemy 26933 WEAK cstator 256 ifhitweapon { spritepal 2 state jibfood } state eatfoodobject enda

useractor notenemy 26935 WEAK cstator 256 ifhitweapon { spritepal 28 state jibfood } state eatfoodobject enda
useractor notenemy 26936 WEAK cstator 256 ifhitweapon { spritepal 28 state jibfood } state eatfoodobject enda
useractor notenemy 26937 WEAK cstator 256 ifhitweapon { spritepal 28 state jibfood } state eatfoodobject enda
useractor notenemy 26938 WEAK cstator 256 ifhitweapon { spritepal 28 state jibfood } state eatfoodobject enda
useractor notenemy 27005 WEAK cstator 256 ifhitweapon { spritepal 28 state jibfood } state eatfoodobject enda
useractor notenemy 27003 WEAK cstator 256 ifhitweapon { spritepal 28 state jibfood } state eatfoodobject enda

useractor notenemy 4517

ifaction 0
{
ifpdistg 2048
	{
	soundonce SERVOSND
	action MINUSONE
	}
}

ifaction MINUSONE
{
ifpdistl 2048
	{
	soundonce SERVOSND
	action 0
	}
}

enda

useractor notenemy 5881 state MARTINIDRINK enda
useractor notenemy 5882 state MARTINIDRINK enda
useractor notenemy 3925 state MARTINIDRINK enda
useractor notenemy 26951 state MARTINIDRINK enda
useractor notenemy 26952 state MARTINIDRINK enda
useractor notenemy 25583 sizeat 14 12 state MARTINIDRINK enda
useractor notenemy 25584 sizeat 14 12 state MARTINIDRINK enda


useractor notenemy 9596 state drinkobject enda
useractor notenemy 20315 state drinkobject enda

useractor notenemy 28479 state drinkobject enda
useractor notenemy 28480 state drinkobject enda
useractor notenemy 28481 state drinkobject enda

useractor notenemy 28482 sizeat 10 8 state eatfoodobject enda
useractor notenemy 28483 sizeat 10 8 state eatfoodobject enda
useractor notenemy 28484 sizeat 10 8 state eatfoodobject enda


useractor notenemy 5883 sizeat 10 8 state eatfoodobject enda

useractor notenemy 16928 sizeat 18 18 state eat_sushi_object ifhitweapon { state break_wood spritepal 8 state jibfood } enda
useractor notenemy 16929 sizeat 18 18 state eat_sushi_object ifhitweapon { state break_wood spritepal 7 state jibfood }  enda
useractor notenemy 16930 sizeat 18 18 state eat_sushi_object ifhitweapon { state break_wood state jibfood } enda

useractor notenemy 16931 sizeat 18 18 state eat_sushi_object ifhitweapon { spritepal 8 state jibfood } enda
useractor notenemy 16932 sizeat 18 18 state eat_sushi_object ifhitweapon { spritepal 7 state jibfood } enda
useractor notenemy 16933 sizeat 18 18 state eat_sushi_object ifhitweapon state jibfood enda

useractor notenemy 16945 sizeat 15 15 state eat_sushi_object ifhitweapon { state break_glass state jibfood } enda
useractor notenemy 16946 sizeat 15 15 ifhitweapon { state break_glass killit } enda

useractor notenemy 27006 sizeat 46 47 state eat_sushi_object ifhitweapon { state break_wood spritepal 8 state jibfood } enda
useractor notenemy 27007 sizeat 18 18 ifhitweapon { state break_glass killit } enda

useractor notenemy 27008 sizeat 12 12 state eat_sushi_object ifhitweapon { state break_glass state jibfood } enda
useractor notenemy 27009 sizeat 12 12 ifhitweapon { state break_glass killit } enda

useractor notenemy 16934 sizeat 18 18 ifhitweapon { state break_wood killit } enda

useractor notenemy 16944 ifhitweapon { state break_metal killit } enda

useractor notenemy 19688 ifaction 0 { cstator 257 action ZERO } ifhitweapon { state break_metal killit } enda

useractor notenemy 16346
set ally_mag 1
ifpdistl 1024 ifp pfacing ifhitspace cactor 16345
ifhitweapon { ifspritepal 0 spritepal 7 state break_metal killit }
enda

useractor notenemy 16345
ifspritepal 3 set ally_mag 1
ife ally_mag 1
{
ifpdistl 32768 ifactorsound THISACTOR WIND_CHIMES nullop else sound WIND_CHIMES
ifhitweapon { stopactorsound THISACTOR WIND_CHIMES ifspritepal 0 spritepal 7 state break_metal  killit }
}
enda

// engineering oil can
useractor notenemy 19540 ifaction 0 { cstator 256 action ZERO } ifhitweapon { state break_metal spawn 2284 killit } enda

// coffee maker
useractor notenemy 26880 ifaction 0 { cstator 256 action ZERO } ifhitweapon { state break_metal killit } enda

// coffee maker
useractor notenemy 26881 ifaction 0 { cstator 256 action ZERO } ifhitweapon { state break_metal killit } enda

useractor notenemy 16973 ifhitweapon { state break_metal state break_wood action ONE } enda

useractor notenemy 16899 50
ifhitweapon { state METAL_HIT_SOUNDS soundvar playsound shoot SPARK ifdead { state break_metal spritepal 2 state break_metal spritepal 7 state break_metal killit } }
enda

spriteshadow 23764
spriteshadow 23765
spriteshadow 23768

useractor notenemy 23764 ifaction 0 { cstator 257 action ZERO } ifhitweapon { state break_wood state break_wood killit } enda
useractor notenemy 23765 ifaction 0 { cstator 257 action ZERO } ifhitweapon { state break_wood state break_wood killit } enda
useractor notenemy 23768 ifaction 0 { cstator 257 action ZERO } ifhitweapon { state break_wood state break_wood killit } enda

useractor notenemy 16309 ifhitweapon { spritepal 2 state break_metal state break_metal killit } enda

spriteshadow 23024
useractor notenemy 23024 ifaction 0 { cstator 257 action ZERO } ifhitweapon { state break_wood state break_wood killit } enda

spriteshadow 23025
useractor notenemy 23025 ifaction 0 { cstator 257 action ZERO } ifhitweapon { state break_wood spritepal 8 debris SCRAP2 4 killit } enda

action HITCLOCK 1

useractor notenemy 16938

ifhitweapon
	{
	ifaction 0
		{
		state break_glass
		action ONE
		strength 1
		}
	else ifaction ONE
		{
		action HITCLOCK
		}
	}

ifaction HITCLOCK
	{
	fall
 iffloordistl 4
		{
		state break_glass
		state break_metal
		killit
		}
	}

enda

useractor notenemy 16380

ifaction 0
	{
	cstat 288
	sizeat 32 32
	action ZERO
	}

ifhitweapon
	{
	ifaction ZERO
		{
		state break_metal
		state jibfood
		}
	else
	ifaction ONE
		{
		state break_metal
		killit
		}
	}


ifpdistl 812
ifaction ZERO
ifp palive
   ifp pfacing
   {
   set player_use 0
	    ifhitspace
		{
		quote 139
		sound EATSOME
	  	palfrom 16 0 32
		addphealth 5
		action ONE
		}
   }

enda

// GLASS

spriteshadow 9520
useractor notenemy 9520
cstat 257

ifhitweapon
	{
	sound GLASS_BREAK3
	spritepal 2
	lotsofglass 6
	guts JIBS6 6
	killit
	}


enda

spriteshadow 9521
useractor notenemy 9521
cstat 257

ifhitweapon
	{
	sound GLASS_BREAK3
	lotsofglass 10
	spawn BROWNSTAIN
	killit
	}


enda

// DUKE CORPSES GIB STUFF
useractor notenemy 1513 cstator 256 ifhitweapon { state squish_sounds state standard_jibs killit } enda
useractor notenemy 1514 cstator 256 ifhitweapon { state squish_sounds state standard_jibs killit } enda
useractor notenemy 1515 cstator 256 ifhitweapon { state squish_sounds state standard_jibs killit } enda
useractor notenemy 1521 cstator 256 ifhitweapon { state squish_sounds state standard_jibs killit } enda
useractor notenemy 1522 cstator 256 ifhitweapon { state squish_sounds state standard_jibs killit } enda
useractor notenemy 1523 cstator 256 ifhitweapon { state squish_sounds state standard_jibs killit } enda
useractor notenemy 1524 cstator 256 ifhitweapon { state squish_sounds state standard_jibs killit } enda
useractor notenemy 1525 cstator 256 ifhitweapon { state squish_sounds state standard_jibs killit } enda
useractor notenemy 1526 cstator 256 ifhitweapon { state squish_sounds state standard_jibs killit } enda
useractor notenemy 1527 cstator 256 ifhitweapon { state squish_sounds state standard_jibs killit } enda

// Octabrain corpse drops
useractor notenemy 9068 ifspawnedby OCTABRAIN { fall sizeat 24 24 cstator 256 ifhitweapon { state squish_sounds state standard_jibs killit } } enda
useractor notenemy 10436 ifspawnedby OCTABRAIN { fall sizeat 24 24 cstator 256 ifhitweapon { state squish_sounds state standard_jibs killit } } enda
useractor notenemy 2060 ifspawnedby OCTABRAIN { fall sizeat 24 24 cstator 256 ifhitweapon { state squish_sounds state standard_jibs killit } } enda

// CORPSES
useractor notenemy 3550 cstator 256 sizeat 24 24 ifaction 0 action FIVE_ANG ifhitweapon { state squish_sounds state standard_jibs killit } enda
useractor notenemy 3569 cstator 256 sizeat 24 24 ifaction 0 action FIVE_ANG ifhitweapon { state squish_sounds state standard_jibs killit } enda

// bisect corpses
defstate bisect_body
fall
seta[].mdflags 16
cstator 256
sizeat 24 24
ifaction 0 { set temp 64 action ZERO }
iffloordistl 8
	{
	move STOP geth
	ifg temp 0
		{
		sub temp 1
		seta[].xvel temp
		}
	}
	else action MINUSONE
ifaction MINUSONE
	{
	iffloordistl 8 { action 0 ifrnd 128 cstator 4 espawn BLOODPOOL ifactor 30449 seta[RETURN].pal 8 state BODY_FALL_NOISES }
	}
ifhitweapon ifwasweapon RADIUSEXPLOSION { ifactor 30449 spritepal 8 state squish_sounds state standard_jibs killit }
ends

useractor notenemy 30419 state bisect_body enda
useractor notenemy 30426 state bisect_body enda
useractor notenemy 30433 state bisect_body enda
useractor notenemy 30449 state bisect_body enda
useractor notenemy 30456 state bisect_body enda
useractor notenemy 30463 state bisect_body enda
useractor notenemy 32518 state bisect_body enda // beyzed
useractor notenemy 30702 state bisect_body enda
useractor notenemy 30709 state bisect_body enda
useractor notenemy 30716 state bisect_body enda
useractor notenemy 32898 state bisect_body enda

defstate corpse_jibs
fall cstator 256 
ifhitweapon ifwasweapon RADIUSEXPLOSION 
	{ 
	ifactor 24446 spritepal 8 // Orc corpse? go green
	state squish_sounds state standard_jibs 
	killit
	} 
ends

// flyback normal corpse
useractor notenemy 24446 sizeat 26 26 state corpse_jibs enda
useractor notenemy 24487 sizeat 30 26 state corpse_jibs enda
useractor notenemy 7776 sizeat 24 24 state corpse_jibs enda
useractor notenemy 18728 sizeat 24 24 state corpse_jibs enda
useractor notenemy 33497  sizeat 24 24 state corpse_jibs enda
useractor notenemy 12600 sizeat 26 26 state corpse_jibs enda
useractor notenemy 3992 sizeat 26 26 state corpse_jibs enda
useractor notenemy 1709 sizeat 26 26 state corpse_jibs enda
useractor notenemy 14949 sizeat 26 26 state corpse_jibs enda

useractor notenemy 9901 sizeat 26 26 state corpse_jibs enda


defstate sitting_corpse_jibs
fall cstator 256 
seta[].mdflags 16
	ifaction 0 action FIVE_ANG 
	ifhitweapon 
		{ 
		ifactor 28828 spritepal 8 // Orc corpse goes green to spawn green jibs
		state squish_sounds state standard_jibs 
		killit 
		} 
/*
ifpdistl 8192 ifcount 30 
		{ 
		geta[].ang temp sub temp 1024 seta[].ang temp 
		sin my sprite[].ang
		cos mx sprite[].ang
		geta[].z temp2
		sub temp2 2048
		hitscan sprite[].x sprite[].y temp2 sprite[].sectnum mx my 0 hitsect hitwall hitsprite hitx hity hitz 16777280
		geta[].ang temp add temp 1024 seta[].ang temp 
		state pythagoras
		ifge xydist 2300 
			{ 
			action 0 
			ifactor 28828 cactor 24446 // Orc
			ifactor 28838 cactor 24487 // Archer
			ifactor 28848 cactor 7776 // Cultist
			ifactor 28858 cactor 18728 // Paradigm Troop
			ifactor 33503 cactor 33497 // Paradigm Shotgunner
			ifactor 28868 cactor 12600 // Thoth
			ifactor 28878 cactor 3992 // Triad
			ifactor 28888 cactor 14949 // Ninja
			ifactor 28898 cactor 1709 // Liztroop
			sound BODY_DROP 
			} 
		resetcount 
		}
*/
ends

// sitting corpse
useractor notenemy 28828 sizeat 24 24 state sitting_corpse_jibs enda
useractor notenemy 28838 sizeat 30 26 state sitting_corpse_jibs enda
useractor notenemy 28848 sizeat 24 24 state sitting_corpse_jibs enda
useractor notenemy 33503 sizeat 24 24 state sitting_corpse_jibs enda
useractor notenemy 28858 sizeat 24 24 state sitting_corpse_jibs enda
useractor notenemy 28868 sizeat 26 26 state sitting_corpse_jibs enda
useractor notenemy 28878 sizeat 24 24 state sitting_corpse_jibs enda
useractor notenemy 28888 sizeat 24 24 state sitting_corpse_jibs enda
useractor notenemy 28898 sizeat 24 24 state sitting_corpse_jibs enda


useractor notenemy 5783 sizeat 32 32 enda
useractor notenemy 5784 sizeat 32 32 enda
useractor notenemy 5787 sizeat 32 32 enda
useractor notenemy 5870 sizeat 32 32 enda

defstate hangcorpse
  ifaction 0
  {
    action ZERO
    cstat 257
  }
  ifhitweapon
  {
    ifdead
    {
	ifn HITAGSAVED 0 espawnvar HITAGSAVED
      state squish_sounds
      guts JIBS5 8
      guts JIBS6 9
      killit
    }
    else
      guts JIBS6 1
  }
  ifrnd 1
    spawn WATERDRIP
ends

useractor notenemy 3327 10 state hangcorpse enda
useractor notenemy 3555 10 state hangcorpse enda

useractor notenemy 20084 10 state hangcorpse enda
useractor notenemy 20085 10 state hangcorpse enda
useractor notenemy 20087 10 state hangcorpse enda
useractor notenemy 20088 10 state hangcorpse enda

spritenoshade 23761

useractor notenemy 23761 10

  ifaction 0
  {
    action ZERO
    cstat 257
  }
  ifhitweapon
  {
    ifdead
    {
	ifn HITAGSAVED 0 espawnvar HITAGSAVED
      state squish_sounds
	  debris SCRAP3 10
      guts JIBS5 8
      guts JIBS6 9
      killit
    }
    else
      guts JIBS6 1
  }

 enda

// VENT

useractor notenemy 33081

ifhitweapon
ifaction 0
	{
	sound VENT_BUST
	debris SCRAP2 4
	action ONE
	geta[].cstat temp
	ifand temp 1 sub temp 1
	ifand temp 256 sub temp 256
	seta[].cstat temp
	}

enda

useractor notenemy NEWVENT1

ifhitweapon
ifaction 0
	{
	sound VENT_BUST
	debris SCRAP2 4
	action ONE
	geta[].cstat temp
	ifand temp 1 sub temp 1
	ifand temp 256 sub temp 256
	seta[].cstat temp
	}

enda

useractor notenemy NEWVENT2

ifhitweapon
ifaction 0
	{
	sound VENT_BUST
	debris SCRAP2 4
	action ONE
	geta[].cstat temp
	ifand temp 1 sub temp 1
	ifand temp 256 sub temp 256
	seta[].cstat temp
	}

enda


spriteshadow 10514

useractor notenemy 10514 cstator 257 ifhitweapon { debris SCRAP1 4 sound VENT_BUST killit } enda

// FULTON BALOON ===============================================================================================================

move AIRLIFT_UP 0 -20
move AIRLIFT_FAST 0 -150

useractor notenemy 3708

ifaction 0
	{
	seta[].htflags 2049
	sizeat 48 48
	action OK
	}
	
ifaction OK
	{
	seta[].xvel 0
	add INTERNALCOUNT 1
	ife INTERNALCOUNT 77 sound FULTON_AW
	ifge INTERNALCOUNT 77 move AIRLIFT_FAST getv
	else move AIRLIFT_UP getv
	ifceilingdistl 16 killit
	}

enda

// SUPPLY BARREL ===============================================================================================================

spritenopal SUPPLY_BARREL

action SB_PICKED_UP 20

useractor notenemy SUPPLY_BARREL

ifaction 0
	{
	seta[].htflags 2049
	ifspritepal 0 spritepal 36
	sizeat 40 40
	fall
	cstat 257
	
	ifpdistl 1536
	 ifp pfacing
	  ifp palive
	  {
	  set player_use 0
	   ifhitspace
		ifcount 13
		{
		ifoutside
			   {
				sound METALB_PICKUP
				sound FULTON
				espawn 3708
				geta[].z temp
				sub temp 8192
				seta[RETURN].z temp
				action SB_PICKED_UP
				}
		else
				{
				userquote 345
				set PLAYER_VOICEOVER 2
				sound METALB_PICKUP
				action OK
				resetcount
				}
		}
	  }
	}
	
ifaction OK
	{
	cstat 258
	setp[].runspeed 45200

	set temp3 player[].posx
	add temp3 512

	rotatepoint player[].posx player[].posy temp3 player[].posy player[].ang temp5 temp6

	geta[].sectnum upd_sect
	getflorzofslope upd_sect temp5 temp6 z

	ifl sprite[].z z
		geta[].z z
		sub z 5600
	updatesectorz temp5 temp6 z upd_sect
	ife upd_sect -1 action 0 else
		{
		seta[].x temp5
		seta[].y temp6
		changespritesect THISACTOR upd_sect
		}
	getp[].posz temp
	getp[].horiz temp4
	mul temp4 28
	sub temp temp4
	add temp 5600
	seta[].z temp
	state lower_weapon

	ifhitspace
	 ifcount 13
		{
		sound METALB_PICKUP
		setp[].runspeed RUNNINGSPEED
		ifoutside 
			{
			cstat 257
			sound METALB_PICKUP
			sound FULTON
			espawn 3708
			geta[].z temp
			sub temp 8192
			seta[RETURN].z temp
			action SB_PICKED_UP
			}
		else
		action 0
		resetcount
		}

	ifpdistg 2048 { sound METALB_PICKUP setp[].runspeed RUNNINGSPEED action 0 }
	ifp pjumping { sound METALB_PICKUP setp[].runspeed RUNNINGSPEED action 0 }

	}
	
ifaction SB_PICKED_UP
	{
	seta[].xvel 0
	add INTERNALCOUNT 1
	ifge INTERNALCOUNT 77 move AIRLIFT_FAST getv
	else move AIRLIFT_UP getv
	ifceilingdistl 16
		{
		ife BASE_RESEARCH[7] 2 globalsound AMCSHIP2_FLYBY
		else globalsound AMCSHIP_FLYBY			
		ifspritepal 36
			{
			qputs 344 Copper Supplies for pickup! ^8+1 Supplies!
			userquote 344
			add SUPPLY_LEVEL 1
			}
		else
		ifspritepal 64
			{
			qputs 344 Bronze Supplies for pickup! ^8+2 Supplies!
			userquote 344
			add SUPPLY_LEVEL 2
			}
		else
		ifspritepal 12
			{
			qputs 344 Silver Supplies for pickup! ^8+3 Supplies!
			userquote 344
			add SUPPLY_LEVEL 3
			}
		else
		ifspritepal 83
			{
			qputs 344 Gold Supplies for pickup! ^8+4 Supplies!
			userquote 344
			add SUPPLY_LEVEL 4
			}
		else
		ifspritepal 89
			{
			qputs 344 Platinum Supplies for pickup! ^8+5 Supplies!
			userquote 344
			add SUPPLY_LEVEL 5
			}
		savegamevar SUPPLY_LEVEL
		killit
		}
	}

enda

// PROPANE

action BARREL_FLAME_EX 0

defstate flame_explode
fall
cstator 257

ifhitweapon
	{
	ifspritepal 3 { strength 1 break }
	debris SCRAP1 4
	quake 13 spawn GROUNDEXPLOSION flash sound BARREL_EXPLODE hitradius 2048 10 25 50 100
	sound VENT_BUST
	action BARREL_FLAME_EX
	}

ifaction BARREL_FLAME_EX
	{
	geta[].ang temp sub temp 128 seta[].ang temp
	cstat 32768
	spawn 3296
	ifactioncount 8 killit
	}
ends

spriteshadow 23538
useractor notenemy 23538 state flame_explode enda

spriteshadow 18388
useractor notenemy 18388 state flame_explode enda

// BARREL ===============================================================================================================

eventloadactor 4087 state GETHITAGLOTAG enda

spriteshadow 4087
useractor notenemy 4087
fall
cstator 257
ifspawnedby APLAYER sizeat 32 32

ifaction 0 { seta[].mdflags 16 ifspritepal 10 strength 50 action ZERO }

ifn LOTAGSAVED 0
	{
	checkactivatormotion LOTAGSAVED
	ife RETURN 1
		{
		spawn GROUNDEXPLOSION
		flash
		quake 13
		sound BARREL_EXPLODE
		hitradius 2048 100 125 175 250
		}
	}

ifaction ZERO cstat 257

ifhitweapon
{
ifspritepal 13 { strength 1 break }
debris SCRAP1 16
ifn HITAGSAVED 0 espawnvar HITAGSAVED
ifspritepal 21 { spawn GROUNDEXPLOSION flash quake 13 sound BARREL_EXPLODE hitradius 2048 100 125 175 250 }
ifspritepal 10 { quake 13 spawn GROUNDEXPLOSION flash sound BARREL_EXPLODE hitradius 2048 10 25 50 100 }
else sound VENT_BUST
ifaction OK setp[].runspeed RUNNINGSPEED
ifspritepal 10 action BARREL_FLAME_EX else killit
}

ifaction BARREL_FLAME_EX
{
geta[].ang temp sub temp 128 seta[].ang temp
cstat 32768
spawn 3296
ifactioncount 15 killit
}

ifpdistl 1024
 ifp pfacing
  ifp palive
  ifaction ZERO
  {
  set player_use 0
   ifhitspace
    ifcount 13
	{
	set PLAYER_VOICEOVER 2
	sound METALB_PICKUP
	action OK
	resetcount
	}
  }

ifaction OK
	{
	cstat 258
	setp[].runspeed 45200

	set temp3 player[].posx
	add temp3 512

	rotatepoint player[].posx player[].posy temp3 player[].posy player[].ang temp5 temp6

	geta[].sectnum upd_sect
	getflorzofslope upd_sect temp5 temp6 z

	ifl sprite[].z z
		geta[].z z
		sub z 5600
	updatesectorz temp5 temp6 z upd_sect
	ife upd_sect -1 action ZERO else
		{
		seta[].x temp5
		seta[].y temp6
		changespritesect THISACTOR upd_sect
		}
	getp[].posz temp
	getp[].horiz temp4
	mul temp4 28
	sub temp temp4
	add temp 5600
	seta[].z temp
	state lower_weapon

	ifhitspace
	 ifcount 13
		{
		sound METALB_PICKUP
		setp[].runspeed RUNNINGSPEED
		action ZERO
		resetcount
		}

	ifpdistg 2048 { sound METALB_PICKUP setp[].runspeed RUNNINGSPEED action ZERO }
	ifp pjumping { sound METALB_PICKUP setp[].runspeed RUNNINGSPEED action ZERO }

	}

enda

defstate big_pot_deb
	ifrnd 128 sound POTBREAK_2 else sound POTBREAK
	setprojectile[POTTERY_DEBRIS1].pal sprite[].pal
	shoot POTTERY_DEBRIS1
	shoot POTTERY_DEBRIS1
	shoot POTTERY_DEBRIS1
	setprojectile[POTTERY_DEBRIS1].pal 0
	setprojectile[POTTERY_DEBRIS2].pal sprite[].pal
	shoot POTTERY_DEBRIS2
	shoot POTTERY_DEBRIS2
	shoot POTTERY_DEBRIS2
	setprojectile[POTTERY_DEBRIS2].pal 0
ends

defstate small_pot_deb
	setprojectile[POTTERY_DEBRIS1].pal sprite[].pal
	shoot POTTERY_DEBRIS1
	shoot POTTERY_DEBRIS1
	setprojectile[POTTERY_DEBRIS1].pal 0
	setprojectile[POTTERY_DEBRIS2].pal sprite[].pal
	shoot POTTERY_DEBRIS2
	shoot POTTERY_DEBRIS2
	setprojectile[POTTERY_DEBRIS2].pal 0
ends

defstate small_pot_object
	ifaction 0
		{
		cstator 257
		action ZERO
		}
	ifhitweapon
		{
		ifactor 33129 nullop else
		spritepal 28
		ifrnd 128 sound POTBREAK_2 else sound POTBREAK
		spawn BIG_SMOKE2
		geta[RETURN].z temp
		sub temp 4096
		seta[RETURN].z temp

		state small_pot_deb
		killit
		}
ends

useractor notenemy 11878 state small_pot_object enda
useractor notenemy 33129 state small_pot_object enda

useractor notenemy 11975
state small_pot_object

ifspritepal 11
	{
      ifp palive
        ifcount 6
          ifpdistl RETRIEVEDISTANCE // quote check OK
            ifp pfacing
              ifcanseetarget
			   ifl PHEALTH pmax_health
				{
				set player_use 0
					ifhitspace
						{
						addphealth 20
						quote 139
						sound EATSOME
						palfrom 16 0 32
						cactor 11878
						}
				}
	}

enda

spritenopal 10054

useractor notenemy 10054
ifspritepal 4
nullop
else
	{
	ifaction 0
		{
		cstator 257
		action ZERO
		}
	ifhitweapon
		{
		spritepal 28

		spawn BIG_SMOKE2
		geta[RETURN].z temp
		sub temp 4096
		seta[RETURN].z temp

		state big_pot_deb
		ifn THISSHADOW -1 seta[THISSHADOW].cstat 32768
		killit
		}
	}
enda

// faberge egg

spritenopal 4069
spriteshadow 4069

useractor notenemy 4069
ifspritepal 4
nullop
else
	{
	ifaction 0
		{
		cstator 257
		action ZERO
		}
	ifhitweapon
		{
		spritepal 28

		spawn BIG_SMOKE2
		geta[RETURN].z temp
		sub temp 4096
		seta[RETURN].z temp

		spritepal 1
		state big_pot_deb
		state big_pot_deb
		ifn THISSHADOW -1 seta[THISSHADOW].cstat 32768
		killit
		}
	}
enda

// FISH

defstate FISHSTUFF
ifspritepal 4
nullop
else
{
cstator 256
ifhitweapon { state squish_sounds state standard_jibs ifn THISSHADOW -1 seta[THISSHADOW].cstat 32768 killit }
}
ends

useractor notenemy 3910 state FISHSTUFF enda
useractor notenemy 3911 state FISHSTUFF enda
useractor notenemy 3912 state FISHSTUFF enda
useractor notenemy 3913 state FISHSTUFF enda
useractor notenemy 3914 state FISHSTUFF enda

// SPECIAL GLASS

useractor notenemy EMGLASS
ifspritepal 4 nullop
else ifhitweapon { sound GLASS_BREAKING lotsofglass 20 seta[THISSHADOW].cstat 32768 killit } enda

useractor notenemy MGLASS
ifspritepal 4 nullop
else ifhitweapon { sound GLASS_BREAKING lotsofglass 20 seta[THISSHADOW].cstat 32768 killit } enda


// CLOTHES DUMMY
spriteshadow 5887
useractor notenemy 5887 cstator 256 ifhitweapon
{ sound WOODBREAK shoot WOODSCRAP shoot WOODSCRAP shoot WOODSCRAP shoot WOODSCRAP shoot WOODSCRAP shoot WOODSCRAP killit }
enda

useractor notenemy 3899 cstator 256 ifhitweapon
{ ifwasweapon KNEE strength 1 else { sound WOODBREAK shoot WOODSCRAP shoot WOODSCRAP strength 1 cactor 3900 } }
enda

useractor notenemy 3900 cstator 256 ifhitweapon
{
ifwasweapon KNEE strength 1 else
{ sound WOODBREAK shoot WOODSCRAP shoot WOODSCRAP shoot WOODSCRAP shoot WOODSCRAP shoot WOODSCRAP shoot WOODSCRAP killit } }
enda

useractor notenemy 3901 cstator 256 ifhitweapon
{ sound WOODBREAK shoot WOODSCRAP shoot WOODSCRAP shoot WOODSCRAP shoot WOODSCRAP shoot WOODSCRAP shoot WOODSCRAP killit }
enda

useractor notenemy 3526 cstator 256 ifhitweapon
{ state break_wood killit }
enda

spritenopal 7423
spritenoshade 7423
useractor notenemy 7423 enda

spriteshadow 3219
spriteshadow 3224
useractor notenemy 3219 fall sizeat 34 34 ifaction 0 action FIVE_ANG cstator 256
ifhitweapon { state break_metal cactor 3224 } enda

spriteshadow POSH_CHAIR
spriteshadow POSH_CH_BROKE
useractor notenemy POSH_CHAIR fall ifaction 0 action FIVE_ANG cstator 256
ifhitweapon { sound WOODBREAK shoot WOODSCRAP shoot WOODSCRAP shoot WOODSCRAP shoot WOODSCRAP shoot WOODSCRAP shoot WOODSCRAP cactor POSH_CH_BROKE } enda

spriteshadow WOOD_CHAIR
spriteshadow WOOD_CH_BROKE
useractor notenemy WOOD_CHAIR fall ifaction 0 action FIVE_ANG cstator 256
ifhitweapon { sound WOODBREAK shoot WOODSCRAP shoot WOODSCRAP shoot WOODSCRAP shoot WOODSCRAP shoot WOODSCRAP shoot WOODSCRAP cactor WOOD_CH_BROKE } enda

spriteshadow 25500
useractor notenemy 25500 fall ifaction 0 action FIVE_ANG cstator 256 sizeat 30 30
ifhitweapon { ifspritepal 3 break sound WOODBREAK shoot WOODSCRAP shoot WOODSCRAP shoot WOODSCRAP shoot WOODSCRAP shoot WOODSCRAP shoot WOODSCRAP killit } enda

spriteshadow GAMER_CHAIR
spriteshadow GAMER_CH_BROKE
useractor notenemy GAMER_CHAIR fall ifaction 0 action FIVE_ANG cstator 256
ifhitweapon { state break_metal cactor GAMER_CH_BROKE } enda

spriteshadow EGG_CHAIR
spriteshadow EGG_CH_BROKE
useractor notenemy EGG_CHAIR fall ifaction 0 action FIVE_ANG cstator 256
ifhitweapon { state break_metal cactor EGG_CH_BROKE } enda

defstate spin_char
ifaction FIVE_ANG
	{
	ifpdistl 1024
	ifp pfacing
	ifhitspace
	 ifl temp 240
		{
		sound JMOVE6
		move STOP
		set temp 256
		}
	}

ifmove STOP
	{
	geta[].ang temp2
	set temp3 temp
	divvar temp3 2
	add temp2 temp3
	seta[].ang temp2
	sub temp 1
	ifl temp 1
		move 0
	}
ends

spriteshadow OFFICE_CHAIR
spriteshadow OFFICE_CH_BROKE
useractor notenemy OFFICE_CHAIR
fall
ifaction 0 { ifspritepal 3 nullop else sizeat 24 24 cstator 257 clipdist 8 action FIVE_ANG }
state spin_char
ifhitweapon
{
ifspritepal 3 break
sound VENT_BUST
debris SCRAP2 3
debris SCRAP1 3
cactor OFFICE_CH_BROKE
}
enda

spriteshadow SCHOOL_CHAIR
spriteshadow SCHOOL_CH_BROKE
useractor notenemy SCHOOL_CHAIR
fall
ifaction 0 { ifspritepal 3 nullop else sizeat 24 24 cstator 257 clipdist 8 action FIVE_ANG }
state spin_char
ifhitweapon
{
ifspritepal 3 break
sound VENT_BUST
debris SCRAP2 3
debris SCRAP1 3
cactor SCHOOL_CH_BROKE
}
enda

spriteshadow EXEC_CHAIR
spriteshadow EXEC_CH_BROKE
useractor notenemy EXEC_CHAIR
fall
ifaction 0 { sizeat 26 26 cstator 257 clipdist 8 action FIVE_ANG }
state spin_char
ifhitweapon
{
ifspritepal 3 break
sound VENT_BUST
debris SCRAP2 3
debris SCRAP1 3
cactor EXEC_CH_BROKE
}
 enda

action MINUS_ONE -1

useractor notenemy 8640

ifhitweapon
ifaction 0
{
debris SCRAP3 8
debris SCRAP6 8
sound THUD
action MINUS_ONE
}
enda

useractor notenemy 10062

  ifpdistl 8192
  {
    soundonce WATER_GURGLE

    ifp palive
      ifpdistl RETRIEVEDISTANCE
        ifp pfacing
          ifcount 32
            ifphealthl 30
              ifhitspace
                ifcansee
    {
      addphealth 1
	ifg INEBRIATION 0 { sub INEBRIATION 10 }
      globalsound PLYR_DRINKING
      resetcount
    }
  }

enda

spriteshadow 10501
spriteshadow 10502
spriteshadow 10503
spriteshadow 10504
spriteshadow 10505
spriteshadow 10506

useractor notenemy 10501 cstat 257 fall ifhitweapon { spritepal 28 debris SCRAP3 6 sound THUD killit } enda
useractor notenemy 10502 cstat 257 fall ifhitweapon { spritepal 28 debris SCRAP3 6 sound THUD killit } enda
useractor notenemy 10503 cstat 257 fall ifhitweapon { spritepal 1 debris SCRAP3 6 sound THUD killit } enda
useractor notenemy 10504 cstat 257 fall ifhitweapon { spritepal 1 debris SCRAP3 6 sound THUD killit } enda
useractor notenemy 10505 cstat 257 fall ifhitweapon { spritepal 1 debris SCRAP3 6 sound THUD killit } enda
useractor notenemy 10506 cstat 257 fall ifhitweapon { spritepal 1 debris SCRAP3 6 sound THUD killit } enda
useractor notenemy 9206 cstat 257 fall ifhitweapon { spritepal 1 debris SCRAP3 6 sound THUD killit } enda

useractor notenemy 12516

ifaction 0
{
cstator 256
action ZERO
}

ifhitweapon
{
debris SCRAP3 8
debris SCRAP5 4
paper 5
ifrnd 16 spawn ARAT
ifn HITAGSAVED 0 espawnvar HITAGSAVED
sound THUD
killit
}
enda

defstate cactus
ifaction 0
{
cstator 256
strength 100
action ZERO
}

ifhitweapon
{
sound THUD
spritepal 8
debris SCRAP3 2
getlastpal

ifdead
	{
	spritepal 8
	debris SCRAP3 16
	sound SMALL_CRUSH
	killit
	}
}
ends

// PILLAR

useractor notenemy 20257 ifspritepal 4 seta[].mdflags 1 clipdist 70 enda
useractor notenemy 20478 ifspritepal 4 seta[].mdflags 1 clipdist 70 enda

spriteshadow 8672
useractor notenemy 8672 state cactus enda
spriteshadow 8673
useractor notenemy 8673 state cactus enda
spriteshadow 8674
useractor notenemy 8674 state cactus enda
spriteshadow 8675
useractor notenemy 8675 state cactus enda

// GARBAGE CAN

defstate garbage_destroy
{
debris SCRAP1 16
 paper 10
 mail 5
ifn HITAGSAVED 0 espawnvar HITAGSAVED
sound VENT_BUST
state rats
state roaches
ifmove PICKEDUP setp[].runspeed RUNNINGSPEED
killit
}
ends

useractor notenemy 5667

ifaction 0 { cstator 256 action ZERO }

ifpdistl 1536
 ifn player_in_vehicle 0
state garbage_destroy

ifhitweapon
state garbage_destroy

enda

useractor notenemy 19535

ifaction 0 { cstator 256 action ZERO }

ifpdistl 1536
 ifn player_in_vehicle 0
state garbage_destroy

ifhitweapon
state garbage_destroy

enda

move CANTHROW 600 0

// GARBAGE CAN

spriteshadow 12416
useractor notenemy 12416
sizeat 24 24

ifpdistl 1536
 ife player_in_vehicle 1
state garbage_destroy

ifhitweapon
state garbage_destroy

enda

useractor notenemy 967
cstator 256
ifhitweapon { sound VENT_BUST debris SCRAP1 8 seta[].picnum 1068 }

ifpdistl 812
 ifp palive
  ifp pfacing
   ifcansee
    ifhitspace
	{
	soundonce DIAL_TONE
	}

enda

useractor notenemy 4575
cstator 256
ifhitweapon { sound VENT_BUST debris SCRAP1 8 shoot SPARK shoot SPARK shoot SPARK seta[].picnum 4839 }

ifpdistl 812
 ifp palive
  ifp pfacing
   ifcansee
    ifhitspace
	{
	soundonce TICKET_PUNCH
	}

enda

useractor notenemy 11966
cstator 256
ifhitweapon { sound VENT_BUST debris SCRAP1 8 shoot SPARK shoot SPARK shoot SPARK killit }

ifpdistl 812
 ifp palive
  ifp pfacing
   ifcansee
    ifhitspace
	 ifcount 6
	{
	soundonce ELEV_DING
	ifaction 0
	 ifn HITAGSAVED 0
		{
		operateactivators HITAGSAVED THISACTOR
		operaterespawns HITAGSAVED
		operatemasterswitches HITAGSAVED
		action ZERO
		}
	resetcount
	}

enda

var taken_piss 0 1

defstate hand_dryer
ifaction 0
	{
	ifpdistl 1024
	 ifp palive
	  ifp pfacing
	   ifcansee
	    ife taken_piss 2
		{
		set player_use 0
		ifhitspace
			{
			set hit_key 30
			addphealth 5
			setplayer[THISACTOR].weapon_pos 10
			sound HAND_DRIER
			set taken_piss 0
			action ZERO
			resetcount
			}
		}
	}
ifaction ZERO
	{
	ifcount 90
		{
		action 0
		resetcount
		}
	}
ends

useractor notenemy 1051 state hand_dryer enda
useractor notenemy 16941 state hand_dryer enda


// --------------------------------------------------------SCREEN BREAK STUFF-------------------------------------------------



defstate SCREENBROKEN
ifhitweapon
ifaction 0
{
sound GLASS_HEAVYBREAK lotsofglass 25
ifrnd 85 { action BREAK cactor W_SCREENBREAK }
ifrnd 170 { action BREAK cactor W_SCREENBREAK2 }
else { action BREAK cactor W_SCREENBREAK3 }
}
ends

useractor notenemy 1289 state SCREENBROKEN enda // Fempic2
useractor notenemy 1298 state SCREENBROKEN enda // Fempic 3
useractor notenemy 1306 state SCREENBROKEN enda // Fempic 4

useractor notenemy 17297
ifhitweapon
ifaction 0
{
sound GLASS_HEAVYBREAK
shoot SPARK shoot SPARK shoot SPARK
lotsofglass 25
action TWO
}
enda

useractor notenemy 20094
ifhitweapon
ifaction 0
{
sound GLASS_HEAVYBREAK
shoot SPARK shoot SPARK shoot SPARK
lotsofglass 25
cactor 17299
}
enda

useractor notenemy 17298
ifhitweapon
ifaction 0
{
sound GLASS_HEAVYBREAK
shoot SPARK shoot SPARK shoot SPARK
lotsofglass 25
action ONE
}
enda

defstate BREAKSCREEN
cstator 256

ifaction 0 { set temp3 param action ZERO }

ifcount 1 { add temp6 1 resetcount }

ifhitweapon
ifaction ZERO
{
shoot SPARK
shoot SPARK
shoot SPARK
shoot SPARK
shoot SPARK
shoot SPARK
shoot SPARK
shoot SPARK
shoot SPARK
shoot SPARK
sound GLASS_HEAVYBREAK lotsofglass 25
ifrnd 85
{
action BREAK
cactor W_SCREENBREAK
}
else
ifrnd 170
{
action BREAK
cactor W_SCREENBREAK2
}
else
{
action BREAK
cactor W_SCREENBREAK3
}
}

ifrnd 16
ifaction ZERO
seta[].picnum SCREENBREAK6

ifg temp6 1
ifaction ZERO
{
seta[].picnum temp3
set temp6 0
}

ends

eventloadactor SCREENBREAK1 geta[].picnum param enda
eventloadactor SCREENBREAK2 geta[].picnum param enda
eventloadactor SCREENBREAK3 geta[].picnum param enda
eventloadactor SCREENBREAK4 geta[].picnum param enda
eventloadactor SCREENBREAK5 geta[].picnum param enda
eventloadactor SCREENBREAK6 geta[].picnum param enda
eventloadactor SCREENBREAK7 geta[].picnum param enda
eventloadactor SCREENBREAK8 geta[].picnum param enda
eventloadactor SCREENBREAK9 geta[].picnum param enda
eventloadactor SCREENBREAK10 geta[].picnum param enda
eventloadactor SCREENBREAK11 geta[].picnum param enda
eventloadactor SCREENBREAK12 geta[].picnum param enda
eventloadactor SCREENBREAK13 geta[].picnum param enda
eventloadactor SCREENBREAK14 geta[].picnum param enda
eventloadactor SCREENBREAK15 geta[].picnum param enda
eventloadactor SCREENBREAK16 geta[].picnum param enda
eventloadactor SCREENBREAK18 geta[].picnum param enda
eventloadactor SCREENBREAK19 geta[].picnum param enda
eventloadactor SCREENBREAK20 geta[].picnum param enda

eventloadactor 19695 geta[].picnum param enda
eventloadactor 19696 geta[].picnum param enda
eventloadactor 19697 geta[].picnum param enda
eventloadactor 19698 geta[].picnum param enda
eventloadactor 19699 geta[].picnum param enda
eventloadactor 19699 geta[].picnum param enda

eventloadactor OJ geta[].picnum param enda
eventloadactor 5884 geta[].picnum param enda
eventloadactor 5885 geta[].picnum param enda
eventloadactor 5886 geta[].picnum param enda
eventloadactor 5785 geta[].picnum param enda
eventloadactor 5786 geta[].picnum param enda
eventloadactor 8070 geta[].picnum param enda
eventloadactor 14301 geta[].picnum param enda
eventloadactor 16609 geta[].picnum param enda
eventloadactor 16610 geta[].picnum param enda

useractor notenemy SCREENBREAK1 state BREAKSCREEN enda
useractor notenemy SCREENBREAK2 state BREAKSCREEN enda
useractor notenemy SCREENBREAK3 state BREAKSCREEN enda
useractor notenemy SCREENBREAK4 state BREAKSCREEN enda
useractor notenemy SCREENBREAK5 state BREAKSCREEN enda
useractor notenemy SCREENBREAK6 state BREAKSCREEN enda
useractor notenemy SCREENBREAK7 state BREAKSCREEN enda
useractor notenemy SCREENBREAK8 state BREAKSCREEN enda
useractor notenemy SCREENBREAK9 state BREAKSCREEN enda
useractor notenemy SCREENBREAK10 state BREAKSCREEN enda
useractor notenemy SCREENBREAK11 state BREAKSCREEN enda
useractor notenemy SCREENBREAK12 state BREAKSCREEN enda
useractor notenemy SCREENBREAK13 state BREAKSCREEN enda
useractor notenemy SCREENBREAK14 state BREAKSCREEN enda
useractor notenemy SCREENBREAK15 state BREAKSCREEN enda
useractor notenemy SCREENBREAK16 state BREAKSCREEN enda
useractor notenemy SCREENBREAK18 state BREAKSCREEN enda
useractor notenemy SCREENBREAK19 state BREAKSCREEN enda
useractor notenemy SCREENBREAK20 state BREAKSCREEN enda
useractor notenemy OJ state BREAKSCREEN enda
useractor notenemy 5884 state BREAKSCREEN enda
useractor notenemy 5885 state BREAKSCREEN enda
useractor notenemy 5886 state BREAKSCREEN enda
useractor notenemy 5785 state BREAKSCREEN enda
useractor notenemy 5786 state BREAKSCREEN enda
useractor notenemy 8070 state BREAKSCREEN enda
useractor notenemy 14301 state BREAKSCREEN enda
useractor notenemy 16609 state BREAKSCREEN enda
useractor notenemy 16610 state BREAKSCREEN enda

useractor notenemy 19695 state BREAKSCREEN enda
useractor notenemy 19696 state BREAKSCREEN enda
useractor notenemy 19697 state BREAKSCREEN enda
useractor notenemy 19698 state BREAKSCREEN enda
useractor notenemy 19699 state BREAKSCREEN enda
useractor notenemy 19699 state BREAKSCREEN enda

state BREAKFAN
ifhitweapon
ifaction 0
{
sound GLASS_HEAVYBREAK debris SCRAP1 12
seta[].picnum 411
}
ends

useractor notenemy 408 cstator 256 state BREAKFAN enda
useractor notenemy 409 cstator 256 state BREAKFAN enda
useractor notenemy 410 cstator 256 state BREAKFAN enda

useractor notenemy W_TECHWALL1 cstator 256 ifhitweapon { sound VENT_BUST debris SCRAP1 8 cactor 363 } enda
useractor notenemy W_TECHWALL2 cstator 256 ifhitweapon { sound VENT_BUST debris SCRAP1 8 cactor 362 } enda
useractor notenemy W_TECHWALL3 cstator 256 ifhitweapon { sound VENT_BUST debris SCRAP1 8 cactor 360 } enda
useractor notenemy W_TECHWALL4 cstator 256 ifhitweapon { sound VENT_BUST debris SCRAP1 8 cactor 361 } enda
useractor notenemy W_TECHWALL5 cstator 256 ifhitweapon { sound VENT_BUST debris SCRAP1 8 cactor 4135 } enda
useractor notenemy W_TECHWALL6 cstator 256 ifhitweapon { sound VENT_BUST debris SCRAP1 8 cactor 4137 } enda
useractor notenemy W_TECHWALL7 cstator 256 ifhitweapon { sound VENT_BUST debris SCRAP1 8 cactor 4139 } enda
useractor notenemy W_TECHWALL8 cstator 256 ifhitweapon { sound VENT_BUST debris SCRAP1 8 cactor 4141 } enda
useractor notenemy W_TECHWALL9 cstator 256 ifhitweapon { sound VENT_BUST debris SCRAP1 8 cactor 4143 } enda
useractor notenemy W_TECHWALL10 cstator 256 ifhitweapon { sound VENT_BUST debris SCRAP1 8 cactor 4145 } enda
useractor notenemy W_TECHWALL11 cstator 256 ifhitweapon { sound VENT_BUST debris SCRAP1 8 cactor 363 } enda
useractor notenemy W_TECHWALL12 cstator 256 ifhitweapon { sound VENT_BUST debris SCRAP1 8 cactor 363 } enda
useractor notenemy W_TECHWALL13 cstator 256 ifhitweapon { sound VENT_BUST debris SCRAP1 8 cactor 363 } enda
useractor notenemy W_TECHWALL14 cstator 256 ifhitweapon { sound VENT_BUST debris SCRAP1 8 cactor 363 } enda
useractor notenemy W_TECHWALL15 cstator 256 ifhitweapon { sound VENT_BUST debris SCRAP1 8 cactor 4147 } enda
useractor notenemy W_TECHWALL16 cstator 256 ifhitweapon { sound VENT_BUST debris SCRAP1 8 cactor 4144 } enda

useractor notenemy W_TECHWALL20 cstator 256 ifhitweapon { sound VENT_BUST debris SCRAP1 8 cactor 12328 } enda
useractor notenemy W_TECHWALL21 cstator 256 ifhitweapon { sound VENT_BUST debris SCRAP1 8 cactor 12332 } enda

useractor notenemy W_SCREENBREAK
enda

useractor notenemy W_SCREENBREAK2
enda

useractor notenemy W_SCREENBREAK3
enda

useractor notenemy 14276
ifaction 0 { cstator 256 action ZERO }
ifhitweapon { sound VENT_BUST lotsofglass 12 cactor 14277 }
enda

useractor notenemy 14278
ifaction 0 { cstator 256 action ZERO }
ifhitweapon { sound VENT_BUST lotsofglass 12 cactor 14278 }
enda

useractor notenemy VENDMACHINE
ifaction 0 { cstator 256 action ZERO }
ifhitweapon { sound VENT_BUST lotsofglass 12 cactor VENDMACHINEBROKE }
enda

useractor notenemy 3470
ifaction 0 { cstator 256 action ZERO }
ifhitweapon { sound VENT_BUST lotsofglass 12 cactor 3471 }
enda

useractor notenemy 5814 // Laptop
ifaction 0 { cstator 256 action ZERO }
ifhitweapon { sound VENT_BUST sound GLASS_BREAKING debris SCRAP1 8 lotsofglass 6 shoot SPARK shoot SPARK shoot SPARK shoot SPARK killit }
enda

useractor notenemy 19691 // misc. Gadget
ifaction 0 { cstator 256 action ZERO }
ifhitweapon { sound VENT_BUST debris SCRAP1 4 shoot SPARK shoot SPARK killit }
enda


useractor notenemy COLAMACHINE
cstator 256
ifhitweapon { sound VENT_BUST lotsofglass 12 cactor COLAMACHINEBROKE }
enda

defstate BREAKSCREEN_2
cstator 256

ifaction 0 { set param sprite[].picnum set temp3 param action ZERO }

ifcount 1 { add temp6 1 resetcount }

ifhitweapon
ifaction ZERO
{
shoot SPARK
shoot SPARK
shoot SPARK
shoot SPARK
shoot SPARK
shoot SPARK
shoot SPARK
shoot SPARK
shoot SPARK
shoot SPARK
sound GLASS_HEAVYBREAK lotsofglass 25
action BREAK
cactor 21753
}

ifrnd 16
ifaction ZERO
seta[].picnum 21754

ifg temp6 1
ifaction ZERO
{
seta[].picnum temp3
set temp6 0
}

ends

useractor notenemy 21754 state BREAKSCREEN_2 enda
useractor notenemy 21755 state BREAKSCREEN_2 enda
useractor notenemy 21756 state BREAKSCREEN_2 enda
useractor notenemy 21757 state BREAKSCREEN_2 enda
useractor notenemy 21758 state BREAKSCREEN_2 enda
useractor notenemy 21759 state BREAKSCREEN_2 enda

defstate BREAKSCREEN_3
cstator 256

ifaction 0 { set param sprite[].picnum set temp3 param action ZERO }

ifcount 1 { add temp6 1 resetcount }

ifhitweapon
ifaction ZERO
{
shoot SPARK
shoot SPARK
shoot SPARK
shoot SPARK
shoot SPARK
shoot SPARK
shoot SPARK
shoot SPARK
shoot SPARK
shoot SPARK
sound GLASS_HEAVYBREAK lotsofglass 25
action BREAK
cactor 21746
}

ifrnd 16
ifaction ZERO
seta[].picnum 21747

ifg temp6 1
ifaction ZERO
{
seta[].picnum temp3
set temp6 0
}

ends

useractor notenemy 21747 state BREAKSCREEN_3 enda
useractor notenemy 21748 state BREAKSCREEN_3 enda
useractor notenemy 21749 state BREAKSCREEN_3 enda
useractor notenemy 21750 state BREAKSCREEN_3 enda
useractor notenemy 21751 state BREAKSCREEN_3 enda
useractor notenemy 21752 state BREAKSCREEN_3 enda

defstate BREAKSCREEN_4
cstator 256

ifaction 0 { set param sprite[].picnum set temp3 param action ZERO }

ifcount 1 { add temp6 1 resetcount }

ifhitweapon
ifaction ZERO
{
shoot SPARK
shoot SPARK
shoot SPARK
shoot SPARK
shoot SPARK
shoot SPARK
shoot SPARK
shoot SPARK
shoot SPARK
shoot SPARK
sound GLASS_HEAVYBREAK lotsofglass 25
action BREAK
cactor 21738
}

ifrnd 16
ifaction ZERO
seta[].picnum 21739

ifg temp6 1
ifaction ZERO
{
seta[].picnum temp3
set temp6 0
}

ends

useractor notenemy 21739 state BREAKSCREEN_4 enda
useractor notenemy 21740 state BREAKSCREEN_4 enda
useractor notenemy 21741 state BREAKSCREEN_4 enda
useractor notenemy 21742 state BREAKSCREEN_4 enda
useractor notenemy 21743 state BREAKSCREEN_4 enda
useractor notenemy 21744 state BREAKSCREEN_4 enda
useractor notenemy 21745 state BREAKSCREEN_4 enda

spriteshadow 11249
useractor notenemy 11249
state ITEM_BOX_STUFF cstat 257
	ifhitweapon
	{
	spritepal 28

	spawn BIG_SMOKE2
	geta[RETURN].z temp
	sub temp 4096
	seta[RETURN].z temp

	state big_pot_deb
	ifn HITAGSAVED 0 espawnvar HITAGSAVED
	ife CHECKBOX THISACTOR { set MOUSEUP 0 set CHECKBOX -1 }
	killit
	}
enda

spriteshadow 11250
useractor notenemy 11250
state ITEM_BOX_STUFF cstat 257
ifhitweapon
	{
	ifrnd 128 sound POTBREAK_2 else sound POTBREAK
	spritepal 28

	spawn BIG_SMOKE2
	geta[RETURN].z temp
	sub temp 4096
	seta[RETURN].z temp

	state small_pot_deb
	ifn HITAGSAVED 0 espawnvar HITAGSAVED
	ife CHECKBOX THISACTOR { set MOUSEUP 0 set CHECKBOX -1 }
	killit
	}
enda

useractor notenemy 25575
state ITEM_BOX_STUFF cstat 257
ifhitweapon
	{
	spawn BIG_SMOKE2
	geta[RETURN].z temp
	sub temp 4096
	seta[RETURN].z temp

	state big_pot_deb
	ifn HITAGSAVED 0 espawnvar HITAGSAVED
	ife CHECKBOX THISACTOR { set MOUSEUP 0 set CHECKBOX -1 }
	killit
	}
enda

useractor notenemy 25576
state ITEM_BOX_STUFF cstat 257
ifhitweapon
	{
	ifrnd 128 sound POTBREAK_2 else sound POTBREAK
	spawn BIG_SMOKE2
	geta[RETURN].z temp
	sub temp 4096
	seta[RETURN].z temp

	state small_pot_deb
	ifn HITAGSAVED 0 espawnvar HITAGSAVED
	ife CHECKBOX THISACTOR { set MOUSEUP 0 set CHECKBOX -1 }
	killit
	}
enda

useractor notenemy 25577
state ITEM_BOX_STUFF cstat 257
ifhitweapon
	{
	spawn BIG_SMOKE2
	geta[RETURN].z temp
	sub temp 4096
	seta[RETURN].z temp

	state big_pot_deb
	ifn HITAGSAVED 0 espawnvar HITAGSAVED
	ife CHECKBOX THISACTOR { set MOUSEUP 0 set CHECKBOX -1 }
	killit
	}
enda

spriteshadow 5664
useractor notenemy 5664
state ITEM_BOX_STUFF cstat 257
ifspritepal 3
	{
	ifpdistl 2048
		{
		ifrnd 128 sound POTBREAK_2 else sound POTBREAK
		spritepal 28

		spawn BIG_SMOKE2
		geta[RETURN].z temp
		sub temp 4096
		seta[RETURN].z temp

		state small_pot_deb
		spawn LIL_SCORP_LEAP
		killit
		}
	}
ifhitweapon
	{
	ifrnd 128 sound POTBREAK_2 else sound POTBREAK
	spritepal 28

	espawn BIG_SMOKE2
	geta[RETURN].z temp
	sub temp 4096
	seta[RETURN].z temp

	state small_pot_deb
	ifn HITAGSAVED 0 espawnvar HITAGSAVED
	ife CHECKBOX THISACTOR { set MOUSEUP 0 set CHECKBOX -1 }
	killit
	}
enda

spriteshadow 5665
useractor notenemy 5665
state ITEM_BOX_STUFF cstat 257
ifhitweapon
	{
	ifrnd 128 sound POTBREAK_2 else sound POTBREAK
	spritepal 1

	espawn BIG_SMOKE2
	geta[RETURN].z temp
	sub temp 8192
	seta[RETURN].z temp

	state small_pot_deb
	ifn HITAGSAVED 0 espawnvar HITAGSAVED
	ife CHECKBOX THISACTOR { set MOUSEUP 0 set CHECKBOX -1 }
	killit
	}
enda

useractor notenemy ATM cstator 256 ifhitweapon { sound GLASS_HEAVYBREAK cactor ATMBROKE } enda
useractor notenemy 918 cstator 256 ifhitweapon { sound VENT_BUST sound SHORT_CIRCUIT seta[].picnum 4430 } enda


// HELL SCREENS==================================================================================

defstate BREAKDSCREEN
cstator 256

ifaction 0 { set temp3 param action ZERO }

ifcount 1 { add temp6 1 resetcount }

ifhitweapon
ifaction ZERO
{
sound GLASS_HEAVYBREAK lotsofglass 25
action BREAK
cactor 7337
}

ifrnd 1
ifaction ZERO
ifspritepal 3
{
ifp pfacing nullop else
seta[].picnum 7336
}

ifg temp6 1
ifaction ZERO
{
seta[].picnum temp3
set temp6 0
}

ends

eventloadactor 7194 geta[].picnum param enda
eventloadactor 7195 geta[].picnum param enda
eventloadactor 7196 geta[].picnum param enda

useractor notenemy 7194 state BREAKDSCREEN enda
useractor notenemy 7195 state BREAKDSCREEN enda
useractor notenemy 7196 state BREAKDSCREEN enda
useractor notenemy 7336 state BREAKDSCREEN enda
useractor notenemy 7337 enda

useractor notenemy 12375

ifpdistl 2048
ife player_in_vehicle 1
	{
	cstat 0
	quake 13
	state break_glass
	state break_metal
	cactor 12799
	}

enda

useractor notenemy 10701

ifpdistl 2048
ife player_in_vehicle 1
	{
	cstat 0
	quake 13
	state break_glass
	state break_metal
	cactor 12799
	}

enda




defstate gib_ground_squish
ifsquished { sound BLOOD_SPURT spawn 2284 killit }
ends

// JIB GROUND SPRITES
useractor notenemy 1519 fall state lowperf state setfloorpal state gib_ground_squish enda
useractor notenemy 1534 fall state lowperf state setfloorpal state gib_ground_squish enda

useractor notenemy 2249 sizeat 24 24 fall state lowperf state setfloorpal state gib_ground_squish enda
useractor notenemy 2254 fall state lowperf state setfloorpal state gib_ground_squish enda
useractor notenemy 2259 fall state lowperf state setfloorpal state gib_ground_squish enda
useractor notenemy 2264 fall state lowperf state setfloorpal state gib_ground_squish enda
useractor notenemy 2269 fall state lowperf state setfloorpal state gib_ground_squish enda

spriteshadow 2214
useractor notenemy 2214

sizeat 32 32
cstat 256
fall
state gib_ground_squish

ifhitweapon { state standard_jibs state squish_sounds killit } else
ifpdistl 812
{
getp[].ang temp
seta[].ang temp
sound ENDSEQVOL3SND1
ifp prunning { setprojectile[LIZMANHEAD3].VEL 600 ezshoot 4096 LIZMANHEAD3 } else
{ setprojectile[LIZMANHEAD3].VEL 400 ezshoot 2048 LIZMANHEAD3 }
geta[].pal temp
seta[RETURN].pal temp
killit
}

enda

spriteshadow 8497
useractor notenemy 8497

ifaction 0
	{
	cstator 256
	action ZERO
	}

ifhitweapon
	{
	spritepal 7
	lotsofglass 12
	sound GLASS_HEAVYBREAK
	killit
	}

enda

spriteshadow 8498

useractor notenemy 8498

ifaction 0
{
cstator 256
action ZERO
}

ifhitweapon
{
spritepal 7
lotsofglass 12
sound GLASS_HEAVYBREAK
killit
}

enda

spriteshadow 18112

useractor notenemy 18112

ifaction 0
{
cstator 256
action ZERO
}

ifhitweapon
{
spritepal 7
lotsofglass 4
spawn 2284
sound GLASS_HEAVYBREAK
killit
}

enda

defstate head_floor_code

ifaction 0
{
ifactor SATYR_HEAD_FLOOR sizeat 26 26 else
ifactor MJ12_HEAD_FLOOR sizeat 30 30 else
sizeat 26 26
cstat 256
action FORM
}
fall
state gib_ground_squish
ifand sector[].floorstat 1 killit

ifhitweapon
	{
	ifactor ORC_HEAD_FLOOR spritepal 8
	state standard_jibs
	state squish_sounds
	killit
	}
	else
ifpdistl 812
	{
	getp[].ang temp
	seta[].ang temp
	sound ENDSEQVOL3SND1
	ifp prunning set temp2 600 else set temp2 400
	ifactor SATYR_HEAD_FLOOR { setprojectile[SATYR_HEAD].VEL temp2 ezshoot 4096 SATYR_HEAD }
	ifactor ORC_HEAD_FLOOR { setprojectile[ORC_HEAD].VEL temp2 ezshoot 4096 ORC_HEAD }
	ifactor MJ12_HEAD_FLOOR { setprojectile[MJ12_HEAD].VEL temp2 ezshoot 4096 MJ12_HEAD }
	ifactor FLAMEC_HEAD_FLOOR { setprojectile[FLAMEC_HEAD].VEL temp2 ezshoot 4096 FLAMEC_HEAD }
	ifactor HMGC_HEAD_FLOOR { setprojectile[HMGC_HEAD].VEL temp2 ezshoot 4096 HMGC_HEAD }
	ifactor ARCHER_HEAD_FLOOR { setprojectile[ARCHER_HEAD].VEL temp2 ezshoot 4096 ARCHER_HEAD }
	ifactor PIG_HEAD_FLOOR { setprojectile[ARCHER_HEAD].VEL temp2 ezshoot 4096 PIG_HEAD }
	geta[].pal temp
	seta[RETURN].pal temp
	killit
	}

ends

useractor notenemy SATYR_HEAD_FLOOR state head_floor_code enda

spriteshadow ORC_HEAD_FLOOR
useractor notenemy ORC_HEAD_FLOOR state head_floor_code enda

useractor notenemy MJ12_HEAD_FLOOR state head_floor_code enda

useractor notenemy FLAMEC_HEAD_FLOOR state head_floor_code enda

useractor notenemy HMGC_HEAD_FLOOR state head_floor_code enda

spriteshadow ARCHER_HEAD_FLOOR
useractor notenemy ARCHER_HEAD_FLOOR state head_floor_code enda

spriteshadow PIG_HEAD_FLOOR
useractor notenemy PIG_HEAD_FLOOR state head_floor_code enda

useractor notenemy 3714

ife opt_glass_shard_toggle 0
    killit

fall
state lowperf

ifaction 0
	{
	geta[].sectnum upd_sect
	updatesectorz sprite[].x sprite[].y sprite[].z upd_sect
	ife upd_sect -1 killit
	else changespritesect THISACTOR upd_sect
	seta[].z sector[].floorz
	findnearactor 3714 128 temp ifn temp -1 killit // prevents odd occasion where hundreds of shards spawn
	sizeat 24 24
	cstat 34
	randvar temp 2048
	seta[].ang temp
	action ZERO
	}

ifaction ZERO
	{
	ifpdistl 764 ifn footstep_count -1 { ife room_type 1 sound O_GL_CRUNCH else sound GL_CRUNCH_UNDER espawn 509 seta[RETURN].pal sprite[].pal killit }
	}
enda

useractor notenemy 509

ife opt_glass_shard_toggle 0
    killit

fall
state lowperf
ifaction 0
	{ seta[].z sector[].floorz sizeat 24 24
	cstat 34 randvar temp 2048 seta[].ang temp
	ifand sector[].floorstat 1 killit
	findnearactor 509 128 temp ifn temp -1 killit
	action ZERO }

ifaction ZERO { ifpdistl 764 ifn footstep_count -1 { sound GLASS_CRUNCH action FORM } }
ifaction FORM { ifpdistg 764 action ZERO }

enda

spriteshadow 2215
useractor notenemy 2215 fall ifand sector[].floorstat 1 killit state lowperf state setfloorpal state gib_ground_squish enda

spriteshadow 2216
useractor notenemy 2216 fall ifand sector[].floorstat 1 killit state lowperf state setfloorpal state gib_ground_squish enda

defstate jib_setup
fall
sizeat 26 26
ifand sector[].floorstat 1 killit
ifaction 0 { spawn 2284 state rf action ZERO }
state lowperf
state setfloorpal
state gib_ground_squish
ends

spriteshadow NJIBI
useractor notenemy NJIBI state jib_setup enda
spriteshadow NJIB2I
useractor notenemy NJIB2I state jib_setup enda
spriteshadow NJIB3I
useractor notenemy NJIB3I state jib_setup enda
spriteshadow NJIB4I
useractor notenemy NJIB4I state jib_setup enda

useractor notenemy OCTA_TENTI state jib_setup enda
useractor notenemy 11430 state jib_setup enda
useractor notenemy 11435 state jib_setup enda

action SUBZERO -1

spriteshadow 1769
useractor notenemy 1769 ifaction 0 action SUBZERO fall state lowperf state setfloorpal state gib_ground_squish enda
spriteshadow 1773
useractor notenemy 1773 ifaction 0 action SUBZERO fall state lowperf state setfloorpal state gib_ground_squish enda
spriteshadow 1777
useractor notenemy 1777 fall state lowperf  state setfloorpal state gib_ground_squish enda

// DEBRIS
spriteshadow ROCKDEB_1F
useractor notenemy ROCKDEB_1F  fall sizeat 32 32 ifaction 0 { state rf action ZERO } state lowperf state setfloorpal enda
spriteshadow ROCKDEB_3F
useractor notenemy ROCKDEB_3F  fall sizeat 16 16 ifaction 0 { state rf ifrnd 128 action ONE else action ZERO } state lowperf state setfloorpal enda
spriteshadow ROCKDEB_4F
useractor notenemy ROCKDEB_4F  fall sizeat 16 16 ifaction 0 { state rf ifrnd 128 cstator 8 action ZERO } state lowperf state setfloorpal enda

useractor notenemy POTTERY_DEBRIS_F1
fall sizeat 16 16
ifaction 0
	{
	cstat 32
	randvar temp 2048
	seta[].ang temp
	ifrnd 96 action ONE else
	ifrnd 96 action TWO else
	action ZERO
	}
state lowperf state setfloorpal
enda

useractor notenemy POTTERY_DEBRIS_F2
fall sizeat 16 16
ifaction 0
	{
	cstat 32
	randvar temp 2048
	seta[].ang temp
	ifrnd 96 action ONE else
	ifrnd 96 action TWO else
	action ZERO
	}
state lowperf state setfloorpal
enda

useractor notenemy METAL_RING_F
fall sizeat 16 16
ifaction 0
	{
	cstat 32
	randvar temp 2048
	seta[].ang temp
	ifrnd 96 action ONE else
	ifrnd 96 action MINUSONE else
	action ZERO
	}
state lowperf state setfloorpal
enda

useractor notenemy 19171 fall sizeat 50 50 ifaction 0 { state rf action ZERO } state lowperf state setfloorpal enda // powersuit arm
useractor notenemy 19176 fall sizeat 50 50 ifaction 0 { state rf action ZERO } state lowperf state setfloorpal enda // powersuit leg

spriteshadow OGRE_MACE_FLOOR
useractor notenemy OGRE_MACE_FLOOR fall sizeat 20 20 ifaction 0 { state rf action ZERO } state lowperf state setfloorpal enda
spriteshadow OGRE_STAFF_FLOOR
useractor notenemy OGRE_STAFF_FLOOR fall sizeat 20 20 ifaction 0 { state rf action ZERO } state lowperf state setfloorpal enda

spriteshadow ORC_SWORD_FLOOR
useractor notenemy ORC_SWORD_FLOOR fall sizeat 20 20 ifaction 0 { state rf action ZERO } state lowperf state setfloorpal enda

useractor notenemy ICE_DEBRIS_F
fall
ifaction 0 { sizeat 16 16 state rf ifrnd 128 action ONE else action ZERO }
else
	{
	ifpdistl 864
		{
		sound ICE_BOUNCE
		spawn 2284
		killit
		}

	ifcount 236
		{
		sizeto 1 1
		}
	ifcount 260
		{
		spawn 2284
		killit
		}
	}
state lowperf



enda

useractor notenemy 21670

ifaction 0
{
cstator 256
ifpdistg 16384
	{
	geta[].mdflags spawntmp
    orvar spawntmp 1  // SPREXT_NOTMD
    seta[].mdflags spawntmp
	action ZERO
	}
}
else
ifaction ZERO
{
ifpdistl 16384
	{
	geta[].mdflags spawntmp
    xorvar spawntmp 1  // SPREXT_NOTMD
    seta[].mdflags spawntmp
	action 0
	}
}

ifhitweapon
{
sound GLASS_HEAVYBREAK lotsofglass 25
cactor 21671
}

enda

useractor notenemy 21671

ifaction 0
{
ifpdistg 16384
	{
	geta[].mdflags spawntmp
    orvar spawntmp 1  // SPREXT_NOTMD
    seta[].mdflags spawntmp
	action ZERO
	}
}
else
ifaction ZERO
{
ifpdistl 16384
	{
	geta[].mdflags spawntmp
    xorvar spawntmp 1  // SPREXT_NOTMD
    seta[].mdflags spawntmp
	action 0
	}
}

enda


// CON Files for the 'Duke Carribean Add-on' by SunStorm Interactive
//
// Actor - BEACHBALL - Sprite #941
//
// --- Resources ---
//
// Sounds:
// Beach Ball Bounce      - BLBOUNCE.WAV
// Beach Ball Explode     - BALLBOOM.WAV
//
// Art:
// 1 * 1 frame(s)         - Beach Ball

define BEACHBALL 20162
define BALLSTRENGTH 20
action BBB 0 8 1 1 10
action BBI 1 1

move   BALL0  0     40
move   BALL1 -500   -90
move   BALL2 -400    30
move   BALL3 -300    -70
move   BALL4 -200    20
move   BALL5 -150    -50
move   BALL6 -80    10
move   BALL7 -100   0

ai     AIBALLRANDOM BBB BALL0 randomangle
ai     AIBALLI BBI BALL0 faceplayer
ai     AIBALLR BBB BALL7 geth getv
ai     AIBALL1 BBB BALL1 geth getv
ai     AIBALL2 BBB BALL2 geth getv
ai     AIBALL3 BBB BALL3 geth getv
ai     AIBALL4 BBB BALL4 geth getv
ai     AIBALL5 BBB BALL5 geth getv
ai     AIBALL6 BBB BALL6 geth getv

spriteshadow BEACHBALL

useractor notenemy BEACHBALL WEAK BBI

fall
ifai 0 { ai AIBALLI cstator 256 sizeat 30 30 }

ifhitweapon
  {
  debris SCRAP3 5
  sound THUD
  killit
  }

ifcansee { }

ifai AIBALLI
  {
  ifpdistl 1024
    {
    ai AIBALL1
    sound BOUNCESOUND
    }
  }

ifai AIBALL1
  {
  ifcount 8
    {
    ai AIBALL2
    }
  ifnotmoving
    {
    ai AIBALLRANDOM
    ai AIBALL1
    }
  }

ifai AIBALL2
  {
  iffloordistl 1
    {
    ai AIBALL3
    sound BOUNCESOUND
    }
  ifnotmoving
    {
    ai AIBALLRANDOM
    ai AIBALL2
    }
  }

ifai AIBALL3
  {
  ifcount 8
    {
    ai AIBALL4
    }
  ifnotmoving
    {
    ai AIBALLRANDOM
    ai AIBALL3
    }
  }

ifai AIBALL4
  {
  iffloordistl 1
    {
    ai AIBALL5
    sound BOUNCESOUND
    }
  ifnotmoving
    {
    ai AIBALLRANDOM
    ai AIBALL4
    }

  }

ifai AIBALL5
  {
  ifcount 8
    {
    ai AIBALL6
    break
    }
  ifnotmoving
    {
    ai AIBALLRANDOM
    ai AIBALL5
    }
  }

ifai AIBALL6
  {
  iffloordistl 1
    {
    ai AIBALLR
    sound BOUNCESOUND
    }
  ifnotmoving
    {
    ai AIBALLRANDOM
    ai AIBALL6
    }
  }

ifai AIBALLR
  {
  ifpdistl 1024
    {
    ai AIBALL1
    sound BOUNCESOUND
    }
  ifcount 15
    {
    ai AIBALLI
    }
  ifnotmoving
    {
    ai AIBALLRANDOM
    ai AIBALLR
    }
  }


break
enda

// following code by Alias Conrad Coldwood for his EDF Bureau level

define ACC_SHADES                       20367
define ACC_SHADESBREAK1                 20368
define ACC_SHADESBREAK2                 20369

useractor notenemy ACC_SHADES
	cstator 2321	// ACC, use the OR method for the actor state:: 2321 = Solid (1) + Vertically Flat (16) + HitScan (256) + Custom Shadow (2048)
	ifhitweapon
		{
		ifrnd 160	// if a random value between 0-255 is less than 160...
			cactor ACC_SHADESBREAK1
		else
			cactor ACC_SHADESBREAK2
		debris SCRAP1 5
		debris SCRAP2 5
		sound VENT_BUST
		cstat 2064	// ACC, reset the actor state to:: 2064 = Vertically Flat (16) + Custom Shadow (2048)
		break
		}
enda

// HOLOGRAMS ===============================================================================

spritenoshade 5627

useractor notenemy 5627
seta[].blend 255
cstator 514
ifrnd 128 cstator 4
ifrnd 128 cstator 8
add temp 1
ifg temp 1 seta[].shade -127
ifg temp 3 killit
enda

useractor notenemy 19582 ifaction 0 { set temp2 2 set X_RATIO 50 set Y_RATIO 50 action ZERO } state HOLOGRAM_FLICKER enda
useractor notenemy 19619 ifaction 0 { set temp2 7 set X_RATIO 54 set Y_RATIO 39 action ZERO } state HOLOGRAM_FLICKER enda
useractor notenemy 19620 ifaction 0 { set temp2 0 set X_RATIO 54 set Y_RATIO 54 action ZERO } state HOLOGRAM_FLICKER enda
useractor notenemy 19628 ifaction 0 { geta[].pal temp2 set X_RATIO 50 set Y_RATIO 26 action ZERO } state HOLOGRAM_FLICKER enda
useractor notenemy 19629 ifaction 0 { set temp2 8 set X_RATIO 52 set Y_RATIO 28 action ZERO } state HOLOGRAM_FLICKER enda
useractor notenemy 19630 ifaction 0 { set temp2 2 set X_RATIO 52 set Y_RATIO 28 action ZERO } state HOLOGRAM_FLICKER enda
useractor notenemy 19631 ifaction 0 { set temp2 2 set X_RATIO 38 set Y_RATIO 40 action ZERO } state HOLOGRAM_FLICKER enda
useractor notenemy 19631 ifaction 0 { set temp2 2 set X_RATIO 52 set Y_RATIO 28 action ZERO } state HOLOGRAM_FLICKER enda

// *************************************************
// CHANDILIER
// *************************************************

define CHAND 5873

define CHANDBASE 3038
define CHANDFALL 3040

useractor notenemy CHAND
cstator 1024
ifspritepal 3
{
cstat 257
ifhitweapon
	{
	sound CHAINSNAP
	espawn CHANDBASE
	seta[RETURN].xrepeat sprite[].xrepeat
	seta[RETURN].yrepeat sprite[].yrepeat
	espawn CHANDFALL
	seta[RETURN].xrepeat sprite[].xrepeat
	seta[RETURN].yrepeat sprite[].yrepeat
	debris SCRAP2 1
	killit
	}
}

enda

useractor notenemy CHANDBASE cstat 0 enda

useractor notenemy CHANDFALL
fall

hitradius 1024 50 100 150 200

iffloordistl 2
{
sound VENT_BUST
debris SCRAP2 5
debris SCRAP1 5
killit
}

enda

useractor notenemy 5707 // fancy street light
ifaction 0 { cstator 256 action ZERO }
ifhitweapon
{
ifspritepal 4 break
sound VENT_BUST
sound GLASS_BREAKING
debris SCRAP2 5
lotsofglass 10
shoot SPARK shoot SPARK shoot SPARK
debris SCRAP1 5
cactor 5714
}
enda

useractor notenemy 5756 // lamp
ifaction 0 { cstator 256 action ZERO }
ifhitweapon
{
ifspritepal 3 break
sound VENT_BUST
sound GLASS_BREAKING
debris SCRAP2 2
lotsofglass 5
shoot SPARK shoot SPARK shoot SPARK
debris SCRAP1 2
killit
}
enda

useractor notenemy 5769 // clothes hanger
ifaction 0 { cstator 256 action ZERO }
ifhitweapon
{
sound VENT_BUST
debris SCRAP2 4
debris SCRAP1 4
killit
}
enda

useractor notenemy 5771 // small lamp
ifaction 0 { cstator 256 action ZERO }
ifhitweapon
{
ifspritepal 3 break
sound VENT_BUST
sound GLASS_BREAKING
debris SCRAP2 2
lotsofglass 4
shoot SPARK shoot SPARK shoot SPARK
debris SCRAP1 2
killit
}
enda

useractor notenemy 8174 // lamp
ifaction 0 { cstator 256 action ZERO }
ifhitweapon
{
ifspritepal 3 break
sound VENT_BUST
sound GLASS_BREAKING
debris SCRAP2 2
lotsofglass 4
shoot SPARK shoot SPARK shoot SPARK
debris SCRAP1 2
killit
}
enda

useractor notenemy 8683  // microscope
ifaction 0 { cstator 256 action ZERO }
ifhitweapon
{
ifspritepal 3 break
sound VENT_BUST
sound GLASS_BREAKING
debris SCRAP2 3
lotsofglass 4
shoot SPARK shoot SPARK shoot SPARK
debris SCRAP1 3
killit
}
enda

useractor notenemy 23773 // ceiling grate
ifspritepal 3 break
else
	{
	ifaction 0
		{
		geta[].z temp2
		gets[].ceilingz temp
		sub temp temp2
		ifl temp 0 mulvar temp -1
		action ZERO
		}
	ifaction ZERO
		{
		gets[].ceilingz temp2
		add temp2 temp
		seta[].z temp2
		}
	}
enda

useractor notenemy 20434 // whiteboard

ifaction 0
{
ifpdistl 1536
 ifp pfacing
  ifcansee
   ifp palive
	{
	set player_use 0
	 ifhitspace
		{
		set hit_key 30
		sound WRITING
		state lower_weapon
		ife CHAR 0 seta[].picnum 20435
		ife CHAR 1 seta[].picnum 20436
		ife CHAR 2 seta[].picnum 20437
		ife CHAR 3 seta[].picnum 20438
		ife CHAR 4 { set PLAYER_VOICEOVER 13 seta[].picnum 20439 }
		ife CHAR 5 seta[].picnum 20440
		ife CHAR 6 seta[].picnum 20441
		ife CHAR 7 seta[].picnum 20442
		ife CHAR 10 seta[].picnum 20442
		ife CHAR 11 seta[].picnum 20437
		ife CHAR 12 seta[].picnum 3559
		ife CHAR 13 seta[].picnum 20443
		ife CHAR 14 seta[].picnum 20444
		ife CHAR 15 seta[].picnum 20443
		ife CHAR 17 seta[].picnum 20445
		}
	}
}

enda

// case specific stuff for CNC

defstate PROPER_SHADE
seta[].shade sector[].floorshade
ends

spritenoshade 9645
spritenoshade 19645
spritenoshade 19646
spritenoshade 19647
spritenoshade 19648
spritenoshade 19649
spritenoshade 19650
spritenoshade 19651

useractor notenemy 9645 state PROPER_SHADE enda
useractor notenemy 19645 state PROPER_SHADE enda
useractor notenemy 19646 state PROPER_SHADE enda
useractor notenemy 19647 state PROPER_SHADE enda
useractor notenemy 19648 state PROPER_SHADE enda
useractor notenemy 19649 state PROPER_SHADE enda
useractor notenemy 19650 state PROPER_SHADE enda
useractor notenemy 19651 state PROPER_SHADE enda

useractor notenemy 4427 TOUGH
  ifaction 0
  {
    action ANULLACTION
    cstat 257
  }
  ifhitweapon
  {
    ifdead
    {
      state squish_sounds
      guts JIBS5 8
      guts JIBS6 9
      killit
    }
    else
      guts JIBS6 1
  }
  ifrnd 1
    spawn WATERDRIP

enda

action ASPEAKERBROKE 1
useractor notenemy SPEAKER
  ifaction 0
  {
    ifhitweapon
    {
	  ifspritepal 3
	  {
	  stopsound PA_SYSTEM_1
	  stopsound PA_SYSTEM_2
	  stopsound PA_SYSTEM_3
	  stopsound PA_SYSTEM_4
	  stopsound PA_SYSTEM_5
	  sound SHORT_CIRCUIT
	  sound VENT_BUST
	  shoot SPARK shoot SPARK shoot SPARK shoot SPARK shoot SPARK
	  }
	  else
	  {
      stopsound STORE_MUSIC
      soundonce STORE_MUSIC_BROKE
	  shoot SPARK shoot SPARK shoot SPARK shoot SPARK shoot SPARK
	  }
      action ASPEAKERBROKE
    }
    else
    {
      ifpdistl 10240
		{
		ifspritepal 3 // Angry PA system
			{
				ifcount 204
				{
				randvar temp4 50
				ifl temp4 10 soundonce PA_SYSTEM_1 else
				ifl temp4 20 soundonce PA_SYSTEM_2 else
				ifl temp4 30 soundonce PA_SYSTEM_3 else
				ifl temp4 40 soundonce PA_SYSTEM_4 else
				ifl temp4 50 soundonce PA_SYSTEM_5
				cstator 256
				resetcount
				}
			}
			else
			ifspritepal 9 nullop
			else
			{
            soundonce STORE_MUSIC
			cstat 289
			}
		}

    }
  }

 ifaction ASPEAKERBROKE
 {
 ifspritepal 3 break
 add INTERNALCOUNT 1
  ifg INTERNALCOUNT 30
	{
	set PLAYER_VOICEOVER 17
	action ONE
	}
 }

enda

action ALAVABUBBLE
action ALAVABUBBLEANIM 0 5 1 1 16

useractor notenemy LAVABUBBLE
  ifaction 0
  {
  seta[].blend 255
    cstat 32768
    action ALAVABUBBLE
  }
  else
    ifaction ALAVABUBBLE
  {
    ifcount 72
      ifrnd 2
    {
      cstat 2
      action ALAVABUBBLEANIM
    }
  }
  else
  {
    ifactioncount 5
    {
      cstat 32768
      action ALAVABUBBLE
    }
  }
enda

// boxing bag

action BAG_PUNCH 1
action BAG_SWING_F 2 4 1 1 8
action BAG_SWING_M 2 4 1 1 16
action BAG_SWING_S 2 4 1 1 32

spriteshadow 28416

useractor notenemy 28416
ifaction 0 { cstat 257 strength 100 action ZERO }

ifhitweapon { strength 100 ifwasweapon KNEE action BAG_PUNCH }
ifaction BAG_PUNCH ifactioncount 2 action BAG_SWING_F
ifaction BAG_SWING_F ifactioncount 8 action BAG_SWING_M
ifaction BAG_SWING_M ifactioncount 16 action BAG_SWING_S
ifaction BAG_SWING_S ifactioncount 32 action ZERO
enda

// bamboo

action BAMB_SLICE 0 5 1 1 12
action BAMB_SLICED 5

defstate tree_slice
sound TREE_FALL
setactorsoundpitch THISACTOR TREE_FALL 1024
geta[].cstat temp xor temp 257 seta[].cstat temp
stopsound METSWIPE
stopsound METSWIPE2
stopsound METSWIPE3
sound MELEE_HIT_WOOD1
action BAMB_SLICE
ends

useractor notenemy 27022

ifaction 0
	{
	cstator 257
	strength 75
	ifhitweapon
		{
		ifwasweapon 12053 state tree_slice
		ifwasweapon 27370 state tree_slice
		ifwasweapon KAG_BLAST_RIGHT state tree_slice
		ifwasweapon KAG_BLAST_LEFT state tree_slice
		}
	}
ifaction BAMB_SLICE
	{
	ifactioncount 5 action BAMB_SLICED
	}

enda

// AMC CHIBI CODE

// 1 = James EP1
// 2 = Arm James EP3
// 3 = Ringworld James EP4
// 5 = AMC Soldier EP2
// 6 = Advanced AMC solder EP4
// 7 = EDF Soldier EP2
// 8 = Mikko EP1
// 10 = Zaxtor EP1
// 11 = Ringworld Zaxtor EP4
// 13 = SMART Micky // EP2
// 14 = Naked Micky // EP3
// 16 = Egghead Micky //EP2
// 17 = Geoffrey // EP1
// 19 = Merlijn // EP1
// 20 = Berserker Merlijn // EP4
// 21 = Warlock Sang // EP1
// 22 = Peacelog Sang // EP3
// 23 = Rusty // EP1
// 24 = Ringworld Rusty // EP4
// 25 = Snowfall // EP3
// 27 = Highwire // EP1
// 29 = Maarten // EP4
// 30 = Fido // EP4
// 31 = Jane // EP2
// 33 = Bombshell // EP2
// 34 = Kagura // EP4
// 35 = Cassandra // EP3
// 36 = Minerva // EP4
// 37 = Armoured Bombshell // EP4
// 38 = Cultist // EP3
// 39 = Armour Highwire // EP3
// 40 = Casual Kagura // EP3

// Give spritepal 3 to display chibis, otherwise leave at zero

var chibi_id 0 2

defstate chibi_code
ifaction 0
{
geta[].htflags temp
xor temp 64
seta[].htflags temp
sizeat 16 16
ifspritepal 32 killit // placeholder for positioning
else ifspritepal 3 ife CHIBIS_FOUND[chibi_id] 0 killit
else ifspritepal 0 ife CHIBIS_FOUND[chibi_id] 1 { cstator 2 spritepal 27 }
action ZERO
}
ifaction ZERO
 ifn sprite[].pal 3
	{
	ifspawnedby APLAYER killit // no cheating
	ife cheated YES killit // no cheating
	ifp pfacing
	 ifp palive
	  ifcansee
	   ifpdistl 812
		{
		set player_use 0
		 ifhitspace
			{
			addphealth 25
			screensound FOUND_CHIBI
			ifspritepal 0
				{
				setarray CHIBIS_FOUND[chibi_id] 1
				setvar array_save 1
				}
			set hit_key 30
			set PLAYER_VOICEOVER 59 
			state getfactornormalizedframerate
			set DISP_KEY -150
			mul DISP_KEY NORMALIZED_FACTOR
			set DISP_KEY_PAL 0
			set DISP_KEY_PIC sprite[].picnum
			killit
			}
		}

	}
ends

// SPOILERS

useractor notenemy 24284 set chibi_id 1 state chibi_code enda
useractor notenemy 24285 set chibi_id 2 state chibi_code enda
useractor notenemy 24286 set chibi_id 3 state chibi_code enda
useractor notenemy 24317 set chibi_id 4 state chibi_code enda
useractor notenemy 24287 set chibi_id 5 state chibi_code enda
useractor notenemy 24316 set chibi_id 6 state chibi_code enda
useractor notenemy 24288 set chibi_id 7 state chibi_code enda
useractor notenemy 24289 set chibi_id 8 state chibi_code enda
useractor notenemy 24315 set chibi_id 9 state chibi_code enda
useractor notenemy 24290 set chibi_id 10 state chibi_code enda
useractor notenemy 24291 set chibi_id 11 state chibi_code enda
// chibi 12
useractor notenemy 24292 set chibi_id 13 state chibi_code enda
useractor notenemy 24293 set chibi_id 14 state chibi_code enda
useractor notenemy 24319 set chibi_id 15 state chibi_code enda
useractor notenemy 24294 set chibi_id 16 state chibi_code enda
useractor notenemy 24295 set chibi_id 17 state chibi_code enda
// chibi 18
useractor notenemy 24296 set chibi_id 19 state chibi_code enda
useractor notenemy 24297 set chibi_id 20 state chibi_code enda
useractor notenemy 24298 set chibi_id 21 state chibi_code enda

useractor notenemy 24299 set chibi_id 22 state chibi_code enda
useractor notenemy 24300 set chibi_id 23 state chibi_code enda
useractor notenemy 24301 set chibi_id 24 state chibi_code enda
useractor notenemy 24302 set chibi_id 25 state chibi_code enda
// chibi 26
useractor notenemy 24303 set chibi_id 27 state chibi_code enda
useractor notenemy 24304 set chibi_id 28 state chibi_code enda
useractor notenemy 24134 set chibi_id 29 state chibi_code enda
useractor notenemy 24135 set chibi_id 30 state chibi_code enda
useractor notenemy 24136 set chibi_id 31 state chibi_code enda
// chibi 32
useractor notenemy 24198 set chibi_id 33 state chibi_code enda
useractor notenemy 24305 set chibi_id 34 state chibi_code enda
useractor notenemy 24199 set chibi_id 35 state chibi_code enda
useractor notenemy 25080 set chibi_id 36 state chibi_code enda // Minerva
useractor notenemy 25081 set chibi_id 37 state chibi_code enda // Bombshell combat outfit
useractor notenemy 25082 set chibi_id 38 state chibi_code enda // Cultist
useractor notenemy 25083 fall set chibi_id 39 state chibi_code enda // Highwire armour
useractor notenemy 24318 set chibi_id 40 state chibi_code enda // Casual Kagura
useractor notenemy 24311 set chibi_id 41 state chibi_code enda // Kagura's cat
useractor notenemy 24312 set chibi_id 42 state chibi_code enda // Kagura coat
useractor notenemy 24313 set chibi_id 43 state chibi_code enda
useractor notenemy 24314 set chibi_id 44 state chibi_code enda
// 48 is golden sang

useractor notenemy 32758  ifaction 0 { ifand BEAT_EPISODES[1] 16 action ZERO else killit } enda // Chainsaw chibi
useractor notenemy 32759 ifaction 0 { ifand BEAT_EPISODES[3] 4 action ZERO else killit } enda // Le Sang Chibi
useractor notenemy 32760 ifaction 0 { ifand BEAT_EPISODES[5] 524288 action ZERO else killit } enda // PATCOS Chibi
useractor notenemy 32764 ifaction 0 { ifand BEAT_EPISODES[4] 32768 action ZERO else killit } enda // Naaldir Chibi
useractor notenemy 32761 ifaction 0 { ifand BEAT_EPISODES[5] 65536 action ZERO else killit } enda // Jekyll Chibi
useractor notenemy 32763 ifaction 0 { ifand BEAT_EPISODES[5] 524288 action ZERO else killit } enda // Magnus Chibi
useractor notenemy 32762 ifaction 0 { ifand BEAT_EPISODES[5] 524288 action ZERO else killit } enda // Trenton Chibi

useractor notenemy 33791 ifaction 0 { ifand BEAT_EPISODES[3] 65536 action ZERO else killit } enda // Semaj
useractor notenemy 33787 ifaction 0 { ifand BEAT_EPISODES[7] 2 action ZERO else killit } enda // Pig boss
useractor notenemy 33786 ifaction 0 { ifand BEAT_EPISODES[3] 16 action ZERO else killit } enda // Liz boss
useractor notenemy 33785 ifaction 0 { ifand BEAT_EPISODES[7] 8 action ZERO else killit } enda // Alien Queen
useractor notenemy 33784 ifaction 0 { ifand BEAT_EPISODES[2] 1 action ZERO else killit } enda // Overlord
useractor notenemy 33783 ifaction 0 { ifand BEAT_EPISODES[1] 1 action ZERO else killit } enda // Battlelord
useractor notenemy 33782 ifaction 0 { ifand BEAT_EPISODES[7] 4 action ZERO else killit } enda // Cycloid Emporer
useractor notenemy 33781 ifaction 0 { ifand BEAT_EPISODES[5] 1024 action ZERO else killit } enda // Dumas

useractor notenemy 33773 ifaction 0 { ifand BEAT_EPISODES[1] 256 action ZERO else ifand BEAT_EPISODES[7] 1 action ZERO else killit } enda // Cyberdemon
useractor notenemy 33774 ifaction 0 { ifand BEAT_EPISODES[3] 4096 action ZERO else killit } enda // Maddrax
useractor notenemy 33775 ifaction 0 { ifand BEAT_EPISODES[4] 256 action ZERO else killit } enda // Mongur
useractor notenemy 33777 ifaction 0 { ifand BEAT_EPISODES[2] 32768 action ZERO else killit } enda // Serpent Goddess
useractor notenemy 33778 cstat 32768 enda 
useractor notenemy 33779 cstat 32768 enda 
useractor notenemy 33780 cstat 32768 enda 

useractor notenemy 24310 // Golden Sang
        ifaction 0
        {
		ifspritepal 3 // Museum variant
			{
			ife CHIBIS_FOUND[48] 1
				{
				sizeat 15 15
				operateactivators 15362 THISACTOR
				action FORM
				}
			else killit
			}
		else
			{
            sizeat 15 15
            action ZERO
			}
        }
		ifaction FORM
		{
		ife CHAR 17
		  ifp pfacing
			ifpdistl 1280
			{
			set kag_blush 90
			}
		}
        ifaction ZERO
        {
            ifspawnedby APLAYER killit // no cheating
            ifp pfacing ifp palive ifcansee ifpdistl 812
            {
                set player_use 0
                ifhitspace
                {
                    screensound FOUND_CHIBI
                    set hit_key 30
					ife CHIBIS_FOUND[48] 1 nullop else
						{
						add TREASURE_FOUND 30
						setarray CHIBIS_FOUND[48] 1
						setvar array_save 1
						}
					set DISP_KEY -150
					set DISP_KEY_PAL 0
					set DISP_KEY_PIC sprite[].picnum
                    operateactivators 666 0
                    killit
                }
            }

        }
enda

// Pickup-able alchemy stuff
defstate pickupable
ifaction ZERO // object is not currently picked up
{
	ife player_holding THISACTOR
		set player_holding -1
}

// if drop forced then we can't pick it back up again
ifn drop_forced 1
{
	set temp 0

	ifp palive
	  ifaction ZERO
	  ife player_holding -1
	{
	ifpdistl 1024 set player_use 0
		ife pickup_forced 1
			set temp 1
		else ifpdistl 1024
		  ifp pfacing
		  ife use_action_allowed 1
			set temp 1
	}

	ife temp 1
	{
	set hit_key 30
		set pickup_forced -1

		ife pickup_voiceover 1
			set PLAYER_VOICEOVER 2

		sound pickup_sound
		set player_holding THISACTOR
		action OK
		state setIgnoreUse
	}
}

ifaction OK // object is picked up
{
	cstator 2
	setp[].runspeed pickedup_runspeed

	set temp3 player[].posx
	add temp3 256

	getp[].posz temp
	add temp 4096
	seta[].z temp

	geta[].x my_x_backup
	geta[].y my_y_backup

	rotatepoint player[].posx player[].posy temp3 player[].posy player[].ang temp5 temp6

	getp[].cursectnum temp7
	updatesectorz temp5 temp6 temp temp7

	ifn temp7 -1
	{
		// valid sector, but maybe hitscan check should block
		seta[].x temp5
		seta[].y temp6
		seta[].sectnum temp7

		state hitscanToFromPlayer

		ife RETURN 0
		{
			seta[].x my_x_backup
			seta[].y my_y_backup
			geta[].z z
			getp[].cursectnum temp7
			updatesectorz my_x_backup my_y_backup z temp7
			seta[].sectnum temp7

			// fallback: still no hitscan hit? force it JUST a bit beyond on the player coordinate
			state hitscanToFromPlayer

			ife RETURN 0
			{
				set temp3 player[].posx
				add temp3 256
				rotatepoint player[].posx player[].posy temp3 player[].posy player[].ang temp5 temp6
				geta[].z z
				getp[].cursectnum upd_sect
				updatesectorz temp5 temp6 z upd_sect

				ifn upd_sect -1
				{
					seta[].x temp5
					seta[].y temp6
					changespritesect THISACTOR upd_sect
				}
				// fallback 2: force on player coordinate exactly (looks weird but aight)
				else
				{
					seta[].x player[].posx
					seta[].y player[].posy
					geta[].z z
					getp[].cursectnum temp7
					updatesectorz player[].posx player[].posy z temp7
					ifn temp7 -1 changespritesect THISACTOR upd_sect
				}
			}
		}
	}
	state lower_weapon

	// if hit space or certain distance away, run drop logic
	set temp 0
	ife use_action_allowed 1
	{
		set hit_key 30
		set temp 1
		state setIgnoreUse
	}

	// hack for cannonballs getting autodropped too quickly
	ife sprite[].picnum 1819
	{
		ifpdistg 4096
			set temp 1
	}
	else ifpdistg 1024
		set temp 1

	ife drop_forced 1
	{
		set temp 1

		seta[].x drop_force_x
		seta[].y drop_force_y
		seta[].z drop_force_z
	}

	ife temp 1
	{
		// disable transparency
		geta[].cstat temp

		ifand temp 2
		{
			sub temp 2
			seta[].cstat temp
		}

		sound drop_sound
		setp[].runspeed RUNNINGSPEED

		set player_holding -1
		action ZERO
	}
}
ends

eventloadactor 17978 state GETHITAGLOTAG enda
useractor notenemy 17978
	ifn LOTAGSAVED 0
	{
		fall
		ifaction 0 { action ZERO }

		set pickedup_runspeed RUNNINGSPEED
		set pickup_sound SGETITEM
		set drop_sound DRINKELIXER
		state pickupable

		// drop forced and player not holding anymore -> turn to blood
		ife drop_forced 1
			ifn player_holding THISACTOR
		{
			seta[].picnum 2301
			seta[].cstat 32
			seta[].xrepeat 20
			seta[].yrepeat 31

		}
	}
enda

eventloadactor 25252 state GETHITAGLOTAG enda
useractor notenemy 25252
	ifn LOTAGSAVED 0
	{
		fall
		ifaction 0 { action ZERO }

		set pickedup_runspeed RUNNINGSPEED
		set pickup_sound DIRT4
		set drop_sound DIRT6
		state pickupable

		// drop forced and player not holding anymore -> turn to grass/dirt sprite
		ife drop_forced 1
			ifn player_holding THISACTOR
		{
			seta[].picnum 23632
			seta[].cstat 32
			seta[].xrepeat 6
			seta[].yrepeat 6
		}
	}
enda

// Cannonball ammo
spriteshadow 1819

useractor notenemy 1819
	fall

	ifaction 0
	{
		sizeat 40 40
		cstat 0

		set pickedup_runspeed 45200
		set pickup_sound METALB_PICKUP
		set drop_sound METALB_PICKUP
		set pickup_voiceover 1

		action ZERO
	}

	state pickupable

	// overwrite a few things from pickupable state
	// Don't make this object transparent, and auto drop if near a cannon
	ifaction OK
	{
		cstat 0

		findnearactor3d CANNON_TURRET 1024 temp
		ifn temp -1
		{
			getav[temp].stationary_gun_ammo temp2
			ife temp2 0
			{
				add temp2 1
				setactorvar[temp].stationary_gun_ammo temp2
				quote 581
				soundonce CANN_LOAD
				setp[].runspeed RUNNINGSPEED
				set player_holding -1
				killit
			}
		}
	}
	else
		cstat 0

enda

// Nazi rat bastard flag

useractor notenemy 22379
ifaction 0
	{
	ife opt_streamer_mode YES action ONE else action ZERO
	}
enda

// custom object =============================================================================================================

spriteshadow CUSTOM_OBJECT

useractor notenemy CUSTOM_OBJECT
ife ZVELSAVED 0 fall
ifaction 0
	{
	seta[].mdflags 16
	ifn HITAGSAVED 0 cstator 257
	ifg EXTRASAVED 0 seta[].extra EXTRASAVED
	action ZERO
	}

ifaction ZERO
	{
	ifhitweapon
		{
		ifdead
			{
			ife HITAGSAVED 1 state break_metal
			ife HITAGSAVED 2 state big_pot_deb
			ife HITAGSAVED 3 state break_glass
			ife HITAGSAVED 4 state break_wood
			ifn YVELSAVED 0 { set LOTAGSAVED YVELSAVED set HITAGSAVED 0 set YVELSAVED 0 ifrnd 128 cstat 4 else cstat 0 } else
			killit
			}
		}
	}
enda

// custom actor =============================================================================================================

spriteshadow CUSTOM_ACTOR
spritenoshade CUSTOM_ACTOR

useractor notenemy CUSTOM_ACTOR

ifaction 0
	{
	seta[].mdflags 16
	// precaching hack
	getactor[THISACTOR].x initx
	getactor[THISACTOR].y inity
	getactor[THISACTOR].z initz
	setsprite THISACTOR player[].posx player[].posy player[].posz
	setsprite THISACTOR initx inity initz

	ifn ZVELSAVED 0
		{
		set CHK_ENEMY_IN_BST_PICNUM ZVELSAVED
		state isenemyinbestiary
		ife ENEMY_IN_BST 1 nullop else killit
		}
	ifn HITAGSAVED 0
		{
		cstat 32768
		checkactivatormotion HITAGSAVED
		ife RETURN 1
			{
			cstat 257
			move STOP faceplayer
			ife XVELSAVED 1
				{
				globalsound DEMON_TELEPORT
				spawn PENTAGRAM
				}
			set HITAGSAVED 0
			ifspritepal 9 action SEVEN_ANG else
			ifspritepal 3 action EIGHT_ANG else
			action FIVE_ANG
			}
		}
	else
		{
		ifspritepal 9 action SEVEN_ANG else
		ifspritepal 3 action EIGHT_ANG else
		action FIVE_ANG
		move STOP
		cstat 257
		}
	}

ifaction EIGHT_ANG
	{
	ifg EXTRASAVED 0
		{
		checkactivatormotion EXTRASAVED
		ife RETURN 1
			{
			ifg YVELSAVED 0 setactor[].picnum YVELSAVED
			else setactor[].picnum LOTAGSAVED
			strength 100
			action 0
			}
		}
	}

ifaction SEVEN_ANG
	{
	ifg EXTRASAVED 0
		{
		checkactivatormotion EXTRASAVED
		ife RETURN 1
			{
			ifg YVELSAVED 0 setactor[].picnum YVELSAVED
			else setactor[].picnum LOTAGSAVED
			strength 100
			action 0
			}
		}
	}

ifaction FIVE_ANG
	{
	ifg EXTRASAVED 0
		{
		checkactivatormotion EXTRASAVED
		ife RETURN 1
			{
			ifg YVELSAVED 0 setactor[].picnum YVELSAVED
			else setactor[].picnum LOTAGSAVED
			strength 100
			action 0
			}
		}
	}
enda

// Toaster =============================================================================================================

action EATEN 1

useractor notenemy 14578
fall

ifaction 0
	{
	sizeat 24 24
	move 0
	cstat 256
	ifpdistl 1536
	 ifp pfacing
	   {
	   set player_use 0
		ifhitspace
			{
			sound LIGHT_SWITCH
			action ONE
			}
	   }
	}
else
ifaction ONE
	{
	ifcount 300
		{
		espawn GUNSMOKE
		geta[RETURN].z temp
		sub temp 1536
		seta[RETURN].z temp
		sound TOAST
		action ZERO
		}
	}
else
ifaction ZERO
	{
ifpdistl 1536
ifp palive
   ifp pfacing
	   {
	   set player_use 0
			ifhitspace
			{
			quote 139
			sound EATSOME
			palfrom 16 0 32
			addphealth 10
			action EATEN
			}
	   }
	}

ifhitweapon { state break_metal killit }
enda

useractor notenemy 14579
fall cstat 256
ifhitweapon { state break_metal killit }
enda

defstate use_taps
	ifpdistl 1024
	 ifp palive
	  ifp pfacing
	   ifcansee
		 ife taken_piss 1
		 {
		 set player_use 0
		  ifhitspace
		   {
		   set hit_key 30
		   soundonce WASH
		   ife CHAR 12 ifrnd 64 globalsound JA_WASH
		   setplayer[THISACTOR].weapon_pos 10
		   set taken_piss 2
		   addphealth 5
		   ifactor TAPS cactor TAPS_ON
		   ifactor 16940 cactor 16871
		   }
		 }
ends

useractor notenemy TAPS state use_taps enda
useractor notenemy 16940 state use_taps enda
useractor notenemy 16949 state use_taps enda

action TAPS_FLOW 0 2 1 1 8

defstate taps_off
ifaction 0 action TAPS_FLOW

ifaction TAPS_FLOW
{
ifactioncount 20
	{
	action 0
	ifactor TAPS_ON cactor TAPS
	ifactor 16871 cactor 16940
	}
}

ends

useractor notenemy TAPS_ON state taps_off enda
useractor notenemy 16871 state taps_off enda

// CAR EXPLODE ============================================================================================================================

defstate car_explode
ifaction 0
	{
	cstat 257
	espawn 34521
	seta[RETURN].z sector[].floorz
	seta[RETURN].ang sprite[].ang
	strength 500
	action ZERO
	randvar ally_mag 3
	geta[].z temp4
	}
	
ifg INTERNALCOUNT_2 0 sub INTERNALCOUNT_2 1
else seta[].z temp4
	
ifaction ZERO
	{
	ifhitweapon 
		{ 
		state METAL_HIT_SOUNDS soundvar playsound
		ife ally_mag 1 { ifactorsound THISACTOR CARAL_01 nullop else sound CARAL_01 }
		ife ally_mag 2 { ifactorsound THISACTOR CARAL_02 nullop else sound CARAL_02 }
		ife ally_mag 3 { ifactorsound THISACTOR CARAL_03 nullop else sound CARAL_03 }
		ife INTERNALCOUNT_2 0
			{
			set temp5 temp4
			add temp5 128
			seta[].z temp5
			set INTERNALCOUNT_2 3
			}
		resetcount
		}
	ifstrength 200
		{
		addstrength -1
		soundonce BUILDUP
		add INTERNALCOUNT 1
		ife INTERNALCOUNT 85 strength 0
		ifrnd 64
			{
			sound FIRE_SPIT
			shoot SPARK shoot SPARK
			espawn 14040
			geta[].x temp
			randvar temp2 128
			ifrnd 128 add temp temp2 else sub temp temp2
			seta[RETURN].x temp

			geta[].y temp
			randvar temp2 128
			ifrnd 128 add temp temp2 else sub temp temp2
			seta[RETURN].y temp

			geta[].z temp
			sub temp 8192
			randvar temp2 2048
			sub temp temp2
			seta[RETURN].z temp
			}
		}
	ifstrength 0
		{
		flash
		ifrnd 128 globalsound CAR_EXP1
		else globalsound CAR_EXP2
		debris SCRAP1 5
		debris SCRAP2 5
		debris SCRAP3 6
		lotsofglass 20
		shoot SPARK shoot SPARK 
		shoot SPARK shoot SPARK 
		shoot CAR_WHEEL
		shoot CAR_WHEEL
		shoot CAR_WHEEL
		shoot CAR_WHEEL
		shoot CAR_DOOR
		shoot CAR_DOOR
		state termspawnlegparts
		state termspawnlegparts
		// explosion should do TONS of damage, but only if the player isn't close to it themselves
		ifpdistg 2048 hitradius 2048 256 512 768 1024
		else hitradius 2048 8 16 32 64
		spawn BIG_SMOKE2
		espawn BIG_EXPLOSION
		state explosion_shake
		seta[RETURN].pal 3
		geta[].z temp3
		sub temp3 4096
		seta[RETURN].z temp3
		espawn 14057
		ifactor 14058 set temp2 42
		else ifactor 14056 set temp2 57
		else ifactor 14061 set temp2 40
		else ifactor 14062 set temp2 54
		else ifactor 14063 set temp2 42
		else set temp2 50
		seta[RETURN].xrepeat temp2
		seta[RETURN].yrepeat temp2
		seta[RETURN].ang sprite[].ang
		ife ally_mag 1 ifactorsound THISACTOR CARAL_01 stopactorsound THISACTOR CARAL_01
		ife ally_mag 2 ifactorsound THISACTOR CARAL_02 stopactorsound THISACTOR CARAL_02
		ife ally_mag 3 ifactorsound THISACTOR CARAL_03 stopactorsound THISACTOR CARAL_03
		killit
		}
	}
ends

useractor notenemy 14053 state car_explode sizeat 50 50 enda
useractor notenemy 14054 state car_explode sizeat 50 50 enda
useractor notenemy 14055 state car_explode sizeat 50 50 enda
useractor notenemy 14056 state car_explode sizeat 50 50 enda
useractor notenemy 14058 state car_explode sizeat 40 40 enda
useractor notenemy 14059 state car_explode sizeat 50 50 enda
useractor notenemy 14060 state car_explode sizeat 50 50 enda
useractor notenemy 14061 state car_explode sizeat 40 40 enda
useractor notenemy 14062 state car_explode sizeat 42 42 enda
useractor notenemy 14063 state car_explode sizeat 48 42 enda

useractor notenemy 21581 state car_explode sizeat 50 50 enda
useractor notenemy 21586 state car_explode sizeat 42 42 enda

// car shadows
useractor notenemy 34521 
	ifaction 0 
		{ 
		sizeat 27 33
		cstat 34 
		seta[].blend 253 
		action ZERO 
		} 
	enda
