/*
-------------------------------------------------------------------------------
===============================================================================

         -ooo:             +oo-            `+oo.       ./+oooooooooo+/:
        /NMMMN+            NMMNo`         -dMMM/      .mMMNmmmmmmmmmMMNo
       /NMd:mMMo           NMMNMd:      `oNMNMM/      :MMM/.........mMMh
      oNMd. -mMMy`         NMN:mMNs`   -hMm/mMM/      :MMM:         ::-.
    `sMMh`   .dMMh`        NMN .sNMd:`oNMh. mMM/      :MMM:
   `yMMMdhhhhhmMMMd.       NMN   /mMNdMm+`  mMM/      :MMM:         ss+:
  `hMMdhhhhhhhhhmMMm-      NMN    .yMMh.    mMM/      :MMM/.........mMMh
 .dMMs`         .hMMm:     NMN      :/`     mMM/      .mMMNmmmmmmmmmMMNo
 :oo+            `+oo+     +o+              +oo.       ./++ooooooooo+/:

###############################################################################
+ The AMC Squad
+ CON code by James Stanfield, Cedric "Sangman" Haegeman, Dino Bollinger,
+              Mikko Sandt, Cedric "Zaxtor" Lutes and Dan "Danarama" Gaskill
-------------------------------------------------------------------------------
* See AMC_MAIN.CON for a full list of script authors.

Feel free to use any code in the game for your own uses; just make
sure to mention the authors and/or "The AMC Squad" in your credits.
--------------------------------------------------------------------------------
NOTES:
This file defines the behavior of the custom ingame settings menu.
Note that the indices used in this CON file are directly linked to the ones
defined in "settings.def".
--------------------------------------------------------------------------------
*/

// Yes this horrible code you see below is unfortunately necessary.

defstate restore_gamevars_from_config
    ifcfgvar opt_photosensitivity_mode readgamevar opt_photosensitivity_mode
    else savegamevar opt_photosensitivity_mode

    ifcfgvar opt_streamer_mode readgamevar opt_streamer_mode
    else savegamevar opt_streamer_mode

    ifcfgvar opt_no_facehuggers readgamevar opt_no_facehuggers
    else savegamevar opt_no_facehuggers

    ifcfgvar opt_old_item_sel readgamevar opt_old_item_sel
    else savegamevar opt_old_item_sel

    ifcfgvar opt_qte_disable readgamevar opt_qte_disable
    else savegamevar opt_qte_disable

    ifcfgvar opt_spiders_disable readgamevar opt_spiders_disable
    else savegamevar opt_spiders_disable

    ifcfgvar opt_random_enemy readgamevar opt_random_enemy
    else savegamevar opt_random_enemy

    ifcfgvar opt_dynamic_music readgamevar opt_dynamic_music
    else savegamevar opt_dynamic_music

    ifcfgvar opt_show_helmet readgamevar opt_show_helmet
    else savegamevar opt_show_helmet

    ifcfgvar opt_glass_effects readgamevar opt_glass_effects
    else savegamevar opt_glass_effects

    ifcfgvar opt_show_subtitles readgamevar opt_show_subtitles
    else savegamevar opt_show_subtitles

    ifcfgvar opt_speech_bubble readgamevar opt_speech_bubble
    else savegamevar opt_speech_bubble

    ifcfgvar opt_big_cursor readgamevar opt_big_cursor
    else savegamevar opt_big_cursor

    ifcfgvar opt_vis_cursor readgamevar opt_vis_cursor
    else savegamevar opt_vis_cursor

    ifcfgvar opt_protected_ding readgamevar opt_protected_ding
    else savegamevar opt_protected_ding

    ifcfgvar opt_voice_cd_length readgamevar opt_voice_cd_length
    else savegamevar opt_voice_cd_length



    ifcfgvar opt_weapon_glow readgamevar opt_weapon_glow
    else savegamevar opt_weapon_glow

    ifcfgvar opt_gold_sparkle readgamevar opt_gold_sparkle
    else savegamevar opt_gold_sparkle

    ifcfgvar opt_disable_rainsnow readgamevar opt_disable_rainsnow
    else savegamevar opt_disable_rainsnow

    ifcfgvar opt_advanced_flame readgamevar opt_advanced_flame
    else savegamevar opt_advanced_flame

    ifcfgvar opt_highres_clouds readgamevar opt_highres_clouds
    else savegamevar opt_highres_clouds

    ifcfgvar opt_particle_distance readgamevar opt_particle_distance
    else savegamevar opt_particle_distance

    ifcfgvar opt_boss_healthbar_toggle readgamevar opt_boss_healthbar_toggle
    else savegamevar opt_boss_healthbar_toggle

    ifcfgvar opt_glass_shard_toggle readgamevar opt_glass_shard_toggle
    else savegamevar opt_glass_shard_toggle

    ifcfgvar opt_slomo_frequency readgamevar opt_slomo_frequency
    else savegamevar opt_slomo_frequency
ends

// restore options from config file
onevent EVENT_INITCOMPLETE
    state restore_gamevars_from_config
endevent

// always restore these values when loading saves
onevent EVENT_LOADGAME
    state restore_gamevars_from_config
endevent

// NO RETURN VALUES
onevent EVENT_CSPOPULATEMENU
    setu[].csarray IDX_PHOTOSENSITIVITY_MODE opt_photosensitivity_mode
    setu[].csarray IDX_NO_FACEHUGGERS opt_no_facehuggers
    setu[].csarray IDX_OLD_ITEM_SEL opt_old_item_sel
    setu[].csarray IDX_QTE opt_qte_disable
    setu[].csarray IDX_SPIDERS opt_spiders_disable
    setu[].csarray IDX_STREAMER opt_streamer_mode
    setu[].csarray IDX_RANDOM_ENEMY opt_random_enemy
    setu[].csarray IDX_DYNAMIC_MUSIC opt_dynamic_music
	setu[].csarray IDX_PROMPT_POSITION opt_prompt_position
    setu[].csarray IDX_SHOW_HELMET opt_show_helmet
	setu[].csarray IDX_HIGH_VIS_ITEMS opt_high_vis_items
    setu[].csarray IDX_GLASS_EFFECTS opt_glass_effects
    setu[].csarray IDX_SHOW_SUBTITLES opt_show_subtitles
    setu[].csarray IDX_SPEECH_BUBBLE opt_speech_bubble
    setu[].csarray IDX_BIG_CURSOR opt_big_cursor
    setu[].csarray IDX_VIS_CURSOR opt_vis_cursor
    setu[].csarray IDX_PROTECTED_DING opt_protected_ding
    setu[].csarray IDX_VOICE_CD_LENGTH opt_voice_cd_length

    setu[].csarray IDX_WEAPON_GLOW opt_weapon_glow
    setu[].csarray IDX_GOLD_SPARKLE opt_gold_sparkle
    setu[].csarray IDX_NO_RAINSNOW opt_disable_rainsnow
    setu[].csarray IDX_ADVANCED_FLAME opt_advanced_flame

    setu[].csarray IDX_HIGHRES_CLOUDS opt_highres_clouds
    setu[].csarray IDX_PARTICLE_DISTANCE opt_particle_distance
    setu[].csarray IDX_HEALTHBAR_TOGGLE opt_boss_healthbar_toggle
    setu[].csarray IDX_GLASS_SHARD_TOGGLE opt_glass_shard_toggle
    setu[].csarray IDX_SLOWMO_FREQUENCY opt_slomo_frequency
endevent

// has RETURN values
onevent EVENT_CSACTIVATELINK
//    al userdef .return 0 // entry index (menu order)
//    al userdef .return 1 // storage index (unique identifier for item)
    switch userdef .return 1
        case IDX_DEFAULT_BUTTON
            // reset defaults
            setu[].csarray IDX_PHOTOSENSITIVITY_MODE DEFAULT_PHOTOSENSITIVITY_MODE
            set opt_photosensitivity_mode DEFAULT_PHOTOSENSITIVITY_MODE
            savegamevar opt_photosensitivity_mode

            setu[].csarray IDX_NO_FACEHUGGERS DEFAULT_FACEHUGGERS
            set opt_no_facehuggers DEFAULT_FACEHUGGERS
            savegamevar opt_no_facehuggers

            setu[].csarray IDX_QTE DEFAULT_QTE
            set opt_qte_disable DEFAULT_QTE
            savegamevar opt_qte_disable

            setu[].csarray IDX_STREAMER DEFAULT_STREAMER_MODE
            set opt_streamer_mode DEFAULT_STREAMER_MODE
            savegamevar opt_streamer_mode

            setu[].csarray IDX_SPIDERS DEFAULT_SPIDERS
            set opt_spiders_disable DEFAULT_SPIDERS
            savegamevar opt_spiders_disable

            setu[].csarray IDX_OLD_ITEM_SEL DEFAULT_OLD_ITEM_SEL
            set opt_old_item_sel DEFAULT_OLD_ITEM_SEL
            savegamevar opt_old_item_sel

            setu[].csarray IDX_RANDOM_ENEMY DEFAULT_RANDOM_ENEMY
            set opt_random_enemy DEFAULT_RANDOM_ENEMY
            savegamevar opt_random_enemy

            setu[].csarray IDX_DYNAMIC_MUSIC DEFAULT_DYNAMIC_MUSIC
            set opt_dynamic_music DEFAULT_DYNAMIC_MUSIC
            savegamevar opt_dynamic_music
			
            setu[].csarray IDX_PROMPT_POSITION DEFAULT_PROMPT_POSITION
            set opt_prompt_position DEFAULT_PROMPT_POSITION
            savegamevar opt_prompt_position
			
            setu[].csarray IDX_HIGH_VIS_ITEMS NO
            set opt_high_vis_items NO
            savegamevar opt_high_vis_items

            setu[].csarray IDX_SHOW_HELMET DEFAULT_SHOW_HELMET
            set opt_show_helmet DEFAULT_SHOW_HELMET
            savegamevar opt_show_helmet

            setu[].csarray IDX_GLASS_EFFECTS DEFAULT_GLASS_EFFECTS
            set opt_glass_effects DEFAULT_GLASS_EFFECTS
            savegamevar opt_glass_effects

            setu[].csarray IDX_SHOW_SUBTITLES DEFAULT_SHOW_SUBTITLES
            set opt_show_subtitles DEFAULT_SHOW_SUBTITLES
            savegamevar opt_show_subtitles

            setu[].csarray IDX_SPEECH_BUBBLE DEFAULT_SPEECH_BUBBLE
            set opt_speech_bubble DEFAULT_SPEECH_BUBBLE
            savegamevar opt_speech_bubble

            setu[].csarray IDX_BIG_CURSOR DEFAULT_BIG_CURSOR
            set opt_big_cursor DEFAULT_BIG_CURSOR
            savegamevar opt_big_cursor

            setu[].csarray IDX_VIS_CURSOR DEFAULT_VIS_CURSOR
            set opt_vis_cursor DEFAULT_VIS_CURSOR
            savegamevar opt_vis_cursor

            setu[].csarray IDX_PROTECTED_DING DEFAULT_PROTECTED_DING
            set opt_protected_ding DEFAULT_PROTECTED_DING
            savegamevar opt_protected_ding

            setu[].csarray IDX_VOICE_CD_LENGTH DEFAULT_VOICE_CD_LENGTH
            set opt_voice_cd_length DEFAULT_VOICE_CD_LENGTH
            savegamevar opt_voice_cd_length

            setu[].csarray IDX_WEAPON_GLOW DEFAULT_WEAPON_GLOW
            set opt_weapon_glow DEFAULT_WEAPON_GLOW
            savegamevar opt_weapon_glow

            setu[].csarray IDX_GOLD_SPARKLE DEFAULT_GOLD_SPARKLE
            set opt_gold_sparkle DEFAULT_GOLD_SPARKLE
            savegamevar opt_gold_sparkle

            setu[].csarray IDX_NO_RAINSNOW DEFAULT_DISABLE_RAINSNOW
            set opt_disable_rainsnow DEFAULT_DISABLE_RAINSNOW
            savegamevar opt_disable_rainsnow

            setu[].csarray IDX_ADVANCED_FLAME DEFAULT_ADVANCED_FLAME
            set opt_advanced_flame DEFAULT_ADVANCED_FLAME
            savegamevar opt_advanced_flame

            setu[].csarray IDX_HIGHRES_CLOUDS DEFAULT_HIGHRES_CLOUDS
            set opt_highres_clouds DEFAULT_HIGHRES_CLOUDS
            savegamevar opt_highres_clouds

            setu[].csarray IDX_PARTICLE_DISTANCE DEFAULT_PARTICLE_DISTANCE
            set opt_particle_distance DEFAULT_PARTICLE_DISTANCE
            savegamevar opt_particle_distance

            setu[].csarray IDX_HEALTHBAR_TOGGLE DEFAULT_HEALTHBAR_TOGGLE
            set opt_boss_healthbar_toggle DEFAULT_HEALTHBAR_TOGGLE
            savegamevar opt_boss_healthbar_toggle

            setu[].csarray IDX_GLASS_SHARD_TOGGLE DEFAULT_GLASS_SHARD_TOGGLE
            set opt_glass_shard_toggle DEFAULT_GLASS_SHARD_TOGGLE
            savegamevar opt_glass_shard_toggle

            setu[].csarray IDX_SLOWMO_FREQUENCY DEFAULT_SLOWMO_FREQUENCY
            set opt_slomo_frequency DEFAULT_SLOWMO_FREQUENCY
            savegamevar opt_slomo_frequency
            break
        default
            qputs 831 ERROR: Settings link activated with undefined behavior!
            echo 831
            break
    endswitch
endevent

// has RETURN values
/*
onevent EVENT_CSPREMODIFYOPTION
//    al userdef .return 0 // entry index (menu order)
//    al userdef .return 1 // storage index (unique identifier for item)
//    al userdef .return 2 // option index (0 for off, 1 for on, multichoice: order of definition)
    switch userdef .return 1
        default
            qputs 831 ERROR: Option entry with undefined behavior!
            echo 831
            break
    endswitch
endevent
*/

// has RETURN values
onevent EVENT_CSPOSTMODIFYOPTION
//    al userdef .return 0 // entry index (menu order)
//    al userdef .return 1 // storage index (unique identifier for item)
//    al userdef .return 2 // option index (0 for off, 1 for on, multichoice: order of definition)
    switch userdef .return 1
        case IDX_PHOTOSENSITIVITY_MODE
            getu[].csarray IDX_PHOTOSENSITIVITY_MODE opt_photosensitivity_mode
            savegamevar opt_photosensitivity_mode
            break
        case IDX_NO_FACEHUGGERS
            getu[].csarray IDX_NO_FACEHUGGERS opt_no_facehuggers
            savegamevar opt_no_facehuggers
            break
        case IDX_QTE
            getu[].csarray IDX_QTE opt_qte_disable
            savegamevar opt_qte_disable
            break
        case IDX_STREAMER
            getu[].csarray IDX_STREAMER opt_streamer_mode
            savegamevar opt_streamer_mode
            break
        case IDX_SPIDERS
            getu[].csarray IDX_SPIDERS opt_spiders_disable
            savegamevar opt_spiders_disable
            break
        case IDX_OLD_ITEM_SEL
            getu[].csarray IDX_OLD_ITEM_SEL opt_old_item_sel
            savegamevar opt_old_item_sel
            break
        case IDX_RANDOM_ENEMY
            getu[].csarray IDX_RANDOM_ENEMY opt_random_enemy
            savegamevar opt_random_enemy
            break
        case IDX_DYNAMIC_MUSIC
            getu[].csarray IDX_DYNAMIC_MUSIC opt_dynamic_music
            savegamevar opt_dynamic_music
            break
        case IDX_PROMPT_POSITION
            getu[].csarray IDX_PROMPT_POSITION opt_prompt_position
            savegamevar opt_prompt_position
            break
        case IDX_HIGH_VIS_ITEMS
            getu[].csarray IDX_HIGH_VIS_ITEMS opt_high_vis_items
            savegamevar opt_high_vis_items
            break
        case IDX_SHOW_HELMET
            getu[].csarray IDX_SHOW_HELMET opt_show_helmet
            savegamevar opt_show_helmet
            break
        case IDX_GLASS_EFFECTS
            getu[].csarray IDX_GLASS_EFFECTS opt_glass_effects
            savegamevar opt_glass_effects
            break
        case IDX_SHOW_SUBTITLES
            getu[].csarray IDX_SHOW_SUBTITLES opt_show_subtitles
            savegamevar opt_show_subtitles
            break
        case IDX_SPEECH_BUBBLE
            getu[].csarray IDX_SPEECH_BUBBLE opt_speech_bubble
            savegamevar opt_speech_bubble
            break
        case IDX_BIG_CURSOR
            getu[].csarray IDX_BIG_CURSOR opt_big_cursor
            savegamevar opt_big_cursor
            break
        case IDX_VIS_CURSOR
            getu[].csarray IDX_VIS_CURSOR opt_vis_cursor
            savegamevar opt_vis_cursor
            break
        case IDX_PROTECTED_DING
            getu[].csarray IDX_PROTECTED_DING opt_protected_ding
            savegamevar opt_protected_ding
            break
        case IDX_VOICE_CD_LENGTH
            getu[].csarray IDX_VOICE_CD_LENGTH opt_voice_cd_length
            savegamevar opt_voice_cd_length
            break
        case IDX_WEAPON_GLOW
            getu[].csarray IDX_WEAPON_GLOW opt_weapon_glow
            savegamevar opt_weapon_glow
            break
        case IDX_GOLD_SPARKLE
            getu[].csarray IDX_GOLD_SPARKLE opt_gold_sparkle
            savegamevar opt_gold_sparkle
            break
        case IDX_NO_RAINSNOW
            getu[].csarray IDX_NO_RAINSNOW opt_disable_rainsnow
            savegamevar opt_disable_rainsnow
            break
        case IDX_ADVANCED_FLAME
            getu[].csarray IDX_ADVANCED_FLAME opt_advanced_flame
            savegamevar opt_advanced_flame
            break
        case IDX_HIGHRES_CLOUDS
            getu[].csarray IDX_HIGHRES_CLOUDS opt_highres_clouds
            savegamevar opt_highres_clouds
            break
        case IDX_PARTICLE_DISTANCE
            getu[].csarray IDX_PARTICLE_DISTANCE opt_particle_distance
            savegamevar opt_particle_distance
            break
        case IDX_HEALTHBAR_TOGGLE
            getu[].csarray IDX_HEALTHBAR_TOGGLE opt_boss_healthbar_toggle
            savegamevar opt_boss_healthbar_toggle
            break
        case IDX_GLASS_SHARD_TOGGLE
            getu[].csarray IDX_GLASS_SHARD_TOGGLE opt_glass_shard_toggle
            savegamevar opt_glass_shard_toggle
            break
        case IDX_SLOWMO_FREQUENCY
            getu[].csarray IDX_SLOWMO_FREQUENCY opt_slomo_frequency
            savegamevar opt_slomo_frequency
            break
        default
            qputs 831 ERROR: Option entry with undefined behavior!
            echo 831
            break
    endswitch
endevent

/*
appendevent EVENT_DISPLAYMENU
    ife current_menu 250
    {
        rotatesprite 60 90 131072 0 3584 0 0 0 0 0 xdim ydim
    }
endevent
*/

// used to display tooltips
appendevent EVENT_DISPLAYMENUREST
    ife current_menu 250
    {
        // m_customsettings refers to the `index` token defined in DEF. It will be -1 if undefined.
        getu .m_customsettings disp_temp
        switch disp_temp
        case IDX_PHOTOSENSITIVITY_MODE
            qputs 831 Reduces the intensity of screen flashing and similar effects, for photosensitive players.
            break
        case IDX_STREAMER
            qputs 831 Disables any copyrighted music, potentially offensive material
            break
        case IDX_NO_FACEHUGGERS
            qputs 831 Removes slimers that attach to the screen.
            break
        case IDX_SPIDERS
            qputs 831 Removes Spiders from the game.
            break
        case IDX_QTE
            qputs 831 Removes various QTEs from the game.
            break
        case IDX_OLD_ITEM_SEL
            qputs 831 Disables the item wheel and re-enables the old left/right inventory item selection.
            break
        case IDX_RANDOM_ENEMY
            qputs 831 Replace Cycloid enemies in usermaps with random enemies of similar class (excluding EDF Missions).
            break
        case IDX_DYNAMIC_MUSIC
            qputs 831 Play dynamic music in usermap levels (excluding EDF Missions).
            break
		case IDX_PROMPT_POSITION
            qputs 831 Place Use prompts centered at bottom of screen.
            break
		case IDX_HIGH_VIS_ITEMS
            qputs 831 Items will remain full bright regardless of in-game visibility
            break
        case IDX_SHOW_HELMET
            qputs 831 Set to "No" to remove helmet graphics from character HUDs.
            break
        case IDX_GLASS_EFFECTS
            qputs 831 Set to "OFF" to disable glass effects on weapons, HUDs, etc.
            break
        case IDX_SHOW_SUBTITLES
            qputs 831 Enable subtitles during cutscenes and gameplay.
            break
        case IDX_SPEECH_BUBBLE
            qputs 831 Whether speech bubbles are shown over NPCs that can be talked to.
            break
        case IDX_BIG_CURSOR
            qputs 831 If enabled, the cursor in ingame UIs will be twice as big.
            break
        case IDX_VIS_CURSOR
            qputs 831 If enabled, the cursor in ingame UIs will have a bright yellow color.
            break
        case IDX_PROTECTED_DING
            qputs 831 Play a warning sound when hitting enemies that have a resistance to the damage type.
            break
        case IDX_VOICE_CD_LENGTH
            qputs 831 Set the minimum delay between character voice lines ingame.
            break
        case IDX_WEAPON_GLOW
            qputs 831 If enabled, will display dynamic glow effects on weapons. May improve performance if disabled.
            break
        case IDX_GOLD_SPARKLE
            qputs 831 If enabled, will display a gold sparkle effect on gold weapons. May improve performance if disabled.
            break
        case IDX_NO_RAINSNOW
            qputs 831 Controls rain and snow effects in levels. May improve performance if disabled.
            break
        case IDX_ADVANCED_FLAME
            qputs 831 If enabled, will display fancy flame effects on torches. May improve performance if disabled.
            break
        case IDX_HIGHRES_CLOUDS
            qputs 831 Control quality of certain cloud actors. May improve performance if reduced or disabled.
            break
        case IDX_PARTICLE_DISTANCE
            qputs 831 Set the distance at which particles like flames and rain are spawned.
            break
        case IDX_HEALTHBAR_TOGGLE
            qputs 831 Change the style of the boss healthbars in the HUD (or disable them).
            break
        case IDX_GLASS_SHARD_TOGGLE
            qputs 831 Whether glass shards remain on the ground and generate noise and debris.
            break
        case IDX_SLOWMO_FREQUENCY
            qputs 831 Frequency of random slow-motion effect when gibbing enemies.
            break
        case IDX_DEFAULT_BUTTON // default button
            qputs 831 Reset the options to their internal defaults.
            break
        case -1 // modder forgot to define an index
            qputs 831 ^21DEBUG: Developer forgot to assign an index to the entry!
            break
        default // modder forgot to define a description
            qputs 831 ^21DEBUG: Developer forgot to add a description!
            break
        endswitch
        gametextz STARTALPHANUM 320 185 831 0 0 0 0 0 xdim ydim HALFSIZE
    }
endevent
