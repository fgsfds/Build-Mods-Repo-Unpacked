/*
--------------------------------------------------------------------------------
Duke Nukem 3D - Blast Edition Version 2.0
By Marcos
2023 - Space In a Bottle
*/

setgamename Duke Nukem 3D - Legacy Edition
setdefname legacy.def
var LOGO_FLAGS 0x5FF000

include DEFS.CON
include USER.CON

action ANULLACTION 0
action ANULLACTION2 0

define TESTQ 9999
definequote TESTQ test

define RQUOTE 9998
definequote RQUOTE redefine me

define RQUOTE2 9996
definequote RQUOTE2 redefine me

define RQUOTE3 9995
definequote RQUOTE3 redefine me

include filequotes.con

definegamefuncname 11 WEAPON_WHEEL
definegamefuncname 12 LASER_CHAINSAW

definequote 7000 UNLOCK NUKE MODE
definequote 7001 UNLOCK ALL LEVELS
definecheatdescription 19 7000
definecheatdescription 11 7001

var enable_nuke 0 0
var music_reset 0 0

var change_weapon 0 1 
var s_bosskill 0 1

var actioncheck 0 2

var pulseshade 0 0

var a_flaming 0 2

var bossfighton -1 0
var BOSSFIGHT_LEVEL 0 1024
gamearray SEBOSSFIGHT 3

gamearray bosspal 16
var num_bosspalfight 0 0

var pushervel 2048 2
var pushercounter 256 2

define CATERDAMAGE 8

var catergot 0 1
var caterhit 0 1
var caterdamage 0 2
var catertimes 0 2
var caterkilled 0 2
var actorlife -1 2

var atemp5 0 2
var atemp6 0 2
var atemp7 0 2

var horizfire 0 1
var horizcur 0 1
var horiztmp 0 1
var horizseek 0 1
var horizcnt 1 1

var angfire 0 1
var angcur 0 1
var angtmp 0 1
var angseek 0 1
var angcnt 0 1
var angdir 0 1

var endgame 0 0

var tutorialWeapon 0 1
var tutorialLastWeap 0 1
var tutorialAltFire 0 1
var tutorialChangeItem 0 1
var tutorialUseItem 0 1
var tutorialSteroids 0 1
var tutorialMF 0 1
var tutorialAltWeap 0 1
var tutorialCater 0 1

var nuke_n1 0 0 //Override no ammo
var nuke_n2 0 0 //Disable Chainsaw at start
var nuke_n3 0 0 //Disable bullet instant gib
var nuke_n4 0 0 //Disable RPG drop
var nuke_n5 0 0 //Limit ammo to 2 clips
var nuke_n6 0 0 //Invert Plasma Rifle Alt. Fire
var nuke_n7 0 0 //More extra lives

include scripts/d_anim.con
include scripts/c_sub.con
include scripts/weapons/w_draw.con

include scripts/s_music.con
include scripts/c_score.con

include scripts/c_misc.con
include scripts/enemies/trooper.con
include scripts/enemies/snakehead.con
include scripts/enemies/snakedrone.con
include scripts/enemies/jelly.con
include scripts/enemies/scorpion.con
include scripts/enemies/sarge.con
include scripts/enemies/firefly.con

include scripts/p_inv.con

include scripts/d_menu.con
include scripts/d_hud.con

include scripts/c_input.con
include scripts/m_umenhanced.con //This needs to come first since in c_init, the actors that do not belong to the skill level, gets deleted.
include scripts/c_init.con
include scripts/m_invert.con
include scripts/c_devkit.con

// Below is example code that ADDS enemies/items in Duke Nukem 3D.

// "MYENEMY" is simply a three-framed object bouncing around in random angles
// mindlessly shooting the freeze weapon towards at closest player.
/*
define MYENEMY 3590            // A position in .art file
define MYENEMY_NORMAL_STRENGTH   100
define MYENEMY_TOUGHER_STRENGTH  200
define MYENEMY_DAMAGE_TO_PLAYER  -20

definesound MYENEMY_ROAM   my_eroam.voc   0 0 0 0 0
definesound MYENEMY_HURT   my_ehurt.voc   0 0 0 0 0
definesound MYENEMY_DEAD   my_edead.voc   0 0 0 0 0
definesound MYENEMY_SHOOT  my_eshot.voc   0 0 0 0 0

action MYENEMY_ANIMATIONS  0  3  1  1  4
move MYENEMY_SPEEDS 64

ai AIMYENEMY_BOUNCE   MYENEMY_ANIMATIONS MYENEMY_SPEEDS geth randomangle

useractor enemy MYENEMY

  ifai NO           // 'NO' is defined as '0'
  {               // Prepare(Initialize) MyEnemy for battle...

    // Give 'MYENEMY' strength.  If it
    // has a palette lookup other than
    // 0, make it twice as strong!

    ifspritepal 0
      strength MYENEMY_NORMAL_STRENGTH
    else
      strength MYENEMY_TOUGHER_STRENGTH

    sizeat 48 48      // Set the size of your actor

    cstator 257         // Force actor to block

    ai AIMYENEMY_BOUNCE   // Make it go!

  }

  ifrnd 8
  {

    // Used with keyword 'shoot'.
    // BLOODSPLAT1 ,BLOODSPLAT2 ,BLOODSPLAT3 ,BLOODSPLAT4 ,KNEE ,
    // SHOTSPARK1 ,SHOTGUN ,CHAINGUN ,FIRELASER ,SPIT ,COOLEXPLOSION1 ,
    // FREEZEBLAST ,RPG ,HANDHOLDINGLASER ,BOUNCEMINE ,MORTER ,SHRINKER
    // GROWSPARK

    shoot FREEZEBLAST


    // A sound effect to play for the shooting action.

    sound MYENEMY_SHOOT
  }

  ifcount 48   // if after about a second and a half and...
    ifrnd 16   // if a random value between 0-255 is less than 16...
      ai AIMYENEMY_BOUNCE // reset everything, including all counters

  ifpdistl 1024
    ifrnd 16
  {
    sound DUKE_GRUNT
    palfrom 24 24
    addphealth MYENEMY_DAMAGE_TO_PLAYER
  }

  ifhitweapon         // Was it hit by a weapon?
  {
    debris SCRAP1 2       // OUCH!  Make some peices fall off

    ifdead          // Is it dead yet?
    {             // If so, then...
      addkills 1        //   Add 1 kill to player score
      spawn EXPLOSION2      //   Make an explosion
      sound MYENEMY_DEAD    //   The sound of death

                    // Damage anything within a close distance.
      hitradius 2048 WEAKEST WEAK MEDIUMSTRENGTH TOUGH
      killit          //   Delete sprite (CODE ABORTS HERE)
    }

    sound MYENEMY_HURT    // No?, Make a hurt sound instead
  }
enda
*/



define SPACESHUTTLE 487
move SHUTTLEVELS 16
actor SPACESHUTTLE TOUGH
//  ifmove 0          //  Init once
//    move SHUTTLEVELS getv geth
enda


actor SATELLITE TOUGH
  //  ifmove 0 move SHUTTLEVELS getv geth
  //  ifcount 120 move SHUTTLEVELS getv geth randomangle
enda


action ASHARKCRUZING 0 8 5 1 24
action ASHARKFLEE  0 8 5 1 10
action ASHARKATACK   0 8 5 1 6
action ASHARKSHRUNK  0 8 5 1 24
action ASHARKGROW  0 8 5 1 24
action ASHARKFROZEN  0 1 5 1 24

move SHARKVELS 24
move SHARKFASTVELS 72
move SHARKFLEEVELS 40

actor SHARK SHARKSTRENGTH ASHARKCRUZING SHARKVELS randomangle geth
  ifaction ASHARKSHRUNK
  {
    ifcount SHRUNKDONECOUNT
      action ASHARKCRUZING
    else ifcount SHRUNKCOUNT
      sizeto 60 60
    else
      state genericshrunkcode
    break
  }
  else
    ifaction ASHARKGROW
  {
    ifcount SHRUNKDONECOUNT
      action ASHARKCRUZING
    else
      ifcount SHRUNKCOUNT
        sizeto 24 24
    else
      state genericgrowcode
  }
  else
    ifaction ASHARKFROZEN
  {
    fall

    ifp pfacing
      ifpdistl FROZENQUICKKICKDIST
        pkick

    ifcount THAWTIME
    {
      action ASHARKFLEE
      getlastpal
      break
    }
    else
      ifcount FROZENDRIPTIME
        ifactioncount 26
          resetactioncount

    ifhitweapon
    {
      ifwasweapon FREEZEBLAST
        break

      lotsofglass 30
      sound GLASS_BREAKING
      addkills 1
      killit
    }
    break
  }
  else
    ifaction ASHARKFLEE
  {
    ifcount 16
      ifrnd 48
    {
      action ASHARKCRUZING
      move SHARKVELS randomangle geth
    }
  }
  else
    ifaction ASHARKCRUZING
  {
    ifcansee
      ifcount 48
        ifrnd 2
          ifcanshoottarget
    {
      action ASHARKATACK
      move SHARKFASTVELS faceplayerslow getv break
    }
    ifcount 32
      ifnotmoving
    {
      ifrnd 128
        move SHARKVELS randomangle geth
      else
        move SHARKFASTVELS randomangle geth
    }
  }
  else
    ifaction ASHARKATACK
  {
    ifcount 4
    {
      ifpdistl 1280
      {
        ifp palive ifcanshoottarget
        {
          sound DUKE_GRUNT
          palfrom 32 32
          addphealth SHARKBITESTRENGTH
        }
        action ASHARKFLEE
        move SHARKFLEEVELS fleeenemy
      }
    }
    else
      ifnotmoving
    {
      ifcount 32
      {
        action ASHARKCRUZING
        move SHARKVELS randomangle geth
      }
    }
    else
      ifcount 48
        ifrnd 2
    {
      action ASHARKCRUZING
      move SHARKFASTVELS randomangle geth
    }
  }

  ifhitweapon
  {
    ifdead
    {
      ifwasweapon GROWSPARK
      {
        move 0
        cstat 0
        action ASHARKGROW
        sound ACTOR_GROWING
        break
      }
      else
        ifwasweapon FREEZEBLAST
      {
        spritepal 1
        strength 0
        action ASHARKFROZEN
        sound SOMETHINGFROZE
      }
      else
      {
        sound SQUISHED
        guts JIBS6 5
        addkills 1
        killit
      }
    }
    else
    {
      ifwasweapon SHRINKSPARK
      {
        action ASHARKSHRUNK
        sound ACTOR_SHRINKING
        move 0
        break
      }
      else
        ifwasweapon GROWSPARK
          sound EXPANDERHIT

      move SHARKVELS randomangle geth
    }
  }
enda


action BLIMPWAITTORESPAWN

state blimphitstate
  cstat 0
  spawn FIRSTGUNSPRITE
  spawn EXPLOSION2

  debris SCRAP1 80      // Weapons and ammo!
  debris SCRAP2 24
  debris SCRAP3 24
  debris SCRAP4 24
  debris SCRAP5 24

  sound PIPEBOMB_EXPLODE
 
  action BLIMPWAITTORESPAWN
  count 0
  cstat 32768
  
ends

actor BLIMP 1

  ifaction BLIMPWAITTORESPAWN
  {
    ifcount BLIMPRESPAWNTIME
    {
      action 0
      cstat 0
    }
    break
  }

  ifhitweapon
  {
    ifwasweapon RADIUSEXPLOSION
      state blimphitstate
    ifwasweapon RPG
      state blimphitstate
	ifwasweapon ROCKETPROJ
      state blimphitstate
    strength 1
  }
enda



state rats
  ifrnd 128
    spawn RAT
  ifrnd 128
    spawn RAT
  ifrnd 128
    spawn RAT
  ifrnd 128
    spawn RAT
  ifrnd 128
    spawn RAT
  ifrnd 128
    spawn RAT
  ifrnd 128
    spawn RAT
  ifrnd 128
    spawn RAT
ends

move MOUSEVELS 32

action RUBCANDENT 1 1 1 1 1

actor RUBBERCAN WEAK
  ifaction RUBCANDENT
  {
    ifactioncount 16
    {
      strength 0
      action ANULLACTION
      break
    }
  }
  else
    ifhitweapon
  {
    ifwasweapon RADIUSEXPLOSION
    {
      state rats
      ifrnd 48
        spawn BURNING
      debris SCRAP3 12
      killit
    }
    else
      action RUBCANDENT
  }
enda

state toughgalspeech
  ifrnd 64
  {
    ifnosounds
      soundonce TOUGHGALSND1
  }
  else
    ifrnd 64
  {
    ifnosounds
      soundonce TOUGHGALSND2
  }
  else
    ifrnd 64
  {
    ifnosounds
      soundonce TOUGHGALSND3
  }
  else
    ifnosounds
      soundonce TOUGHGALSND4
ends

state jibfood
  sound SQUISHED
  guts JIBS6 3
  killit
ends

state breakobject
  ifaction 0
  {
    action ANULLACTION
    cstator 257
    ifactor ROBOTMOUSE
      clipdist 64
  }
  else
    ifactor ROBOTMOUSE
  {
      ifdead
      {
        ifcount 32
        {
          globalsound MOUSEANNOY
          killit
        }
        break
      }
      ifcount 64 ifrnd 6
      {
        ifrnd 128
          move MOUSEVELS randomangle geth
        else
        {
          ifrnd 64
            soundonce HAPPYMOUSESND1
          else
            ifrnd 64
              soundonce HAPPYMOUSESND2
          else
            ifrnd 64
              soundonce HAPPYMOUSESND3
          else
            soundonce HAPPYMOUSESND4
        }
        resetcount
      }
  }

  ifhitweapon
  {
    ifdead
    {
      ifactor FOODOBJECT6
        state jibfood
      else
        ifactor FOODOBJECT11
          state jibfood
      else
        ifactor FOODOBJECT12
          state jibfood
      else
        ifactor FOODOBJECT13
          state jibfood
      else
        ifactor FOODOBJECT14
          state jibfood
      else
        ifactor FOODOBJECT15
          state jibfood
      else
        ifactor FOODOBJECT16
          state jibfood
      else
        ifactor FOODOBJECT17
          state jibfood
      else
        ifactor SKINNEDCHICKEN
          state jibfood
      else
        ifactor SHOPPINGCART
      {
        debris SCRAP1 5
        debris SCRAP2 5
        debris SCRAP3 5
        sound GLASS_HEAVYBREAK
        killit
      }
      else
        ifactor ROBOTDOG2
      {
        soundonce DEAD_DOG
        guts JIBS2 1
        guts JIBS3 2
        guts JIBS6 3
        killit
      }
      else
        ifactor FEATHEREDCHICKEN
          state jibfood
      else
        ifactor DOLPHIN1
      {
        guts JIBS2 1
        guts JIBS3 2
        guts JIBS4 3
        guts JIBS5 2
        state jibfood
      }
      else
        ifactor DOLPHIN2
      {
        guts JIBS2 1
        guts JIBS3 2
        guts JIBS4 3
        guts JIBS5 2
        state jibfood
      }
      else
        ifactor SNAKEP
      {
        guts JIBS2 1
        guts JIBS3 2
        guts JIBS4 3
        guts JIBS5 2
        state jibfood
      }
      else
        ifactor DONUTS
      {
        spritepal 7
        guts JIBS6 2
        killit
      }
      else
        ifactor DONUTS2
      {
        debris SCRAP1 1
        spritepal 7
        guts JIBS6 2
        killit
      }
      else
        ifactor MAILBAG
        {
          mail 30
          debris SCRAP3 5
          debris SCRAP4 3
          killit
        }
      else
        ifactor TEDDYBEAR
      {
        debris SCRAP3 5
        spritepal 1
        debris SCRAP3 6
      }
      else
      {
        ifrnd 128
          sound GLASS_BREAKING
        else
          sound GLASS_HEAVYBREAK
      }

      ifactor CLOCK
      {
	    add s_destruction 1
        cactor BROKENCLOCK
        break
      }
      else
        ifactor JOLLYMEAL
      {
        spawn ATOMICHEALTH
        debris SCRAP3 1
        debris SCRAP4 2
      }
      else
        ifactor GUMBALLMACHINE
      {
        cactor GUMBALLMACHINEBROKE
        strength 1
        debris SCRAP4 2
        lotsofglass 10
        break
      }
      else
        ifactor GUMBALLMACHINEBROKE
      {
        debris SCRAP3 3
        debris SCRAP4 2
        lotsofglass 10
      }
      else
        ifactor DUKEBURGER
      {
        debris SCRAP3 14
        debris SCRAP1 13
        debris SCRAP4 12
        debris SCRAP2 12
        debris SCRAP5 11
      }
      else
        ifactor POLICELIGHTPOLE
      {
        debris SCRAP3 4
        debris SCRAP1 3
        debris SCRAP4 2
        debris SCRAP2 2
        debris SCRAP5 1
      }
      else
        ifactor TOPSECRET
          paper 10
      else
        ifactor GUNPOWDERBARREL
      {
        spawn EXPLOSION2
        sound PIPEBOMB_EXPLODE
        hitradius 2048 WEAKEST WEAK MEDIUMSTRENGTH TOUGH
        ifpdistl 2048
          wackplayer
        debris SCRAP1 10      // Weapons and ammo!
        debris SCRAP2 13
        debris SCRAP3 4
        debris SCRAP4 17
        debris SCRAP5 6
      }
      else
        ifactor FLOORBASKET
      {
        spawn PUKE
        debris SCRAP1 2
        debris SCRAP3 3
        debris SCRAP4 2
      }
      else
        ifactor ROBOTMOUSE
      {
        debris SCRAP2 10
        spritepal 1
        debris SCRAP3 4
        resetcount
        cstat 32768
        break
      }
      else
        ifactor ROBOTPIRATE
      {
        debris SCRAP2 10
        debris SCRAP1 5
        debris SCRAP3 3
        lotsofglass 10
      }
      else
        ifactor PIRATE1A
      {
        debris SCRAP2 10
        debris SCRAP1 5
        debris SCRAP3 3
        lotsofglass 10
      }
      else
        ifactor MAN
      {
        debris SCRAP2 10
        debris SCRAP1 5
        debris SCRAP3 3
        lotsofglass 10
      }
      else
        ifactor MAN2
      {
        debris SCRAP2 10
        debris SCRAP1 5
        debris SCRAP3 3
        lotsofglass 10
      }
      else
        ifactor PIRATE2A
      {
        debris SCRAP2 10
        debris SCRAP1 5
        debris SCRAP3 3
        lotsofglass 10
      }
      else
        ifactor PIRATE3A
      {
        debris SCRAP2 10
        debris SCRAP1 5
        debris SCRAP3 3
        lotsofglass 10
      }
      else
        ifactor PIRATE4A
      {
        debris SCRAP2 10
        debris SCRAP1 5
        debris SCRAP3 3
        lotsofglass 10
      }
      else
        ifactor PIRATE4A
      {
        debris SCRAP2 10
        debris SCRAP1 5
        debris SCRAP3 3
        lotsofglass 10
      }
      else
        ifactor PIRATE5A
      {
        debris SCRAP2 10
        debris SCRAP1 5
        debris SCRAP3 3
        lotsofglass 10
      }
      else
        ifactor PIRATE6A
      {
        debris SCRAP2 10
        debris SCRAP1 5
        debris SCRAP3 3
        lotsofglass 10
      }
      else
      {
        lotsofglass 10
        debris SCRAP4 3
      }
      killit
    }
    else
      ifactor DOLPHIN1
    {
      guts JIBS6 1
      soundonce DOLPHINSND
      ifstrength TOUGH
      {
        cactor DOLPHIN2
        sound SQUISHED
      }
    }
    else
      ifactor DOLPHIN2
    {
      guts JIBS6 1
      soundonce DOLPHINSND
    }
    else
      ifactor ROBOTDOG2
    {
      guts JIBS6 1
      soundonce WHINING_DOG
    }
  }
  else
  {
    ifactor CLOCK
      nullop
    else
      ifactor TOPSECRET
        nullop
    else
      ifactor SKINNEDCHICKEN
        nullop
    else
      ifactor FEATHEREDCHICKEN
        nullop
    else
      ifactor FOODOBJECT2
        nullop
    else
      ifactor FOODOBJECT6
        nullop
    else
      ifactor DOLPHIN1
        nullop
    else
      ifactor DOLPHIN2
        nullop
    else
      fall
  }


ends

action ABURGERROTS 0 1 5
useractor notenemy DUKEBURGER PIRATEGALSTRENGTH ABURGERROTS state breakobject enda

useractor notenemy MOP WEAK state breakobject enda

useractor notenemy BROOM WEAK state breakobject enda

useractor notenemy WETFLOOR WEAK state breakobject enda

useractor notenemy DESKLAMP WEAK state breakobject enda

// useractor notenemy DUKECUTOUT WEAK state breakobject enda

useractor notenemy HATRACK WEAK state breakobject enda

useractor notenemy GUNPOWDERBARREL TOUGH state breakobject enda

useractor notenemy COFFEEMACHINE WEAK state breakobject enda

useractor notenemy TEDDYBEAR WEAK state breakobject enda

useractor notenemy TOPSECRET WEAK state breakobject enda

useractor notenemy ROBOTMOUSE ROBOTMOUSESTRENGTH state breakobject enda

useractor notenemy MAN PIRATEGALSTRENGTH state breakobject enda

useractor notenemy MAN2 PIRATEGALSTRENGTH state breakobject enda

useractor notenemy WOMAN PIRATEGALSTRENGTH state breakobject enda

useractor notenemy PIRATE1A PIRATEGALSTRENGTH state breakobject enda

useractor notenemy PIRATE2A PIRATEGALSTRENGTH state breakobject enda

useractor notenemy PIRATE3A PIRATEGALSTRENGTH state breakobject enda

useractor notenemy PIRATE4A PIRATEGALSTRENGTH state breakobject enda

useractor notenemy PIRATE5A PIRATEGALSTRENGTH state breakobject enda

useractor notenemy PIRATE6A PIRATEGALSTRENGTH state breakobject enda

useractor notenemy ROBOTPIRATE PIRATEGALSTRENGTH state breakobject enda

useractor notenemy PIRATEHALF TOUGH state breakobject enda

useractor notenemy CHESTOFGOLD WEAK state breakobject enda

useractor notenemy ROBOTDOG PIRATEGALSTRENGTH state breakobject enda

useractor notenemy ROBOTDOG2 TOUGH state breakobject enda

useractor notenemy PLEASEWAIT state breakobject enda

useractor notenemy FOODOBJECT1 WEAK state breakobject enda

useractor notenemy FOODOBJECT2 WEAK state breakobject enda

useractor notenemy FOODOBJECT3 WEAK state breakobject enda

useractor notenemy FOODOBJECT4 WEAK state breakobject enda

useractor notenemy FOODOBJECT5 WEAK state breakobject enda

useractor notenemy FOODOBJECT6 WEAK state breakobject enda

useractor notenemy FOODOBJECT7 WEAK state breakobject enda

useractor notenemy FOODOBJECT8 WEAK state breakobject enda

useractor notenemy FOODOBJECT9 WEAK state breakobject enda

useractor notenemy FOODOBJECT10 WEAK state breakobject enda

useractor notenemy FOODOBJECT11 WEAK state breakobject enda

useractor notenemy FOODOBJECT12 WEAK state breakobject enda

useractor notenemy FOODOBJECT13 WEAK state breakobject enda

useractor notenemy FOODOBJECT14 WEAK state breakobject enda

useractor notenemy FOODOBJECT15 WEAK state breakobject enda

useractor notenemy FOODOBJECT16 WEAK state breakobject enda

useractor notenemy FOODOBJECT17 WEAK state breakobject enda

useractor notenemy FOODOBJECT18 WEAK state breakobject enda

useractor notenemy FOODOBJECT19 WEAK state breakobject enda

useractor notenemy FOODOBJECT20 WEAK state breakobject enda

useractor notenemy JOLLYMEAL WEAK state breakobject enda

useractor notenemy GUMBALLMACHINE WEAK state breakobject enda

useractor notenemy GUMBALLMACHINEBROKE WEAK state breakobject enda

useractor notenemy POLICELIGHTPOLE TOUGH state breakobject enda

useractor notenemy CLOCK WEAK state breakobject enda

useractor notenemy MAILBAG WEAK state breakobject enda

useractor notenemy FEATHEREDCHICKEN WEAK state breakobject enda

useractor notenemy SKINNEDCHICKEN WEAK state breakobject enda

useractor notenemy HEADLAMP WEAK state breakobject enda

useractor notenemy DOLPHIN1 DOLPHINSTRENGTH state breakobject enda

useractor notenemy DOLPHIN2 DOLPHINSTRENGTH state breakobject enda

useractor notenemy SNAKEP MEDIUMSTRENGTH state breakobject enda

useractor notenemy DONUTS WEAK state breakobject enda

useractor notenemy GAVALS WEAK state breakobject enda

useractor notenemy GAVALS2 WEAK state breakobject enda

useractor notenemy CUPS WEAK state breakobject enda

useractor notenemy DONUTS2 WEAK state breakobject enda

useractor notenemy FLOORBASKET WEAK state breakobject enda

useractor notenemy METER WEAK state breakobject enda

useractor notenemy DESKPHONE WEAK state breakobject enda

useractor notenemy MACE WEAK state breakobject enda

useractor notenemy SHOPPINGCART WEAK state breakobject enda

useractor notenemy COFFEEMUG WEAK state breakobject enda



state headhitstate

// Unrem the following line to invoke screen tilting during
// low player hitpoint damage.

	wackplayer

ends


action EXPBARRELFRAME     0   2   1   1   15
actor EXPLODINGBARREL 26
  fall
  ifaction EXPBARRELFRAME
  {
    ifactioncount 2
    {
      hitradius 1024 WEAKEST WEAK MEDIUMSTRENGTH TOUGH
      spawn EXPLOSION2
      debris SCRAP2 2
      sound PIPEBOMB_EXPLODE
      killit
    }
    break
  }
  ifsquished
  {
    debris SCRAP1 5
    killit
    break
  }
  ifhitweapon
    action EXPBARRELFRAME
enda

action BURNING_FLAME  0   12   1   1   2
move BURNING_VELS 

state burningstate

  sleeptime 300


  ifspawnedby BURNING
  {
    ifgapzl 16
      break
  }
  else
    ifspawnedby BURNING2
  {
    ifgapzl 16
      break
  }

  ifpdistg 10240
    break

  ifcount 128
  {
    ifspawnedby TIRE
    {
      ifactioncount 512
        killit
      ifrnd 16
        sizeto 64 48
    }
    else
    {
      sizeto 8 8
      sizeto 8 8
      ifcount 192
        killit
    }
  }
  else
  {
    ifmove 0
      move BURNING_VELS

    sizeto 52 52

    ifp palive
      ifpdistl 844
        ifrnd 32
          ifcansee
    {
      soundonce DUKE_LONGTERM_PAIN
      addphealth -1
      palfrom 24 16
    }
  }

ends

actor BURNING WEAK BURNING_FLAME
  state burningstate
enda

actor BURNING2 WEAK BURNING_FLAME
  state burningstate
enda

action TOILETWATERFRAMES 0 4 1 1 1
actor TOILETWATER 0 TOILETWATERFRAMES
  ifpdistl 8192
  {
    soundonce WATER_GURGLE
    ifspawnedby TOILET
      sizeto 34 34
    else
    {
      ifspawnedby WATERFOUNTAINBROKE
        sizeto 6 15
      else
        ifspawnedby TOILETWATER
          nullop
      else
        sizeto 24 32
    }

    ifp palive
      ifpdistl RETRIEVEDISTANCE
        ifp pfacing
          ifactioncount 32
            ifphealthl MAXPLAYERHEALTH
              ifhitspace
                ifcansee
    {
      addphealth 1
      globalsound DUKE_DRINKING
      resetactioncount
    }
  }
enda

action WOODENHORSEFRAME  0   1   4
action WOODENFALLFRAME  122  1   5

actor HORSEONSIDE WEAKEST
  cactor WOODENHORSE
  action WOODENFALLFRAME
enda
actor WOODENHORSE WEAK WOODENHORSEFRAME
  fall
  ifhitweapon
  {
    ifdead
    {
      debris SCRAP1 4
      debris SCRAP2 3
      killit
    }
    else
      action WOODENFALLFRAME
  }
enda

state steamcode
  ifpdistl 6144
    soundonce STEAM_HISSING

  ifcount 20
    {
      resetcount
      ifp palive
        ifpdistl 1024
      {
        addphealth -1
        palfrom 16 16
      }
    }
  else
  {
    ifspawnedby STEAM
      break
    else
      ifspawnedby CEILINGSTEAM
        break

    sizeto 24 24
  }
ends

action STEAMFRAMES    0     5     1     1     1
actor STEAM 0 STEAMFRAMES
  state steamcode
enda

actor CEILINGSTEAM 0 STEAMFRAMES
  state steamcode
enda

actor WATERBUBBLEMAKER 0 0 randomangle
  ifpdistl 3084
    ifrnd 24
      spawn WATERBUBBLE
enda

action BUBBLE
action CRACKEDBUBBLE  1
move BUBMOVE       -10 -36
move BUBMOVEFAST     -10 -52

actor WATERBUBBLE 0 BUBBLE BUBMOVE getv geth randomangle

  ifaction CRACKEDBUBBLE
  {
    ifinwater
      ifrnd 192
        killit
    ifactioncount 7
      killit
  }
  else
  {
    ifcount 4
    {
      ifrnd 192
        move BUBMOVE getv geth randomangle
      else
        move BUBMOVEFAST getv geth randomangle
      resetcount

      ifrnd 84
        sizeat 8 10
      else
        ifrnd 84
          sizeat 10 8
      else
        sizeat 9 9
    }

    ifonwater
    {
      iffloordistl 8
        action CRACKEDBUBBLE
    }
    else
      ifactioncount 40
        action CRACKEDBUBBLE
  }
enda


move SMOKEVEL 8 -16
move ENGINE_SMOKE 64 -64
move SMOKESHOOTOUT -192
action SMOKEFRAMES 0 4 1 1 10
actor SMALLSMOKE 0 SMOKEFRAMES
  ifmove 0
  {
    ifspawnedby RECON
      move SMOKESHOOTOUT geth
    else
      ifspawnedby SECTOREFFECTOR
        move ENGINE_SMOKE geth getv
    else
      move SMOKEVEL geth getv faceplayer
    ifspawnedby RPG
      cstat 2
  }
  ifpdistl 1596
    ifspawnedby RPG
      killit
  ifactioncount 4
    killit
enda

action BARREL_DENTING  2 2 1 1 6
action BARREL_DENTED   1
action BARREL_DENTED2  2

move SPAWNED_BLOOD

actor NUKEBARRELDENTED WEAK
  cactor NUKEBARREL
  action BARREL_DENTED
enda

actor NUKEBARRELLEAKED WEAK
  cactor NUKEBARREL
  action BARREL_DENTED2
enda

actor NUKEBARREL MEDIUMSTRENGTH
  ifsquished
  {
    debris SCRAP1 32
    spawn BLOODPOOL
    state random_ooz
    killit
  }
  fall
  ifaction BARREL_DENTING
  {
    ifactioncount 2
    {
      debris SCRAP1 10
      ifrnd 2 spawn BLOODPOOL
      killit
    }
  }
  else
    ifhitweapon
  {
    ifdead
    {
      sound VENT_BUST

      ifrnd 128
        spawn BLOODPOOL
      action BARREL_DENTING
    }
    else
    {
      ifaction 0
        action BARREL_DENTED
      else
        ifaction BARREL_DENTED
      {
        action BARREL_DENTED2
        spawn BLOODPOOL
      }
      else
        ifaction BARREL_DENTED2
          action BARREL_DENTING
    }
  }
enda

state burningbarrelcode
  fall
  ifcount 32
  {
    resetcount
    ifp palive
      ifpdistl 1480
        ifp phigher
    {
      addphealth -1
      palfrom 16 16
      ifrnd 96
        sound DUKE_LONGTERM_PAIN
    }
  }
  ifhitweapon
  {
    sound VENT_BUST
    debris SCRAP1 10
    ifrnd 128
      spawn BURNING
    else
      spawn BURNING2
    killit
  }
ends

actor FIREBARREL
  state burningbarrelcode
enda
actor FIREVASE
  state burningbarrelcode
enda

action SHRINKERFRAMES 0 4 1 1 10
actor SHRINKEREXPLOSION 0 SHRINKERFRAMES
  ifactioncount 4
    killit
enda

defstate MultipleExplosions

	set atemp 0
	set atemp2 0
	whilen atemp 4
	{
		eqspawn EXPLOSION2
		seta[RETURN].xrepeat 24
		seta[RETURN].yrepeat 24
		geta[].z atemp3
		sub atemp3 2048
			
		seta[RETURN].z atemp3
		
		set atemp6 RETURN
		
		geta[].x atemp3
		add atemp3 768
		
		rotatepoint sprite[].x sprite[].y atemp3 sprite[].y atemp2 atemp3 atemp4

		setsprite atemp6 atemp3 atemp4 sprite[atemp6].z
		
		add atemp 1
		add atemp2 512
	}
	
	//ifrnd 128
	//{
		set atemp 0
		set atemp2 256
		whilen atemp 3
		{
			eqspawn EXPLOSION3
			seta[RETURN].xrepeat 24
			seta[RETURN].yrepeat 24
			
			geta[].z atemp3
			sub atemp3 6144
			
			seta[RETURN].z atemp3
			
			set atemp6 RETURN
			
			geta[].x atemp3
			add atemp3 384
			
			rotatepoint sprite[].x sprite[].y atemp3 sprite[].y atemp2 atemp3 atemp4

			setsprite atemp6 atemp3 atemp4 sprite[atemp6].z
			
			add atemp 1
			add atemp2 682
		}
	//}

ends

action EXPLOSION_FRAMES 0 20 1 1  4
actor EXPLOSION2 1 EXPLOSION_FRAMES

  ife sprite[].yvel 0
  ifn sprite[].xrepeat 16
  ifspawnedby RPG
  {
    ifrnd 96
		spawn FIREBALL
		
	ifrnd 96
		spawn FIREBALL
		
	ifrnd 96
		spawn FIREBALL
		
	ifrnd 96
		spawn FIREBALL
		
	ifrnd 96
		spawn FIREBALL
	
	ifg userdef.qsize 96
		state MultipleExplosions
	
  }
  
  ife sprite[].yvel 0
  ifn sprite[].xrepeat 16
  ifspawnedby SEENINE
  {
    ifrnd 96
		spawn FIREBALL
		
	ifrnd 96
		spawn FIREBALL
		
	ifrnd 96
		spawn FIREBALL
		
	ifrnd 96
		spawn FIREBALL
		
	ifrnd 96
		spawn FIREBALL
	
	ifrnd 96
	ifg userdef.qsize 96 
		state MultipleExplosions
	
  }
  
  ife sprite[].yvel 0
  ifn sprite[].xrepeat 16
  ifspawnedby OOZFILTER
  {
    ifrnd 96
		spawn FIREBALL
		
	ifrnd 96
		spawn FIREBALL
		
	ifrnd 96
		spawn FIREBALL
		
	ifrnd 96
		spawn FIREBALL
		
	ifrnd 96
		spawn FIREBALL
	
	ifrnd 96
	ifg userdef.qsize 96 
		state MultipleExplosions
	
  }
  
  ife sprite[].yvel 0
  ifspawnedby HEAVYHBOMB
  {
    ifrnd 96
		spawn FIREBALL
		
	ifrnd 96
		spawn FIREBALL
		
	ifrnd 96
		spawn FIREBALL
		
	ifrnd 96
		spawn FIREBALL
		
	ifrnd 96
		spawn FIREBALL
		
	ifg userdef.qsize 96 
		state MultipleExplosions
	
  }
  
  ife sprite[].yvel 0
  ifspawnedby CLUSTERPROJ
  {
    ifrnd 96
		spawn FIREBALL
		
	ifrnd 96
		spawn FIREBALL
		
	ifrnd 96
		spawn FIREBALL
		
	ifrnd 96
		spawn FIREBALL
		
	ifrnd 96
		spawn FIREBALL
	
  }
  
  seta[].yvel 1

  ifactioncount 20
    killit
enda

actor EXPLOSION2BOT 1 EXPLOSION_FRAMES
  ifactioncount 20
    killit
enda

action FFLAME_FR 0 16 1 1 1
action FFLAME 0 1 1 1 1

actor FLOORFLAME 0 FFLAME_FR
  ifaction FFLAME_FR
  {
    ifpdistl 1024
      hitradius 1024 WEAKEST WEAKEST WEAKEST WEAKEST
    ifactioncount 16
      action FFLAME
  }
  ifaction FFLAME
    ifrnd 4
  {
    action FFLAME_FR
    sound CAT_FIRE
    resetactioncount
  }
enda



action ASATNSPIN     0 5 1 1 4
action ASATSHOOTING   -10 3 5 1 40
action ASATWAIT      0 1 5 1 1
move TURRVEL

actor ROTATEGUN ROTTURRETSTRENGTH
// ASATSHOOTING TURRVEL faceplayer

  ifaction 0
  {
    action ASATSHOOTING
    move TURRVEL faceplayer
  }
  else
    ifaction ASATNSPIN
  {
    ifactioncount 32
    {
      action ASATWAIT
      move TURRVEL faceplayer
    }
  }
  else
    ifaction ASATSHOOTING
  {
    ifactioncount 12
      ifrnd 32
    {
      action ASATWAIT
      move 0
    }
    ifcount 32
      resetcount
    else
      ifcount 16
    {
      ifcount 17 nullop
      else
      {
        sound PRED_ATTACK
        shoot FIRELASER
      }
    }
    else
      ifcount 4
    {
      ifcount 5 nullop
      else
      {
        ifcansee
          ifcanshoottarget
        {
          sound PRED_ATTACK
          shoot FIRELASER
        }
      }
    }
  }
  else
    ifaction ASATWAIT
  {
    ifactioncount 64
      ifrnd 32
        ifp palive
          ifcansee
    {
      action ASATSHOOTING
      move TURRVEL faceplayer
    }
  }
  ifhitweapon
  {
    ifdead
    {
      addkills 1
      sound LASERTRIP_EXPLODE
      debris SCRAP1 15
      spawn EXPLOSION2
      killit
    }
    else
    {
      action ASATNSPIN
      debris SCRAP1 4
    }
    move 0
  }
enda

action RIP_F 0 8 1 1 1
actor FORCERIPPLE 0 RIP_F
  ifactioncount 8
    killit
enda

action TRANSFOWARD 0  6  1  1  2
action TRANSBACK   5  6  1 -1  2

actor TRANSPORTERSTAR 0 TRANSFOWARD

  ifaction TRANSFOWARD
  {
    ifactioncount 6
      action TRANSBACK
  }
  else
    ifactioncount 6
      killit
enda

action BEAMFOWARD  0  4  1  1  9
actor TRANSPORTERBEAM 0 BEAMFOWARD
  sizeto 32 64
  sizeto 32 64
  sizeto 32 64
  ifactioncount 4
    killit
enda


actor STEROIDS
  fall
  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk
      nullop
    else
      ifp palive
        ifcount 6
          ifpdistl RETRIEVEDISTANCE
            ifpinventory GET_STEROIDS STEROID_AMOUNT
              ifcanseetarget
      {
        addinventory GET_STEROIDS STEROID_AMOUNT
		set selected_inv ICON_STEROIDS
        quote 37
        ifspawnedby STEROIDS
          state getcode
        else
          state quikget
      }
enda

actor BOOTS
  fall
  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk
      nullop
    else
      ifp palive
        ifcount 6
          ifpdistl RETRIEVEDISTANCE
            ifpinventory GET_BOOTS BOOT_AMOUNT
              ifcanseetarget
      {
        addinventory GET_BOOTS BOOT_AMOUNT
		set selected_inv ICON_BOOTS
        quote 6
        ifspawnedby BOOTS
          state getcode
        else
          state quikget
      }
enda

actor HEATSENSOR
  fall
  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk
      nullop
  else
    ifp palive
      ifcount 6
        ifpdistl RETRIEVEDISTANCE
          ifpinventory GET_HEATS HEAT_AMOUNT
            ifcanseetarget
      {
        addinventory GET_HEATS HEAT_AMOUNT
		set selected_inv ICON_HEATS
        quote 101
        ifspawnedby HEATSENSOR
          state getcode
        else
          state quikget
      }
enda

actor SHIELD
  fall
  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifcount 6
          ifpdistl RETRIEVEDISTANCE
            ifpinventory GET_SHIELD SHIELD_AMOUNT
              ifcanseetarget
      {
        ifspawnedby PIGCOP
			set atmp2 1
		else ifspawnedby DPIGCOP
			set atmp2 1
		else ifspawnedby ELITEPIGCOP
			set atmp2 1
		
		ife atmp2 1
        {
          ifrnd 96
            addinventory GET_SHIELD PIG_SHIELD_AMOUNT1
          else
            addinventory GET_SHIELD PIG_SHIELD_AMOUNT2
          quote 104
          sound KICK_HIT
          palfrom 24 0 32
          killit
        }
        else
		{
		  ife userdef.player_skill 6
			addinventory GET_SHIELD 50
		  else
            addinventory GET_SHIELD SHIELD_AMOUNT
		}
        quote 38
        ifspawnedby SHIELD
          state getcode
        else
          state quikget
      }
enda


actor AIRTANK
  fall
  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifcount 6
          ifpdistl RETRIEVEDISTANCE
            ifpinventory GET_SCUBA SCUBA_AMOUNT
              ifcanseetarget
      {
        addinventory GET_SCUBA SCUBA_AMOUNT
		set selected_inv ICON_SCUBA
        quote 39
        ifspawnedby AIRTANK
          state getcode
        else
          state quikget
      }
enda

action HOLODUKE_FRAMES 0 4 1 1 8
actor HOLODUKE 0 HOLODUKE_FRAMES
  fall
  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifcount 6
          ifpdistl RETRIEVEDISTANCE
            ifpinventory GET_HOLODUKE HOLODUKE_AMOUNT
              ifcanseetarget
      {
        addinventory GET_HOLODUKE HOLODUKE_AMOUNT
		set selected_inv ICON_HOLODUKE
        quote 51
        ifspawnedby HOLODUKE
          state getcode
        else
          state quikget
      }
enda

actor JETPACK
  fall
  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE
          ifcount 6
            ifpinventory GET_JETPACK JETPACK_AMOUNT
              ifcanseetarget
      {
        addinventory GET_JETPACK JETPACK_AMOUNT
		set selected_inv ICON_JETPACK
        quote 41
        ifspawnedby JETPACK
          state getcode
        else
          state quikget
      }
enda

actor ACCESSCARD
  fall
  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE
          ifcount 6
            ifcanseetarget
      {
        ifpinventory GET_ACCESS 0
          break
        addinventory GET_ACCESS 1
        quote 43
        state getcode
      }
enda

actor AMMO
  fall
  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifcount 6
          ifpdistl RETRIEVEDISTANCE
            ifcanseetarget
      {
		ife userdef.enable_nuke 1
		ife userdef.nuke_active 1
		ife nuke_n5 1
		ifge player[].ammo_amount PISTOL_WEAPON 24
			break
		
        addammo PISTOL_WEAPON PISTOLAMMOAMOUNT
        quote 65
        ifspawnedby AMMO
          state getcode
        else
          state quikget
      }
enda

actor FREEZEAMMO
  fall
  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifcount 6
          ifpdistl RETRIEVEDISTANCE
			ifl freezeammo MAXFREEZEAMMO
            ifcanseetarget
      {
	  
		ife userdef.enable_nuke 1
		ife userdef.nuke_active 1
		ife nuke_n5 1
		ifge freezeammo 30
			break
	  
        addammo FREEZE_WEAPON FREEZEAMMOAMOUNT
		ife userdef.player_skill 6
			add freezeammo 7
		else
			add freezeammo FREEZEAMMOAMOUNT
        quote 66
        ifspawnedby FREEZEAMMO
          state getcode
        else
          state quikget
      }
enda

actor SHOTGUNAMMO
  fall
  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifcount 6
          ifpdistl RETRIEVEDISTANCE
            ifcanseetarget
      {
		ife userdef.enable_nuke 1
		ife userdef.nuke_active 1
		ife nuke_n5 1
		ifge player[].ammo_amount SHOTGUN_WEAPON 8
			break
	  
		ife userdef.player_skill 6
			addammo SHOTGUN_WEAPON 4
		else
			addammo SHOTGUN_WEAPON SHOTGUNAMMOAMOUNT
        quote 69
        ifspawnedby SHOTGUNAMMO
          state getcode
        else
          state quikget
      }
enda

actor AMMOLOTS
  fall
  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifcount 6
          ifpdistl RETRIEVEDISTANCE
            ifcanseetarget
      {
        addammo PISTOL_WEAPON 48
        quote 65
        ifspawnedby AMMOLOTS
          state getcode
        else
          state quikget
      }
enda

actor CRYSTALAMMO
  fall
  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE
          ifcount 6
            ifcanseetarget
      {
		ife userdef.enable_nuke 1
		ife userdef.nuke_active 1
		ife nuke_n5 1
		ifge player[].ammo_amount SHRINKER_WEAPON 3
			break
	  
        addammo SHRINKER_WEAPON CRYSTALAMMOAMOUNT
        quote 78
        ifspawnedby CRYSTALAMMO
          state getcode
        else
          state quikget
      }
enda

actor GROWAMMO
  fall
  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE
          ifcount 6
            ifcanseetarget
      {
		ife userdef.enable_nuke 1
		ife userdef.nuke_active 1
		ife nuke_n5 1
		ifge player[].ammo_amount GROW_WEAPON 10
			break
	  
		ife userdef.player_skill 6
			addammo GROW_WEAPON 5
		else
			addammo GROW_WEAPON GROWCRYSTALAMMOAMOUNT
        quote 123
        ifspawnedby GROWAMMO
          state getcode
        else
          state quikget
      }
enda

actor BATTERYAMMO
  fall
  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE
			ifl ripperammo MAXCHAINGUNAMMO
          ifcount 6
            ifcanseetarget
      {
		ife userdef.enable_nuke 1
		ife userdef.nuke_active 1
		ife nuke_n5 1
		ifge ripperammo 50
			break
	  
        ife userdef.player_skill 6
			add ripperammo 25
		else
			add ripperammo CHAINGUNAMMOAMOUNT
          quote 63
        ifspawnedby BATTERYAMMO
          state getcode
        else
          state quikget
      }
enda

actor DEVISTATORAMMO
  fall
  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE
		ifl devistatorammo MAXDEVISTATORAMMO
          ifcount 6
            ifcanseetarget
      {
		ife userdef.enable_nuke 1
		ife userdef.nuke_active 1
		ife nuke_n5 1
		ifge devistatorammo 15
			break
	  
        addammo DEVISTATOR_WEAPON DEVISTATORAMMOAMOUNT
		ife userdef.player_skill 6
			add devistatorammo 8
		else
			add devistatorammo DEVISTATORAMMOAMOUNT
        quote 14
        ifspawnedby DEVISTATORAMMO
          state getcode
        else
          state quikget
      }
enda

actor RPGAMMO
  fall
  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else ifp palive
      ifpdistl RETRIEVEDISTANCE
		ifl rpgammo MAXRPGAMMO
        ifcount 6
          ifcanseetarget
      {
		ife userdef.enable_nuke 1
		ife userdef.nuke_active 1
		ife nuke_n5 1
		ifge rpgammo 4
			break
	  
        addammo RPG_WEAPON RPGAMMOBOX
		ife userdef.player_skill 6
			add rpgammo 2
		else
			add rpgammo RPGAMMOBOX
        quote 64
        ifspawnedby RPGAMMO
          state getcode
        else
          state quikget
      }
enda

actor HBOMBAMMO
  fall
  ifmove RESPAWN_ACTOR_FLAG state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE
          ifcount 6
            ifcanseetarget
      {
		ife userdef.enable_nuke 1
		ife userdef.nuke_active 1
		ife nuke_n5 1
		ifge player[].ammo_amount HANDBOMB_WEAPON 4
			break
	  
        ifgotweaponce 0
          break

        addweapon HANDBOMB_WEAPON HANDBOMBBOX
        quote 55
//        addammo HANDBOMB_WEAPON HANDBOMBBOX

        ifspawnedby HBOMBAMMO
          state getweaponcode
        else
          state quikweaponget
      }
enda

actor RPGSPRITE
  fall
  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE
          ifcount 6
            ifcanseetarget
      {
        ifgotweaponce 0
          break

		ifn gotweapons[RPG_WEAPON] 1
		  {
		     ife player[].curr_weapon RPG_WEAPON
			  {
				set change_weapon 1
				setp[].weapon_pos -1
			  }
			  else ife gotweapons[RPGBLAST_WEAPON] 1
			  {
			    sound SELECT_WEAPON
				set weapon_to_switch RPG_WEAPON
				setp[].bsubweapon RPG_WEAPON 0
				setp[].weapon_pos -1
			  }
		  
			setarray gotweapons[RPG_WEAPON] 1
			addweapon RPG_WEAPON 1
			
			ifl rpgammo MAXRPGAMMO
				add rpgammo RPGAMMOBOX
		  } else ifl rpgammo MAXRPGAMMO
				add rpgammo RPGAMMOBOX
			else break
			
        quote 56
        ifspawnedby RPGSPRITE
          state getweaponcode
        else
          state quikweaponget
      }
enda

actor SHOTGUNSPRITE
  fall
  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE
          ifcount 6
            ifcanseetarget
      {
       ifspawnedby DPIGCOP
        {
		  ife gotweapons[SHOTGUNDOUBLE_WEAPON] 0
		  {
			  ife player[].curr_weapon SHOTGUN_WEAPON
			  {
				set change_weapon 1
				setp[].weapon_pos -1
			  }
			  else
			  {
				set weapon_to_switch SHOTGUN_WEAPON
				sound SHOTGUN_COCK
				setp[].bsubweapon SHOTGUN_WEAPON 1
				setp[].weapon_pos -1
			  }
			  
			  setarray gotweapons[SHOTGUNDOUBLE_WEAPON] 1
			  ifn player.ammo_amount SHOTGUN_WEAPON MAXSHOTGUNAMMO
			  {
				  addweapon SHOTGUN_WEAPON 0
				 ifrnd 64
					addammo SHOTGUN_WEAPON 3
			     else ifrnd 64
					addammo SHOTGUN_WEAPON 2
				  else
					addammo SHOTGUN_WEAPON 1
			  }
		  }
		  else
		  {
		     addweapon SHOTGUN_WEAPON 0
			 ifrnd 64
				addammo SHOTGUN_WEAPON 3
			 else ifrnd 64
				addammo SHOTGUN_WEAPON 2
			  else
				addammo SHOTGUN_WEAPON 1
		  }
        }
        else
        {
          ifgotweaponce 0
            break
		  ife gotweapons[SHOTGUNDOUBLE_WEAPON] 0
		  {
			  ife player[].curr_weapon SHOTGUN_WEAPON
			  {
				set change_weapon 1
				setp[].weapon_pos -1
			  }
			  else
			  {
			    sound SHOTGUN_COCK
				set weapon_to_switch SHOTGUN_WEAPON
				setp[].bsubweapon SHOTGUN_WEAPON 1
				setp[].weapon_pos -1
			  }
			  
			  setarray gotweapons[SHOTGUNDOUBLE_WEAPON] 1
			  ifn player.ammo_amount SHOTGUN_WEAPON MAXSHOTGUNAMMO
				addweapon SHOTGUN_WEAPON 4
		  }
		  else
			addweapon SHOTGUN_WEAPON 4
			
          quote 127
        }

        ifspawnedby SHOTGUNSPRITE
          state getweaponcode
        else
          state quikweaponget
      }
enda



actor SIXPAK
  fall
  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE
          ifcount 6
            ifphealthl MAXPLAYERHEALTH
              ifcanseetarget
      {
		addphealth 25
		
		quote 62
		
        ifspawnedby SIXPAK
          state getcode
        else
          state quikget
      }
enda

actor COLA
  fall
  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE
          ifcount 6
            ifphealthl MAXPLAYERHEALTH
              ifcanseetarget
      {
	   
		addphealth 5
		
		quote 61
			
        ifspawnedby COLA
          state getcode
        else
          state quikget
      }
enda

actor ATOMICHEALTH
  fall
  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE
          ifcount 6
            ifphealthl MAXPLAYERATOMICHEALTH
              ifcanseetarget
      {
        addphealth 50
        quote 19
        ifspawnedby ATOMICHEALTH
          state getcode
        else
          state quikget
      }
enda




actor FIRSTAID
  fall
  ifmove RESPAWN_ACTOR_FLAG state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE
          ifcount 6
            ifpinventory GET_FIRSTAID FIRSTAID_AMOUNT
              ifcanseetarget
      {
        addinventory GET_FIRSTAID FIRSTAID_AMOUNT
		set selected_inv ICON_FIRSTAID
        quote 3

        ifspawnedby FIRSTAID
          state getcode
        else
          state quikget
      }
enda


actor FIRSTGUNSPRITE
  fall
  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE
          ifcount 6
            ifcanseetarget
      {
        ifgotweaponce 0
          break
		ife userdef.player_skill 6
			addweapon PISTOL_WEAPON 24
		else
			addweapon PISTOL_WEAPON 48
        ifspawnedby FIRSTGUNSPRITE
          state getweaponcode
        else
          state quikweaponget
      }
enda


actor TRIPBOMBSPRITE
  fall
  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE
          ifcount 6
            ifcanseetarget
      {
        ifgotweaponce 0
          break

        addweapon TRIPBOMB_WEAPON 1
        quote 58
        ifspawnedby TRIPBOMBSPRITE
          state getweaponcode
        else
          state quikweaponget
      }
enda

actor CHAINGUNSPRITE
  fall
  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE
          ifcount 6
            ifcanseetarget
      {
        ifgotweaponce 0
          break

		ifn gotweapons[CHAINGUN_WEAPON] 1
		  {
			ife player[].curr_weapon CHAINGUN_WEAPON
			  {
				set change_weapon 1
				setp[].weapon_pos -1
			  }
			  else ife gotweapons[PLASMA_WEAPON] 1
			  {
			    sound SELECT_WEAPON
				set weapon_to_switch CHAINGUN_WEAPON
				setp[].bsubweapon CHAINGUN_WEAPON 0
				setp[].weapon_pos -1
			  }
		  
			setarray gotweapons[CHAINGUN_WEAPON] 1
			addweapon CHAINGUN_WEAPON 1
			
			ifl ripperammo MAXCHAINGUNAMMO
				add ripperammo CHAINGUNAMMOAMOUNT
		  } else ifl ripperammo MAXCHAINGUNAMMO
				add ripperammo CHAINGUNAMMOAMOUNT
			else break
			
        quote 54
        ifspawnedby CHAINGUNSPRITE
          state getweaponcode
        else
          state quikweaponget
      }
enda



actor SHRINKERSPRITE
  fall
  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE
          ifcount 6
            ifcanseetarget
      {
        ifgotweaponce 0
          break
        addweapon SHRINKER_WEAPON CRYSTALAMMOAMOUNT
        quote 60
        ifspawnedby SHRINKERSPRITE
          state getweaponcode
        else
          state quikweaponget
      }
enda

actor FREEZESPRITE
  fall
  ifmove RESPAWN_ACTOR_FLAG
    state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE
          ifcount 6
            ifcanseetarget
      {
        ifgotweaponce 0
          break

		ifn gotweapons[FREEZE_WEAPON] 1
		  {
		     ife player[].curr_weapon FREEZE_WEAPON
			  {
				set change_weapon 1
				setp[].weapon_pos -1
			  }
			  else ife gotweapons[FLAME_WEAPON] 1
			  {
				set weapon_to_switch FREEZE_WEAPON
				sound SELECT_WEAPON
				setp[].bsubweapon FREEZE_WEAPON 0
				setp[].weapon_pos -1
			  }
		  
			setarray gotweapons[FREEZE_WEAPON] 1
			addweapon FREEZE_WEAPON 1
			
			ifl freezeammo MAXFREEZEAMMO
				add freezeammo FREEZEAMMOAMOUNT
		  } else ifl freezeammo MAXFREEZEAMMO
				add freezeammo FREEZEAMMOAMOUNT
			else break
		
        quote 59
        ifspawnedby FREEZESPRITE
          state getweaponcode
        else
          state quikweaponget
      }
enda

actor DEVISTATORSPRITE
  fall
  ifmove RESPAWN_ACTOR_FLAG state respawnit
  else
    ifp pshrunk nullop
    else
      ifp palive
        ifpdistl RETRIEVEDISTANCE
          ifcount 6
            ifcanseetarget
      {
       ifn gotweapons[DEVISTATOR_WEAPON] 1
		  {
		     ife player[].curr_weapon DEVISTATOR_WEAPON
			  {
				set change_weapon 1
				setp[].weapon_pos -1
			  }
			  else ife gotweapons[DEVISTATOR_WEAPON] 1
			  {
				set weapon_to_switch DEVISTATOR_WEAPON
				sound SELECT_WEAPON
				setp[].bsubweapon DEVISTATOR_WEAPON 0
				setp[].weapon_pos -1
			  }
		  
			setarray gotweapons[DEVISTATOR_WEAPON] 1
			addweapon DEVISTATOR_WEAPON 1
			
			ifl devistatorammo MAXDEVISTATORAMMO
				add devistatorammo DEVISTATORAMMOAMOUNT
		  } else ifl devistatorammo MAXDEVISTATORAMMO
				add devistatorammo DEVISTATORAMMOAMOUNT
			else break
			
        quote 87
        ifspawnedby DEVISTATORSPRITE
          state getweaponcode
        else
          state quikweaponget
      }
enda

action FIRE_FRAMES   -1 14 1 1 1
move FIREVELS

state firestate

  ifaction 0
    ifrnd 16
    {
      action FIRE_FRAMES
      cstator 128
    }

  sleeptime 300         // Never let it fall to sleep

  ifspawnedby FIRE
  {
    ifgapzl 16
      break
  }
  else
    ifspawnedby FIRE2
  {
    ifgapzl 16
      break
  }

  ifinwater
    killit

  ifp palive
    ifpdistl 844
      ifrnd 32
        ifcansee
  {
    soundonce DUKE_LONGTERM_PAIN
    addphealth -1
    palfrom 32 32
  }

  ifactor FIRE
  {
    ifspawnedby FIRE
      break
  }
  else
    ifactor FIRE2
      ifspawnedby FIRE2
        break

  iffloordistl 128
  {
    ifrnd 128
    {
      ifcount 84
        killit
                // This line(and the else below)
                // is not necessary, since actors
                // with zero x-size are automatically
                // deleted anyway!
      else
        ifcount 42
          sizeto 0 0
      else
        sizeto 32 32
    }
  }
  else
    killit

ends

useractor notenemy FIRE WEAK 0 FIREVELS state firestate enda
useractor notenemy FIRE2 WEAK 0 FIREVELS state firestate enda

actor FECES
  ifcount 24
  {
    ifpdistl RETRIEVEDISTANCE
    {
      ifrnd SWEARFREQUENCY
        soundonce DUKE_STEPONFECES

      sound STEPNIT

      spawn BLOODPOOL   // Will be brown
      killit
    }
  }
  else
    sizeto 32 32
enda





action FEMSHRUNK
action FEMFROZEN1 1
action FEMGROW
action FEMFROZEN2
action FEMDANCE1 19 1 1 1 16
action FEMDANCE3 19 1 1 1 26
action FEMDANCE2 20 2 1 1 10

action FEMANIMATESLOW 0 2 1 1 100
action TOUGHGALANIM   0 5 1 1 25
action FEMANIMATE

state femcode

  ifactor NAKED1 nullop
  else
    ifactor FEM6 nullop
    else
    {
      fall
      ifactor BLOODYPOLE
        ifhitweapon
          ifdead
      {
        state standard_jibs
        killit
      }
    }

  ifaction FEMSHRUNK
  {
    ifcount SHRUNKDONECOUNT
    {
      action FEMANIMATE
      cstat 257
    }
    else
      ifcount SHRUNKCOUNT
        sizeto 40 40
    else
      state genericshrunkcode
  }
  else ifaction FEMGROW
  {
    ifcount 32
    {
      respawnhitag
      guts JIBS4 20
      guts JIBS6 20
      spritepal 6
      soundonce LADY_SCREAM
      ifactor NAKED1
        debris SCRAP3 4
      else
        ifactor PODFEM1
          debris SCRAP3 4
      sound SQUISHED
	  add s_babekilled 1
      killit
    }
    else
      sizeto MAXXSTRETCH MAXYSTRETCH
  }

  else
    ifaction FEMDANCE1
  {
    ifactioncount 2
      action FEMDANCE2
  }
  else
    ifaction FEMDANCE2
  {
    ifactioncount 8
      action FEMDANCE3
  }
  else
    ifaction FEMDANCE3
  {
    ifactioncount 2
    action FEMANIMATE
  }
  else
    ifaction FEMFROZEN1
  {
    ifcount THAWTIME
    {
      action FEMANIMATE
      getlastpal
    }
    else
      ifcount FROZENDRIPTIME
    {
      ifactioncount 26
      {
        spawn WATERDRIP
        resetactioncount
      }
    }

    ifhitweapon
    {
      ifwasweapon FREEZEBLAST
      {
        strength 0
        break
      }
      lotsofglass 30
      sound GLASS_BREAKING
      respawnhitag
      ifrnd 84
        spawn BLOODPOOL
	  add s_babekilled 1
      killit
    }
    else
      ifp pfacing
        ifpdistl FROZENQUICKKICKDIST
          pkick
    break
  }
  else ifaction FEMFROZEN2
  {
    ifcount THAWTIME
    {
      ifactor TOUGHGAL
        action TOUGHGALANIM
      else
        ifactor FEM10
          action FEMANIMATESLOW
      else
        action FEMANIMATE

      getlastpal
    }
    else
      ifcount FROZENDRIPTIME
    {
      ifactioncount 26
      {
        spawn WATERDRIP
        resetactioncount
      }
    }

    ifhitweapon
    {
      ifwasweapon FREEZEBLAST
      {
        strength 0
          break
      }

      lotsofglass 30
      add s_babekilled 1
      sound GLASS_BREAKING
      ifrnd 84
        spawn BLOODPOOL
      respawnhitag

      ifrnd 128
        sound DUKE_HIT_STRIPPER1
      else
        sound DUKE_HIT_STRIPPER2

      killit
    }
    else
      ifp pfacing
        ifpdistl FROZENQUICKKICKDIST
          pkick
    break
  }

  ifhitweapon
  {
    ifdead
    {
      ifwasweapon GROWSPARK
      {
        cstat 0
        move 0
        sound ACTOR_GROWING
        action FEMGROW
        break
      }
      else ifwasweapon FREEZEBLAST
      {
        ifaction FEMSHRUNK
          break

        ifactor NAKED1
          action FEMFROZEN2
        else
          ifactor FEM5
            action FEMFROZEN2
        else
          ifactor FEM6
            action FEMFROZEN2
        else
          ifactor FEM8
            action FEMFROZEN2
        else
          ifactor FEM9
            action FEMFROZEN2
        else
          ifactor FEM10
            action FEMFROZEN2
        else
          ifactor TOUGHGAL
            action FEMFROZEN2
        else
          ifactor PODFEM1
            action FEMFROZEN2
        else
          action FEMFROZEN1

        move 0
        spritepal 1
        strength 0

        sound SOMETHINGFROZE

        break
      }

      ifrnd 128
        sound DUKE_HIT_STRIPPER1
      else
        sound DUKE_HIT_STRIPPER2

      respawnhitag
      state standard_jibs
      state random_wall_jibs
      spawn BLOODPOOL

      ifactor FEM1
        money 5
      else
        ifactor FEM2
      {
        money 7
        cactor BARBROKE
        cstat 0
      }
      else
        ifactor FEM3
          money 4
      else
        ifactor FEM7
          money 8

      ifactor FEM5
      {
        strength TOUGH
        cactor BLOODYPOLE
      }
      else ifactor FEM6
      {
        cstat 0
        cactor FEM6PAD
      }
      else
        ifactor FEM8
      {
        strength TOUGH
        cactor BLOODYPOLE
      }
      else
      {
        spritepal 6
        soundonce LADY_SCREAM
        ifactor NAKED1
          debris SCRAP3 18
        else
          ifactor PODFEM1
            debris SCRAP3 18
	    add s_babekilled 1
        killit
      }
    }
    else
    {
      ifwasweapon SHRINKSPARK
      {
        sound ACTOR_SHRINKING
        move 0
        action FEMSHRUNK
        cstat 0
        break
      }
      else
        ifwasweapon GROWSPARK
          sound EXPANDERHIT
      ifactor FEM8
        break

      ifactor TOUGHGAL
          state toughgalspeech
      else sound SQUISHED

      guts JIBS6 1
    }
  }
ends

state killme
    ifp pfacing
	  ifcansee
	  {
      ifpdistl 1536
	  {
        ifrnd 16
          soundonce KILLME
		
		ifcount 6
		ifhitspace
		{	
			sound TELEPORTER
			ifinwater
				nullop
			else
				globalsound ONEUPSND
				
			quote 142
			
			add s_babesaved 1
			
			//Kill the respawns associated with this babe's hitag
			set atemp 0
			for atemp spritesofstatus 11
			{
				ife sprite[atemp].picnum RESPAWN
				ife sprite[atemp].lotag sprite[].hitag
					killit
			}
			
			spawn TRANSPORTERBEAM
			
			ifrnd 32
				spawn ONEUP
			else ifrnd 96
				spawn SIXPAK
			else ifrnd 64
				spawn SHIELD
			else
				state SpawnShards3
				
			action 0	
			
			ifactor PODFEM1
				cactor FEMPODEMPTY
			else ifactor FEM5
				cactor FEMPODEMPTY2
			else ifactor FEM6
				cactor FEMPODEMPTY3
			else ifactor NAKED1
				cactor FEMPODEMPTY4
			else
				killit
				
			break
		}
	  }
	}
		  
  
ends

defstate podempty

	ifactor 1399
		nullop
	else ifactor FEMPODEMPTY4
		nullop
	else
		fall

	ifhitweapon
	{
		ifdead
		{
			ifrnd 72
				spawn BLOODPOOL
				
			state random_wall_jibs
			state standard_jibs
			sound SQUISHED
			killit
		}
		else
		{
			sound SQUISHED
			guts JIBS6 1
		}
	}

ends 

state tipme
  ifp pfacing
    ifpdistl 1280
      ifhitspace
  {
    tip
    ifrnd 128
      soundonce DUKE_TIP1
    else
      soundonce DUKE_TIP2
    ifactor FEM1
      action FEMDANCE1
  }
ends

state toughgaltalk
  ifp pfacing
    ifpdistl 1280
      ifhitspace
        state toughgalspeech
ends

useractor notenemy FEMPODEMPTY TOUGH state podempty enda
useractor notenemy FEMPODEMPTY2 TOUGH state podempty enda
useractor notenemy FEMPODEMPTY3 TOUGH state podempty enda
useractor notenemy FEMPODEMPTY4 TOUGH state podempty enda

actor FEM1 TOUGH FEMANIMATE
  state tipme
  state femcode
enda
actor FEM2 TOUGH FEMANIMATE
  state tipme
  state femcode
enda
actor FEM3 TOUGH FEMANIMATE
  state tipme
  state femcode
enda
actor FEM4 TOUGH FEMANIMATE
  state femcode
enda
actor FEM5 TOUGH FEMANIMATE
  state killme
  state femcode
enda
actor FEM6 TOUGH FEMANIMATE
  state killme
  state femcode
enda
actor FEM7 TOUGH FEMANIMATE
  state tipme
  state femcode
enda
actor FEM8 TOUGH FEMANIMATE
  state femcode
enda
actor FEM9 TOUGH FEMANIMATE
  state femcode
enda
actor FEM10 TOUGH FEMANIMATESLOW
  state tipme
  state femcode
enda

actor TOUGHGAL MANWOMANSTRENGTH TOUGHGALANIM
  state toughgaltalk
  state femcode
enda

actor NAKED1 TOUGH FEMANIMATE
  state killme
  state femcode
enda
actor PODFEM1 TOUGH FEMANIMATE
  state killme
  state femcode
enda
actor BLOODYPOLE TOUGH
  state femcode
enda
actor STATUEFLASH
  fall
  ifcount 32
    cactor STATUE
enda
actor STATUE
  fall
  ifp pfacing
    ifpdistl 1280
      ifhitspace
  {
    cactor STATUEFLASH
    move 0
  }
enda

actor MIKE
  ifp pfacing
    ifpdistl 1280
      ifhitspace
        mikesnd
enda





action BLOODFRAMES 0 4 1 1 15
actor BLOOD 0 BLOODFRAMES
  sizeto 72 72 sizeto 72 72 sizeto 72 72
  ifpdistg 3144 killit
  ifactioncount 4 killit
enda

action EGGOPEN1 1 1 1 1 4
action EGGOPEN2 2 1 1 1 4
action EGGOPEN3 2 1 1 1 4
action EGGWAIT  0
action EGGFROZEN 1
action EGGGROW 1
action EGGSHRUNK 1
action EGGBURN 1

actor EGG TOUGH
  fall
  ifaction 0
  {
    ifcount 64
    {
      ifrnd 128
      {
        action EGGWAIT
        move 0
      }
      else
      {
        sound SLIM_HATCH
        action EGGOPEN1
      }
    }
  }
  else
    ifaction EGGOPEN1
      ifactioncount 4
        action EGGOPEN2
  else
    ifaction EGGOPEN2
      ifactioncount 4
    {
      spawn GREENSLIME
      action EGGOPEN3
    }
  else
    ifaction EGGGROW
      state genericgrowcode
  else
    ifaction EGGSHRUNK
      state genericshrunkcode
  else
    ifaction EGGFROZEN
  {
    ifcount THAWTIME
    {
      action 0
      getlastpal
    }
    else
      ifcount FROZENDRIPTIME
    {
      ifactioncount 26
      {
        spawn WATERDRIP
        resetactioncount
      }
    }

    ifhitweapon
    {
      ifwasweapon FREEZEBLAST
      {
        strength 0
        break
      }
      lotsofglass 30

      sound GLASS_BREAKING
      ifrnd 84
        spawn BLOODPOOL

      addkills 1
      killit
    }

    // ifp pducking
    ifp pfacing
      ifpdistl FROZENQUICKKICKDIST
        pkick

    break
  }

  ifhitweapon
  {
    ifwasweapon FLAMEPROJ
	{
		state genericburn_dead_code
		move 0
		strength 0
		action EGGBURN
		addkills 1
		break
	}
    ifdead
    {
      ifwasweapon FREEZEBLAST
      {
        sound SOMETHINGFROZE
        spritepal 1
        move 0
        action EGGFROZEN
        strength 0
        break
      }
      else
        ifwasweapon GROWSPARK
      {
        cstat 0
        move 0
        sound ACTOR_GROWING
        action EGGGROW
        break
      }

      addkills 1

      sound SQUISHED

      state standard_jibs
      killit
    }
    else
      ifwasweapon SHRINKSPARK
      {
        move 0
        sound ACTOR_SHRINKING
        action EGGSHRUNK
        break
      }

      ifwasweapon GROWSPARK
        sound EXPANDERHIT
  }
  else
    ifaction EGGWAIT
  {
    ifcount 512
      ifrnd 2
    {
      ifaction EGGSHRUNK
        break
      sound SLIM_HATCH
      action EGGOPEN1
    }
  }

enda

actor KNEE KNEE_WEAPON_STRENGTH enda
actor SPIT SPIT_WEAPON_STRENGTH enda
actor CHAINGUN CHAINGUN_WEAPON_STRENGTH enda
actor SHOTGUN SHOTGUN_WEAPON_STRENGTH enda
actor FIRELASER FIRELASER_WEAPON_STRENGTH enda
actor HEAVYHBOMB HANDBOMB_WEAPON_STRENGTH enda
actor BOUNCEMINE BOUNCEMINE_WEAPON_STRENGTH enda
actor MORTER MORTER_WEAPON_STRENGTH enda
actor SHRINKSPARK SHRINKER_WEAPON_STRENGTH enda

actor GROWSPARK GROWSPARK_WEAPON_STRENGTH
  ifcount 18
    killit
  else
    ifcount 9
  {
    sizeto 0 0
    sizeto 0 0
    sizeto 0 0
    sizeto 0 0
  }
  else
  {
    sizeto 28 28
    sizeto 28 28
    sizeto 28 28
    sizeto 28 28
  }
enda

actor RPG RPG_WEAPON_STRENGTH enda
actor FREEZEBLAST FREEZETHROWER_WEAPON_STRENGTH enda
actor DEVISTATORBLAST FREEZETHROWER_WEAPON_STRENGTH enda
actor COOLEXPLOSION1 COOL_EXPLOSION_STRENGTH enda
actor TRIPBOMB TRIPBOMB_STRENGTH enda

action WEAP2FRAMES 0  4  1  1  6
actor SHOTSPARK1 PISTOL_WEAPON_STRENGTH WEAP2FRAMES
  ifdead
    killit
  ifactioncount 4
    killit
  else
  {
    ifactioncount 3
    {
      ifinwater
      spawn WATERBUBBLE
    }
    else
      ifcount 2 nullop
      else
        ifonwater
          spawn WATERSPLASH2
  }
enda

state standard_pjibs
  guts JIBS1 1
  guts JIBS3 2
  guts JIBS4 1
  guts JIBS5 1
  guts JIBS6 2
  guts DUKETORSO 1
  guts DUKELEG 2
  guts DUKEGUN 1
  ifrnd 16 money 1
ends

move DUKENOTMOVING
state handle_dead_dukes
  fall
  ifmove 0   // 1st time initializiation...
  {
    ifrnd 128
      cstat 4
    else
      cstat 0
    move DUKENOTMOVING
  }

  ifsquished
  {
    sound SQUISHED
    state random_ooz
    killit
  }
  else
    ifcount 1024
      ifpdistg 4096
        killit
  else
  {
    strength 0
    ifhitweapon
      ifwasweapon RADIUSEXPLOSION
    {
      state standard_jibs
      killit
    }
  }
ends

action PLYINGFRAMES 0 1 0 1 1
actor DUKELYINGDEAD 0 PLYINGFRAMES
  state handle_dead_dukes
enda

action PGROWING   0
action PSTAND     0   1   5   1  1
action PEXPLODE   106   5   1   1   10
action PEXPLODEAD   113   1   1
action PJPHOUVER  15   1   5   1
action PWALK    20   4   5   1   16
action PRUN     20   4   5   1   10
action PWALKBACK  45   4   5  -1   16
action PRUNBACK   45   4   5  -1   10
action PJUMPING   50   4   5   1   30
action PFALLING   65   1   5
action PDUCKING   86   1   5
action PCRAWLING  86   3   5   1   20
action PAKICKING  40   2   5   1   25
action PFLINTCHING  106  1   1   1   10
action PTHROWNBACK  106  5   1   1   18
action PFROZEN     20  1   5
action PLYINGDEAD   113  1   1

action PSWIMMINGGO   375   1   5   1   10
action PSWIMMING   375   4   5   1   13
action PSWIMMINGWAIT 395   1   5   1   13
action PTREDWATER  395   2   5   1   17

move PSTOPED
move PSHRINKING // used as a var only

state check_pstandard
  ifp pwalking
    action PWALK
  else
    ifp pkicking
	{
	  ife player[].bsubweapon KNEE_WEAPON 1
	  ifg player[].kickback_pic 0
		nullop
	  else
		action PAKICKING
	}
  else
    ifp pwalkingback
      action PWALKBACK
  else
    ifp prunning
      action PRUN
  else
    ifp prunningback
      action PRUNBACK
  else
    ifp pjumping
      action PJUMPING
  else
    ifp pducking
      action PDUCKING
ends



move PGROWINGPOP        // Used only as a variable

actor APLAYER MAXPLAYERHEALTH PSTAND 0 0

  ife st 2
		{
			spawn PUSHERPLAYER
			setvar st 0
		}

  ifaction 0
    action PSTAND

  ifaction PFROZEN
  {
    cstat 257

    fall

    palfrom 16 0 0 24

    ifmove 0
    {
      ifhitweapon
      {
        ifwasweapon FREEZEBLAST
          break
		  
        lotsofglass 60
        ifrnd 84
          spawn BLOODPOOL

        sound GLASS_BREAKING
        spawn ATOMICHEALTH

        getlastpal

        move 1
        break
      }
    }
    else
    {
      cstat 32768
      quote 13
      ifhitspace
      {
        action PSTAND
        resetplayer
      }
      break
    }

    ifactioncount THAWTIME
    {
      getlastpal
      strength 1
      move 0
      action PSTAND
    }
    else
      ifactioncount FROZENDRIPTIME
    {
      ifrnd 32
      spawn WATERDRIP
    }

    ifp pfacing   // assumes another other player  (multiplayer)
      ifpdistl FROZENQUICKKICKDIST
        pkick

    break
  }

  ifdead
  {
    ifaction PGROWING
    {
      ifmove PGROWINGPOP
      {
        quote 13
        ifhitspace
        {
          action 0
          resetplayer
        }
        break
      }
      else
      {
        ifcount 32
        {
          sound SQUISHED
          palfrom 48 64

          state standard_pjibs

          guts JIBS4 20
          guts JIBS6 20
          move PGROWINGPOP
          cstat 32768
          //tossweapon

          hitradius 2048 60 70 80 90

        }
        else
          sizeto MAXXSTRETCH MAXYSTRETCH
      }
      break
    }

    ifsquished
      palfrom 32 63 63 63
    else
      fall

    ifactioncount 7
      move 0
    else
      ifactioncount 6
    {
      ifmultiplayer nullop
      else
      {
        ifrnd 32
          sound DUKE_KILLED5
        else
          ifrnd 32
            sound DUKE_KILLED3
        else
          ifrnd 32
            sound DUKE_KILLED1
        else
          ifrnd 32
            sound DUKE_KILLED2
      }
    }

    ifaction PLYINGDEAD
    {
      ifactioncount 3
        move PSTOPED
      quote 13
      ifhitspace
      {
        action PSTAND
        spawn DUKELYINGDEAD
        resetplayer
      }
      break
    }

    ifaction PTHROWNBACK
    {
      ifactioncount 5
      {
        spawn BLOODPOOL
        action PLYINGDEAD
      }
      else
        ifactioncount 1
          move 0
      break
    }

    ifaction PEXPLODEAD
    {
      quote 13
      ifhitspace
      {
        resetplayer
        action PSTAND
      }
      break
    }
    ifaction PEXPLODE
    {
      ifactioncount 5
      {
        action PEXPLODEAD
        spawn BLOODPOOL
      }
      break
    }

    ifp pshrunk
    {
      state standard_pjibs
      spawn BLOODPOOL

      sound SQUISHED
      sound DUKE_DEAD

      cstat 32768         // Hide the sprite

      action PLYINGDEAD
    }
    else
    {
      ifinwater
      {
        action PLYINGDEAD
        spawn WATERBUBBLE
        spawn WATERBUBBLE
      }
      else
      {
        action PEXPLODE
        state standard_pjibs
        cstat 32768
        sound SQUISHED
        sound DUKE_DEAD
      }
    }

    //tossweapon

    break
  }

  ifsquished
  {
    strength -1
    sound SQUISHED
    state random_ooz
    break
  }

  ifp ponsteroids
  {
    ifp pstanding nullop
    else
      spawn FRAMEEFFECT1
  }

  ifmove PSHRINKING
  {
    ifcount 32
    {
      ifcount SHRUNKDONECOUNT
      {
        move 0
        cstat 257
      }
      else
        ifcount SHRUNKCOUNT
      {
        sizeto 42 36
        ifgapzl 24
        {
          strength 0
          sound SQUISHED
          palfrom 48 64
          break
        }
      }
      else
        ifp ponsteroids
          count SHRUNKCOUNT
    }
    else
    {
      ifp ponsteroids
        count SHRUNKCOUNT
      else
      {
        sizeto 8 9
        spawn FRAMEEFFECT1
      }
    }
  }
  else ifhitweapon
  {
    ifdead
    {
      ifmultiplayer
        sound DUKE_KILLED4

      ifwasweapon GROWSPARK
      {
        palfrom 48 48
        action PGROWING
        count 0
        move 0
        sound ACTOR_GROWING
        cstat 0
        break
      }
    }
    else
    {
      ifmultiplayer
      {
        ifphealthl YELLHURTSOUNDSTRENGTHMP
        {
          ifrnd 64
            sound DUKE_LONGTERM_PAIN2
          else
            ifrnd 64
              sound DUKE_LONGTERM_PAIN3
          else
            ifrnd 64
              sound DUKE_LONGTERM_PAIN4
          else
            sound DUKE_DEAD
        }
        else
        {
          ifrnd 64
            sound DUKE_LONGTERM_PAIN5
          else ifrnd 64
            sound DUKE_LONGTERM_PAIN6
          else ifrnd 64
            sound DUKE_LONGTERM_PAIN7
          else
            sound DUKE_LONGTERM_PAIN8
        }
      }
      else
      {
        ifphealthl YELLHURTSOUNDSTRENGTH
        {
          ifrnd 74
            sound DUKE_LONGTERM_PAIN2
          else
            ifrnd 8
              sound DUKE_LONGTERM_PAIN3
          else
            sound DUKE_LONGTERM_PAIN4
			
		  palfrom 36 52
        }
        ifrnd 128
          sound DUKE_LONGTERM_PAIN5
		else ifrnd 128
			sound DUKE_LONGTERM_PAIN6
      }
    }
    ifstrength TOUGH
    {
      state headhitstate
      sound DUKE_GRUNT
      ifp pstanding
        action PFLINTCHING
    }

    ifwasweapon RPG
    {
      ifrnd 32
        spawn BLOOD
      ifdead
        state standard_pjibs
      palfrom 48 52
      break
    }
	
	ifwasweapon ROCKETPROJ
    {
      ifrnd 32
        spawn BLOOD
      ifdead
        state standard_pjibs
      palfrom 48 52
      break
    }
	
    ifwasweapon RADIUSEXPLOSION
    {
      ifrnd 32
        spawn BLOOD
      ifdead
        state standard_pjibs
      palfrom 48 52
      break
    }
    ifwasweapon FIREEXT
    {
      ifrnd 32
        spawn BLOOD
      ifdead
        state standard_pjibs
      palfrom 48 52
      break
    }
    ifwasweapon GROWSPARK
    {
      palfrom 48 52
      sound EXPANDERHIT
      break
    }
    ifwasweapon SHRINKSPARK
    {
      palfrom 48 0 48
      move PSHRINKING // used as a var only.
      sound ACTOR_SHRINKING
      cstat 0
      break
    }
    ifwasweapon SHOTSPARK1
      palfrom 24 48
	  
	ifwasweapon TRACER
      palfrom 24 48
	  
	ifwasweapon FLAMEPROJ
	{
		quote 126 
		palfrom 32 63
		set a_flaming 1
	}
	
	ifwasweapon PLASMAPROJ
	{
		palfrom 32 36 0 63
		set a_plasmaeffect 1
	}
	
	ifwasweapon PLASMAMICROPROJ
	{
		palfrom 24 36 0 63
	}
	
    ifwasweapon FREEZEBLAST
    {
      palfrom 48 0 0 48
      ifdead
      {
        sound SOMETHINGFROZE
		//strength 1
        spritepal 1
        move 0
        action PFROZEN
        break
      }
    }
    ifwasweapon COOLEXPLOSION1
      palfrom 48 48 0 48
    ifwasweapon KNEE
      palfrom 16 32
    ifwasweapon FIRELASER
      palfrom 32 32

    ifdead
    {
      action PTHROWNBACK
      //tossweapon
    }

    state random_wall_jibs

    break
  }

  ifaction PFLINTCHING
  {
    ifactioncount 2
      action PSTAND
    break
  }

  ifinwater
  {
    ifaction PTREDWATER
    {
      ifp pwalking prunning
        action PSWIMMINGGO
    }
    else
      ifp pstanding pwalkingback prunningback
        action PTREDWATER
    else
    {
      ifaction PSWIMMING
      {
        ifrnd 4
          spawn WATERBUBBLE
        ifactioncount 4
          action PSWIMMINGWAIT
      }
      else
        ifaction PSWIMMINGWAIT
      {
        ifactioncount 2
          action PSWIMMINGGO
      }
      else
        ifaction PSWIMMINGGO
      {
        ifactioncount 2
          action PSWIMMING
      }
      else
        action PTREDWATER
    }

    ifrnd 4
      spawn WATERBUBBLE // For effect

    break
  }
  else ifp pjetpack
  {
    ifaction PJPHOUVER
    {
      ifactioncount 4
        resetactioncount
    }
    else
      action PJPHOUVER
    break
  }
  else
  {
    ifaction PTREDWATER
      action PSTAND
    ifaction PSWIMMING
      action PSTAND
    ifaction PSWIMMINGWAIT
      action PSTAND
    ifaction PSWIMMINGGO
      action PSTAND
    ifaction PJPHOUVER
      action PFALLING
  }

  ifaction PFALLING
  {
    ifp ponground
      action PSTAND
    else
    {
      ifp pfalling
        break
      else
        state check_pstandard
    }
  }

  ifaction PDUCKING
  {
    ifgapzl 48
    {
      ifp pwalking pwalkingback prunning prunningback
        action PCRAWLING
    }
    else ifp pducking
    {
      ifp pwalking pwalkingback prunning prunningback
        action PCRAWLING
    }
    else
    {
      ifp pstanding
        action PSTAND
      else
        state check_pstandard
    }
  }

  else ifaction PCRAWLING
  {
    ifgapzl 48
    {
      ifp pstanding
        action PCRAWLING
    }
    else
      ifp pducking
    {
      ifp pstanding
        action PDUCKING
    }
    else
    {
      ifp pstanding
        action PSTAND
      else
        state check_pstandard
    }
  }
  else
    ifgapzl 48
      action PDUCKING

  else
    ifaction PJUMPING
  {
    ifp ponground
      action PSTAND
    else
      ifactioncount 4
        ifp pfalling
          action PFALLING
  }

  ifp pfalling
    action PFALLING
  else
    ifaction PSTAND
      state check_pstandard
  else
    ifaction PAKICKING
  {
    ifactioncount 2
      action PSTAND
    break
  }
  else
    ifaction PWALK
  {
    ifp pfalling
      action PFALLING
    else
      ifp pstanding
        action PSTAND
    else
      ifp prunning
        action PRUN
    else
      ifp pwalkingback
        action PWALKBACK
    else
      ifp prunningback
        action PRUNBACK
    else
      ifp pjumping
        action PJUMPING
    else
      ifp pducking
        action PDUCKING
  }

  else
    ifaction PRUN
  {
    ifp pstanding
      action PSTAND
    else
      ifp pwalking
        action PWALK
    else
      ifp pwalkingback
        action PWALKBACK
    else
      ifp prunningback
        action PRUNBACK
    else
      ifp pjumping
        action PJUMPING
    else
      ifp pducking
        action PDUCKING
  }

  else
    ifaction PWALKBACK
  {
    ifp pstanding
      action PSTAND
    else
      ifp pwalking
        action PWALK
    else
      ifp prunning
        action PRUN
    else
      ifp prunningback
        action PRUNBACK
    else
      ifp pjumping
        action PJUMPING
    else
      ifp pducking
        action PDUCKING
  }

  else
    ifaction PRUNBACK
  {
    ifp pstanding
      action PSTAND
    else
      ifp pwalking
        action PWALK
    else
      ifp prunning
        action PRUN
    else
      ifp pwalkingback
        action PWALKBACK
    else
      ifp pjumping
        action PJUMPING
    else
      ifp pducking
        action PDUCKING
  }
enda


action ATURRSTAND 0 1
action ATURROPEN 0 6 1 1 10
action ATURRSPIN 5 5 1 1 6
action ATURRSPINX 9 5 1 -1 6
action ATURRIDLE 5 1 5 1 1

move TURRMOVE 0

useractor enemy ORGANTIC TURRETSTRENGTH ATURRSTAND

	ifaction ATURRSTAND
	{
		sizeat 36 36
		cstator 257
		
		
		ifand sprite[].cstat 128
		{
			geta[].cstat atemp6
			xor atemp6 128
			seta[].cstat atemp6
		}	
		
		getsector[sprite[].sectnum].ceilingz atemp6
		add atemp6 3072
		seta[].z atemp6
		
		ifcansee
		{
			action ATURROPEN
			move TURRMOVE faceplayerslow
		}
	}
	else ifaction ATURROPEN
	{
		soundonce TURR_RECOG
		
		ifactioncount 6
		{
			geta[].z atemp6
			set atemp7 atemp6
			add atemp6 8192
			seta[].z atemp6
			shoot SPIT
			shoot SPIT
			seta[].z atemp7
			action ATURRIDLE
			move TURRMOVE randomangle
		}
	}
	else ifaction ATURRIDLE
	{
		ifrnd 1
			soundonce TURR_ROAM
	
		ifcansee
		//ifcanshoottarget
		ifpdistl 16384
		ifactioncount 30
		{
			action ATURRSPIN
			move TURRMOVE faceplayerslow
		}
	}
	else ifaction ATURRSPIN
	{
		//ifcansee
		//ifcanshoottarget
		//{
			ifactioncount 6
			{
				geta[].z atemp6
				set atemp7 atemp6
				add atemp6 8192
				seta[].z atemp6
				shoot SPIT
				shoot SPIT
				shoot SPIT
				seta[].z atemp7
				sound TURR_ATTACK
				action ATURRSPINX
				cstator 4
			}
			else
			{
				ifpdistg 8192
				ifrnd 64
				{
					action ATURRIDLE
					move TURRMOVE randomangle
				}
			}
		/*
		}
		else
		{
			action ATURRIDLE
			move TURRMOVE randomangle
		}
		*/
		
	}
	else ifaction ATURRSPINX
	{
		//ifcansee
		//ifcanshoottarget
		//{
			ifactioncount 6
			{
				geta[].z atemp6
				set atemp7 atemp6
				add atemp6 8192
				seta[].z atemp6
				shoot SPIT
				shoot SPIT
				shoot SPIT
				seta[].z atemp7
				sound TURR_ATTACK
				action ATURRSPIN
				geta[].cstat atemp6
				xor atemp6 4
				seta[].cstat atemp6
			}
			else
			{
				ifpdistg 8192
				ifrnd 64
				{
					action ATURRIDLE
					move TURRMOVE randomangle
					
					geta[].cstat atemp6
					xor atemp6 4
					seta[].cstat atemp6
				}
			}
		/*
		}
		else
		{
			action ATURRIDLE
			move TURRMOVE randomangle
			geta[].cstat atemp6
			xor atemp6 4
			seta[].cstat atemp6
		}
		*/
		
	}
	
	ifhitweapon
	{
		sound TURR_PAIN
		geta[].z atemp6
		set atemp7 atemp6
		add atemp6 8192
		seta[].z atemp6
		guts JIBS6 1
		seta[].z atemp7
		
		ifaction ATURRSTAND
			action ATURROPEN
		else ifaction ATURRIDLE
		{
			action ATURRSPIN
			move TURRMOVE faceplayerslow
		}
		
		ifdead
		{
			sound TURR_DYING
			
			addkills 1
			add s_bodies 1
			geta[].z atemp6
			set atemp7 atemp6
			add atemp6 8192
			seta[].z atemp6
			guts JIBS1 2
			guts JIBS3 5
			guts JIBS4 2
			guts JIBS6 3
			seta[].z atemp6
			
			killit
		}
	}
	
enda

state rf
  ifrnd 128
    cstat 4
  else
    cstat 0
ends


//
//
//    TROOP/LIZTROOP CODE
//
//

action ATROOPSTAND     0  1  5  1  1
action ATROOPGROW    0  1  5  1  1
action ATROOPSTAYSTAND  -2  1  5  1  1
action ATROOPWALKING   0  4  5  1   12
action ATROOPWALKINGBACK 15   4  5   -1   12
action ATROOPRUNNING   0  4  5  1  8
action ATROOPSHOOT    35  1  5  1   30
action ATROOPJETPACK  40  1  5  1  1
action ATROOPJETPACKILL 40  2  5  1   50
action ATROOPFLINTCH  50  1  1  1  6
action ATROOPDYING    50  5  1  1   16
action ATROOPDEAD     54
action ATROOPPLAYDEAD   54
action ATROOPSUFFERDEAD 58  2  1   -4   24
action ATROOPSUFFERING  59  2  1  1   21
action ATROOPDUCK     64  1  5  1  3
action ATROOPDUCKSHOOT  64  2  5  1   25
action ATROOPABOUTHIDE  74  1  1  1   25
action ATROOPHIDE     75  1  1  1   25
action ATROOPREAPPEAR   74  1  1  1   25
action ATROOPFROZEN    0  1  5
action ALIZBEGHEAD 2005 3 1 1 30
action ALIZNOHEADDEAD 2007 1 1 1 1
action ALIZTORSO 2012 5 1 1 25
action ALIZTORSODEAD 2016 1 1 1 1
action ALIZHACKED 77 6 1 1 18
action ALIZHACKEDDEAD 83 1 1
action ALIZHALFED 2135 5 1 1 25

move TROOPWALKVELS 128
move TROOPWALKVELSBACK -128
move TROOPJETPACKVELS 64 -84
move TROOPJETPACKILLVELS 192 -38
move TROOPRUNVELS 164
move TROOPSTOPPED
move DONTGETUP
move SHRUNKVELS 32

ai AITROOPSEEKENEMY  ATROOPWALKING   TROOPWALKVELS seekplayer
ai AITROOPSEEKPLAYER ATROOPWALKING   TROOPWALKVELS seekplayer
ai AITROOPFLEEING  ATROOPWALKING   TROOPWALKVELS fleeenemy
ai AITROOPFLEEINGBACK ATROOPWALKINGBACK   TROOPWALKVELSBACK faceplayer
ai AITROOPDODGE    ATROOPWALKING   TROOPRUNVELS  dodgebullet
ai AITROOPSHOOTING   ATROOPSHOOT   TROOPSTOPPED  faceplayer
ai AITROOPDUCKING  ATROOPDUCK    TROOPSTOPPED  faceplayer
ai AITROOPJETPACK  ATROOPJETPACK   TROOPJETPACKVELS seekplayer
ai AITROOPSHRUNK   ATROOPWALKING   SHRUNKVELS fleeenemy
ai AITROOPHIDE     ATROOPABOUTHIDE TROOPSTOPPED faceplayer
ai AITROOPGROW     ATROOPGROW    DONTGETUP faceplayerslow
ai AILIZBEGHEAD ALIZBEGHEAD TROOPSTOPPED faceplayer
ai AILIZTORSO ALIZTORSO TROOPSTOPPED faceplayer
ai AILIZHACKED ALIZHACKED TROOPSTOPPED faceplayer
ai AILIZHALFED ALIZHALFED TROOPSTOPPED faceplayer

state troophidestate
  ifaction ATROOPREAPPEAR
  {
    ifactioncount 2
    {
      sound TELEPORTER
      ai AITROOPSHOOTING
      cstat 257
    }
    else
    {
      sizeto 41 40
      sizeto 41 40
      sizeto 41 40
      sizeto 41 40
      spawn FRAMEEFFECT1
    }
  }
  else
    ifaction ATROOPWALKING
  {
    ifpdistl 2448
      ifpdistg 1024
    {
      ifceilingdistl 48
        break
      ifp pfacing
        break

      ifgapzl 64 nullop
      else
        ifawayfromwall
      {
        spawn TRANSPORTERSTAR
        action ATROOPREAPPEAR
        move 0
        break
      }
    }
  }
  else
    ifaction ATROOPHIDE
  {
    ifdead
	{
		ai AITROOPFLEEING
		action ATROOPDEAD
		break
	}
	
    ifactioncount 2
    {
      spawn TRANSPORTERSTAR
      sound TELEPORTER
      action ATROOPWALKING
      move TROOPWALKVELS faceplayer
      cstat 32768
    }
    else
    {
      sizeto 4 40
      sizeto 4 40
      sizeto 4 40
      sizeto 4 40
      spawn FRAMEEFFECT1
    }
  }
  else
    ifaction ATROOPABOUTHIDE
      ifactioncount 2
    {
      action ATROOPHIDE
      cstat 0
    }
ends


state troopgunnashoot
  ifp palive
  {
    ifpdistl 1024
      ai AITROOPSHOOTING
    else
      ifactornotstayput
    {
      ifactioncount 12
        ifrnd 16
          ifcanshoottarget
      {
        ifspritepal 21
          ifrnd 4
            ifpdistg 4096
              ai AITROOPHIDE
        else
        {
          ifpdistl 1100
            ai AITROOPFLEEING
          else
          {
            ifpdistl 4096
              ifcansee
                ifcanshoottarget
                  ai AITROOPSHOOTING
            else
            {
              move TROOPRUNVELS seekplayer
              action ATROOPRUNNING
            }
          }
        }
      }
    }
    else
      ifcount 26
        ifrnd 32
          ai AITROOPSHOOTING
  }
ends

state troopseekstate
  state troopgunnashoot
  ifinwater
  {
    ai AITROOPJETPACK
    break
  }
  ifcansee
  {
    ifmove TROOPRUNVELS
      ifpdistl 1596
        ai AITROOPDUCKING
    ifp phigher
    {
      ifceilingdistl 128 nullop
      else
        ifactornotstayput
          ai AITROOPJETPACK
      break
    }
    else
      ifrnd 2
    {
      ifspritepal 21
        ifpdistg 1596
      {
        ai AITROOPHIDE
        break
      }
      ifbulletnear
      {
        ifrnd 128
          ai AITROOPDODGE
        else
          ai AITROOPDUCKING
        break
      }
    }
  }
  ifnotmoving
  {
    ifrnd 32
      operate
    else
      ifcount 32
        ifp palive
          ifcansee
            ifcanshoottarget
              ai AITROOPSHOOTING
  }
  ifrnd 1
  {
    ifrnd 128
      soundonce PRED_ROAM
    else
      soundonce PRED_ROAM2
  }
ends

state troopduckstate
  ifaction ATROOPDUCK
  {
    ifactioncount 8
    {
      ifp palive
      {
        ifrnd 128
          action ATROOPDUCKSHOOT
      }
      else
        ifmove DONTGETUP
          break
        else
          ai AITROOPSEEKPLAYER
    }
  }
  else
    ifaction ATROOPDUCKSHOOT
  {
    ifcount 64
    {
      ifmove DONTGETUP
        resetcount
      else
      {
        ifpdistl 1100
          ai AITROOPFLEEING
        else
          ai AITROOPSEEKPLAYER
      }
    }
    else
      ifactioncount 2
      {
        ifcanshoottarget
        {
          sound PRED_ATTACK
          resetactioncount
          shoot FIRELASER
        }
        else ai AITROOPSEEKPLAYER
      }
  }
ends

state troopshootstate
  ifactioncount 2
  {
    ifcanshoottarget
    {
      shoot FIRELASER
      sound PRED_ATTACK
      resetactioncount
      ifrnd 128
        ai AITROOPSEEKPLAYER
      ifcount 24
      {
        ifrnd 96
          ifpdistg 2048
            ai AITROOPSEEKPLAYER
          else
          {
            ifpdistg 1596
              ai AITROOPFLEEING
            else
              ai AITROOPFLEEINGBACK
          }
      }
    }
    else
      ai AITROOPSEEKPLAYER
  }
ends

state troopfleestate
  ifactioncount 7
  {
    ifpdistg 3084
    {
      ai AITROOPSEEKPLAYER
      break
    }
    else
      ifrnd 32
        ifp palive
          ifcansee
            ifcanshoottarget
      {
        ifrnd 128
          ai AITROOPDUCKING
        else
          ai AITROOPSHOOTING
          break
      }
  }
  ifnotmoving
  {
    ifrnd 32
      operate
    else
      ifcount 32
        ifp palive
          ifcansee
            ifcanshoottarget
      {
        ifrnd 128
          ai AITROOPSHOOTING
        else
          ai AITROOPDUCKING
      }
  }
ends

state troopdying
  iffloordistl 32
  {
	ifaction ALIZTORSO
	{
		ifcount 5
		{
			state random_wall_jibs
			guts JIBS6 3
			resetcount
		}
		
		cstat 0
	}
  
    ifactioncount 5
    {
      cstat 0
      iffloordistl 8
      sound THUD
      ifrnd 64
        spawn BLOODPOOL
      state rf
      strength 0
      move TROOPSTOPPED
	  ifaction ALIZTORSO
	  {
		state random_wall_jibs
		action ALIZTORSODEAD
		state SpawnShards
	  }
	  else
        action ATROOPDEAD
    }
    break
  }
  else
  {
    state rf
    move 0
	ifai AILIZTORSO
		action ALIZTORSO
	else
		action ATROOPDYING
  }
ends

state checktroophit
  ifaction ATROOPSUFFERING
  {
    stopsound LIZARD_BEG
    sound PRED_DYING
    cstat 256
    action ATROOPSUFFERDEAD
    break
  }
  ifdead
  {
	addkills 1
  
	ifwasweapon CATERKILAR
	{
		ifrnd 72
		{
			ifai AILIZBEGHEAD
				nullop
			else ifai AILIZHACKED
				nullop
			else ifai AILIZHALFED
				nullop
			else ifai AILIZTORSO
				nullop
			else
			{			
				set gutPic NHEADJIB
				//set gutAng 1024
				state GutSlow
				
				guts JIBS6 2
				guts JIBS3 2
				guts JIBS2 1
				
				ai AILIZBEGHEAD
				sound SQUISHED
				sound THUD
				
				state random_wall_jibs
			}
		}
		else ifrnd 72
		{
			ifai AILIZHACKED
				nullop
			else ifai AILIZBEGHEAD
				nullop
			else ifai AILIZHALFED
				nullop
			else ifai AILIZTORSO
				nullop
			else
			{			
				set gutPic NHEADJIB
				//set gutAng 1024
				state GutSlow
				
				set gutPic NARMJIB
				set gutAng 512
				state GutSlow
				
				set gutPic NARMJIB
				set gutAng -512
				state GutSlow
				
				guts JIBS6 4
				guts JIBS3 2
				guts JIBS1 2
				guts JIBS4 3
				guts JIBS2 1
				
				ai AILIZTORSO
				sound SQUISHED
				
				state random_wall_jibs
				state random_wall_jibs
			}
		}
		else ifrnd 96
		{
			ifai AILIZHACKED
				nullop
			else ifai AILIZBEGHEAD
				nullop
			else ifai AILIZHALFED
				nullop
			else ifai AILIZTORSO
				nullop
			else
			{			
				guts JIBS3 4
				guts JIBS6 3
				
				ai AILIZHALFED
				sound SQUISHED
				
				state random_wall_jibs
				state random_wall_jibs
			}
		}
		else
		{
			ifai AILIZHACKED
				nullop
			else ifai AILIZBEGHEAD
				nullop
			else ifai AILIZHALFED
				nullop
			else ifai AILIZTORSO
				nullop
			else
			{			
				guts JIBS3 2
				guts JIBS6 3
				
				ai AILIZHACKED
				sound SQUISHED
				
				state random_wall_jibs
				state random_wall_jibs
			}
		}
		
		break
	}
  
    ifwasweapon FREEZEBLAST
    {
      sound SOMETHINGFROZE
      spritepal 1
      move 0
      action ATROOPFROZEN
      strength 0
      break
    }

    state drop_ammo
    state random_wall_jibs

    ifwasweapon GROWSPARK
    {
      cstat 0
      sound ACTOR_GROWING
      ai AITROOPGROW
      break
    }

    ifwasweapon RPG
    {
      sound SQUISHED
      state troop_body_jibs
      state standard_jibs
      killit
    }
    else
      ifwasweapon RADIUSEXPLOSION
    {
      sound SQUISHED
      state troop_body_jibs
      state standard_jibs
      killit
    }
    else
    {
		 sound PRED_DYING
		 
	  ifwasweapon ROCKETPROJ
	  {
		sound SQUISHED
        state troop_body_jibs
        state standard_jibs
        killit
	  }
	  
	  ifwasweapon PLASMAPROJ
	  {
		sound SQUISHED
        state troop_body_jibs
        state standard_jibs
        killit
	  }
		 
	  ifwasweapon FLAMEPROJ
		state genericburn_dead_code
	  else ifrnd 32
        iffloordistl 32
      {
        sound LIZARD_BEG
        spawn BLOODPOOL
        strength 0
        move 0
        action ATROOPSUFFERING
        break
      }
      action ATROOPDYING
      break
    }
  }
  else
  {
  
    state random_wall_jibs
    sound PRED_PAIN

	ifwasweapon CATERKILAR
	{
		ifrnd 48
			state SpawnShards2
			
		action ATROOPFLINTCH
	}

    ifwasweapon SHRINKSPARK
    {
      sound ACTOR_SHRINKING
      ai AITROOPSHRUNK
    }
    else
      ifwasweapon GROWSPARK
	  {
        sound EXPANDERHIT
	  }
	else
	{
		ifwasweapon FLAMEPROJ
			set a_flaming 1
			
		ifwasweapon PLASMAPROJ
		{
			action ATROOPFLINTCH
			set a_plasmaeffect 1
		}
		
      iffloordistl 32
        ifrnd 96
          action ATROOPFLINTCH
	}
  }
ends

state troopjetpackstate
  ifaction ATROOPJETPACKILL
  {
    ifcansee
      ifactioncount 2
    {
      resetactioncount
      sound PRED_ATTACK
      shoot FIRELASER
    }

    ifp phigher
      ai AITROOPJETPACK
    else
      ifinwater
        ai AITROOPJETPACK
    else
      ifcount 26
        iffloordistl 32
          ai AITROOPSEEKPLAYER
  }
  else
    ifcount 48
      ifcansee
  {
    action ATROOPJETPACKILL
    move TROOPJETPACKILLVELS
    seekplayer
  }
ends

state troopsufferingstate
  ifactioncount 2
  {
    ifrnd 16
      spawn WATERDRIP
    ifactioncount 14
    {
      stopsound LIZARD_BEG
      cstat 256
      strength 30
      action ATROOPSUFFERDEAD
      break
    }
  }
ends

state troopshrunkstate
  ifcount SHRUNKDONECOUNT
    ai AITROOPSEEKENEMY
  else
    ifcount SHRUNKCOUNT
      sizeto 48 40
  else
    state genericshrunkcode
ends


state troopcode fall

	ife sprite[].yvel 2
	ifaction 0
	ifai 0
	{
		soundonce PRED_ROAM
		ai AITROOPSHOOTING
		seta[].yvel 0
	}

  ifinwater
    ifrnd 1
      spawn WATERBUBBLE
  ifaction ATROOPSTAND
  {
    ifrnd 192
      ai AITROOPSHOOTING
    else
      ai AITROOPSEEKPLAYER
  }
  else
    ifaction ATROOPFROZEN
  {
    ifcount THAWTIME
    {
      ai AITROOPSEEKENEMY
      getlastpal
    }
    else
      ifcount FROZENDRIPTIME
    {
      ifactioncount 26
      {
        spawn WATERDRIP
        resetactioncount
      }
    }
    ifhitweapon
    {
      ifwasweapon FREEZEBLAST
      {
        strength 0
		resetcount
        break
      }
      addkills 1

      ifrnd 84
        spawn BLOODPOOL
      lotsofglass 30
      sound GLASS_BREAKING
	  
      killit
    }
    ifp pfacing
      ifpdistl FROZENQUICKKICKDIST
        pkick
    break
  }
  else ifaction ATROOPPLAYDEAD
  {
     action 0
	cactor LIZTROOPDSPRITE
	seta[].yvel 2
  
    strength 0
	
	break
	
    state checksquished

    ifcount PLAYDEADTIME
    {
      soundonce PRED_ROAM
      cstat 257
      strength 1
      ai AITROOPSHOOTING
    }
    else
      ifp pfacing
        resetcount

    break
  }
  else
    ifaction ATROOPDEAD
  {
    action 0
	cactor LIZTROOPDSPRITE
  
    strength 0
    ifrespawn
      ifcount RESPAWNACTORTIME
    {
      spawn TRANSPORTERSTAR
      cstat 257
      strength TROOPSTRENGTH
      ai AITROOPSEEKENEMY
    }
    ifhitweapon
    {
      ifwasweapon RADIUSEXPLOSION
      {
        sound SQUISHED
        state troop_body_jibs
        state standard_jibs
        killit
      }
      break
    }
    else
      state checksquished
    break
  }
  else
    ifaction ALIZHACKEDDEAD
  {
    action 0
	cactor LIZHACKED
  
    strength 0
    ifrespawn
      ifcount RESPAWNACTORTIME
    {
      spawn TRANSPORTERSTAR
      cstat 257
      strength TROOPSTRENGTH
      ai AITROOPSEEKENEMY
    }
    ifhitweapon
    {
      ifwasweapon RADIUSEXPLOSION
      {
        sound SQUISHED
        state troop_body_jibs
        state standard_jibs
        killit
      }
      break
    }
    else
      state checksquished
    break
  }
   else
    ifaction ALIZTORSODEAD
  {
   action 0
	cactor LIZTROOPTORSOLESS
  
    strength 0
    ifhitweapon
    {
      ifwasweapon RADIUSEXPLOSION
      {
        sound SQUISHED
        state troop_body_jibs
        state standard_jibs
        killit
      }
      break
    }
    else
      state checksquished
    break
  }
  else
    ifaction ALIZNOHEADDEAD
  {
    action 0
	cactor LIZTROOPHEADLESS
  
    strength 0
    ifhitweapon
    {
      ifwasweapon RADIUSEXPLOSION
      {
        sound SQUISHED
        state troop_body_jibs
        state standard_jibs
        killit
      }
      break
    }
    else
      state checksquished
    break
  }
  else
    ifaction ATROOPSUFFERDEAD
  {
    ifactioncount 2
    {
      ifrnd 64
      {
        resetcount
		addkills -1
        action ATROOPPLAYDEAD
      }
      else
      {
        soundonce PRED_DYING
        action ATROOPDEAD
      }
    }
  }
  else
    ifaction ATROOPDYING
  {
    state troopdying
    break
  }
  else
    ifaction ATROOPSUFFERING
  {
    state troopsufferingstate
    ifhitweapon
      state checktroophit
    break
  }
  else
    ifaction ATROOPFLINTCH
  {
    ifactioncount 4
      ai AITROOPSEEKENEMY
  }
  else
  {
    ifai AILIZBEGHEAD
	{
		cstat 0
		ifactioncount 3
		{
			state SpawnShards
			action ALIZNOHEADDEAD
			sound SQUISHED
			sound THUD
			state random_wall_jibs
		}
	}
	else ifai AILIZHACKED
	{
		ifaction ALIZHACKED
		{
			cstat 0
			ifcount 16
			{
				sound SQUISHED
				guts JIBS6 1
				state random_wall_jibs
				resetcount
			}
			
			ifactioncount 6
			{
				state SpawnShards
				action ALIZHACKEDDEAD
				sound THUD
				spawn BLOODPOOL
				state random_wall_jibs
				break
			}
		}
	}
	else ifai AILIZHALFED
	{
		ifaction ALIZHALFED
		{
			cstat 0
			ifcount 16
			{
				sound SQUISHED
				guts JIBS6 1
				state random_wall_jibs
				resetcount
			}
			
			ifactioncount 5
			{
				state SpawnShards
				action ALIZHACKEDDEAD
				sound THUD
				spawn BLOODPOOL
				state random_wall_jibs
				set noshards 1
				ai AILIZTORSO
				
				set gutPic LIZTORSO
				set gutAng 512
				state GutSlow
				break
			}
		}
	}
	else
	  ifai AILIZTORSO
	  {
		ifactioncount 2
		ifrnd 72
			state random_wall_jibs
		
		state troopdying
	  }
	else
      ifai AITROOPSEEKPLAYER
        state troopseekstate
    else
      ifai AITROOPJETPACK
    {
      state troopjetpackstate
      ifinwater nullop
      else
        soundonce DUKE_JETPACK_IDLE
    }
    else
      ifai AITROOPSEEKENEMY
        state troopseekstate
    else
      ifai AITROOPSHOOTING
        state troopshootstate
    else
      ifai AITROOPFLEEING
        state troopfleestate
    else
      ifai AITROOPFLEEINGBACK
        state troopfleestate
    else
      ifai AITROOPDODGE
        state troopseekstate
    else
      ifai AITROOPDUCKING
        state troopduckstate
    else
      ifai AITROOPSHRUNK
        state troopshrunkstate
    else
      ifai AITROOPGROW
        state genericgrowcode
    else
      ifai AITROOPHIDE
    {
      state troophidestate
      //break
    }
  }

  ifhitweapon
    state checktroophit
  else
    state checksquished
ends

state checktrooppalette
  ifai 0
  {
    ifspritepal 0
        nullop
    else
        ifspritepal 21
          addstrength TROOPSTRENGTH // Double the hitpoint vals
  }
ends


actor LIZTROOPJETPACK TROOPSTRENGTH
  state checktrooppalette
  ai AITROOPJETPACK
  cactor LIZTROOP
enda

actor LIZTROOPDUCKING TROOPSTRENGTH
  state checktrooppalette
  ai AITROOPDUCKING
  cactor LIZTROOP
  ifgapzl 48
    move DONTGETUP
enda

actor LIZTROOPSHOOT TROOPSTRENGTH ATROOPSTAND
  state checktrooppalette
  ai AITROOPSHOOTING
  cactor LIZTROOP
enda
actor LIZTROOPSTAYPUT TROOPSTRENGTH ATROOPSTAYSTAND
  state checktrooppalette
  ai AITROOPSEEKPLAYER
  cactor LIZTROOP
enda
actor LIZTROOPRUNNING TROOPSTRENGTH ATROOPSTAND
  state checktrooppalette
  ai AITROOPSEEKPLAYER
  cactor LIZTROOP
enda
actor LIZTROOPONTOILET TROOPSTRENGTH
  ifcount 24
  {
    sound FLUSH_TOILET
    operate
    ai AITROOPSEEKPLAYER
    cactor LIZTROOP
  }
  else
    ifcount 2
      nullop
  else
    state checktrooppalette
enda

actor LIZTROOPJUSTSIT TROOPSTRENGTH
  ifcount 30
  {
    operate
    ai AITROOPSEEKPLAYER
    cactor LIZTROOP
  }
  else
    ifcount 2
      nullop
  else
    state checktrooppalette
enda


actor LIZTROOP TROOPSTRENGTH ATROOPSTAND
  state checktrooppalette
  state troopcode
enda

action ALIZSTAND     0
action ALIZWALKING     0   4  5  1  15
action ALIZRUNNING     0   4  5  1  11
action ALIZTHINK     20  2  5  1  40
action ALIZSCREAM    30  1  5  1  2
action ALIZJUMP      45  3  5  1  20
action ALIZFALL      55  1  5
action ALIZSHOOTING    70  2  5  1  7
action ALIZFLAMESHOOTING    70  2  5  1  6
action ALIZELITESHOOTING    70  2  5  1  7
action ALIZDYING     60  6  1  1  15
action ALIZLYINGDEAD   65  1
action ALIZFROZEN     0  1  5
action ALIZMANTORSO -6 5 1 1 25
action ALIZMANTORSODEAD -1 1
action ALIZMANHACKED -30 9 1 1 18

action AFLIZJDEATH 1580 2 1 1 30
action AFLIZARM1 1582 4 1 1 30
action AFLIZARM1DEAD 1586 1
action AFLIZARM1DEAD2 1585 1
action AFLIZARM2 1587 4 1 1 30
action AFLIZARM2DEAD 1590 1
action AFLIZLEG 1592 4 1 1 30
action AFLIZLEGDEAD 1595 1
action AFLIZHACKED -3394 9 1 1 18

move LIZWALKVEL 72
move LIZRUNVEL 192
move LIZJUMPVEL 184
move LIZSTOP

ai AILIZGETENEMY ALIZWALKING LIZWALKVEL seekplayer
ai AILIZDODGE ALIZRUNNING LIZRUNVEL dodgebullet
ai AILIZCHARGEENEMY ALIZRUNNING LIZRUNVEL seekplayer
ai AILIZFLEENEMY ALIZWALKING LIZWALKVEL fleeenemy
ai AILIZSHOOTENEMY ALIZSHOOTING LIZSTOP faceplayer
ai AILIZFLAMESHOOTENEMY ALIZFLAMESHOOTING LIZSTOP faceplayer
ai AILIZELITESHOOTENEMY ALIZELITESHOOTING LIZSTOP faceplayer
ai AILIZJUMPENEMY ALIZJUMP LIZJUMPVEL jumptoplayer
ai AILIZTHINK ALIZTHINK LIZSTOP faceplayerslow
ai AILIZSHRUNK ALIZWALKING SHRUNKVELS fleeenemy
ai AILIZGROW ALIZSTAND  LIZSTOP faceplayerslow
ai AILIZSPIT ALIZSCREAM LIZSTOP faceplayerslow
ai AILIZDYING ALIZDYING LIZSTOP faceplayer

state lizseekstate

  ifactornotstayput
  {
    ifcansee
      ifp palive
        ifpdistl 2048
          ifcount 16
            ifcanshoottarget
    {
	  ifactor FLAMEENFORCER
		ai AILIZFLAMESHOOTENEMY
	  else ifactor ELITEENFORCER
	    ai AILIZELITESHOOTENEMY
	  else
		ai AILIZSHOOTENEMY
      break
    }
    ifai AILIZCHARGEENEMY
    {
      ifcount 72
        ifcanshoottarget
      {
        ifactor FLAMEENFORCER
		ai AILIZFLAMESHOOTENEMY
	  else ifactor ELITEENFORCER
	    ai AILIZELITESHOOTENEMY
	  else
		ai AILIZSHOOTENEMY
        break
      }
      ifp phigher
        ifpdistg 2048
          ifrnd 6
      {
        ai AILIZJUMPENEMY
        break
      }
    }
    else
      ifpdistg 4096
    {
      ifrnd 92
      {
        ifcount 48
          ifcanshoottarget
		  {
            ifactor FLAMEENFORCER
				ai AILIZFLAMESHOOTENEMY
			  else ifactor ELITEENFORCER
				ai AILIZELITESHOOTENEMY
			  else
				ai AILIZSHOOTENEMY
		  }
      }
      else
        ifcount 24
      {
        ai AILIZCHARGEENEMY
        break
      }
    }

    iffloordistl 16
    {
      ifcount 48
        ifnotmoving
          ifcansee
      {
        ai AILIZJUMPENEMY
        break
      }
    }
    else
    {
      ifpdistg 1280
        ai AILIZJUMPENEMY
      break
    }

    ifrnd 4
      ifnotmoving
        operate
    else
      ifrnd 1
        ifbulletnear
    {
      ifgapzl 128
        ai AILIZDODGE
      else
        ifactornotstayput
      {
        ifrnd 32
          ai AILIZJUMPENEMY
        else
          ai AILIZDODGE
      }
    }
  }
  else
  {
    ifactioncount 16
    {
      ifp palive
        ifrnd 32
          ifcansee
            ifcanshoottarget
			{
              ifactor FLAMEENFORCER
				ai AILIZFLAMESHOOTENEMY
			  else ifactor ELITEENFORCER
				ai AILIZELITESHOOTENEMY
			  else
				ai AILIZSHOOTENEMY
			}
    }
    ifcount 16
      ifrnd 32
        move LIZWALKVEL randomangle geth
  }

ends

state lizshrunkstate
  ifcount SHRUNKDONECOUNT
    ai AILIZGETENEMY
  else
    ifcount SHRUNKCOUNT
      sizeto 48 40
  else
    state genericshrunkcode
ends

state lizfleestate
  ifcount 16
  {
    ifrnd 48
      ifp palive
        ifcansee
          ai AILIZSPIT
  }
  else
  {
    iffloordistl 16 nullop
    else
      ai AILIZGETENEMY
    break
  }
ends

state lizthinkstate
  ifrnd 8
    soundonce CAPT_ROAM
  ifactioncount 3
  {
    ifrnd 32
      ifp palive
        ifcansee
          ai AILIZSPIT
        else
          ifrnd 96
            ai AILIZGETENEMY
  }
  else
    ifactioncount 2
      ifrnd 1
        spawn FECES
  ifrnd 1
    ifbulletnear
  {
    ifgapzl 96
      ai AILIZDODGE
    else
    {
      ifrnd 128
        ai AILIZJUMPENEMY
      else
        ai AILIZDODGE
    }
  }
ends

state lizshootstate

   ife userdef.player_skill 6
	move LIZSTOP faceplayersmart

  ifcount 20
    ifrnd 8
  {
    ifcansee
      ifpdistl 2048
    {
      ifrnd 128
        ai AILIZFLEENEMY
      break
    }
    ifrnd 80
      ai AILIZTHINK
    else
      ai AILIZGETENEMY
  }
  ifactioncount 2
  {
    ifcansee
    {
      ifcanshoottarget
      {
	    ifactor FLAMEENFORCER
		{
			ifpdistl 8192
			{
				sound FLAMEFIRE_SOUND
				setprojectile[FLAMEPROJ].extra 2
				setprojectile[FLAMEPROJ].extra_rand 2
				setprojectile[FLAMEPROJ].range 0
				zshoot -1024 FLAMEPROJ
				setprojectile[FLAMEPROJ].extra FLAMEDAMAGE
				setprojectile[FLAMEPROJ].extra_rand 15
				setprojectile[FLAMEPROJ].range 15
				resetactioncount
			}
			else
				ai AILIZGETENEMY
		}
		else ifactor ELITEENFORCER
		{
			ifrnd 24
			{
				sound PLASMARIFLE_FIRE
				setprojectile[PLASMAPROJ].extra 12
				shoot PLASMAPROJ
				setprojectile[FLAMEPROJ].extra PLASMA_DAMAGE
				ai AILIZTHINK
			}
			else
			{
				sound PLASMAMICRO_FIRE			
				setprojectile[PLASMAMICROPROJ].extra 3
				shoot PLASMAMICROPROJ
				setprojectile[PLASMAMICROPROJ].extra PLASMAMICRO_DAMAGE
				resetactioncount
			}
		}
		else
		{
			sound CAPT_ATTACK
			state ShootSpark
			resetactioncount
		}
      }
      else
        ai AILIZTHINK
    }
    else
      ai AILIZGETENEMY
  }
ends

state checklizhit
  spawn BLOOD
  ifai AILIZSHRUNK
  {
    addkills 1
    sound SQUISHED
    state standard_jibs
    killit
  }
  ifdead
  {
  
    ifwasweapon FREEZEBLAST
    {
      sound SOMETHINGFROZE
      spritepal 1
      move 0
      action ALIZFROZEN
      strength 0
      break
    }

    state drop_chaingun

    ifwasweapon GROWSPARK
    {
      cstat 0
      sound ACTOR_GROWING
      ai AILIZGROW
      break
    }

    addkills 1

    ifwasweapon RPG
    {
      sound SQUISHED
      state liz_body_jibs
      state standard_jibs
      killit
    }
	else
		ifwasweapon ROCKETPROJ
	  {
		ifrnd 72
			{
				 ai AILIZDYING
				action ALIZMANTORSO
				set noshards 1
			}
		else
		{
			sound SQUISHED
			state liz_body_jibs
			state standard_jibs
			killit
		}
	  }
    else
      ifwasweapon RADIUSEXPLOSION
    {
      sound SQUISHED
      state liz_body_jibs
      state standard_jibs
      killit
    }
	else
      ifwasweapon PLASMAPROJ
    {
      sound SQUISHED
      state liz_body_jibs
      state standard_jibs
      killit
    }
    else
    {
	  ifwasweapon FLAMEPROJ
		state genericburn_dead_code
      state rf
      ai AILIZDYING
	  
	  ifwasweapon CATERKILAR
	  {
		//ifaction AFLIZARM1
			//nullop
		//else
		ifaction AFLIZJDEATH
			nullop
		else ifaction AFLIZARM1
			nullop
		else ifaction AFLIZARM2
			nullop
		else ifaction AFLIZLEG
			nullop
		else ifaction ALIZTORSO
			nullop
		else ifaction ALIZMANHACKED
			nullop
		else ifaction AFLIZHACKED
			nullop
		else
		{
			ifrnd 96
				action ALIZMANTORSO
			else ifrnd 96
				action AFLIZJDEATH
			else
			{
				ifactor FLAMEENFORCER
					action AFLIZHACKED
				else
				{
					seta[].picnum LIZMAN
					action ALIZMANHACKED
				}
			}
		}
		
		sound CAPT_DYING
		break
	  }
	  
      ifrnd 64
        spawn BLOODPOOL
    }
    sound CAPT_DYING
  }
  else
  {
    sound CAPT_PAIN
	state random_wall_jibs
	
	ifactor ELITEENFORCER
	{
		ifwasweapon RPG
		{
			addkills 1
			ifrnd 72
			{
				 ai AILIZDYING
				action ALIZMANTORSO
				set noshards 1
				break
			}
			else
			{
			  sound SQUISHED
			  state liz_body_jibs
			  state standard_jibs
			  killit
			}
		}
	}
	
    ifwasweapon SHRINKSPARK
    {
      sound ACTOR_SHRINKING
      ai AILIZSHRUNK
      break
    }
    else ifwasweapon GROWSPARK
      sound EXPANDERHIT  
	else ifwasweapon FLAMEPROJ
		set a_flaming 1
	else ifwasweapon PLASMAPROJ
	{
		ifactor LIZMAN
		ifrnd 96
		{
			addkills 1
			sound SQUISHED
			state liz_body_jibs
			state standard_jibs
			killit
			break
		}
	
		set a_plasmaeffect 1
	}
	else ifwasweapon RADIUSEXPLOSION
	{
		ifactor ELITEENFORCER
			nullop
		else
		{
			addkills 1
			
			ifrnd 48
			{
				ai AILIZDYING
				action AFLIZARM1
				set noshards 1
				seta[].htg_t 2 2
				seta[].htg_t 3 2
				
				displayrandvarvar gutAng 2048
				set gutPic NARM2JIB2
				set gutNum 1
				state GutFast
				strength -1
				break
			}
			else ifrnd 48
			{
				 ai AILIZDYING
				strength -1
				action ALIZMANTORSO
				set noshards 1
				break
			}
			else
			{
				sound SQUISHED
				state liz_body_jibs
				state standard_jibs
				killit
			}
		}
	}
	else ifwasweapon CATERKILAR
	{
		ifrnd 32
			state SpawnShards2
			
		//ifrnd 128	
		ai AILIZFLEENEMY
	}
	else
    ifp palive
      ifcansee
        ifcanshoottarget
    {
      ifactor FLAMEENFORCER
	  {
		ifai AILIZFLAMESHOOTENEMY nullop
		else ai AILIZFLAMESHOOTENEMY
	  }
	  else ifactor ELITEENFORCER
	    ai AILIZELITESHOOTENEMY
	  else
	  {
		ifai AILIZSHOOTENEMY nullop
			else ai AILIZSHOOTENEMY
	   }
      break
    }
  }
ends

state lizjumpstate
  ifaction ALIZFALL
  {
    iffloordistl 16
      ai AILIZGETENEMY
  }
  else
    ifactioncount 3
      action ALIZFALL
ends

state lizdyingstate
  //cstat 0
  
  ifaction AFLIZJDEATH
  {
	ifactor FLAMEENFORCER
	{
		seta[].picnum LIZMAN
		seta[].yvel 1
	}
	else ifactor ELITEENFORCER
		seta[].picnum LIZMAN
	
	ifactioncount 2
	{
		state SpawnShards
	
		ifrnd 96
		{
			action AFLIZARM1
			
			set gutPic NARM2JIB2
			set gutAng -512
			state GutSlow
			
			guts JIBS6 3
			guts JIBS2 1
			
			sound SQUISHED
			state random_wall_jibs
			state random_wall_jibs
		}
		else ifrnd 96
		{
			action AFLIZARM2

			set gutPic NARM2JIB2
			set gutAng -512
			state GutSlow
			
			guts JIBS6 3
			guts JIBS2 1
			sound SQUISHED
			state random_wall_jibs
			state random_wall_jibs
		}
		else
		{
			action AFLIZLEG
			
			set gutPic NARM2JIB2
			set gutAng -512
			state GutSlow
			
			guts JIBS6 3
			guts JIBS2 1
			sound SQUISHED
			state random_wall_jibs
			state random_wall_jibs
		}
	}
  }
  else ifaction ALIZMANTORSO
  {
	ifactor LIZMAN
		nullop
	else
		seta[].picnum LIZMAN
		
	ife actioncheck 0
	{
		set gutPic LIZMANTORSO
		set gutAng 2048
		set gutNum 1
		state GutsSlow

		guts LIZMANHEAD1 1
		guts LIZMANARM1 1

		displayrandvarvar gutAng 2048
		set gutPic NARM2JIB2
		set gutNum 1
		state GutFast
		
		sound SQUISHED
		set actioncheck 1
	}
		
	ifcount 16
	{
		guts JIBS6 2
		state random_wall_jibs
		
		resetcount
	}
	
	ifactioncount  5
	{
		state SpawnShards
		action ALIZMANTORSODEAD
		cstat 0
		sound THUD
	}
	
  }
  else ifaction ALIZMANHACKED
  {
	cstat 0
	ifcount 16
	{
		guts JIBS6 2
		state random_wall_jibs
		guts JIBS3 1
		sound SQUISHED
		resetcount
	}
	
	ifactioncount 9
	{
		action 0
		cactor LIZMANHACKED
		sound THUD
		state SpawnShards
		spawn BLOODPOOL
		break
	}
  }
  else ifaction AFLIZHACKED
  {
	cstat 0
	ifcount 16
	{
		guts JIBS6 2
		state random_wall_jibs
		guts JIBS3 1
		sound SQUISHED
		resetcount
	}
	
	ifactioncount 9
	{
		action 0
		cactor LIZMANHACKED
		sound THUD
		state SpawnShards
		spawn BLOODPOOL
		break
	}
  }
  else ifaction AFLIZARM1
  {
	ifactor FLAMEENFORCER
	{
		seta[].picnum LIZMAN
		seta[].yvel 1
	}
	else ifactor ELITEENFORCER
		seta[].picnum LIZMAN
  
	ifactioncount 4
	{
		iffloordistl 8
		  sound THUD
		move LIZSTOP
		ife sprite[].yvel 1
			action AFLIZARM1DEAD2
		else
			action AFLIZARM1DEAD
		state random_wall_jibs
		guts JIBS6 2
	}
  }
  else ifaction AFLIZARM2
  {
	ifactioncount 4
	{
		iffloordistl 8
		  sound THUD
		move LIZSTOP
		action AFLIZARM2DEAD
		state random_wall_jibs
		guts JIBS6 2
	}
	else ifactioncount 3 nullop
	else ifactioncount 2
	ife actioncheck 0
	{
		set actioncheck 1
		
		set gutPic NARMJIB2
		set gutAng 512
		state GutSlow
			
		guts JIBS6 3
		guts JIBS3 2
		state random_wall_jibs
		sound SQUISHED
	}
  }
  else ifaction AFLIZLEG
  {
	ifactioncount 4
	{
		iffloordistl 8
		  sound THUD
		move LIZSTOP
		action AFLIZLEGDEAD
		state random_wall_jibs
		guts JIBS6 3
	}
	else ifactioncount 3
	ife actioncheck 1
	{
		set actioncheck 2
		
		set gutPic NLEGJIB2
		set gutAng 1024
		state GutSlow
			
		guts JIBS6 1
		state random_wall_jibs
		sound SQUISHED
	}
	else ifactioncount 2
	ife actioncheck 0
	{
		set actioncheck 1
		
		set gutPic NARMJIB2
		set gutAng 512
		state GutSlow
			
		guts JIBS6 3
		guts JIBS3 2
		state random_wall_jibs
		sound SQUISHED
	}
  }
  else
    ifaction ALIZMANTORSODEAD
  {
    action 0
	cactor LIZMANTORSODEAD
  
    strength 0
    ifhitweapon
      ifwasweapon RADIUSEXPLOSION
    {
      sound SQUISHED
      state standard_jibs
      killit
    }
    ifcount RESPAWNACTORTIME
      ifrespawn
    {
      spawn TRANSPORTERSTAR
      cstat 257
      strength LIZSTRENGTH
      ai AILIZGETENEMY
    }
  }
  else
    ifaction ALIZLYINGDEAD
  {
    action 0
	ifactor LIZMAN
		cactor LIZMANDEADSPRITE
	else ifactor FLAMEENFORCER
		cactor FLAMEENFORCERDEAD
	else ifactor ELITEENFORCER
		cactor ELITEENFORCERDEAD
  
    strength 0
    ifhitweapon
      ifwasweapon RADIUSEXPLOSION
    {
      sound SQUISHED
      state standard_jibs
      killit
    }
    ifcount RESPAWNACTORTIME
      ifrespawn
    {
      spawn TRANSPORTERSTAR
      cstat 257
      strength LIZSTRENGTH
      ai AILIZGETENEMY
    }
  }
  else
    ifaction AFLIZARM1DEAD
  {
    action 0
	cactor ENFORCERARMLESS
  
    strength 0
    ifhitweapon
      ifwasweapon RADIUSEXPLOSION
    {
      sound SQUISHED
      state standard_jibs
      killit
    }
  }
  else
    ifaction AFLIZARM1DEAD2
  {
    action 0
	cactor FLAMEENFORCERARMLESS
  
    strength 0
    ifhitweapon
      ifwasweapon RADIUSEXPLOSION
    {
      sound SQUISHED
      state standard_jibs
      killit
    }
  }
  else
    ifaction AFLIZARM2DEAD
  {
    action 0
	cactor ENFORCERNOARMS
  
    strength 0
    ifhitweapon
      ifwasweapon RADIUSEXPLOSION
    {
      sound SQUISHED
      state standard_jibs
      killit
    }
  }
  else
    ifaction AFLIZLEGDEAD
  {
    action 0
	cactor ENFORCERNOARMS
  
    strength 0
    ifhitweapon
      ifwasweapon RADIUSEXPLOSION
    {
      sound SQUISHED
      state standard_jibs
      killit
    }
  }
  else
    ifai AILIZDYING
	 ifaction ALIZDYING
	 {
      ifactioncount 6
	  {
		iffloordistl 8
		  sound THUD
		move LIZSTOP
		action ALIZLYINGDEAD
	  }
	  else ifactioncount 4
	  ife actioncheck 0
	  {
		guts JIBS2 1
		set actioncheck 1
	  }
  }
ends

state lizdodgestate
  ifcount 13
    ai AILIZGETENEMY
ends

actor LIZMANSTAYPUT LIZSTRENGTH ai AILIZGETENEMY cactor LIZMAN enda
actor LIZMANSPITTING LIZSTRENGTH ai AILIZSPIT cactor LIZMAN enda
actor LIZMANJUMP LIZSTRENGTH ai AILIZJUMPENEMY cactor LIZMAN enda

state lizcode
  state checksquished
  ifai 0
    ai AILIZGETENEMY
  else
    ifaction ALIZLYINGDEAD
  {
    fall
    state lizdyingstate
    break
  }
   else
    ifaction ALIZTORSODEAD
  {
    fall
    state lizdyingstate
    break
  }
  else
    ifaction ALIZFROZEN
  {
    ifcount THAWTIME
    {
      ai AILIZGETENEMY
      getlastpal
    }
    else
      ifcount FROZENDRIPTIME
    {
      ifactioncount 26
      {
        spawn WATERDRIP
        resetactioncount
      }
    }

    ifhitweapon
    {
      ifwasweapon FREEZEBLAST
      {
        strength 0
        break
      }
      addkills 1

      ifrnd 84
        spawn BLOODPOOL
      lotsofglass 30
      sound GLASS_BREAKING
      killit
    }
    ifp pfacing
      ifpdistl FROZENQUICKKICKDIST
        pkick
    break
  }
  else
    ifai AILIZJUMPENEMY
      state lizjumpstate
  else
  {
    fall
	ifai AILIZBEGHEAD
	{
		cstat 0
		ifactioncount 3
			action ALIZNOHEADDEAD
	}
	else
	  ifai AILIZTORSO
		state lizdyingstate
	else
      ifai AILIZGETENEMY
      state lizseekstate
    else
      ifai AILIZCHARGEENEMY
        state lizseekstate
    else
      ifai AILIZDODGE
        state lizdodgestate
    else
      ifai AILIZSHOOTENEMY
        state lizshootstate
	else
      ifai AILIZFLAMESHOOTENEMY
        state lizshootstate
	else
      ifai AILIZELITESHOOTENEMY
        state lizshootstate
    else
      ifai AILIZFLEENEMY
        state lizfleestate
    else
      ifai AILIZTHINK
        state lizthinkstate
    else
      ifai AILIZSHRUNK
        state lizshrunkstate
    else
      ifai AILIZGROW
        state genericgrowcode
    else
      ifai AILIZDYING
        state lizdyingstate
    else
      ifai AILIZSPIT
    {
      ifcount 26
        ai AILIZGETENEMY
      else
        ifcount 18
          ifrnd 96
      {
        shoot SPIT
        sound LIZARD_SPIT
      }
    }
  }

  ifai AILIZSHRUNK
    break
  ifhitweapon
    state checklizhit
ends

actor LIZMAN LIZSTRENGTH
  fall
  
   ifdead nullop
  else ifg a_plasmaeffect 0
	{
		ifrnd 64
			ai AILIZFLEENEMY
	}
  
  state lizcode
enda

include scripts/enemies/feenforcer.con




action DRONEFRAMES   0   1   7   1   1
action DRONESCREAM   0   1   7   1   1
move DRONERUNVELS 128 64
move DRONERUNUPVELS 128 -64
move DRONEBULLVELS 252 -64
move DRONEBACKWARDS -64 -64
move DRONERISE 32 -32
move DRONESTOPPED -16

ai AIDRONEGETE DRONESCREAM DRONERUNVELS faceplayerslow getv
ai AIDRONEWAIT DRONEFRAMES DRONESTOPPED faceplayerslow
ai AIDRONEGETUP DRONESCREAM DRONERUNUPVELS faceplayer getv
ai AIDRONEPULLBACK DRONEFRAMES DRONEBACKWARDS faceplayerslow
ai AIDRONEHIT DRONESCREAM DRONEBACKWARDS faceplayer
ai AIDRONESHRUNK DRONEFRAMES SHRUNKVELS fleeenemy
ai AIDRONEDODGE DRONEFRAMES DRONEBULLVELS dodgebullet geth
ai AIDRONEDODGEUP DRONEFRAMES DRONERISE getv geth

state dronedead
  addkills 1
  debris SCRAP1 8
  debris SCRAP2 4
  debris SCRAP3 7
  spawn EXPLOSION2
  sound RPG_EXPLODE
  hitradius 2048 10 15 20 20
  killit
ends

state checkdronehitstate

  ifdead state dronedead
  else ifsquished state dronedead
  else
  {
    ifwasweapon PLASMAPROJ
		set a_plasmaeffect 1
		
    sound DRON_PAIN
    ifbulletnear
    {
      ifceilingdistl 64
        ifrnd 48
          ai AIDRONEDODGE
      ai AIDRONEDODGEUP
    }
    else
      ai AIDRONEGETE
  }
ends

state droneshrunkstate
  ifcount 24
    killit
  else
    sizeto 1 1
ends

state checkdronenearplayer

  ifp palive
   ifcansee
    ifpdistl 1596
  {
    ifcount 8
    {
      addkills 1
      sound DRON_ATTACK2
      debris SCRAP1 8
      debris SCRAP2 4
      debris SCRAP3 7
      spawn EXPLOSION2
      sound RPG_EXPLODE
      hitradius 2048 15 20 25 30
      killit
    }
    else
      ifcount 3 nullop
      else
        sound LASERTRIP_ARMING
  }

ends

state dronegetstate
  ifrnd 192
  {
    ifcansee
    {
      ifbulletnear
      {
        ai AIDRONEDODGE
        break
      }
      ifmove DRONEBULLVELS
      {
        ifcount 64
          ai AIDRONEPULLBACK
        else
          ifnotmoving
            ifcount 16
              ai AIDRONEPULLBACK
      }
      else
        ifcount 32
      {
        ifp phigher
          move DRONEBULLVELS geth getv
        else
          move DRONEBULLVELS geth
      }
    }
    else
      ifrnd 1
        operate
  }
ends

state dronedodgestate
  ifai AIDRONEDODGEUP
  {
     ifcount 8
       ai AIDRONEGETE
     else
       ifnotmoving
         ai AIDRONEGETE
  }
  else
  {
    ifcount 8
      ai AIDRONEGETE
    else
      ifnotmoving
        ai AIDRONEGETE
  }
ends

actor DRONE DRONESTRENGTH
  state checkdronenearplayer

 ifdead nullop
  else ifg a_plasmaeffect 0
	{
		ifrnd 64
			ai AIDRONEWAIT
	}

  ifrnd 2
    fall
  else
    soundonce DRON_JETSND

  ifaction 0
    ai AIDRONEGETE

  else
    ifai AIDRONEWAIT
  {
    ifactioncount 4
      ifrnd 16
        ifcansee
    {
      sound DRON_ATTACK1
      ifp phigher
        ai AIDRONEGETUP
      else ai AIDRONEGETE
    }
  }
  else
    ifai AIDRONEGETE
      state dronegetstate
  else
    ifai AIDRONEGETUP
      state dronegetstate
  else
    ifai AIDRONEPULLBACK
  {
    ifcount 32
    ai AIDRONEWAIT
  }
  else
    ifai AIDRONEHIT
  {
    ifcount 8
      ai AIDRONEWAIT
  }
  else
    ifai AIDRONESHRUNK
      state droneshrunkstate
  else
    ifai AIDRONEDODGE
      state dronedodgestate
  else
    ifai AIDRONEDODGEUP
      state dronedodgestate

  ifhitweapon
    state checkdronehitstate

  ifrnd 1
    soundonce DRON_ROAM

enda



action AOCTAWALK    0   3   5   1   15
action AOCTASTAND     0   1   5   1   15
action AOCTASCRATCH   0   4   5   1   15
action AOCTAHIT    30   1   1   1   10
action AOCTASHOOT    20   1   5   1   10
action AOCTADYING    30   8   1   1   17
action AOCTADEAD     38   1   1   1  1
action AOCTAFROZEN    0   1   5
action AOCTAHEADLESS 1908 5 1 1 30
action AOCTAHEADLESSDEAD 1912 1
action AOCTAHACKED 40 8 1 1 20
action AOCTAHACKED2 -17 6 1 1 22

move OCTAWALKVELS 96 -30
move OCTAUPVELS 96 -70
move OCTASTOPPED 0 -30
move OCTAINWATER 96 24

ai AIOCTAGETENEMY AOCTAWALK OCTAWALKVELS seekplayer
ai AIOCTASHOOTENEMY AOCTASHOOT OCTASTOPPED faceplayer
ai AIOCTASCRATCHENEMY AOCTASCRATCH OCTASTOPPED faceplayerslow
ai AIOCTAHIT AOCTAHIT OCTASTOPPED faceplayer
ai AIOCTASHRUNK AOCTAWALK SHRUNKVELS faceplayer
ai AIOCTAGROW AOCTASTAND OCTASTOPPED faceplayerslow
ai AIOCTADYING AOCTADYING OCTASTOPPED faceplayer
ai AIOCTADYING2 AOCTADYING OCTASTOPPED faceplayer

state octagetenemystate

  ifcansee
  {
    ifactioncount 32
    {
      ifrnd 48
        ifcanshoottarget
      {
        sound OCTA_ATTACK1
        ai AIOCTASHOOTENEMY
        break
      }
    }
    else
      ifpdistl 1280
        ai AIOCTASCRATCHENEMY
  }

ends

state octascratchenemystate
  ifpdistg 1280
    ai AIOCTAGETENEMY
  else
    ifcount 32
  {
    resetcount
    sound OCTA_ATTACK2
    palfrom 8 32
    addphealth OCTASCRATCHINGPLAYER
  }
ends

state octashootenemystate
  ifcount 25
  {
    ifcount 27
      ai AIOCTAGETENEMY
  }
  else
    ifcount 24
      shoot COOLEXPLOSION1
  else
    ifactioncount 6
      resetactioncount
ends

state checkoctahitstate
  ifwasweapon SHRINKSPARK
  {
    sound ACTOR_SHRINKING
    ai AIOCTASHRUNK
  }
  else
  {
    ifdead
    {
      state drop_cola

      ifwasweapon FREEZEBLAST
      {
        sound SOMETHINGFROZE
        spritepal 1
        move 0
        action AOCTAFROZEN
        strength 0
        break
      }

	  addkills 1

	  ifwasweapon CATERKILAR
	  {
			ifai AIOCTADYING2
				nullop
			else
			{
				state octa_1jib
				state rf
				ai AIOCTADYING2
				
				ifrnd 96
					action AOCTAHEADLESS
				else ifrnd 96
					action AOCTADYING
				else ifrnd 96
					action AOCTAHACKED2
				else
					action AOCTAHACKED
			}
			
			break
	  }

      ifwasweapon RPG
      {
        sound SQUISHED
        state standard_jibs
		state octa_jibs
        killit
      }
      else
        ifwasweapon RADIUSEXPLOSION
      {
        sound SQUISHED
        state standard_jibs
		state octa_jibs
        killit
      }
      else
	  ifwasweapon PLASMAPROJ
      {
        sound SQUISHED
        state standard_jibs
		state octa_jibs
        killit
      } else
        ifwasweapon GROWSPARK
      {
        cstat 0
        sound ACTOR_GROWING
        ai AIOCTAGROW
        break
      }
      else
      {
		ifwasweapon FLAMEPROJ
			state genericburn_dead_code
			
        state rf
        ai AIOCTADYING
      }
      sound OCTA_DYING
    }
    else
    {
	  ifwasweapon PLASMAPROJ
		set a_plasmaeffect 1
	   else	
	    ifwasweapon CATERKILAR
		{
			ifrnd 32
				state SpawnShards2
				
			ai AIOCTAHIT
		}
	  else
      ifwasweapon ROCKETPROJ
      {
        sound OCTA_DYING
        addkills 1
        state standard_jibs
		state octa_jibs
        killit
      }
	  else ifwasweapon RPG
      {
        sound SQUISHED
        state standard_jibs
		state octa_jibs
        killit
      }
      else
        ifwasweapon GROWSPARK
          sound EXPANDERHIT
	  else	  
	  ifwasweapon FLAMEPROJ
			set a_flaming 1

      sound OCTA_PAIN
      spawn BLOOD
      ifrnd 64
        ai AIOCTAHIT
    }
  }
  state random_wall_jibs
ends

state octashrunkstate
  ifcount SHRUNKDONECOUNT
    ai AILIZGETENEMY
  else
    ifcount SHRUNKCOUNT
      sizeto 40 40
  else
    state genericshrunkcode
ends


state octadyingstate

  ifai AIOCTADYING2
  {
	ifaction AOCTAHACKED
	{
		cstat 0
		ifcount 16
		{
			guts JIBS6 2
			state random_wall_jibs
			guts JIBS3 1
			sound SQUISHED
			resetcount
		}
		
		ifactioncount 8
		{
			action 0
			cactor OCTAHACKED
			sound THUD
			state SpawnShards
			spawn BLOODPOOL
			break
		}
	}
	else ifaction AOCTAHACKED2
	{
		cstat 0
		ifcount 16
		{
			guts JIBS6 2
			state random_wall_jibs
			guts JIBS3 1
			sound SQUISHED
			resetcount
		}
		
		ifactioncount 6
		{
			state SpawnShards
			action 0
			cactor OCTAHACKED2
			sound THUD
			state SpawnShards
			spawn BLOODPOOL
			break
		}
	}
	else
	{
		ifcount 5
		{
			guts JIBS6 2
			resetcount
		}
	
		ifactioncount 5
		ife actioncheck 5
		{
			set actioncheck 8
			sound SQUISHED
			state octa_1jib
			state random_wall_jibs
			guts JIBS6 2
			
			state random_wall_jibs
			state SpawnShards
			
			ifaction AOCTAHEADLESS
			{
				action AOCTAHEADLESSDEAD
				spawn BLOODPOOL
				move OCTASTOPPED
				break
			}
			else
			{
				state standard_jibs
				killit
			}
		}
		else ifactioncount 4
		ife actioncheck 4
		{
			set actioncheck 5
			sound SQUISHED
			state octa_1jib
			state random_wall_jibs
			guts JIBS6 2
		}
		else ifactioncount 3
		ife actioncheck 3
		{
			set actioncheck 4
			
			ifaction AOCTAHEADLESS
			{
				state octa_headjib
				sound SQUISHED
			
			}
			state random_wall_jibs
			guts JIBS6 2
		}
		else ifactioncount 2
		ife actioncheck 0
		{
			set actioncheck 3
			sound SQUISHED
			state octa_1jib
			state random_wall_jibs
			guts JIBS6 2
		}
	}
  }

  ifactioncount 8
  {
    ifrnd 64
      spawn BLOODPOOL
    move OCTASTOPPED
    action AOCTADEAD
    break
  }
  else
    ifactioncount 5 nullop
  else
    ifactioncount 4
      iffloordistl 8
        sound THUD
ends

actor OCTABRAINSTAYPUT OCTASTRENGTH
  ai AIOCTAGETENEMY
  cactor OCTABRAIN
enda

actor OCTABRAIN OCTASTRENGTH
  fall
  state checksquished
  
  ifdead nullop
  else ifg a_plasmaeffect 0
	{
		ifrnd 64
			ai AIOCTAHIT
	}
  
  ifai 0
    ai AIOCTAGETENEMY
  else
    ifaction AOCTADEAD
  {
    action 0
	cactor OCTADEADSPRITE
  
    strength 0
    ifcount RESPAWNACTORTIME
      ifrespawn
    {
      addkills -1
      spawn TRANSPORTERSTAR
      cstat 257
      strength OCTASTRENGTH
      ai AIOCTAGETENEMY
    }
    ifhitweapon
      ifwasweapon RADIUSEXPLOSION
    {
      state standard_jibs
      killit
    }
    break
  }
  else
    ifaction AOCTAHEADLESSDEAD
  {
    action 0
	cactor OCTAHEADLESS
  
    strength 0
    ifhitweapon
      ifwasweapon RADIUSEXPLOSION
    {
      state standard_jibs
      killit
    }
    break
  }
  else ifaction AOCTAFROZEN
  {
    ifcount THAWTIME
    {
      ai AIOCTAGETENEMY
      getlastpal
    }
    else
      ifcount FROZENDRIPTIME
      {
        ifactioncount 26
        {
          spawn WATERDRIP
          resetactioncount
        }
      }

    ifhitweapon
    {
      addkills 1
      ifwasweapon FREEZEBLAST
      {
        strength 0
        break
      }

      lotsofglass 30
      ifrnd 84
        spawn BLOODPOOL
      sound GLASS_BREAKING
      killit
    }
    ifp pfacing
      ifpdistl FROZENQUICKKICKDIST
        pkick
    break
  }
  else
  {
    ifrnd 1
      soundonce OCTA_ROAM

    ifai AIOCTAGETENEMY
      state octagetenemystate
    else
      ifai AIOCTAHIT
      {
        ifcount 8
          ai AIOCTASHOOTENEMY
      }
    else
      ifai AIOCTADYING
      {
        state octadyingstate
        break
      }
	else
      ifai AIOCTADYING2
      {
        state octadyingstate
        break
      }
    else
      ifai AIOCTASCRATCHENEMY
        state octascratchenemystate
    else
      ifai AIOCTASHOOTENEMY
        state octashootenemystate
    else
      ifai AIOCTASHRUNK
      {
        state octashrunkstate
        break
      }
    else
      ifai AIOCTAGROW
        state genericgrowcode

    ifmove OCTAUPVELS nullop
    else
      ifp phigher
        move OCTAUPVELS seekplayer
    else
      ifmove OCTAINWATER nullop
      else
        ifinwater
          move OCTAINWATER seekplayer

    ifhitweapon
      state checkoctahitstate
  }
enda

action APIGWALK     0  4 5 1 20
action APIGRUN      0  4 5 1 11
action APIGSHOOT    30 2 5 1 58
action AELITEPIGSHOOT    30 2 5 1 25
action APIGCOCK     25 1 5 1 16
action APIGSTAND    30 1 5 1 1
action APIGDIVE     40 2 5 1 40
action APIGDIVESHOOT  45 2 5 1 58
action AELITEDIVEPIGSHOOT 45 2 5 1 25
action APIGDYING    55 5 1 1 15
action APIGHIT      55 1 1 1 10
action APIGDEAD     60 1 1 1 1
action APIGFROZEN    0 1 5
action APIGGROW      0
action APIGLIMBLESSTORSO 1665 5 1 1 20
action APIGTORSO 1669 1 1 1 1
action APIGLOSINGLIMBS 1670 6 1 1 20
action APIGLOSINGLIMBS2 1676 2 1 1 40
action APIGHEADLESS 1630 5 1 1 20
action APIGHEADLESSDEAD 1635 1 1
action APIGHACKED 80 9 1 1 18

action AELITEPIGLIMBLESSTORSO -2025 5 1 1 15
action AELITEPIGTORSO -2021 1
action AELITEPIGLOSINGLIMBS -1870 6 1 1 20
action AELITEPIGLOSINGLIMBS2 -1864 2 1 1 40

action ADPIGLIMBLESSTORSO -1767 5 1 1 20
action ADPIGTORSO -1763 1
action ADPIGLOSINGLIMBS -1762 6 1 1 20
action ADPIGLOSINGLIMBS2 -1756 2 1 1 40
action ADPIGHEADLESS -1802 5 1 1 20
action ADPIGHEADLESSDEAD -1807 1 1


move PIGWALKVELS 72
move PIGRUNVELS 108
move PIGSTOPPED

ai AIPIGSEEKENEMY APIGWALK PIGWALKVELS seekplayer
ai AIPIGSHOOTENEMY APIGSHOOT PIGSTOPPED faceplayer
ai AIPIGFLEEENEMY APIGWALK PIGWALKVELS fleeenemy
ai AIPIGSHOOT APIGSHOOT PIGSTOPPED faceplayer
ai AIPIGDODGE APIGRUN PIGRUNVELS dodgebullet
ai AIPIGCHARGE APIGRUN PIGRUNVELS seekplayer
ai AIPIGDIVING APIGDIVE PIGSTOPPED faceplayer
ai AIPIGDYING APIGDYING PIGSTOPPED faceplayer
ai AIPIGSHRINK APIGWALK SHRUNKVELS fleeenemy
ai AIPIGGROW APIGGROW PIGSTOPPED faceplayerslow
ai AIPIGHIT APIGHIT PIGSTOPPED faceplayer
ai AIPIGLIMBLESSTORSO APIGLIMBLESSTORSO PIGSTOPPED faceplayer
ai AIPIGLOSINGLIMBS APIGLOSINGLIMBS PIGSTOPPED faceplayer
ai AIPIGHACKED APIGHACKED PIGSTOPPED faceplayer

ai AIDPIGLIMBLESSTORSO ADPIGLIMBLESSTORSO PIGSTOPPED faceplayer
ai AIDPIGLOSINGLIMBS ADPIGLOSINGLIMBS PIGSTOPPED faceplayer

ai AIELITEPIGLIMBLESSTORSO AELITEPIGLIMBLESSTORSO PIGSTOPPED faceplayer
ai AIELITEPIGLOSINGLIMBS AELITEPIGLOSINGLIMBS PIGSTOPPED faceplayer

state pigseekenemystate

  ifai AIPIGCHARGE
  {
    ifcansee
      ifpdistl 3084
    {
      ifnotmoving
        ai AIPIGSEEKENEMY
      else
        ai AIPIGDIVING
    }
    break
  }
  else iffloordistl 32
  {
    ifpdistg 4096
    {
      ifactornotstayput
      ai AIPIGCHARGE
    }
    ifrnd 8
    {
      ifbulletnear
        ai AIPIGDODGE
    }
  }

  ifrnd 128
    ifcansee
  {
    ifai AIPIGDODGE
    {
      ifcount 32
        ai AIPIGCHARGE
          break
    }
    iffloordistl 32
    {
      ifpdistl 1024
        ifp palive
          ifcanshoottarget
      {
        ai AIPIGSHOOTENEMY
		ife userdef.player_skill 6
			move PIGSTOPPED faceplayersmart
        break
      }
      ifcount 48
      {
        ifrnd 8
          ifp palive
            ifcanshoottarget
        {
          ifrnd 192
            ai AIPIGSHOOTENEMY
          else
            ai AIPIGDIVING
			
		ife userdef.player_skill 6
			move PIGSTOPPED faceplayersmart
          break
        }
      }
    }
  }
ends


state pigshootenemystate
//  ifcansee
   ifactor ELITEPIGCOP
     ifaction APIGSHOOT
		action AELITEPIGSHOOT
		
		
  ifaction AELITEPIGSHOOT
  {
		ifcanseetarget
		ifcanshoottarget
		{
			ifactioncount 2
			{
				sound SHOTGUN_FIRE
				state ShootShotgun
				state ShootShotgun
				espawn SHOTGUNSHELL
	
				geta[].ang atemp
				add atemp 512
				seta[RETURN].ang atemp
				resetactioncount
			}
		}
		else
			ai AIPIGSEEKENEMY
  }
  else ifcanseetarget	
  {
    ifcount 12 nullop
    else
      ifcount 11
    {
      ifcanshoottarget
      {
		  ifactor DPIGCOP
		  {
			sound SHOTGUN_FIRE
			  state ShootShotgun
			  state ShootShotgun
			  state ShootShotgun
			  	espawn SHOTGUNSHELL
	
				geta[].ang atemp
				add atemp 512
				seta[RETURN].ang atemp
		  }
		  else
		  {
			sound SHOTGUNBETA_FIRE
			state ShootSpark
			state ShootSpark
			state ShootSpark
			state ShootSpark
			state ShootSpark
			
			espawn SHOTGUNSHELL
	
				geta[].ang atemp
				add atemp 512
				seta[RETURN].ang atemp
		  }
      }
      else
        ai AIPIGSEEKENEMY
    }
    ifcount 25 nullop
    else
      ifcount 24
      {
        action APIGCOCK
        sound SHOTGUN_COCK
      }
    ifcount 48 nullop
    else
      ifcount 47
    {
      ifcanshoottarget
      {
        ifactor DPIGCOP
		  {
			sound SHOTGUN_FIRE
			  state ShootShotgun
			  state ShootShotgun
			  state ShootShotgun
			  
			  espawn SHOTGUNSHELL
	
				geta[].ang atemp
				add atemp 512
				seta[RETURN].ang atemp
		  }
		  else
		  {
			sound SHOTGUNBETA_FIRE
			state ShootSpark
			state ShootSpark
			state ShootSpark
			state ShootSpark
			state ShootSpark
			
			espawn SHOTGUNSHELL
	
				geta[].ang atemp
				add atemp 512
				seta[RETURN].ang atemp
		  }
      }
      else
        ai AIPIGSEEKENEMY
    }
    ifcount 60 nullop
    else
      ifcount 59
      {
        action APIGCOCK
        sound SHOTGUN_COCK
      }
    ifcount 72
    {
      ifrnd 64
        resetcount
      else
      {
        ifpdistl 768
          ai AIPIGFLEEENEMY
        else
          ai AIPIGSEEKENEMY
      }
    }
    ifaction APIGCOCK
      ifactioncount 2
        action APIGSHOOT
  }
  else
    ai AIPIGSEEKENEMY
ends

state pigfleeenemystate
  ifactioncount 8
    ai AIPIGSEEKENEMY
  else
    ifnotmoving
      ai AIPIGSEEKENEMY
ends

state pigdivestate
   ifactor ELITEPIGCOP
     ifaction APIGDIVESHOOT
		action AELITEDIVEPIGSHOOT
		
  ifaction AELITEDIVEPIGSHOOT
  {
		ifcanseetarget
		ifcanshoottarget
		{
			ifactioncount 2
			{
				sound SHOTGUN_FIRE
				state ShootShotgun
				
				espawn SHOTGUNSHELL
	
				geta[].ang atemp
				add atemp 512
				seta[RETURN].ang atemp
				resetactioncount
			}
		}
		else
			ai AIPIGSEEKENEMY
  }
  else ifaction APIGDIVESHOOT
  {
    ifcansee
    {
      ifcount 12 nullop
      else
        ifcount 11
      {
        ifcanshoottarget
        {
          ifactor DPIGCOP
		  {
			sound SHOTGUN_FIRE
			  state ShootShotgun
			  state ShootShotgun
			  state ShootShotgun
			  
			  espawn SHOTGUNSHELL
	
				geta[].ang atemp
				add atemp 512
				seta[RETURN].ang atemp
		  }
		  else ifactor ELITEPIGCOP
		  {
			sound SHOTGUN_FIRE
			  state ShootShotgun
			  
			  espawn SHOTGUNSHELL
	
				geta[].ang atemp
				add atemp 512
				seta[RETURN].ang atemp
			  //resetcount
		  }
		  else
		  {
			sound SHOTGUNBETA_FIRE
			state ShootSpark
			state ShootSpark
			state ShootSpark
			state ShootSpark
			state ShootSpark
			
			espawn SHOTGUNSHELL
	
				geta[].ang atemp
				add atemp 512
				seta[RETURN].ang atemp
		  }
        }
        else
          ai AIPIGSEEKENEMY
      }
      ifcount 25 nullop
      else
        ifcount 24
          sound SHOTGUN_COCK
      ifcount 48 nullop
      else
        ifcount 47
      {
        ifcanshoottarget
        {
          ifactor DPIGCOP
		  {
			sound SHOTGUN_FIRE
			  state ShootShotgun
			  state ShootShotgun
			  state ShootShotgun
		  }
		  else ifactor ELITEPIGCOP
		  {
			sound SHOTGUN_FIRE
			 state ShootShotgun
			  resetcount
		  }
		  else
		  {
			sound SHOTGUNBETA_FIRE
			state ShootSpark
			state ShootSpark
			state ShootSpark
			state ShootSpark
			state ShootSpark
		  }
        }
        else
          ai AIPIGSEEKENEMY
      }
      ifcount 60 nullop
      else
        ifcount 59
      {
        sound SHOTGUN_COCK
        ifgapzl 32
          ai AIPIGDIVING
        else
        {
          ifpdistl 4096
            ai AIPIGFLEEENEMY
          else
            ai AIPIGSEEKENEMY
        }
      }
    }
    else
      ifgapzl 32
        ai AIPIGDIVING
      else
        ai AIPIGSEEKENEMY
  }
  else
    ifactioncount 2
    ifp palive
    {
      resetcount
      action APIGDIVESHOOT
    }
ends

state checkpighitstate
  spawn BLOOD
  ifdead
  {
    state random_wall_jibs
    ifrnd 16
      spawn SHIELD
    else
      state drop_shotgun

    ifwasweapon GROWSPARK
    {
      sound ACTOR_GROWING
      ai AIPIGGROW
      break
    }

    addkills 1
	
	
		ifwasweapon CATERKILAR
		{
			ifai AIPIGLOSINGLIMBS
				nullop
			else ifai AIDPIGLOSINGLIMBS
				nullop
			else ifai AIELITEPIGLOSINGLIMBS
				nullop
			else ifai AIPIGHACKED
				nullop
			else
			{
				ifrnd 96
				{
					ifactor PIGCOP
					{
						ai AIPIGLOSINGLIMBS
						
						ifrnd 96
						{
							action APIGHEADLESS
							state SpawnShards
							
							state random_wall_jibs
							state random_wall_jibs
							
							espawn PIGHEAD
							seta[RETURN].yvel 1
							
							guts JIBS6 2
							
							ifrnd 192
								guts JIBS2 1
							
							ifrnd 96
								guts JIBS3 2
							
							sound SQUISHED
						}
						else ifrnd 96
						{
							action APIGLOSINGLIMBS2
							state SpawnShards
								
							guts JIBS3 5
							guts JIBS1 2
							guts JIBS4 2
							
							ifrnd 128
							{
								set gutPic PIGARM2
								set gutAng -512
								state GutSlow
							}
							
							ifrnd 128
							{
								set gutPic PIGARM1
								set gutAng 512
								state GutSlow
							}
							
							seta[RETURN].yvel 1
							
							state random_wall_jibs
							state random_wall_jibs
							
							espawn PIGHEAD
							seta[RETURN].yvel 1
							
							guts JIBS6 2
							
							ifrnd 192
								guts JIBS2 1
							
							ifrnd 96
								guts JIBS3 2
							
							sound SQUISHED
						}
					}
					else ifactor ELITEPIGCOP
					{
						ai AIELITEPIGLOSINGLIMBS
						
						ifrnd 96
						{
							action AELITEPIGLIMBLESSTORSO
							state SpawnShards
						}
					}
					else
					{
						ai AIDPIGLOSINGLIMBS
						
						ifrnd 96
						{
							action ADPIGHEADLESS
							state SpawnShards
							
							state random_wall_jibs
							state random_wall_jibs
							
							espawn PIGHEAD
							seta[RETURN].yvel 1
							
							guts JIBS6 2
							
							ifrnd 192
								guts JIBS2 1
							
							ifrnd 96
								guts JIBS3 2
							
							sound SQUISHED
						}
						else ifrnd 96
						{
							action ADPIGLOSINGLIMBS2
							state SpawnShards
								
							guts JIBS3 5
							guts JIBS1 2
							guts JIBS4 2
							
							ifrnd 128
							{
								set gutPic PIGARM2
								set gutAng -512
								state GutSlow
							}
							
							ifrnd 128
							{
								set gutPic PIGARM1
								set gutAng 512
								state GutSlow
							}
							
							seta[RETURN].yvel 1
							
							state random_wall_jibs
							state random_wall_jibs
							
							espawn PIGHEAD
							seta[RETURN].yvel 1
							
							guts JIBS6 2
							
							ifrnd 192
								guts JIBS2 1
							
							ifrnd 96
								guts JIBS3 2
							
							sound SQUISHED
						}
					}
				}
				else
				{
					seta[].picnum PIGCOP
					ai AIPIGHACKED
					
					set gutPic PIGARM1
					set gutAng 512
					state GutSlow
					
					state random_wall_jibs
					state random_wall_jibs
					
					guts JIBS6 2
							
					ifrnd 96
						guts JIBS3 2
							
					sound SQUISHED
				}
			}
				
			break
		}
	
    ifwasweapon FREEZEBLAST
    {
      sound SOMETHINGFROZE
      spritepal 1
      move 0
      action APIGFROZEN
      strength 0
      break
    }
	ifwasweapon ROCKETPROJ
	  {
	    ifrnd 64
		{
			strength 0
			ifactor ELITEPIGCOP
			{
				ai AIELITEPIGLOSINGLIMBS
				action AELITEPIGLOSINGLIMBS2
				
				guts JIBS3 5
						guts JIBS1 2
						guts JIBS4 2
						
						ifrnd 128
						{
							set gutPic PIGARM2
							set gutAng -512
							state GutSlow
						}
						
						ifrnd 128
						{
							set gutPic PIGARM1
							set gutAng 512
							state GutSlow
						}
						
						seta[RETURN].yvel 1
						
						state random_wall_jibs
						state random_wall_jibs
						
						espawn PIGHEAD
						seta[RETURN].yvel 1
						
						guts JIBS6 2
						
						ifrnd 192
							guts JIBS2 1
						
						ifrnd 96
							guts JIBS3 2
						
						sound SQUISHED
			}
			else ifactor DPIGCOP
			{
				ai AIDPIGLOSINGLIMBS
				action ADPIGLOSINGLIMBS2
				
				guts JIBS3 5
						guts JIBS1 2
						guts JIBS4 2
						
						ifrnd 128
						{
							set gutPic PIGARM2
							set gutAng -512
							state GutSlow
						}
						
						ifrnd 128
						{
							set gutPic PIGARM1
							set gutAng 512
							state GutSlow
						}
						
						seta[RETURN].yvel 1
						
						state random_wall_jibs
						state random_wall_jibs
						
						espawn PIGHEAD
						seta[RETURN].yvel 1
						
						guts JIBS6 2
						
						ifrnd 192
							guts JIBS2 1
						
						ifrnd 96
							guts JIBS3 2
						
						sound SQUISHED
			}
			else
			{
				ai AIPIGLOSINGLIMBS
				action APIGLOSINGLIMBS2
				
				guts JIBS3 5
						guts JIBS1 2
						guts JIBS4 2
						
						ifrnd 128
						{
							set gutPic PIGARM2
							set gutAng -512
							state GutSlow
						}
						
						ifrnd 128
						{
							set gutPic PIGARM1
							set gutAng 512
							state GutSlow
						}
						
						seta[RETURN].yvel 1
						
						state random_wall_jibs
						state random_wall_jibs
						
						espawn PIGHEAD
						seta[RETURN].yvel 1
						
						guts JIBS6 2
						
						ifrnd 192
							guts JIBS2 1
						
						ifrnd 96
							guts JIBS3 2
						
						sound SQUISHED
			}
		}
		else
		{
			sound SQUISHED
			state standard_jibs
			state pig_jibs
			killit
		}
	  }
    else ifwasweapon RADIUSEXPLOSION
    {
      ifrnd 64
		{
			strength 0
			ifactor ELITEPIGCOP
				ai AIELITEPIGLOSINGLIMBS
			else ifactor DPIGCOP
				ai AIDPIGLOSINGLIMBS
			else
				ai AIPIGLOSINGLIMBS
				
			seta[].htg_t 3 3
			seta[].htg_t 2 3
			set actioncheck 3
				
			set noshards 1
			break
		}
		else
		{
			sound SQUISHED
			state standard_jibs
			state pig_jibs
			killit
		}
    }
    else ifwasweapon PLASMAPROJ
    {
      sound SQUISHED
      state standard_jibs
	  state pig_jibs
      killit
    }
    else
      ifwasweapon RPG
    {
      sound SQUISHED
      state standard_jibs
	  state pig_jibs
      killit
    }
    else
	{
	  ifwasweapon FLAMEPROJ
		state genericburn_dead_code
	
      ai AIPIGDYING
        sound PIG_DYING
	}
  }
  else
  {
    sound PIG_PAIN
    state random_wall_jibs
	
	ifactor ELITEPIGCOP
	{
		debris SCRAP4 1
		
		ifwasweapon RPG
		{
			ifrnd 72
			{
				strength 0
				ai AIELITEPIGLOSINGLIMBS
				
				seta[].htg_t 3 3
				seta[].htg_t 2 3
				set actioncheck 3
					
				set noshards 1
				break
			}
			else ifrnd 72
			{
				strength 0
				ai AIELITEPIGLOSINGLIMBS
				action AELITEPIGLOSINGLIMBS2
				break
			}
			else
			{
			  addkills 1
			  sound SQUISHED
			  state standard_jibs
			  state pig_jibs
			  killit
			}
		}
	}
	
	ifwasweapon PLASMAPROJ
	{
		ifactor PIGCOP
		{
			addkills 1
			sound SQUISHED
			state standard_jibs
			state pig_jibs
			killit
		}
		
		set a_plasmaeffect 1
	}
	
	ifwasweapon FLAMEPROJ
		set a_flaming 1
		
	ifwasweapon CATERKILAR
	{
		ifrnd 32
			state SpawnShards2
			
		ai AIPIGHIT
	}

    ifwasweapon SHRINKSPARK
    {
      sound ACTOR_SHRINKING
      ai AIPIGSHRINK
	  break
    }
    else
      ifwasweapon GROWSPARK
        sound EXPANDERHIT
	
	ifactor ELITEPIGCOP
	{
		ifai AIPIGSHOOTENEMY
			nullop
		else ifrnd 96
			ai AIPIGSHOOTENEMY
	}
	else
	{
		ifactor PIGCOP
		{
			ifwasweapon FREEZEBLAST
			{
			  sound SOMETHINGFROZE
			  spritepal 1
			  move 0
			  action APIGFROZEN
			  strength 0
			  break
			}
		}
		
		ifactor DPIGCOP
		{
			ifwasweapon FREEZEBLAST
			{
			  sound SOMETHINGFROZE
			  spritepal 1
			  move 0
			  action APIGFROZEN
			  strength 0
			  break
			}
		}
	
		ifrnd 32
			ai AIPIGHIT
		else
		  ifrnd 64
			ai AIPIGSHOOTENEMY
		else
		  ifrnd 64
		  {
			ai AIPIGDIVING
			action APIGDIVESHOOT
		  }
	}
  }
ends

state pigshrinkstate
  ifcount SHRUNKDONECOUNT
    ai AIPIGSEEKENEMY
  else
    ifcount SHRUNKCOUNT
      sizeto 48 40
  else
    state genericshrunkcode
ends

state pigdyingstate
  ifactioncount 5
  {
    ifrnd 64
      spawn BLOODPOOL
    state rf
    iffloordistl 8
      sound THUD
	
	ifaction APIGLIMBLESSTORSO
		action APIGTORSO
	else ifaction ADPIGLIMBLESSTORSO
		action ADPIGTORSO
	else ifaction AELITEPIGLIMBLESSTORSO
		action AELITEPIGTORSO
	else ifaction APIGHEADLESS
		action APIGHEADLESSDEAD
	else ifaction ADPIGHEADLESS
		action ADPIGHEADLESSDEAD
	else
		action APIGDEAD
		
    move PIGSTOPPED
    break
  }
ends


actor PIGCOPDIVE PIGCOPSTRENGTH
  ai AIPIGDIVING
  action APIGDIVESHOOT
  cactor PIGCOP
enda
actor PIGCOPSTAYPUT PIGCOPSTRENGTH
  ai AIPIGSEEKENEMY
  cactor PIGCOP
enda
actor PIGCOP PIGCOPSTRENGTH APIGSTAND
  fall
  state checksquished
  ifaction APIGSTAND
    ai AIPIGSEEKENEMY
  else
    ifaction APIGDEAD
  {
    action 0
	cactor PIGCOPDEADSPRITE
  
    ifrespawn
      ifcount RESPAWNACTORTIME
    {
      spawn TRANSPORTERSTAR
      cstat 257
      strength PIGCOPSTRENGTH
      ai AIPIGSEEKENEMY
    }
    else
    {
      strength 0
      ifhitweapon
        ifwasweapon RADIUSEXPLOSION
      {
	    state pig_jibs
        sound SQUISHED
        state standard_jibs
        killit
      }
      break
    }
  }
  else
    ifaction APIGFROZEN
  {
    ifcount THAWTIME
    {
      ai AIPIGSEEKENEMY
      getlastpal
    }
    else
      ifcount FROZENDRIPTIME
        ifrnd 8
          spawn WATERDRIP

    ifhitweapon
    {
      ifwasweapon FREEZEBLAST
      {
        strength 0
        break
      }
      addkills 1

      lotsofglass 30
      ifrnd 84 spawn BLOODPOOL
      sound GLASS_BREAKING
      killit
    }
    ifp pfacing
      ifpdistl FROZENQUICKKICKDIST
        pkick
    break
  }
  else
    ifaction APIGTORSO
	{
	 action 0
	cactor PIGCOPLIMBLESS
	
	 strength 0
      ifhitweapon
        ifwasweapon RADIUSEXPLOSION
      {
        sound SQUISHED
        state standard_jibs
        killit
      }
      break
	}
  else
    ifaction APIGHEADLESSDEAD
	{
	 action 0
	cactor PIGCOPHEADLESS
	
	 strength 0
      ifhitweapon
        ifwasweapon RADIUSEXPLOSION
      {
        sound SQUISHED
        state standard_jibs
        killit
      }
      break
	}
  else ifaction APIGLOSINGLIMBS2
  {
	cstat 0
	ifactioncount 2
	{
		ife actioncheck 6
		{
			state random_wall_jibs
			state random_wall_jibs
			
			set actioncheck 8
		}
		
		guts JIBS6 1
		
		ifcount 30
		{
			state random_wall_jibs
			state random_wall_jibs
			state standard_jibs
			
			sound SQUISHED
			ifrnd 84 spawn BLOODPOOL
			killit
		}
	}
	else ifactioncount 1
	{
		ifcount 10
		{
			guts JIBS6 1
			state random_wall_jibs
		}
		
		resetcount
	} 
  }
  else
  ifai AIPIGHACKED
  {
	cstat 0
	
	ifcount 16
	{
		guts JIBS6 2
		state random_wall_jibs
		sound SQUISHED
		
		ifactioncount 4
		ifrnd 72
		{
			guts JIBS4 1
			guts JIBS3 2
		}
		
		resetcount
	}
	
	ifactioncount 9
	{
		state SpawnShards
		action 0
		strength 0
		cactor PIGCOPHACKED
		spawn BLOODPOOL
		sound THUD
		break
	}
  }
  else
	ifai AIPIGLOSINGLIMBS
	{
	   cstat 0
	   ifaction APIGHEADLESS
	   {
			ifactioncount 5
				action APIGHEADLESSDEAD
	   }
	  else
	  {
		ifactioncount 6
		{
			ifn actioncheck 6
			{
				state SpawnShards
				set actioncheck 6
				ifrnd 128
				{
					set gutPic PIGLEG
					set gutAng 1024
					state GutSlow
					
					set gutPic PIGLEG
					set gutAng -768
					state GutSlow
					
					ai AIPIGLIMBLESSTORSO
				}
				else
					action APIGLOSINGLIMBS2
					
				guts JIBS3 5
				guts JIBS1 2
				guts JIBS4 2
				
				espawn PIGHEAD
				seta[RETURN].yvel 1
				
				state random_wall_jibs
				state standard_jibs
				guts JIBS6 2
				
				ifrnd 192
					guts JIBS2 1
				
				ifrnd 96
					guts JIBS3 5
				sound SQUISHED
			}
		}
		else ifactioncount 5
		{
			ifn actioncheck 5
			{
				set actioncheck 5
				ifrnd 128
				{
					set gutPic PIGARM2
					set gutAng -512
					state GutSlow
				}
				else
				{
					set gutPic PIGARM1
					set gutAng 512
					state GutSlow
				}
				
				seta[RETURN].yvel 1
				
				state random_wall_jibs
				guts JIBS6 2
				sound SQUISHED
			}
		}
		else ifactioncount 4
			nullop
		else ifactioncount 3
			nullop
		else ifactioncount 2
			nullop
		else ifactioncount 1
		ife actioncheck 0
		{
			set actioncheck 1
			ifrnd 128
			{
				set gutPic PIGARM2
				set gutAng -512
				state GutSlow
			}
			else
			{
				set gutPic PIGARM1
				set gutAng 512
				state GutSlow
			}
				
			seta[RETURN].yvel 1
			state random_wall_jibs
			guts JIBS6 2
			sound SQUISHED
		}
	  }
	}
  else
	ifai AIPIGLIMBLESSTORSO
		state pigdyingstate
  else
    ifai AIPIGDYING
      state pigdyingstate
  else
    ifai AIPIGHIT
    {
      ifactioncount 3
      ai AIPIGSEEKENEMY
    }
  else
    ifai AIPIGSHRINK
      state pigshrinkstate
  else
  {
    ifai AIPIGSEEKENEMY
      state pigseekenemystate
    else
      ifai AIPIGDODGE
        state pigseekenemystate
    else
      ifai AIPIGSHOOTENEMY
        state pigshootenemystate
    else
      ifai AIPIGGROW
        state genericgrowcode
    else
      ifai AIPIGFLEEENEMY
        state pigfleeenemystate
    else
      ifai AIPIGDIVING
        state pigdivestate
    else
      ifai AIPIGCHARGE
        state pigseekenemystate
    ifhitweapon
      state checkpighitstate
	  
	 ifdead nullop
	 else ifg a_plasmaeffect 0
	{
		ifrnd 64
			ai AIPIGHIT
	}
	
    ifrnd 1
    {
      ifrnd 32
        soundonce PIG_ROAM
      else
        ifrnd 64
          soundonce PIG_ROAM2
      else
        soundonce PIG_ROAM3
    }
  }
enda

include scripts/enemies/dspigcop.con

action ABOSS1WALK        0  4  5  1  12
action ABOSS1FROZEN        30 1  5
action ABOSS1RUN         0  6  5  1  5
action ABOSS1SHOOT         30 2  5  1  4
action ABOSS1LOB         40 2  5  1  35
action ABOSS1DYING        50 5  1  1  45
action BOSS1FLINTCH       50 2  1  1  50
action ABOSS1DEAD         55
action ABOSS1DEFLECT        40 1  5  1  16

move PALBOSS1SHRUNKRUNVELS 32
move PALBOSS1RUNVELS 164
move BOSS1WALKVELS 300
move BOSS1RUNVELS 450
move BOSS1STOPPED

ai AIBOSS1SEEKENEMY ABOSS1WALK BOSS1WALKVELS seekplayer
ai AIBOSS1DODGE ABOSS1RUN BOSS1RUNVELS dodgebullet
ai AIBOSS1RUNENEMY ABOSS1RUN BOSS1RUNVELS faceplayer
ai AIBOSS1SHOOTENEMY ABOSS1SHOOT BOSS1STOPPED faceplayersmart
ai AIBOSS1LOBBED ABOSS1LOB BOSS1STOPPED faceplayersmart
ai AIBOSS1DYING ABOSS1DYING BOSS1STOPPED faceplayer
ai AIBOSS1PALSHRINK ABOSS1WALK PALBOSS1SHRUNKRUNVELS furthestdir
ai AIBOSS1DEFLECT ABOSS1DEFLECT BOSS1STOPPED geth

state boss1palshrunkstate
  ifcount SHRUNKDONECOUNT
    ai AIBOSS1SEEKENEMY
  else
    ifcount SHRUNKCOUNT
      sizeto 40 40
  else
	state genericshrunkcode	
ends

state checkboss1seekstate
  ai AIBOSS1SEEKENEMY
  ifspritepal 0 nullop
    else   // a fake way of doing a ifspritepal NOT.
      move PALBOSS1RUNVELS seekplayer
ends

state boss1runenemystate

  ifbulletnear
  ifrnd 32
	ai AIBOSS1DODGE
	
  ifpdistl 2048
  {
    ifp palive
      ai AIBOSS1SHOOTENEMY
    break
  }
  else
    ifcansee
  {
    ifactioncount 6
    {
      ifcanshoottarget
      {
        resetactioncount
        sound BOS1_WALK
      }
      else
        ai AIBOSS1SEEKENEMY
    }
  }
  else
    ai AIBOSS1SEEKENEMY
ends

state boss1seekenemystate
  ifrnd 2
    soundonce BOS1_ROAM
  else
    ifactioncount 6
  {
    resetactioncount
    sound BOS1_WALK
  }

  ifbulletnear
  ifrnd 16
	ai AIBOSS1DODGE

  ifpdistl 2548
    ifp palive
  {
    ai AIBOSS1SHOOTENEMY
    break
  }

  ifcansee
    ifcount 32
  {
    ifrnd 32
    {
      ifp palive
        ifcanshoottarget
          ai AIBOSS1SHOOTENEMY
    }
    else
      ifpdistg 2548
        ifrnd 192
          ifcanshoottarget
    {
      ifrnd 64
      {
        ai AIBOSS1RUNENEMY
        ifspritepal 0 nullop
        else
          move PALBOSS1RUNVELS seekplayer
      }
      else
	  {
	    ifrnd 96
			ai AIBOSS1LOBBED
		else
			ai AIBOSS1SHOOTENEMY
	  }
    }
  }

ends

state boss1dyingstate
  ifaction ABOSS1DEAD
  {
    ifspritepal 0
      break
	else
	{
		action 0
		cactor BOSS1DEAD
		strength 0
		cstat 0
		break
	}
    ifrespawn
      ifcount RESPAWNACTORTIME
    {
      spawn TRANSPORTERSTAR
      cstat 257
      strength PIGCOPSTRENGTH
      state checkboss1seekstate
    }
    else
    {
      strength 0
      ifhitweapon
        ifwasweapon RADIUSEXPLOSION
      {
        sound SQUISHED
        state standard_jibs
        killit
      }
      break
    }
  }
  ifactioncount 5
  {
    iffloordistl 8
      sound THUD
    action ABOSS1DEAD
    cstat 0
    ifspritepal 0
		set endgame 1
	else ifrnd 72
		spawn ONEUP
  }
ends

state boss1lobbedstate
  ifcansee
  {
    ifactioncount 2
    {
      resetactioncount
      sound BOS1_ATTACK2
	  ifrnd 96
	  {
	    espawn CLUSTERSPAWNER
		geta[RETURN].z atemp5
		sub atemp5 12000
		seta[RETURN].z atemp5
	  }
	  
	  shoot MORTER
    }
    else
      ifcount 64
        ifrnd 16
          state checkboss1seekstate
  }
  else
    state checkboss1seekstate
ends

state boss1shootenemy
  ifcount 72
    state checkboss1seekstate
  else
    ifaction ABOSS1SHOOT
      ifactioncount 2
  {
    sound BOS1_ATTACK1
    state ShootSpark
    state ShootSpark
	state ShootSpark
	
	ifle userdef.player_skill 4
	{	
		state ShootSpark
		state ShootSpark
		//state ShootSpark
		//state ShootSpark
	}
    resetactioncount
  }
ends

state checkboss1hitstate
  ifrnd 2
    spawn BLOODPOOL
  ifdead
  {
    ifspritepal 0
	{
      globalsound DUKE_TALKTOBOSSFALL
	  
		ife boss1fx 1
		{
			set boss1fx 0
			state NextSample
			set loopMusic 0
		}
	}
    else
    {
	  ifwasweapon FLAMEPROJ
		state genericburn_dead_code
	
      ifrnd 64
        globalsound DUKE_TALKTOBOSSFALL
      ifwasweapon FREEZEBLAST
      {
        sound SOMETHINGFROZE
        spritepal 1
        move 0
        action ABOSS1FROZEN
        strength 0
        break
      }
    }

    sound BOS1_DYING

    addkills 1
	add s_bosskill 1
    ai AIBOSS1DYING
  }
  else
  {
    ifrnd 4
    {
		state SpawnShards3
		state SpawnShards3
		state SpawnShards3
		state SpawnShards3
	  
	  ifaction BOSS1FLINTCH
		nullop
	  else
	  {
		action BOSS1FLINTCH
        move 0
	  }
    }

    ifspritepal 0 nullop
    else
	{
		ifwasweapon SHRINKSPARK
		{
		  sound ACTOR_SHRINKING
		  ai AIBOSS1PALSHRINK
		  cstat 0
		  break
		}
		else ifwasweapon FLAMEPROJ
			set a_flaming 1
	}
	
	ifwasweapon PLASMAPROJ
		set a_plasmaeffect 1

    soundonce BOS1_PAIN

    debris SCRAP1 1
    guts JIBS6 1
  }
ends

state boss1code

	ifdead nullop
	else
	{
		ifg a_plasmaeffect 1
		ifrnd 72
			action BOSS1FLINTCH
		else ife boss1deflect 1
		  {
			ifaction BOSS1FLINTCH 
				set boss1deflect 0
			else
			{
				ifrnd 64
					sound BOS1_RECOG
					
				ai AIBOSS1DEFLECT
				set boss1deflect 0
			}
		  }
		  
		ife boss1deflect 1
			set boss1deflect 0
	}
	
	ifg sprite[].extra 0
	ifl sprite[].extra 1000
	ifspritepal 0
	{
		ife boss1fx 0
		{
			set boss1fx 1
			state SwapToNextSample
		}
	}

  ifaction ABOSS1FROZEN
  {
    ifcount THAWTIME
    {
      ai AIBOSS1SEEKENEMY
      spritepal 21
    }
    else
      ifcount FROZENDRIPTIME
    {
      ifactioncount 26
      {
        spawn WATERDRIP
        resetactioncount
      }
    }

    ifhitweapon
    {
      ifwasweapon FREEZEBLAST
      {
        strength 0
        break
      }
      addkills 1
      lotsofglass 30
	  add s_bosskill 1

      ifrnd 84
        spawn BLOODPOOL
      sound GLASS_BREAKING
      killit
    }
    ifp pfacing
      ifpdistl FROZENQUICKKICKDIST
        pkick
    break
  }
  ifai 0
  {
    ifspritepal 0
	{
      ai AIBOSS1RUNENEMY
	  set bossfighton THISACTOR
	}
    else
    {
      strength BOSS1PALSTRENGTH
	  clipdist 80
	  ife userdef.enable_nuke 1
	  ife userdef.nuke_active 1
	  {
		set ue_temp userdef.nuke_enemyhealth
		mul ue_temp sprite[].extra
		div ue_temp 100
		seta[].extra ue_temp
	  }
      ai AIBOSS1SHOOTENEMY
	  setarray bosspal[num_bosspalfight] THISACTOR
	  add num_bosspalfight 1
    }
  }
  else
    ifaction BOSS1FLINTCH
  {
    soundonce BOS1_PAIN
	ifspritepal 0
	{
		ifactioncount 5
			ai AIBOSS1SHOOTENEMY
	}
	else ifactioncount 1
			ai AIBOSS1SHOOTENEMY
	
  }
  else
	ifai AIBOSS1DEFLECT
		ifactioncount 2
			ai AIBOSS1SHOOTENEMY
  else
    ifai AIBOSS1SEEKENEMY	
      state boss1seekenemystate
  else
    ifai AIBOSS1RUNENEMY
      state boss1runenemystate
  else
    ifai AIBOSS1DODGE
	{
		ifcount 5
		{
			ai AIBOSS1RUNENEMY
			resetcount
		}
	}
  else
    ifai AIBOSS1SHOOTENEMY
      state boss1shootenemy
    ifai AIBOSS1SHOOTENEMY
      state boss1shootenemy
  else
    ifai AIBOSS1LOBBED
      state boss1lobbedstate
  else
    ifai AIBOSS1PALSHRINK
      state boss1palshrunkstate

  ifai AIBOSS1DYING
    state boss1dyingstate
  else
  {
    ifhitweapon
      state checkboss1hitstate
    else
      ifp palive
        ifspritepal 0
          ifpdistl 1280
    {
      addphealth -1000
      palfrom 63 63
    }
  }

  
ends

actor BOSS1STAYPUT BOSS1STRENGTH cactor BOSS1 enda
actor BOSS1 BOSS1STRENGTH fall state boss1code enda


action ABOSS2WALK        0  4  5  1  20
action ABOSS2FROZEN        0  1  5
action ABOSS2RUN         0  4  5  1  10
action ABOSS2SHOOT         20 2  5  1  15
action ABOSS2LOB         30 2  5  1  105
action ABOSS2DYING        40 8  1  1  35
action BOSS2FLINTCH       40 1  1  1  1
action ABOSS2DEAD         48
action ABOSS2TRANSFORM    40  2  1  1  35
action ABOSS2GETDOWN	  40  5  1  1  35
action ABOSS2TRYGETUP	  45  2  1  -1  60
action ABOSS2TRYGETUP2	  43  2  1  1  60
action ABOSS2GETUP	  	  45  5  1  -1  60
action ABOSS2COMEBACK     30 2  5  1  105
action ABOSS2TRANSFORM2	  40 5	1  1  35
action ABOSS2TRANSFORM3	  45 5	1  -1  35

move PALBOSS2SHRUNKRUNVELS 32
move PALBOSS2RUNVELS 84
move BOSS2WALKVELS 300
move BOSS2RUNVELS 400
move BOSS2STOPPED

ai AIBOSS2SEEKENEMY ABOSS2WALK BOSS2WALKVELS seekplayer
ai AIBOSS2RUNENEMY ABOSS2RUN BOSS2RUNVELS faceplayer
ai AIBOSS2SHOOTENEMY ABOSS2SHOOT BOSS2STOPPED faceplayersmart
ai AIBOSS2LOBBED ABOSS2LOB BOSS2STOPPED faceplayersmart
ai AIBOSS2DYING ABOSS2DYING BOSS2STOPPED faceplayer
ai AIBOSS2PALSHRINK ABOSS2WALK PALBOSS2SHRUNKRUNVELS furthestdir
ai AIBOSS2GETDOWN ABOSS2GETDOWN BOSS2STOPPED faceplayer
ai AIBOSS2COMEBACK ABOSS2COMEBACK BOSS2STOPPED faceplayer
ai AIBOSS2TRANSFORM2 ABOSS2TRANSFORM2 BOSS2STOPPED faceplayer
ai AIBOSS2DODGE ABOSS2RUN BOSS2RUNVELS dodgebullet

state boss2palshrunkstate
  ifcount SHRUNKDONECOUNT
  {
    cstat 257
    ai AITROOPSEEKENEMY
  }
  else
    ifcount SHRUNKCOUNT
      sizeto 40 40
  else
    state genericshrunkcode
ends

state checkboss2seekstate
  ai AIBOSS2SEEKENEMY
  ifspritepal 0 nullop
  else   // a fake way of doing a ifspritepal NOT.
    move PALBOSS2RUNVELS seekplayer
ends

state boss2runenemystate
	ifbulletnear
	ifrnd 32
		ai AIBOSS2DODGE

  ifcansee
  {
    ifactioncount 3
    {
      ifcanshoottarget
      {
        resetactioncount
        sound BOS1_WALK
      }
      else
        ai AIBOSS2SEEKENEMY
    }
    ifcount 48
      ifrnd 2
    {
      ifp palive
      {
		ifp phigher
		{
			globalsound BOS2_ATTACK
			ai AIBOSS2SHOOTENEMY
		}
      }
      break
    }
  }
  else
    ai AIBOSS2SEEKENEMY
ends

state boss2seekenemystate
	
	ifbulletnear
		ai AIBOSS2DODGE

  ifrnd 2
    soundonce BOS2_ROAM
  else
    ifactioncount 3
  {
    resetactioncount
    sound BOS1_WALK
  }
  
ifactor BOSS2RED
ifg cycloid_under_octa 2
{
  ifcansee
    ifcount 32
      ifp palive
        ifrnd 48
          ifcanshoottarget
  {
    ifrnd 64
      ifpdistg 4096
    {
      ai AIBOSS2RUNENEMY
      ifspritepal 0 nullop
      else
        move PALBOSS2RUNVELS seekplayer
      break
    }

    ifpdistl 12000
    {
      ifrnd 192
      {
        globalsound BOS2_ATTACK
        ai AIBOSS2LOBBED
      }
    }
    else
    {
      globalsound BOS2_ATTACK
      ai AIBOSS2SHOOTENEMY
    }
  }
}
else ifactor BOSS2RED
{
	ifcansee
	ifp palive
	ifcanshoottarget
	{
		ifpdistl 12000
		ifrnd 196
			ai AIBOSS2LOBBED
		else
			ai AIBOSS2RUNENEMY	
	}
	
	ifp phigher
		ai AIBOSS2SHOOTENEMY
}
else
{
   ifcansee
    ifcount 32
      ifp palive
        ifrnd 48
          ifcanshoottarget
  {
    ifrnd 64
      ifpdistg 4096
    {
      ai AIBOSS2RUNENEMY
      ifspritepal 0 nullop
      else
        move PALBOSS2RUNVELS seekplayer
      break
    }

    ifpdistl 12000
    {
      ifrnd 192
      {
        globalsound BOS2_ATTACK
        ai AIBOSS2LOBBED
      }
    }
    else
    {
      globalsound BOS2_ATTACK
      ai AIBOSS2SHOOTENEMY
    }
  }
}
ends

state boss2dyingstate
	
  ifspritepal 0
  {
	  ifactor BOSS2RED nullop
	  else ifn boss3musictrack 4
	  {
		set music_load_pos 0
		state PlayActionMusic
		set boss3musictrack 4
	  }
	}

  ifaction ABOSS2DEAD
  {
    ifspritepal 0
      break
    ifrespawn
      ifcount RESPAWNACTORTIME
    {
      spawn TRANSPORTERSTAR
      cstat 257
      strength PIGCOPSTRENGTH
      state checkboss2seekstate
    }
    else
    {
      strength 0
      ifhitweapon
        ifwasweapon RADIUSEXPLOSION
      {
        sound SQUISHED
        state standard_jibs
        killit
      }
      break
    }
  }
  
  ifactioncount 8
  {
    iffloordistl 8
      sound THUD
    action ABOSS2DEAD
    cstat 0
    ifspritepal 0
	{
		ifactor BOSS2RED nullop
		else set endgame 1
	}
  }
ends

state boss2lobbedstate
  ifcansee
  {
    ifactioncount 2
      resetactioncount
    else
      ifactioncount 1
    {
      ifrnd 128
        shoot COOLEXPLOSION1
	  
	  ifrnd 88
	  {
		ife cycloid_final 2
		{
			ifp phigher
			ifg player[].jetpack_on 1
			ifrnd 96
			{
				espawn ROCKETPROJPF
				geta[RETURN].z atemp
				sub atemp 8192
				seta[RETURN].z atemp
			}
		
			ifrnd 128
			{
				espawn JELLYCONNECTORACTOR
				seta[RETURN].yvel 4
				geta[RETURN].z atemp2
				sub atemp2 8192
				seta[RETURN].z atemp2
							
				geta[].ang atemp
				sub atemp 64
				seta[RETURN].ang atemp
							
				espawn JELLYCONNECTORACTOR
				seta[RETURN].yvel 4
				geta[RETURN].z atemp2
				sub atemp2 8192
				seta[RETURN].z atemp2
							
				geta[].ang atemp
				add atemp 64
				seta[RETURN].ang atemp
				
				ifrnd 24
				{
					espawn JELLYCONNECTORACTOR
					seta[RETURN].yvel 3
					geta[RETURN].z atemp2
					sub atemp2 8192
					seta[RETURN].z atemp2
								
					geta[].ang atemp
					seta[RETURN].ang atemp
				}
				else ifrnd 32
				{
					espawn JELLYCONNECTORACTOR
					seta[RETURN].yvel 3
					geta[RETURN].z atemp2
					sub atemp2 8192
					seta[RETURN].z atemp2
					setactorvar[RETURN].atmp -16384
								
					geta[].ang atemp
					seta[RETURN].ang atemp
					
					espawn JELLYCONNECTORACTOR
					seta[RETURN].yvel 3
					geta[RETURN].z atemp2
					sub atemp2 8192
					seta[RETURN].z atemp2
					setactorvar[RETURN].atmp -16384
								
					geta[].ang atemp
					add atemp 64
					seta[RETURN].ang atemp
					
					espawn JELLYCONNECTORACTOR
					seta[RETURN].yvel 3
					geta[RETURN].z atemp2
					sub atemp2 8192
					seta[RETURN].z atemp2
					setactorvar[RETURN].atmp -16384
								
					geta[].ang atemp
					sub atemp 64
					seta[RETURN].ang atemp
				}
			}
			
			geta[].ang atemp
			set atemp2 atemp
			rand atemp3 128
			rand atemp4 -128
			add atemp3 atemp4
			add atemp2 atemp3
			seta[].ang atemp2
			
			sound FLAMEALT_SOUND
			setprojectile[FLAMEPROJ].extra 4
			setprojectile[FLAMEPROJ].drop -48
			setprojectile[FLAMEPROJ].pal 2
			setprojectile[FLAMEPROJ].workslike 86082
			setprojectile[FLAMEPROJ].hitradius 1024
			setprojectile[FLAMEPROJ].range 0
			setprojectile[FLAMEPROJ].spawns FLAMECLUSTERSPAWNER
			shoot FLAMEPROJ
			setprojectile[FLAMEPROJ].extra FLAMEDAMAGE
			setprojectile[FLAMEPROJ].drop -256
			setprojectile[FLAMEPROJ].pal 0
			setprojectile[FLAMEPROJ].workslike 118850
			setprojectile[FLAMEPROJ].hitradius 768
			setprojectile[FLAMEPROJ].range 15
			setprojectile[FLAMEPROJ].spawns FLAMEPROJSPAWNED
			
			seta[].ang atemp
		}
		else
		{
			geta[].ang atemp
			set atemp2 atemp
			rand atemp3 128
			rand atemp4 -128
			add atemp3 atemp4
			add atemp2 atemp3
			seta[].ang atemp2
		
			sound FLAMEALT_SOUND
			setprojectile[FLAMEPROJ].extra 7
			setprojectile[FLAMEPROJ].drop -128
			setprojectile[FLAMEPROJ].workslike 86082
			setprojectile[FLAMEPROJ].hitradius 1024
			setprojectile[FLAMEPROJ].range 0
			setprojectile[FLAMEPROJ].pal 2
			setprojectile[FLAMEPROJ].spawns FLAMECLUSTERSPAWNER
			shoot FLAMEPROJ
			setprojectile[FLAMEPROJ].extra FLAMEDAMAGE
			setprojectile[FLAMEPROJ].drop -256
			setprojectile[FLAMEPROJ].workslike 118850
			setprojectile[FLAMEPROJ].hitradius 768
			setprojectile[FLAMEPROJ].range 15
			setprojectile[FLAMEPROJ].pal 2
			setprojectile[FLAMEPROJ].spawns FLAMEPROJSPAWNED
			
			seta[].ang atemp
		}
	  }
    }
    else
      ifcount 64
        ifrnd 16
          state checkboss2seekstate
  }
  else
    state checkboss2seekstate
ends

state boss2shootenemy
	ifbulletnear
	ifrnd 32
		ai AIBOSS2DODGE

  ifcount 72
    state checkboss2seekstate
  else
    ifaction ABOSS2SHOOT
      ifactioncount 2
  {
	setprojectile[ROCKETPROJ].vel 512
	setprojectile[ROCKETPROJ].drop 0
	setprojectile[ROCKETPROJ].extra 15
	setprojectile[ROCKETPROJ].xrepeat 24
	setprojectile[ROCKETPROJ].yrepeat 24
	setprojectile[ROCKETPROJ].trail EXPLOSION3
	setprojectile[ROCKETPROJ].sxrepeat 26
	setprojectile[ROCKETPROJ].syrepeat 26
	shoot ROCKETPROJ
	setprojectile[ROCKETPROJ].vel 896
	setprojectile[ROCKETPROJ].drop -128
	setprojectile[ROCKETPROJ].extra ROCKETDAMAGE
	setprojectile[ROCKETPROJ].xrepeat 32
	setprojectile[ROCKETPROJ].yrepeat 32
	setprojectile[ROCKETPROJ].trail SMALLSMOKE
	setprojectile[ROCKETPROJ].sxrepeat 24
	setprojectile[ROCKETPROJ].syrepeat 24
	
	ifp phigher
	ifg player[].jetpack_on 0
	ifrnd 128
	{
		espawn ROCKETPROJPF
		geta[RETURN].z atemp
		sub atemp 8192
		seta[RETURN].z atemp
	}
		
    resetactioncount
  }
ends

state checkboss2hitstate
  ifrnd 2
    spawn BLOODPOOL
  ifdead
  {
    ifspritepal 0
      globalsound DUKE_TALKTOBOSSFALL
    else
    {
      ifrnd 64
        globalsound DUKE_TALKTOBOSSFALL
      ifwasweapon FREEZEBLAST
      {
        sound SOMETHINGFROZE
        spritepal 1
        move 0
        action ABOSS2FROZEN
        strength 0
        break
      }
    }

    globalsound BOS2_DYING

	ifactor BOSS2RED
	{
		add s_bosskill 1
		add s_bosskill 1
		ai AIBOSS2GETDOWN
	}
	else
	{
		ifspritepal 0
		{
			ife cycloid_final 0
			ife LEVEL 8
			ife VOLUME 2
			{
				addkills 1
				add s_bosskill 1
				add s_bosskill 1
				ai AIBOSS2TRANSFORM2
				cstat 0
				set cycloid_final 1
				set atmp2 1
			}
			else
			{
				addkills 1
				add s_bosskill 1
				add s_bosskill 1
				ai AIBOSS2DYING
			}
		}
		else
		{
			addkills 1
			add s_bosskill 1
			add s_bosskill 1
			ai AIBOSS2DYING
		}
	}
  }
  else
  {
    ife cycloid_final 0
	{ 
		ifrnd 64
		{
		  ifrnd 8
		  {
			action BOSS2FLINTCH
			move 0
		  }
		  else
		  {
			globalsound BOS2_ATTACK
			ifai AIBOSS2LOBBED nullop
			else ifai AIBOSS2SHOOTENEMY nullop
			else
			{
				ifpdistl 12000
				  ifrnd 128
					ai AIBOSS2LOBBED
				else
					ai AIBOSS2SHOOTENEMY
			}
		  }
		}

		ifspritepal 0 nullop
		else
		  ifwasweapon SHRINKSPARK
		{
		  sound ACTOR_SHRINKING
		  ai AIBOSS2PALSHRINK
		  break
		}
	}
	//else ife cycloid_final 2
	//{
		ifrnd 6
			state SpawnShards3
	
		ifrnd 4
		{
			espawn JELLYCONNECTORACTOR
			seta[RETURN].yvel 23
			geta[RETURN].z atemp2
			sub atemp2 8192
			seta[RETURN].z atemp2
										
			geta[].ang atemp
			rand atemp2 1024
			add atemp atemp2
			seta[RETURN].ang atemp
			
			espawn JELLYCONNECTORACTOR
			seta[RETURN].yvel 22
			geta[RETURN].z atemp2
			sub atemp2 8192
			seta[RETURN].z atemp2
										
			geta[].ang atemp
			rand atemp2 1024
			sub atemp atemp2
			seta[RETURN].ang atemp
		}
		else ifrnd 4
		{
			espawn JELLYCONNECTORACTOR
			seta[RETURN].yvel 23
			geta[RETURN].z atemp2
			sub atemp2 8192
			seta[RETURN].z atemp2
										
			geta[].ang atemp
			rand atemp2 1024
			add atemp atemp2
			seta[RETURN].ang atemp
			
			espawn JELLYCONNECTORACTOR
			seta[RETURN].yvel 20
			geta[RETURN].z atemp2
			sub atemp2 8192
			seta[RETURN].z atemp2
										
			geta[].ang atemp
			rand atemp2 1024
			sub atemp atemp2
			seta[RETURN].ang atemp
		}
		else ifrnd 1
		{
			espawn JELLYCONNECTORACTOR
			seta[RETURN].yvel 24
			geta[RETURN].z atemp2
			sub atemp2 8192
			seta[RETURN].z atemp2
										
			geta[].ang atemp
			rand atemp2 64
			add atemp atemp2
			seta[RETURN].ang atemp
		}
	//}

    soundonce BOS2_PAIN

    debris SCRAP1 1
    //guts JIBS6 1
  }
ends

state boss2code

	ifactor BOSS2RED
	ifg atmp 0
	ifl atmp 21
	{
		ife atmp 10
		{
			espawn JELLYCONNECTORACTOR
			seta[RETURN].yvel 2
			geta[RETURN].z atemp
			sub atemp 14000
			seta[RETURN].z atemp
			
			set cycloid_beam_1 RETURN
		}
		else ife atmp 20
		{
			espawn JELLYCONNECTORACTOR
			seta[RETURN].yvel 2
			geta[RETURN].z atemp
			sub atemp 20000
			seta[RETURN].z atemp
			
			set cycloid_beam_2 RETURN
		}
		
		ifl atmp 21
			add atmp 1
	}

  ifaction ABOSS2FROZEN
  {
    ifcount THAWTIME
    {
      ai AIBOSS2SEEKENEMY
        spritepal 21
    }
    else
      ifcount FROZENDRIPTIME
    {
      ifactioncount 26
      {
        spawn WATERDRIP
        resetactioncount
      }
    }

    ifhitweapon
    {
      ifwasweapon FREEZEBLAST
      {
        strength 0
        break
      }
      addkills 1
      add s_bosskill 1
      lotsofglass 30
      sound GLASS_BREAKING
      ifrnd 84 spawn BLOODPOOL
      killit
    }
    ifp pfacing
      ifpdistl FROZENQUICKKICKDIST
        pkick
    break
  }
  
  ife cycloid_final 2
  {
	guts JIBS6 1
	ifai AIBOSS2LOBBED nullop
	else ifdead nullop
	else ai AIBOSS2LOBBED
	/*
	ifl sprite[].extra 2000
	ife boss3musictrack 1
	{
		starttrack 24
		set boss3musictrack 2
	}
	*/
  }
  
  ifai 0
  {
	
  
	ifactor BOSS2RED
	ife atmp 0
	{
		espawn JELLYCONNECTORACTOR
		seta[RETURN].yvel 2
		geta[RETURN].z atemp
		sub atemp 8192
		seta[RETURN].z atemp
		
		set cycloid_beam_0 RETURN
		
		set atmp 1
	}
	
	ife sprite[].yvel 1
	{
		cstat 0
		ai AIBOSS2COMEBACK
		set atmp2 1
	}
	else ifspritepal 0
	{
		ifn sprite[].yvel 1
			ai AIBOSS2RUNENEMY
			
		set bossfighton THISACTOR
	}
	else ifspritepal 3
	ife LEVEL 8
	ife VOLUME 2
	{
		cstat 257
		//sizeat 64 64
		clipdist 164
		
		ife atmp 0
		{
			globalsound WHIPYOURASS
			set atmp 1
		}
		
		ifhitweapon
		{
			ifwasweapon JELLYCONNECTOR
			{
				ifaction 0
					action ABOSS2TRANSFORM
				
				add atemp6 1
				
				set atemp7 atemp6
				mod atemp7 2
				ife atemp7 0
				{
					seta[].shade 12
					quake 10
				}
				else
					seta[].shade 0
				
				spawn FRAMEEFFECT1
				sizeto 64 64
				sizeto 64 64
				sizeto 64 64
				
				sound BOS2_PAIN
				guts JIBS6 1
			}
		}
		
		ifg atemp6 18
		{
			spawn EXPLOSION2
			sound PIPEBOMB_EXPLODE
			
			espawn JELLYCONNECTORACTOR
						seta[RETURN].yvel 3
						geta[RETURN].z atemp2
						sub atemp2 8192
						seta[RETURN].z atemp2
						
						setactorvar[RETURN].atmp -32768
						geta[].ang atemp
						sub atemp 512
						seta[RETURN].ang atemp
						
						espawn JELLYCONNECTORACTOR
						seta[RETURN].yvel 3
						geta[RETURN].z atemp2
						sub atemp2 8192
						seta[RETURN].z atemp2
						
						setactorvar[RETURN].atmp -32768
						geta[].ang atemp
						add atemp 512
						seta[RETURN].ang atemp
						
						espawn JELLYCONNECTORACTOR
						seta[RETURN].yvel 3
						geta[RETURN].z atemp2
						sub atemp2 8192
						seta[RETURN].z atemp2
						
						geta[].ang atemp
						sub atemp 512
						seta[RETURN].ang atemp
						
						espawn JELLYCONNECTORACTOR
						seta[RETURN].yvel 3
						geta[RETURN].z atemp2
						sub atemp2 8192
						seta[RETURN].z atemp2
						
						geta[].ang atemp
						add atemp 512
						seta[RETURN].ang atemp
			
			palfrom 63 63 63 63
			espawn BOSS2RED
			set bossfighton RETURN
			set cycloid_sprite RETURN
			seta[RETURN].xrepeat 64
			seta[RETURN].yrepeat 64
			killit
		}
	}
    else
    {
	  ifspritepal 40
		strength BOSS3PALSTRENGTH
	  else
		strength 1
		
      globalsound BOS2_ATTACK ai AIBOSS2SHOOTENEMY
    }
  }
  else
    ifaction BOSS2FLINTCH
  {
    ifactioncount 3
      ai AIBOSS2SEEKENEMY
  }
  else
    ifai AIBOSS2SEEKENEMY
      state boss2seekenemystate
  else
    ifai AIBOSS2RUNENEMY
      state boss2runenemystate
  else
    ifai AIBOSS2SHOOTENEMY
      state boss2shootenemy
  else
    ifai AIBOSS2LOBBED
      state boss2lobbedstate
  else
    ifai AIBOSS2PALSHRINK
      state boss2palshrunkstate
  else ifai AIBOSS2GETDOWN
  {
		cstat 0
		
		ifaction ABOSS2GETDOWN
		ifactioncount 5
		{
			espawn JELLYCONNECTORACTOR
			seta[RETURN].yvel 20
			geta[RETURN].z atemp2
			sub atemp2 8192
			seta[RETURN].z atemp2
							
			geta[].ang atemp
			rand atemp2 1024
			sub atemp atemp2
			seta[RETURN].ang atemp
			
			espawn JELLYCONNECTORACTOR
			seta[RETURN].yvel 20
			geta[RETURN].z atemp2
			sub atemp2 8192
			seta[RETURN].z atemp2
							
			geta[].ang atemp
			rand atemp2 1024
			add atemp atemp2
			seta[RETURN].ang atemp
			
			espawn JELLYCONNECTORACTOR
			seta[RETURN].yvel 22
			geta[RETURN].z atemp2
			sub atemp2 8192
			seta[RETURN].z atemp2
							
			geta[].ang atemp
			rand atemp2 256
			add atemp atemp2
			seta[RETURN].ang atemp
		
			geta[].ang atemp
			set atemp3 0
			whilen atemp3 4
			{
				sound FLAMEALT_SOUND
				setprojectile[FLAMEPROJ].extra 10
					setprojectile[FLAMEPROJ].drop -256
					setprojectile[FLAMEPROJ].workslike 86082
					setprojectile[FLAMEPROJ].hitradius 1024
					setprojectile[FLAMEPROJ].range 0
					setprojectile[FLAMEPROJ].vel 128
					setprojectile[FLAMEPROJ].spawns FLAMECLUSTERSPAWNER
					ezshoot -4096 FLAMEPROJ
					add atemp 512
					seta[].ang atemp
					setprojectile[FLAMEPROJ].vel 812
					setprojectile[FLAMEPROJ].extra FLAMEDAMAGE
					setprojectile[FLAMEPROJ].drop -256
					setprojectile[FLAMEPROJ].workslike 118850
					setprojectile[FLAMEPROJ].hitradius 768
					setprojectile[FLAMEPROJ].range 15
					setprojectile[FLAMEPROJ].spawns FLAMEPROJSPAWNED
				
				add atemp3 1
			}
			
			action ABOSS2TRYGETUP
			globalsound BOS2_RECOG
			set atmp2 1
			
			ife atmp2 1
			{
				espawn JELLYCONNECTORACTOR
				seta[RETURN].yvel 21
				geta[RETURN].z atemp2
				sub atemp2 8192
				seta[RETURN].z atemp2
								
				geta[].ang atemp
				rand atemp2 64
				sub atemp atemp2
				seta[RETURN].ang atemp
				
				espawn JELLYCONNECTORACTOR
				seta[RETURN].yvel 22
				geta[RETURN].z atemp2
				sub atemp2 8192
				seta[RETURN].z atemp2
								
				geta[].ang atemp
				rand atemp2 256
				add atemp atemp2
				seta[RETURN].ang atemp
			
				espawn JELLYCONNECTORACTOR
				seta[RETURN].yvel 10
				geta[RETURN].z atemp2
				sub atemp2 8192
				seta[RETURN].z atemp2
							
				setactorvar[RETURN].atmp -16384
				geta[].ang atemp
				sub atemp 512
				seta[RETURN].ang atemp
				
				espawn JELLYCONNECTORACTOR
				seta[RETURN].yvel 10
				geta[RETURN].z atemp2
				sub atemp2 8192
				seta[RETURN].z atemp2
							
				setactorvar[RETURN].atmp -16384
				geta[].ang atemp
				add atemp 512
				seta[RETURN].ang atemp
				
				espawn JELLYCONNECTORACTOR
				seta[RETURN].yvel 11
				geta[RETURN].z atemp2
				sub atemp2 8192
				seta[RETURN].z atemp2
							
				geta[].ang atemp
				sub atemp 512
				seta[RETURN].ang atemp
				
				espawn JELLYCONNECTORACTOR
				seta[RETURN].yvel 11
				geta[RETURN].z atemp2
				sub atemp2 8192
				seta[RETURN].z atemp2
							
				geta[].ang atemp
				add atemp 512
				seta[RETURN].ang atemp
			}
		}
		
		ifg atmp2 0
		{
			ifaction ABOSS2TRYGETUP
			ifactioncount 2
			{
				ife atmp2 5
				{
					geta[].ang atemp
					set atemp3 0
					whilen atemp3 4
					{
						sound FLAMEALT_SOUND
						setprojectile[FLAMEPROJ].extra 10
						setprojectile[FLAMEPROJ].drop -256
						setprojectile[FLAMEPROJ].workslike 86082
						setprojectile[FLAMEPROJ].hitradius 1024
						setprojectile[FLAMEPROJ].range 0
						setprojectile[FLAMEPROJ].vel 128
						setprojectile[FLAMEPROJ].spawns FLAMECLUSTERSPAWNER
						ezshoot -4096 FLAMEPROJ
						add atemp 512
						seta[].ang atemp
						setprojectile[FLAMEPROJ].vel 812
						setprojectile[FLAMEPROJ].extra FLAMEDAMAGE
						setprojectile[FLAMEPROJ].drop -256
						setprojectile[FLAMEPROJ].workslike 118850
						setprojectile[FLAMEPROJ].hitradius 768
						setprojectile[FLAMEPROJ].range 15
						setprojectile[FLAMEPROJ].spawns FLAMEPROJSPAWNED
						
						add atemp3 1
					}
					
					espawn JELLYCONNECTORACTOR
					seta[RETURN].yvel 23
					geta[RETURN].z atemp2
					sub atemp2 8192
					seta[RETURN].z atemp2
									
					geta[].ang atemp
					rand atemp2 128
					add atemp atemp2
					seta[RETURN].ang atemp
					
					action ABOSS2GETUP
					resetcount
					globalsound BOS2_RECOG
					add atmp2 1
					palfrom 63 63 63 63
					quake 45
				}
				else
				{
					geta[].ang atemp
					set atemp3 0
					whilen atemp3 4
					{
						sound FLAMEALT_SOUND
						setprojectile[FLAMEPROJ].extra 10
						setprojectile[FLAMEPROJ].drop -256
						setprojectile[FLAMEPROJ].workslike 86082
						setprojectile[FLAMEPROJ].hitradius 1024
						setprojectile[FLAMEPROJ].range 0
						setprojectile[FLAMEPROJ].vel 128
						setprojectile[FLAMEPROJ].spawns FLAMECLUSTERSPAWNER
						ezshoot -4096 FLAMEPROJ
						add atemp 512
						seta[].ang atemp
						setprojectile[FLAMEPROJ].vel 812
						setprojectile[FLAMEPROJ].extra FLAMEDAMAGE
						setprojectile[FLAMEPROJ].drop -256
						setprojectile[FLAMEPROJ].workslike 118850
						setprojectile[FLAMEPROJ].hitradius 768
						setprojectile[FLAMEPROJ].range 15
						setprojectile[FLAMEPROJ].spawns FLAMEPROJSPAWNED
						
						add atemp3 1
					}
					action ABOSS2TRYGETUP2
					globalsound BOS2_PAIN
					add atmp2 1
					palfrom 32 63 63 63
					quake 10
				}
			}
			
			ifaction ABOSS2TRYGETUP2
			ifactioncount 2
			{
				geta[].ang atemp
				set atemp3 0
				whilen atemp3 4
				{
					sound FLAMEALT_SOUND
					setprojectile[FLAMEPROJ].extra 10
					setprojectile[FLAMEPROJ].drop -256
					setprojectile[FLAMEPROJ].workslike 86082
					setprojectile[FLAMEPROJ].hitradius 1024
					setprojectile[FLAMEPROJ].range 0
					setprojectile[FLAMEPROJ].vel 128
					setprojectile[FLAMEPROJ].spawns FLAMECLUSTERSPAWNER
					ezshoot -4096 FLAMEPROJ
					add atemp 512
					seta[].ang atemp
					setprojectile[FLAMEPROJ].vel 812
					setprojectile[FLAMEPROJ].extra FLAMEDAMAGE
					setprojectile[FLAMEPROJ].drop -256
					setprojectile[FLAMEPROJ].workslike 118850
					setprojectile[FLAMEPROJ].hitradius 768
					setprojectile[FLAMEPROJ].range 15
					setprojectile[FLAMEPROJ].spawns FLAMEPROJSPAWNED
					
					add atemp3 1
				}
				
					espawn JELLYCONNECTORACTOR
					seta[RETURN].yvel 23
					geta[RETURN].z atemp2
					sub atemp2 8192
					seta[RETURN].z atemp2
									
					geta[].ang atemp
					rand atemp2 128
					add atemp atemp2
					seta[RETURN].ang atemp
				
				action ABOSS2TRYGETUP
				globalsound BOS2_ROAM
				add atmp2 1
			}
			
			ifaction ABOSS2GETUP
			{
				ifactioncount 5 { sound BOS2_RECOG set atmp 60 }
				else ifactioncount 1
				{
					ifcount 20
					{
						globalsound BOS2_RECOG
						
						geta[].ang atemp
						set atemp3 0
						whilen atemp3 4
						{
							sound FLAMEALT_SOUND
							setprojectile[FLAMEPROJ].extra 10
							setprojectile[FLAMEPROJ].drop -256
							setprojectile[FLAMEPROJ].workslike 86082
							setprojectile[FLAMEPROJ].hitradius 1024
							setprojectile[FLAMEPROJ].range 0
							setprojectile[FLAMEPROJ].vel 128
							setprojectile[FLAMEPROJ].spawns FLAMECLUSTERSPAWNER
							ezshoot -4096 FLAMEPROJ
							add atemp 512
							seta[].ang atemp
							setprojectile[FLAMEPROJ].vel 812
							setprojectile[FLAMEPROJ].extra FLAMEDAMAGE
							setprojectile[FLAMEPROJ].drop -256
							setprojectile[FLAMEPROJ].workslike 118850
							setprojectile[FLAMEPROJ].hitradius 768
							setprojectile[FLAMEPROJ].range 15
							setprojectile[FLAMEPROJ].spawns FLAMEPROJSPAWNED
							
							add atemp3 1
						}
						
						resetcount
					}
				}
				
					ife atmp 60
					ifcount 20
					{
						espawn BOSS2
						set bossfighton RETURN
						seta[RETURN].xrepeat 80
						seta[RETURN].yrepeat 80
						seta[RETURN].yvel 1
						spawn EXPLOSION2
						sound PIPEBOMB_EXPLODE
						
						espawn JELLYCONNECTORACTOR
						seta[RETURN].yvel 3
						geta[RETURN].z atemp2
						sub atemp2 8192
						seta[RETURN].z atemp2
						
						setactorvar[RETURN].atmp -32768
						geta[].ang atemp
						sub atemp 512
						seta[RETURN].ang atemp
						
						espawn JELLYCONNECTORACTOR
						seta[RETURN].yvel 3
						geta[RETURN].z atemp2
						sub atemp2 8192
						seta[RETURN].z atemp2
						
						setactorvar[RETURN].atmp -32768
						geta[].ang atemp
						add atemp 512
						seta[RETURN].ang atemp
						
						espawn JELLYCONNECTORACTOR
						seta[RETURN].yvel 3
						geta[RETURN].z atemp2
						sub atemp2 8192
						seta[RETURN].z atemp2
						
						geta[].ang atemp
						sub atemp 512
						seta[RETURN].ang atemp
						
						espawn JELLYCONNECTORACTOR
						seta[RETURN].yvel 3
						geta[RETURN].z atemp2
						sub atemp2 8192
						seta[RETURN].z atemp2
						
						geta[].ang atemp
						add atemp 512
						seta[RETURN].ang atemp
						
						
						espawn JELLYCONNECTORACTOR
						seta[RETURN].yvel 23
						geta[RETURN].z atemp2
						sub atemp2 8192
						seta[RETURN].z atemp2
										
						geta[].ang atemp
						rand atemp2 128
						add atemp atemp2
						seta[RETURN].ang atemp
						
						espawn JELLYCONNECTORACTOR
						seta[RETURN].yvel 23
						geta[RETURN].z atemp2
						sub atemp2 8192
						seta[RETURN].z atemp2
										
						geta[].ang atemp
						rand atemp2 128
						add atemp atemp2
						seta[RETURN].ang atemp
						
						addkills 1
						
						killit
					}
			}
		}
  }
  else ifai AIBOSS2COMEBACK
  {
	ifactioncount 2
	{
		ai AIBOSS2RUNENEMY
		set atmp2 0
		seta[].yvel 0
		cstat 257
	}
	else ifactioncount 1
	{
		ife atmp2 1
		{
			operatemasterswitches 6666
			operateactivators 6666 0
			
			geta[].ang atemp
			
			espawn JELLYCONNECTORACTOR
			seta[RETURN].yvel 3
			geta[RETURN].z atemp2
			sub atemp2 8192
			seta[RETURN].z atemp2
			
			set atemp3 0
			
			whilen atemp3 8
			{
				espawn JELLYCONNECTORACTOR
				seta[RETURN].yvel 3
				geta[RETURN].z atemp2
				sub atemp2 8192
				seta[RETURN].z atemp2
				add atemp 256
				seta[RETURN].ang atemp
				
				add atemp3 1
			}
			
			set atmp2 2
		}
	}
  }
  else ifai AIBOSS2TRANSFORM2
  {
		cstat 0
		
		ife boss3musictrack 0
			state PlayLoadingMusic
			
		set boss3musictrack 1
		
		ifaction ABOSS2TRANSFORM2
		ifactioncount 5
		{
			action ABOSS2TRANSFORM3
			add atmp2 1
			globalsound BOS2_PAIN
			guts JIBS6 5
			geta[].ang atemp
						set atemp3 0
						whilen atemp3 4
						{
							sound FLAMEALT_SOUND
							setprojectile[FLAMEPROJ].extra 10
							setprojectile[FLAMEPROJ].drop -256
							setprojectile[FLAMEPROJ].workslike 86082
							setprojectile[FLAMEPROJ].hitradius 1024
							setprojectile[FLAMEPROJ].range 0
							setprojectile[FLAMEPROJ].vel 128
							setprojectile[FLAMEPROJ].spawns FLAMECLUSTERSPAWNER
							ezshoot -4096 FLAMEPROJ
							add atemp 512
							seta[].ang atemp
							setprojectile[FLAMEPROJ].vel 812
							setprojectile[FLAMEPROJ].extra FLAMEDAMAGE
							setprojectile[FLAMEPROJ].drop -256
							setprojectile[FLAMEPROJ].workslike 118850
							setprojectile[FLAMEPROJ].hitradius 768
							setprojectile[FLAMEPROJ].range 15
							setprojectile[FLAMEPROJ].spawns FLAMEPROJSPAWNED
							
							add atemp3 1
						}
		}
		
		ifaction ABOSS2TRANSFORM3
		ifactioncount 5
		{
			ife atmp2 4
			{
				set cycloid_final 2
				
				set atemp8 BOSS2FINALSTRENGTH
				ife userdef.enable_nuke 1
				ife userdef.nuke_active 1
				{
					mul atemp8 userdef.nuke_enemyhealth
					div atemp8 100
				}
				
				seta[].extra atemp8
				set bossfighton THISACTOR
				
				espawn JELLYCONNECTORACTOR
				seta[RETURN].yvel 23
				geta[RETURN].z atemp2
				sub atemp2 8192
				seta[RETURN].z atemp2
										
				geta[].ang atemp
				rand atemp2 128
				add atemp atemp2
				seta[RETURN].ang atemp
				
				espawn JELLYCONNECTORACTOR
				seta[RETURN].yvel 21
				geta[RETURN].z atemp2
				sub atemp2 8192
				seta[RETURN].z atemp2
										
				geta[].ang atemp
				rand atemp2 128
				add atemp atemp2
				seta[RETURN].ang atemp
				
				espawn JELLYCONNECTORACTOR
				seta[RETURN].yvel 23
				geta[RETURN].z atemp2
				sub atemp2 8192
				seta[RETURN].z atemp2
										
				geta[].ang atemp
				rand atemp2 128
				add atemp atemp2
				seta[RETURN].ang atemp
				
				espawn JELLYCONNECTORACTOR
				seta[RETURN].yvel 22
				geta[RETURN].z atemp2
				sub atemp2 8192
				seta[RETURN].z atemp2
										
				geta[].ang atemp
				rand atemp2 1024
				add atemp atemp2
				seta[RETURN].ang atemp
				
				espawn JELLYCONNECTORACTOR
				seta[RETURN].yvel 22
				geta[RETURN].z atemp2
				sub atemp2 8192
				seta[RETURN].z atemp2
										
				geta[].ang atemp
				rand atemp2 1024
				sub atemp atemp2
				seta[RETURN].ang atemp
				
				espawn JELLYCONNECTORACTOR
				seta[RETURN].yvel 20
				geta[RETURN].z atemp2
				sub atemp2 8192
				seta[RETURN].z atemp2
										
				geta[].ang atemp
				rand atemp2 1024
				add atemp atemp2
				seta[RETURN].ang atemp
				
				espawn JELLYCONNECTORACTOR
				seta[RETURN].yvel 20
				geta[RETURN].z atemp2
				sub atemp2 8192
				seta[RETURN].z atemp2
										
				geta[].ang atemp
				rand atemp2 1024
				sub atemp atemp2
				seta[RETURN].ang atemp
				
				cstat 257
				set atmp2 0
				ai AIBOSS2LOBBED
				geta[].ang atemp
						set atemp3 0
						whilen atemp3 4
						{
							sound FLAMEALT_SOUND
							setprojectile[FLAMEPROJ].extra 10
							setprojectile[FLAMEPROJ].drop -256
							setprojectile[FLAMEPROJ].workslike 86082
							setprojectile[FLAMEPROJ].hitradius 1024
							setprojectile[FLAMEPROJ].range 0
							setprojectile[FLAMEPROJ].vel 128
							setprojectile[FLAMEPROJ].spawns FLAMECLUSTERSPAWNER
							ezshoot -4096 FLAMEPROJ
							add atemp 512
							seta[].ang atemp
							setprojectile[FLAMEPROJ].vel 812
							setprojectile[FLAMEPROJ].extra FLAMEDAMAGE
							setprojectile[FLAMEPROJ].drop -256
							setprojectile[FLAMEPROJ].workslike 118850
							setprojectile[FLAMEPROJ].hitradius 768
							setprojectile[FLAMEPROJ].range 15
							setprojectile[FLAMEPROJ].spawns FLAMEPROJSPAWNED
							
							add atemp3 1
						}
			}
			else
			{
				action ABOSS2TRANSFORM2
				add atmp2 1
				globalsound BOS2_PAIN
				guts JIBS6 5
				geta[].ang atemp
						set atemp3 0
						whilen atemp3 4
						{
							sound FLAMEALT_SOUND
							setprojectile[FLAMEPROJ].extra 10
							setprojectile[FLAMEPROJ].drop -256
							setprojectile[FLAMEPROJ].workslike 86082
							setprojectile[FLAMEPROJ].hitradius 1024
							setprojectile[FLAMEPROJ].range 0
							setprojectile[FLAMEPROJ].vel 128
							setprojectile[FLAMEPROJ].spawns FLAMECLUSTERSPAWNER
							ezshoot -4096 FLAMEPROJ
							add atemp 512
							seta[].ang atemp
							setprojectile[FLAMEPROJ].vel 812
							setprojectile[FLAMEPROJ].extra FLAMEDAMAGE
							setprojectile[FLAMEPROJ].drop -256
							setprojectile[FLAMEPROJ].workslike 118850
							setprojectile[FLAMEPROJ].hitradius 768
							setprojectile[FLAMEPROJ].range 15
							setprojectile[FLAMEPROJ].spawns FLAMEPROJSPAWNED
							
							add atemp3 1
						}
			}
		}
  }
  else ifai AIBOSS2DODGE
  {
	ifactioncount 4
	{
		ifrnd 128
			ai AIBOSS2SHOOTENEMY
		else
			ai AIBOSS2RUNENEMY
	}
  }

  ife atmp2 0
  {
	  ifai AIBOSS2DYING
		state boss2dyingstate
	  else
	  {
		ifhitweapon state checkboss2hitstate
		else
		  ifp palive
			ifspritepal 0
			{
				ife cycloid_final 2
				{
					ifpdistl 4096
					{
					  addphealth -1000
					  palfrom 63 63
					}
				}
				else
				{
					ifpdistl 1280
					{
					  addphealth -1000
					  palfrom 63 63
					}
				}
			}
	  }
  }


ends

actor BOSS2 BOSS2STRENGTH fall state boss2code enda
useractor enemy BOSS2RED BOSS2STRENGTH
	fall
	
	ifai 0
	{
		sizeat 64 64
		clipdist 164
		cstat 257
	}
	
	state boss2code
enda

action ABOSS3WALK        0  4  5  1  25
action ABOSS3FROZEN        0  1  5
action ABOSS3RUN         0  4  5  1  10
action ABOSS3LOB        20 4  5  1  50
action ABOSS3LOBBING      30 2  5  1  18
action ABOSS3GUNNING	 535 2  5  1  7
action ABOSS3DYING        40 8  1  1  30
action BOSS3FLINTCH       40 1  1  1  1
action ABOSS3DEAD         48

move PALBOSS3SHRUNKRUNVELS 32
move PALBOSS3RUNVELS 192
move BOSS3WALKVELS 280
move BOSS3RUNVELS 360
move BOSS3STOPPED

ai AIBOSS3SEEKENEMY ABOSS3WALK BOSS3WALKVELS seekplayer
ai AIBOSS3DODGE ABOSS3RUN BOSS3RUNVELS dodgebullet
ai AIBOSS3RUNENEMY ABOSS3RUN BOSS3RUNVELS faceplayersmart
ai AIBOSS3LOBENEMY ABOSS3LOB BOSS3STOPPED faceplayersmart
ai AIBOSS3DYING ABOSS3DYING BOSS3STOPPED faceplayer
ai AIBOSS3PALSHRINK ABOSS3WALK PALBOSS3SHRUNKRUNVELS faceplayer

state boss3palshrunkstate
  ifcount SHRUNKDONECOUNT
    ai AIBOSS3SEEKENEMY
  else
    ifcount SHRUNKCOUNT
	{
		sizeto 40 40
	 }
  else
    state genericshrunkcode
ends

state checkboss3seekstate
  ai AIBOSS3SEEKENEMY
  ifspritepal 0 nullop
  else   // a fake way of doing a ifspritepal NOT.
    move PALBOSS3RUNVELS seekplayer
ends

state boss3runenemystate

  ifge userdef.player_skill 4
  ifg PlayerLives 0
		nullop
   else
  ifcount 48
  ifbulletnear
	ifrnd 24
		ai AIBOSS3DODGE

  ifcansee
  {
    ifactioncount 3
    {
      ifcanshoottarget
      {
	    ifspritepal 0
			resetactioncount
		else ifrnd 128
			ai AIBOSS3SEEKENEMY
			
        sound BOS1_WALK
      }
      else
        ai AIBOSS3SEEKENEMY
    }
  }
  else
    ai AIBOSS3SEEKENEMY
ends

state boss3seekenemystate
  ifrnd 2
    soundonce BOS3_ROAM
  else
    ifactioncount 3
    {
      resetactioncount
      sound BOS1_WALK
	  
	  ifspritepal 0
		quake 1
    }
	
	ifge userdef.player_skill 4
	ifg PlayerLives 0
		nullop
	else
	ifbulletnear
	ifrnd 48
		ai AIBOSS3DODGE
	
ifspritepal 0
{
  ifcansee
    ifcount 32
      ifrnd 48
        ifcanshoottarget
  {
    ifge userdef.player_skill 4
	ifg PlayerLives 0
		nullop
	else
    ifrnd 64
	  ifg PlayerLives 0
      ifpdistg 4096
      {
        ai AIBOSS3RUNENEMY
        ifspritepal 0
          break
        move PALBOSS3RUNVELS seekplayer
        break
      }

    ifp palive
      ai AIBOSS3LOBENEMY
  }
}
  else
  {
	  ifcanseetarget
		ifcount 32
		  ifrnd 192
			//ifcanshoottarget
	  {
		ifrnd 32
		  ifpdistg 8192
		  {
			ai AIBOSS3RUNENEMY
			move PALBOSS3RUNVELS seekplayer
			break
		  }

		ifp palive
		  ai AIBOSS3LOBENEMY
	  }
  }
ends

state boss3dyingstate
  ifaction ABOSS3DEAD
  {
    ifspritepal 0
      break
	else
	{
		action 0
		cactor BOSS3DEAD
		strength 0
		cstat 0
		break
	}
    ifrespawn
      ifcount RESPAWNACTORTIME
    {
      spawn TRANSPORTERSTAR
      cstat 257
      strength PIGCOPSTRENGTH
      state checkboss3seekstate
    }
    else
    {
      strength 0
      ifhitweapon
        ifwasweapon RADIUSEXPLOSION
      {
        sound SQUISHED
        state standard_jibs
        killit
      }
      break
    }
  }
  ifactioncount 8
  {
    iffloordistl 8
      sound THUD
    action ABOSS3DEAD
    cstat 0
    ifspritepal 0	
		set endgame 1
	else ifrnd 72
		spawn ONEUP
  }
  else ifactioncount 3
	nullop
  else ifactioncount 2
  {
	ifspritepal 0
	{
		state NextSample
		set loopMusic NO
	}
  }
ends

state boss3lobbedstate

  //ifcanseetarget
  //{
    ifaction ABOSS3LOBBING
      ifactioncount 2
	  {
	    ifl sprite[].extra 2500
		ifspritepal 0
		{
			shoot RPG
				
			ifrnd 96
			{
				spawn FIREBALL
				spawn FIREBALL
				spawn FIREBALL
				spawn FIREBALL
				ifrnd 72
				{
					espawn JELLYCONNECTORACTOR
					seta[RETURN].yvel 3
					geta[RETURN].z atemp2
					sub atemp2 8192
					seta[RETURN].z atemp2
						
					setactorvar[RETURN].atmp -32768
					displayrandvar atemp 2048
					seta[RETURN].ang atemp
				}
			}
		}
		else
			shoot RPG
		
		sound RPG_SHOOT
      resetactioncount
	  
	  ifspritepal 0
      ifrnd 2
        ai AIBOSS3SEEKENEMY
    }
	
	ifaction ABOSS3GUNNING
      ifactioncount 2
	  {
		state ShootSpark
		state ShootSpark
		state ShootSpark
		ifle userdef.player_skill 4
		{
			state ShootSpark
			state ShootSpark
		}
		sound CHAINGUN_FIRE
      resetactioncount
	  
	  ifspritepal 0
      ifrnd 2
        ai AIBOSS3SEEKENEMY
    }

    ifactioncount 3
    {
		ifrnd 128
			action ABOSS3GUNNING
		else
			action ABOSS3LOBBING
		
      resetcount
    }
  //}
  
  ifcount 60
  {
      ifspritepal 0
	  {
		  ifrnd 4
		  ifcanseetarget
			state checkboss3seekstate
	  }
	  else
	  {
		ifpdistg 16384
		{
			ifrnd 2
				state checkboss3seekstate
		}
		else ifrnd 4
			ifcansee
				state checkboss3seekstate
	 }
  }
ends

state boss3lobbed2state

    ifaction ABOSS3LOBBING
      ifactioncount 2
	  {
	    ifl sprite[].extra 2500
		ifspritepal 0
		{
			ifrnd 96
				shoot RPG
			else
				zshoot -6144 CLUSTERPROJ
				
			ifrnd 96
			{
				spawn FIREBALL
				spawn FIREBALL
				spawn FIREBALL
				spawn FIREBALL
			}
		}
		else
			shoot RPG
		
		sound RPG_SHOOT
      resetactioncount
	  
    }
ends

state checkboss3hitstate
  ifrnd 2
    spawn BLOODPOOL
  ifdead
  {
    ifspritepal 0
	{
      globalsound DUKE_TALKTOBOSSFALL
	  set boss1fx 0
	}
    else
    {
      ifrnd 64
        globalsound DUKE_TALKTOBOSSFALL
      ifwasweapon FREEZEBLAST
      {
        sound SOMETHINGFROZE
        spritepal 1
        move 0
        action ABOSS3FROZEN
        strength 0
        break
      }
	  else ifwasweapon FLAMEPROJ
		state genericburn_dead_code
    }

    addkills 1
	add s_bosskill 1
    ai AIBOSS3DYING

    sound BOS3_DYING
    sound JIBBED_ACTOR9

  }
  else
  {
    ifai AIBOSS3LOBENEMY nullop
	else
    {
	  ifspritepal 0
	  {
	    ife boss1fx 0
		ifrnd 32
		{
			action BOSS3FLINTCH
			move 0
		}
	  }
	  else 
	  {
	    ifnotmoving
			ai AIBOSS3LOBENEMY
		else ifrnd 96
			ai AIBOSS3LOBENEMY
	  }

	  ifrnd 128
		state SpawnShards3
    }
	
    ifspritepal 0 nullop
    else
	{
		ifwasweapon SHRINKSPARK
		{
		  sound ACTOR_SHRINKING
		  ai AIBOSS3PALSHRINK
		  break
		}
		else ifwasweapon FLAMEPROJ
			set a_flaming 1
	}
	
	ifwasweapon PLASMAPROJ
		set a_plasmaeffect 1

    soundonce BOS3_PAIN

    debris SCRAP1 1
    guts JIBS6 1
  }
ends

state boss3code

	ifdead nullop
	else ifg a_plasmaeffect 1
	ifrnd 64
	{
		action BOSS3FLINTCH
		move BOSS3STOPPED
	}
	
	ife overlord_init 2
	{
		set atemp BOSS3STRENGTH
		div atemp 4
		mul atemp 3
		
		ifl sprite[].extra atemp
			set overlord_init 3
	}
	else ife overlord_init 3
	{
		cstat 0
		ifai AIBOSS3SEEKENEMY
			nullop
		else
			ai AIBOSS3SEEKENEMY
			
		ifaction ABOSS3WALK
			nullop
		else
			action ABOSS3WALK
			
		//move BOSS3WALKVELS geth
		
		geta[overlord_SEpos].x atemp
		geta[overlord_SEpos].y atemp2
		sub atemp sprite[].x
		sub atemp2 sprite[].y
		getangle atemp3 atemp atemp2
		
		ldist atemp THISACTOR overlord_SEpos
		
		ifle atemp 2048
		{
			set overlord_init 4
			cstat 257
		}
		
		seta[].ang atemp3
	}
	else ifge overlord_init 4
	ifl overlord_init 60
	{
		
		seta[].ang sprite[overlord_SEpos].ang
		ifai AIBOSS3LOBENEMY
			nullop
		else
			ai AIBOSS3LOBENEMY
			
		ifaction ABOSS3LOBBING
			nullop
		else
			action ABOSS3LOBBING
			
		//move BOSS3STOPPED geth
		
		ifl overlord_init 55
			add overlord_init 1
		else
		{
			operatemasterswitches 6666
			operateactivators 6666 0
			operaterespawns 6668
			
			set atemp 0
			for atemp allsprites
			{
				ife sprite[atemp].picnum SECTOREFFECTOR
				ife sprite[atemp].lotag 61
				ife sprite[atemp].hitag 6666
					setactorvar[atemp].se61a 1
			}
			
			ai AIBOSS3RUNENEMY
			
			set overlord_init 60
		}
	}
	else ifge overlord_init 60
	{
		ifl sprite[].extra 2000
		ifg sprite[].extra 0
		{
			ife boss1fx 0
			{
				//state NextSample
				ifai AIBOSS3SEEKENEMY
				{
					set atemp 0
					for atemp spritesofstatus 7
					{
						ife sprite[atemp].picnum LOCATORS
						ife sprite[atemp].lotag 1
							break
					}
					
					ldist atemp2 atemp THISACTOR
					
					ifl atemp2 512
					{
						add s_bosskill 1
						set boss1fx 1
						ai AIBOSS3LOBENEMY
						action ABOSS3LOBBING
					}
					else
					{
						geta[atemp].x atemp4
						geta[atemp].y atemp5
						sub atemp4 sprite[].x
						sub atemp5 sprite[].y
						getangle atemp3 atemp4 atemp5
						seta[].ang atemp3
					}
				}
				else
					ai AIBOSS3SEEKENEMY
			}
			else
			{
				ifai AIBOSS3LOBENEMY
					nullop
				else ife a_plasmaeffect 0
				{
					ai AIBOSS3LOBENEMY
					action ABOSS3LOBBING
				}
				
				move BOSS3STOPPED faceplayer
				
				ifaction ABOSS3LOBBING
					nullop
				else
					action ABOSS3LOBBING
			}
		}
	
		ife overlord_init 60
		ifl sprite[].extra 500
		{
			set overlord_init 61
			
			sound ALIEN_DOOR2
			
			operateactivators 6667 0
			
			set atemp 0
			for atemp allsprites
			{
				ife sprite[atemp].picnum SECTOREFFECTOR
				ife sprite[atemp].lotag 61
				ife sprite[atemp].hitag 6666
					setactorvar[atemp].se61a 0
			}
		}
	}
	
  ifaction ABOSS3FROZEN
  {
    ifhitweapon
    {
      ifwasweapon FREEZEBLAST
      {
        strength 0
        break
      }

      addkills 1
	  add s_bosskill 1
      lotsofglass 30

      ifrnd 84
        spawn BLOODPOOL
      sound GLASS_BREAKING
      killit
    }
    ifp pfacing
      ifpdistl FROZENQUICKKICKDIST
        pkick
    break
  }
  ifai 0
  {
    ifspritepal 0
	{
      ai AIBOSS3LOBENEMY
	  action ABOSS3LOBBING
	  set bossfighton THISACTOR
	}
    else
    {
      strength BOSS3PALSTRENGTH
	  
	  ife userdef.enable_nuke 1
	  ife userdef.nuke_active 1
	  {
		set ue_temp userdef.nuke_enemyhealth
		mul ue_temp sprite[].extra
		div ue_temp 100
		seta[].extra ue_temp
	  }
	  sizeat 40 40
      ai AIBOSS3LOBENEMY
	  setarray bosspal[num_bosspalfight] THISACTOR
	  add num_bosspalfight 1
    }
  }
  else
    ifaction BOSS3FLINTCH
    {
      ifactioncount 3
	  {
		ifp palive
		ifcansee
		ifcanshoottarget
		ifrnd 164
		{
			ifai AIBOSS3LOBENEMY nullop
			else
				ai AIBOSS3LOBENEMY	
		}
		else
			ai AIBOSS3SEEKENEMY
	  }
    }
  else
    ifai AIBOSS3SEEKENEMY
      state boss3seekenemystate
  else
    ifai AIBOSS3DODGE
	{
		ifcount 5
		{
			ifrnd 96
				ai AIBOSS3SEEKENEMY
			else
				ai AIBOSS3RUNENEMY		
			resetcount
		}
	}
  else
    ifai AIBOSS3RUNENEMY
      state boss3runenemystate
  else
    ifai AIBOSS3LOBENEMY
        state boss3lobbedstate
  else
    ifai AIBOSS3PALSHRINK
      state boss3palshrunkstate

  ifai AIBOSS3DYING
    state boss3dyingstate
  else
  {
    ifhitweapon
      state checkboss3hitstate
    else
      ifp palive
        ifspritepal 0
          ifpdistl 1280
      {
        addphealth -1000
        palfrom 63 63
      }
  }
ends

actor BOSS3 BOSS3STRENGTH fall state boss3code enda
useractor enemystayput BOSS3STAYPUT BOSS3STRENGTH fall cstat 257 cactor BOSS3 enda

action ACOMMBREETH  0  3  5  1  40
action ACOMMFROZEN  0  1  5
action ACOMMSPIN   -5  1  5  1  12
action ACOMMGET   0  3  5  1  30
action ACOMMSHOOT  20  1  5   1 35
action ACOMMABOUTTOSHOOT 20 1 5 1 30
action ACOMMDYING  30  8  1  1  12
action ACOMMDEAD   38  1  1  1  1
action ACOMMHEADLESS 1862 7 1 1 15
action ACOMMHOLE 2052 6 1 1 25
action ACOMMHOLEDEAD 2058 1 1
action ACOMMHACKED -50 9 1 1 18

move COMMGETUPVELS 128 -64
move COMMGETVELS 128 64
move COMMSLOW 64 24
move COMMSTOPPED

ai AICOMMWAIT ACOMMBREETH COMMSTOPPED faceplayerslow
ai AICOMMGET ACOMMGET COMMGETVELS seekplayer
ai AICOMMSHOOT ACOMMSHOOT COMMSTOPPED faceplayerslow
ai AICOMMABOUTTOSHOOT ACOMMABOUTTOSHOOT COMMSTOPPED faceplayerslow
ai AICOMMSPIN ACOMMSPIN COMMGETVELS spin
ai AICOMMDYING ACOMMDYING COMMSTOPPED faceplayer
ai AICOMMSHRUNK ACOMMGET COMMSLOW furthestdir
ai AICOMMGROW ACOMMGET COMMSTOPPED furthestdir

state checkcommhitstate

  ifhitweapon
  {
    guts JIBS6 2

    ifdead
    {
	  state drop_cola
      ifwasweapon FREEZEBLAST
      {
        sound SOMETHINGFROZE
        spritepal 1
        move 0
        action ACOMMFROZEN
        strength 0
        break
      }
      else
        ifwasweapon GROWSPARK
      {
        sound ACTOR_GROWING
        ai AICOMMGROW
        break
      }

      addkills 1
	  
	  ifwasweapon CATERKILAR
	  {
	    ifrnd 96
		{
			ai AICOMMDYING
			state random_wall_jibs
			sound SQUISHED
			state comm_headjib
			action ACOMMHEADLESS
			break
		}
		else ifrnd 96
		{
			ai 0
			action 0
			move 0
			spawn EXPLOSION2
			sound RPG_EXPLODE
			state standard_jibs
			state random_wall_jibs
			state standard_scraps
			state SpawnShards
			cactor COMMCRAWLING
			break
		}
		else
		{
			ai AICOMMDYING
			action ACOMMHACKED
			state random_wall_jibs
			sound SQUISHED
			break
		}
	  }
	  
	ifwasweapon PLASMAPROJ
      {
        spawn BLOODPOOL
        sound SQUISHED
        state standard_jibs
        killit
      }
      else
      ifwasweapon RADIUSEXPLOSION
      {
        spawn BLOODPOOL
        sound SQUISHED
        state standard_jibs
        killit
      }
      else
        ifwasweapon RPG
      {
        sound SQUISHED
        spawn BLOODPOOL
        state standard_jibs
        killit
      }
	  
	  ifwasweapon FLAMEPROJ
		state genericburn_dead_code
	  
      sound COMM_DYING
      ai AICOMMDYING
    }
    else
    {
	  ifwasweapon SONICPROJ
	  {
		ife commpad 1
		{
			ezshoot -6144 FLYPAD
			geta[].htang atemp
			//add atemp 1024
			seta[RETURN].ang atemp
			
			spawn EXPLOSION2
			sound RPG_EXPLODE
			state standard_jibs
			state random_wall_jibs
			state standard_scraps
			state standard_scraps
			state standard_scraps
			ai 0
			action 0
			move 0
			cactor COMMCRAWLING
			break
		}
	  }
	  
	  ifwasweapon RPG
      {
		addkills 1
        sound SQUISHED
        spawn BLOODPOOL
        state standard_jibs
        killit
      }
	
	  ifwasweapon CATERKILAR
		{
			ifrnd 32
				state SpawnShards2
					
			ai AICOMMWAIT
		}
	
	  ifwasweapon FLAMEPROJ
			set a_flaming 1
			
		ifwasweapon PLASMAPROJ
		set a_plasmaeffect 1
		
      soundonce COMM_PAIN
      ifwasweapon SHRINKSPARK
      {
        sound ACTOR_SHRINKING
        ai AICOMMSHRUNK
      }
      else
        ifwasweapon GROWSPARK
          sound EXPANDERHIT
      else
        ifrnd 24
          ai AICOMMABOUTTOSHOOT
    }
  }
ends

actor COMMANDERSTAYPUT COMMANDERSTRENGTH
  cactor COMMANDER
  ai AICOMMABOUTTOSHOOT
enda

actor COMMANDER COMMANDERSTRENGTH

  state checksquished
  
   ifdead nullop
   else ifg a_plasmaeffect 0
	{
		ifrnd 64
			ai AICOMMWAIT
	}
	
  ife projpass 1
  {
		ai AICOMMDYING
		action ACOMMHOLE
		strength -1
		cstat 0
		guts JIBS6 3
		guts JIBS3 3
		guts JIBS1 1
		sound SQUISHED
		state random_wall_jibs
		state random_wall_jibs
		set projpass 2
  }

  ifaction ACOMMFROZEN
  {
    fall

    ifcount THAWTIME
    {
      getlastpal
      ai AICOMMWAIT
    }
    else
      ifcount FROZENDRIPTIME
    {
      ifactioncount 26
      {
        spawn WATERDRIP
        resetactioncount
      }
    }

    ifhitweapon
    {
      ifwasweapon FREEZEBLAST
      {
        strength 0
        break
      }
      addkills 1

      ifrnd 84
        spawn BLOODPOOL
      lotsofglass 30
      sound GLASS_BREAKING
      killit
    }
    ifp pfacing
      ifpdistl FROZENQUICKKICKDIST
        pkick
    break
  }
  ifai 0
    ai AICOMMSHOOT
  else
    ifai AICOMMWAIT
  {
    ifcount 20
    {
      ifcansee
      {
        ifcanshoottarget
        {
          ifrnd 96
            ai AICOMMGET
          else
            ai AICOMMABOUTTOSHOOT
        }
      }
      else
        ai AICOMMGET
    }
  }
  else
    ifai AICOMMABOUTTOSHOOT
  {
    ifactioncount 2
    {
      ifcansee
        ai AICOMMSHOOT
      else
      {
        ai AICOMMGET
        break
      }
    }
    ifrnd 32 soundonce COMM_ATTACK
  }
  else
    ifai AICOMMSHOOT
  {
    ifcanshoottarget
    {
      ifcount 24
        ifrnd 16
          ai AICOMMWAIT
      ifactioncount 2
      {
	    setprojectile[ROCKETPROJ].extra 15
        eshoot ROCKETPROJ
		setprojectile[ROCKETPROJ].extra ROCKETDAMAGE
        resetactioncount
      }
    }
    else
      ai AICOMMGET
  }
  else
    ifai AICOMMSHRUNK
  {
    ifcount SHRUNKDONECOUNT
      ai AICOMMGET
    else
      ifcount SHRUNKCOUNT
        sizeto 48 40
    else
      state genericshrunkcode
  }
  else
    ifai AICOMMGROW
      state genericgrowcode
  else
    ifai AICOMMGET
  {
    ifnotmoving
      ifrnd 4
        operate
    ifpdistl 1024
      ifp palive
    {
      sound COMM_SPIN
      ai AICOMMSPIN
      break
    }

    ifcansee
    {
      ifp phigher
        move COMMGETUPVELS getv geth faceplayer
      else
        move COMMGETVELS getv geth faceplayer
    }
    ifactioncount 8
      ifrnd 2
        ai AICOMMABOUTTOSHOOT
  }
  else
    ifai AICOMMSPIN
  {
    soundonce COMM_SPIN
    ifcount 16
    {
      ifpdistl 1280
      {
        addphealth CAPTSPINNINGPLAYER
        sound DUKE_GRUNT
        palfrom 32
        16 resetcount
      }
      else
        ifpdistg 2300
          ai AICOMMWAIT
    }
    ifactioncount 52
      ai AICOMMWAIT
    ifnotmoving
      ifrnd 32
        operate
  }

  ifai AICOMMDYING
  {
    strength 0

	ifaction ACOMMHOLE
	{
		ifactioncount 4
			fall
		
		ifactioncount 6
		{
			iffloordistl 8
				sound THUD
			cstat 0
			action 0
			cactor COMMANDERHOLEDEAD
			break
		}
	}
	else
		fall
		
	ifaction ACOMMHACKED
	{
		cstat 0
		ifcount 16
		{
			state random_wall_jibs
			guts JIBS3 1
			guts JIBS6 2
			sound SQUISHED
			resetcount
		}
		
		ifactioncount 9
		{
			action 0
			cactor COMMHACKED
			sound THUD
			state SpawnShards
			spawn BLOODPOOL
			break
		}
	}

    ifhitweapon
      ifwasweapon RADIUSEXPLOSION
    {
      sound SQUISHED
      spawn BLOODPOOL
      state standard_jibs
	  state drop_cola
      killit
    }

    ifaction ACOMMDYING
      ifactioncount 8
    {
      iffloordistl 8
        sound THUD
      cstat 0
      action 0
	  cactor COMMANDERDEAD
	  break
    }
	else ifaction ACOMMHEADLESS
	{
		ifactioncount 7
		{
		  iffloordistl 8
			sound THUD
		  cstat 0
		  state SpawnShards
		  action 0
		  cactor COMMANDERHEADLESS
		  break
		}
	}
  }
  else
  {
    ifrnd 2
      soundonce COMM_ROAM
    state checkcommhitstate
  }
enda


// CANNONBALL for Pirates of the Carribean
define CANNONBALLSTRENGTH 400
move CANNONBALL1 512 0
move CANNONBALL2 512 10
move CANNONBALL3 512 20
move CANNONBALL4 512 40
move CANNONBALL5 512 80

useractor notenemy CANNONBALL CANNONBALLSTRENGTH

  ifaction 0
  {
    sizeat 32 32
    cstat 257         // Force actor to block
    action ANULLACTION
  }

    ifactioncount 46
    {
      ifactioncount 47 nullop
      else
        move CANNONBALL5 geth getv
    }
    else
      ifactioncount 44
    {
      ifactioncount 45 nullop
      else
        move CANNONBALL4 geth getv
    }
    else
      ifactioncount 40
    {
      ifactioncount 41 nullop
      else
        move CANNONBALL3 geth getv
    }
    else
      ifactioncount 32
    {
      ifactioncount 33 nullop
      else
        move CANNONBALL2 geth getv
    }
    else
      ifactioncount 16
    {
      ifactioncount 17 nullop
      else move CANNONBALL1 geth getv
    }

  ifnotmoving
  {
    spawn EXPLOSION2
    sound PIPEBOMB_EXPLODE
    hitradius 4096 WEAKEST WEAK MEDIUMSTRENGTH TOUGH
    killit
  }

  ifhitweapon
  {
    ifdead
    {
      spawn EXPLOSION2
      hitradius 4096 WEAKEST WEAK MEDIUMSTRENGTH TOUGH
      killit
    }
    else
      debris SCRAP1 3
  }

enda


define CANNONBALLS 1818
define CANNONBALLSSTRENGTH 10
move CANNONBALLSVEL

useractor notenemy CANNONBALLS CANNONBALLSSTRENGTH
  ifaction 0
  {
    cstator 257
    action ANULLACTION
  }
  ifhitweapon
  {
    ifdead
    {
      spawn EXPLOSION2
      hitradius 4096 WEAKEST WEAK MEDIUMSTRENGTH TOUGH
      killit
    }
    else
      debris SCRAP1 3
  }
enda


define CANNON 1810
define CANNONSTRENGTH 400
action ACANNONWAIT 0 1 7 1 1
action ACANNONSHOOTING 0 1 7 1 1
move CANNONSTOP

useractor enemy CANNON CANNONSTRENGTH // fall

  ifaction 0
  {
//    sizeat 64 64
    action ACANNONWAIT
  }
  else
    ifaction ACANNONSHOOTING
  {
    spawn CANNONBALL
    action ACANNONWAIT
  }
  else
    ifaction ACANNONWAIT
  {
    ifactioncount 64
    {
      ifrnd 128
        action ACANNONSHOOTING
      else
        resetactioncount
    }
  }

  ifhitweapon
  {
    ifdead
    {
      addkills 1
      hitradius 4096 WEAKEST WEAK MEDIUMSTRENGTH TOUGH
      spawn EXPLOSION2
      killit
    }
    else debris SCRAP1 3
  }

  ifpdistl 1024
    ifhitspace
  {
    ifp pfacing
      ifcanshoottarget
        spawn CANNONBALL
      else break
  }
enda

useractor notenemy HOTMEAT TOUGH
  ifaction 0
  {
    action ANULLACTION
    cstat 257
  }
  ifhitweapon
  {
    ifdead
    {
      sound SQUISHED
      guts JIBS5 8
      guts JIBS6 9
      killit
    }
    else
      guts JIBS6 1
  }
  ifrnd 1
    spawn WATERDRIP

enda

action ASPEAKERBROKE 1
useractor notenemy SPEAKER
  ifaction 0
  {
    ifhitweapon
    {
      stopsound STORE_MUSIC
      soundonce STORE_MUSIC_BROKE
      action ASPEAKERBROKE
    }
    else
    {
      ifpdistl 10240
          soundonce STORE_MUSIC
      cstat 289
    }
  }
enda

action ALAVABUBBLE
action ALAVABUBBLEANIM 0 5 1 1 16

useractor notenemy LAVABUBBLE
  ifaction 0
  {
    cstat 32768
    action ALAVABUBBLE
  }
  else
    ifaction ALAVABUBBLE
  {
    ifcount 72
      ifrnd 2
    {
      cstat 0
      action ALAVABUBBLEANIM
    }
  }
  else
  {
    ifactioncount 5
    {
      cstat 32768
      action ALAVABUBBLE
    }
  }
enda

// RIOT TANK with Pigcop inside

define TANKSTRENGTH       500      // 2 3 4 5 7 8
//           off-set, numofframes, numofrot, skipframes, delay
action ATANKSPIN   0 1 7 1 4
action ATANKSHOOTING 7 2 7 1 10
action ATANKWAIT 0 1 7 1 1
action ATANKDESTRUCT 0 1 7 1 1
action ATANKDEAD 0 1 7 1 1
// move TANKVEL horiz vert
move TANKFORWARD 100
move TANKSTOP

useractor enemy TANK TANKSTRENGTH fall

  ifaction 0
  {
    sizeat 60 60
    action ATANKWAIT
    cstat 257
    clipdist 100
  }
  else
    ifaction ATANKSPIN
  {
    soundonce TANK_ROAM

    ifactioncount 20
    {
      ifrnd 16
        ifcansee
          ifcanshoottarget
      {
        move TANKSTOP geth
        action ATANKSHOOTING
        stopsound TANK_ROAM
      }
    }

    ifrnd 16
      move TANKFORWARD seekplayer
  }
  else
    ifaction ATANKSHOOTING
  {
    ifactioncount 22
    {
      ifpdistg 8192
      {
        sound BOS1_ATTACK2
        shoot MORTER
      }
      resetcount
      move 0 action ATANKWAIT
    }
    else
      ifactioncount 2
    {
      ifcansee
      {
        ifpdistl 16384
        {
          ifrnd 128
          {
            sound PISTOL_FIRE
            state ShootSpark
          }
        }
        else
          ifrnd 128
        {
          sound PRED_ATTACK
          shoot FIRELASER
        }
      }
      else
      {
        move TANKFORWARD seekplayer
        action ATANKSPIN
      }
    }

    ifrnd 16
    {
      stopsound TANK_ROAM
      move TANKSTOP faceplayerslow
    }
  }
  else
    ifaction ATANKWAIT
  {
    ifactioncount 32
    {
      move TANKFORWARD seekplayer
      action ATANKSPIN
    }
  }
  else
    ifaction ATANKDESTRUCT
  {
    ifactioncount 64
      action ATANKDEAD
    else
      ifactioncount 56
       sound LASERTRIP_ARMING
     else
       ifactioncount 48
         sound LASERTRIP_ARMING
     else
       ifactioncount 32
         sound LASERTRIP_ARMING
     else
       ifactioncount 16
         sound LASERTRIP_ARMING
     break
  }
  else
    ifaction ATANKDEAD
  {
    addkills 1
    hitradius 2560 TOUGH TOUGH TOUGH TOUGH
    sound LASERTRIP_EXPLODE
    debris SCRAP1 15
    spawn EXPLOSION2
    ifrnd 128 spawn DPIGCOP
    killit
  }

  ifhitweapon
  {
    ifdead
      action ATANKDEAD
    else
    {
      debris SCRAP1 1
      ifaction ATANKSHOOTING break

      ifrnd 192
      {
        move TANKSTOP geth
        action ATANKSHOOTING
        stopsound TANK_ROAM
      }
    }
  }

  ifpdistl 1280
    ifhitspace
      ifp pfacing
        ifangdiffl 512
          action ATANKDESTRUCT
enda







action ABOSS4WALK          0 4  5  1  16
action ABOSS4DYING        40 9  1  1  40
action ABOSS4ABOUTTOSHOOT 20 1  5  1  40
action ABOSS4SHOOT        25 2  5  1  10
action ABOSS4LAYIT        50 3  5  1  120
action BOSS4FLINTCH       40 1  1  1  1
action ABOSS4DEAD         49

move BOSS4WALKVELS 350
move BOSS4STOPPED

ai AIBOSS4LAYEGGS ABOSS4WALK BOSS4WALKVELS faceplayerslow
ai AIBOSS4DODGE ABOSS4WALK BOSS4WALKVELS dodgebullet
ai AIBOSS4SHOOT ABOSS4ABOUTTOSHOOT BOSS4STOPPED faceplayersmart
ai AIBOSS4DYING ABOSS4DYING BOSS4STOPPED faceplayer
ai AIBOSS4PHASE ABOSS4ABOUTTOSHOOT BOSS4STOPPED randomangle geth

state boss4shootstate
  ifaction ABOSS4ABOUTTOSHOOT
    ifactioncount 3
	{
      action ABOSS4SHOOT
	  resetcount
	}

  ifaction ABOSS4SHOOT
  {
	set boss4att 1
    ifcount 48
    {
      ifrnd 4
        ai AIBOSS4LAYEGGS
    }
    ifcount 26
	{
		ifspritepal 0
		{
			set atemp3 -6144
			mul atemp3 atemp5
			
			set atemp 0
			set atemp2 sprite[].ang
			set atmp atemp2
			whilen atemp 4
			{
				eshoot COOLEXPLOSION1
				seta[].zvel 0
				geta[RETURN].z atemp4
				sub atemp4 atemp3
				seta[RETURN].z atemp4
				seta[RETURN].ang atemp2
				add atemp2 512
				add atemp 1
				seta[].ang atemp2
				
			}
			
			seta[].ang atmp
			
			set atemp 0
			set atemp2 sprite[].ang
			whilen atemp 16
			{
				setprojectile[PLASMAMICROPROJ].extra 3
				setprojectile[PLASMAMICROPROJ].xrepeat 14
				setprojectile[PLASMAMICROPROJ].yrepeat 14
				setprojectile[PLASMAMICROPROJ].velmult 2
				eshoot PLASMAMICROPROJ
				geta[RETURN].z atemp4
				sub atemp4 atemp3
				seta[RETURN].z atemp4
				seta[RETURN].ang atemp2
				add atemp2 128
				add atemp 1
				seta[].ang atemp2
				setprojectile[PLASMAMICROPROJ].extra PLASMAMICRO_DAMAGE
				setprojectile[PLASMAMICROPROJ].velmult 1
				setprojectile[PLASMAMICROPROJ].xrepeat 4
				setprojectile[PLASMAMICROPROJ].yrepeat 4
				
			}
			
			seta[].ang atmp
			
			ifl atemp5 10
				add atemp5 1
			else
				set atemp5 0
				
			ifrnd 196
			{
				setprojectile[PLASMAMICROPROJ].extra 2
				setprojectile[PLASMAMICROPROJ].xrepeat 14
				setprojectile[PLASMAMICROPROJ].yrepeat 14
				setprojectile[PLASMAMICROPROJ].velmult 2
				setprojectile[PLASMAMICROPROJ].pal 21
				displayrandvar atemp 64
				displayrandvar atemp2 1024
				displayrandvar atemp3 1024
				eshoot PLASMAMICROPROJ
				add atemp sprite[].ang
				displayrandvar atemp4 -64
				add atemp atemp4
				seta[RETURN].ang atemp
				sub atemp2 atemp3
				add atemp2 sprite[RETURN].zvel
				seta[RETURN].zvel atemp2
				setprojectile[PLASMAMICROPROJ].extra PLASMAMICRO_DAMAGE
				setprojectile[PLASMAMICROPROJ].velmult 1
				setprojectile[PLASMAMICROPROJ].xrepeat 4
				setprojectile[PLASMAMICROPROJ].yrepeat 4
				setprojectile[PLASMAMICROPROJ].pal 0
				sound PLASMAMICRO_FIRE
			}
		}
		else
		{
			ifrnd 128
			{
				setprojectile[PLASMAMICROPROJ].extra 2
				setprojectile[PLASMAMICROPROJ].xrepeat 14
				setprojectile[PLASMAMICROPROJ].yrepeat 14
				setprojectile[PLASMAMICROPROJ].velmult 2
				setprojectile[PLASMAMICROPROJ].pal 21
				displayrandvar atemp 64
				displayrandvar atemp2 1024
				displayrandvar atemp3 1024
				eshoot PLASMAMICROPROJ
				add atemp sprite[].ang
				displayrandvar atemp4 -64
				add atemp atemp4
				seta[RETURN].ang atemp
				sub atemp2 atemp3
				add atemp2 sprite[RETURN].zvel
				seta[RETURN].zvel atemp2
				setprojectile[PLASMAMICROPROJ].extra PLASMAMICRO_DAMAGE
				setprojectile[PLASMAMICROPROJ].velmult 1
				setprojectile[PLASMAMICROPROJ].xrepeat 4
				setprojectile[PLASMAMICROPROJ].yrepeat 4
				setprojectile[PLASMAMICROPROJ].pal 0
				sound PLASMAMICRO_FIRE
			}
		}
	}
	else ifcount 11
		set atemp5 0
	else ifcount 10
	{
		set atemp 0
		set atemp2 sprite[].ang
		whilen atemp 16
		{
			ifspritepal 21
			{
				setprojectile[FLAMEPROJ].extra 4
				setprojectile[FLAMEPROJ].extra_rand 2
				setprojectile[FLAMEPROJ].range 0
				eshoot FLAMEPROJ
				seta[RETURN].ang atemp2
				add atemp2 128
				add atemp 1
				seta[].ang atemp2
				setprojectile[FLAMEPROJ].extra FLAMEDAMAGE
				setprojectile[FLAMEPROJ].extra_rand 15
				setprojectile[FLAMEPROJ].range 15
			}
			else
			{
				setprojectile[PLASMAPROJ].extra 5
				eshoot PLASMAPROJ
				seta[RETURN].ang atemp2
				add atemp2 128
				add atemp 1
				seta[].ang atemp2
				setprojectile[PLASMAPROJ].extra PLASMA_DAMAGE
			}
		}
	}
  }

ends

state boss4layeggs
  ifrnd 2
    sound BOS4_ROAM

  ifaction ABOSS4LAYIT
  {
    ifactioncount 3
	{
		  ifcount 32
		{
		  ai AIBOSS4LAYEGGS
		  ifrnd 32
			move BOSS4WALKVELS faceplayerslow
		  
		  ifrnd 96
		  {
			espawn NEWBEASTHANG
		  
			  ifrnd 96
				seta[RETURN].pal 17
		  }
		  else
			spawn OCTABRAIN
		}
	}
	else ifactioncount 2
		nullop
	else ifactioncount 1
		ifbulletnear
			ai AIBOSS4DODGE
	
  }
  else
  {
	ifaction ABOSS4WALK
		ifbulletnear
			ifrnd 128
				ai AIBOSS4DODGE

		ifcount 64
		  ifrnd 4
	  {
		move 0

		ifrnd 88
		ifspritepal 0
		{
		  action ABOSS4LAYIT
		  state SpawnShards3
		  state SpawnShards3
		  sound BOS4_LAY
		}
		else
		  ifp palive
			ifcansee
		{
		  ai AIBOSS4SHOOT
		  sound BOS4_ATTACK
		}
	  }
  }

ends

state boss4dyingstate
  ifaction ABOSS4DEAD
    break
  else
    ifactioncount 9
  {
    iffloordistl 8
      sound THUD
    action ABOSS4DEAD
    cstat 0
  }
ends

state checkboss4hitstate
  ifrnd 2
    spawn BLOODPOOL

  ifdead
  {
    globalsound DUKE_TALKTOBOSSFALL

    addkills 1
    ai AIBOSS4DYING
	set endgame 1
	set loopMusic NO

    sound BOS4_DYING
    sound BOSS4_DEADSPEECH
  }
  else
  {
    soundonce BOS4_PAIN
    debris SCRAP1 1
    guts JIBS6 1

    ifaction ABOSS4LAYIT
	{
	  ifrnd 96
		state SpawnShards3
      break
	}
    
	ifai AIBOSS4PHASE
		break

    ifrnd 16
    {
      action BOSS4FLINTCH
	  state SpawnShards3
	  state SpawnShards3
      move 0
    }
  }
ends

state boss4code

	set cycloid_sprite THISACTOR
	
  ifaction ABOSS4SHOOT nullop
  else set boss4att 0

  ife boss4phase 1
  ifg SE120Active 16
  ifl sprite[].extra 5000
  {
	set boss4phase 2
	state NextSample
  }
	
  ifg boss4phase 11
  ifl sprite[].extra 2500
  ifg sprite[].extra 0
  {
    ife boss4phase 12
	{
		ifai AIBOSS4PHASE
			nullop
		else
		{
			operatemasterswitches 6680
			ai AIBOSS4PHASE
			action ABOSS4WALK
			move BOSS4WALKVELS geth
			state NextSample
		}
		
		ife boss4locator -1
		{
			set atemp 0
			for atemp spritesofstatus 7
			{
				ife sprite[atemp].picnum LOCATORS
				ife sprite[atemp].lotag 10
				{
					set boss4locator atemp
					break
				}
			}
		}
		else
		{
			geta[boss4locator].x atemp
			geta[boss4locator].y atemp2
			sub atemp sprite[].x
			sub atemp2 sprite[].y
			getangle atemp3 atemp atemp2
			seta[].ang atemp3
			
			ldist atemp THISACTOR boss4locator
			
			ifl atemp 256
			{
				ai AIBOSS4SHOOT
				action ABOSS4SHOOT
					
				set boss4locator -1
				
				set boss4phase 13
			}
		}
	}
	else
	{
		ifai AIBOSS4SHOOT
			nullop
		else 
			ai AIBOSS4SHOOT
			
		ifaction ABOSS4SHOOT
			nullop
		else
			action ABOSS4SHOOT
	}
  }
  
  ifge boss4phase 2
  ifl boss4phase 11
  {
	ifai AIBOSS4PHASE
		nullop
	else
	{
		ai AIBOSS4PHASE
		action ABOSS4WALK
		move BOSS4WALKVELS geth
	}
		
	ifaction ABOSS4WALK
	{
		ife boss4phase 10
		{
			add boss4phase 1
			action ABOSS4ABOUTTOSHOOT
			move BOSS4STOPPED
		}
	
		ife boss4locator -1
		{
			set atemp 0
			for atemp spritesofstatus 7
			{
				set atemp2 boss4phase
				sub atemp2 2
				
				ife sprite[atemp].picnum LOCATORS
				ife atemp2 sprite[atemp].lotag
				{
					set boss4locator atemp
					add boss4phase 1
					break
				}
			}
		}
		else
		{
			geta[boss4locator].x atemp
			geta[boss4locator].y atemp2
			sub atemp sprite[].x
			sub atemp2 sprite[].y
			getangle atemp3 atemp atemp2
			seta[].ang atemp3
			
			ldist atemp THISACTOR boss4locator
			
			ifl atemp 512
			{
				ife boss4phase 4
				{
					seta[].ang sprite[boss4locator].ang
					action ABOSS4SHOOT
					move BOSS4STOPPED
					resetcount
				}
				else
					set boss4locator -1
			}
		}
	}
	else ifaction ABOSS4SHOOT
	{
		soundonce BOS4_ATTACK
		
		ifcount 30
		{
			set boss4locator -1
			action ABOSS4WALK
			move BOSS4WALKVELS geth
		}
	
		ifcount 7
		ifrnd 128
		{
			setprojectile[PLASMAMICROPROJ].extra 3
			setprojectile[PLASMAMICROPROJ].xrepeat 14
			setprojectile[PLASMAMICROPROJ].yrepeat 14
			setprojectile[PLASMAMICROPROJ].pal 21
			displayrandvar atemp 128
			displayrandvar atemp2 2048
			displayrandvar atemp3 2048
			eshoot PLASMAMICROPROJ
			displayrandvar atemp4 -128
			add atemp atemp4
			add atemp sprite[].ang
			seta[RETURN].ang atemp
			sub atemp2 atemp3
			seta[RETURN].zvel atemp2
			setprojectile[PLASMAMICROPROJ].extra PLASMAMICRO_DAMAGE
			setprojectile[PLASMAMICROPROJ].xrepeat 4
			setprojectile[PLASMAMICROPROJ].yrepeat 4
			setprojectile[PLASMAMICROPROJ].pal 0
			sound PLASMAMICRO_FIRE
		
			shoot FLAMEPROJ
		}
	}
  }
  else ife boss4phase 11
  {
	ifaction ABOSS4ABOUTTOSHOOT
	{
		ifactioncount 5
		{
			action ABOSS4SHOOT
			move BOSS4STOPPED faceplayerslow
			set boss4att 1
			resetcount
		}
	}
	else ifaction ABOSS4SHOOT
	{
		soundonce BOS4_ATTACK
		
		ifpdistl 8192
		ifcansee
		{
			seta[].yvel 1
			set atemp5 0
		}
			
		ife sprite[].yvel 1
		{
			
			set atemp3 -6144
			mul atemp3 atemp5
			
			set atemp 0
			set atemp2 sprite[].ang
			set atmp atemp2
			whilen atemp 8
			{
				eshoot COOLEXPLOSION1
				seta[].zvel 0
				geta[RETURN].z atemp4
				sub atemp4 atemp3
				seta[RETURN].z atemp4
				seta[RETURN].ang atemp2
				add atemp2 256
				add atemp 1
				seta[].ang atemp2
				
			}
			
			ifl atemp5 10
				add atemp5 1
			else
				set atemp5 0
			
			ife sprite[].xrepeat 110
			ife sprite[].yrepeat 110
			{
				set boss4phase 12
				ai AIBOSS4LAYEGGS
				
				quake 30
								
				geta[].ang atemp
				set atemp4 0
				whilen atemp4 8
				{
					espawn JELLYCONNECTORACTOR
					seta[RETURN].yvel 3
					geta[RETURN].z atemp2
					sub atemp2 8192
					seta[RETURN].z atemp2
											
					setactorvar[RETURN].atmp -12444
					add atemp 256
					seta[RETURN].ang atemp
									
					add atemp4 1
				}
				
				clipdist 96
				
				resetcount
				
				state NextSample
			}
			
			ifcount 10
			{
				ifspritepal 21
					spritepal 10
				else ifspritepal 10
					spritepal 15
				else ifspritepal 15
					spritepal 23
				else ifspritepal 23
					spritepal 11
				else ifspritepal 11
				{
					spritepal 12
					globalsound JIBBED_ACTOR4
				}
				else ifspritepal 12
					spritepal 16
				else ifspritepal 16
					spritepal 0
				resetcount
			}
			
			ifcount 8
				sizeto 110 110
			else ifcount 7
			{
				geta[].ang atemp
				set atemp2 atemp
				
				ifrnd 96
					sub atemp 512
				else
					add atemp 512
					
				seta[].ang atemp
				spawn FRAMEEFFECT1
				
				seta[].ang atemp2
				
			}
		}
	}
  }

  ifai 0
  ife boss4phase 1 
  {
    set music_load_pos 0
    state PlayActionMusic
    sizeat 64 64
    set bossfighton THISACTOR
	ai AIBOSS4LAYEGGS
  }
  else
    ifaction BOSS4FLINTCH
    {
      ifactioncount 3
	  {
	    ifspritepal 0
			ai AIBOSS4LAYEGGS
		else
			ai AIBOSS4SHOOT
	  }
    }
  else
    ifai AIBOSS4LAYEGGS
      state boss4layeggs
  else
    ifai AIBOSS4SHOOT
      state boss4shootstate
  else
	ifai AIBOSS4DODGE
	{
		ifcount 8
		{
			ifrnd 72
			ifcansee
			ifp palive
				ai AIBOSS4SHOOT
			else
				ai AIBOSS4LAYEGGS
				
			resetcount
		}
	}

  ifai AIBOSS4DYING
    state boss4dyingstate
  else
  {
    ifhitweapon
      state checkboss4hitstate
    else
      ifp palive
        ifpdistl 1280
      {
        addphealth -1000
        palfrom 63 63
      }
  }
ends

actor BOSS4STAYPUT BOSS4STRENGTH

  fall
  cactor BOSS4
  //spritepal 6
  state boss4code
  //getlastpal

enda

actor BOSS4 BOSS4STRENGTH ABOSS4ABOUTTOSHOOT

  fall
  cactor BOSS4
  //spritepal 6
  state boss4code
  //getlastpal

enda

action ANEWBEASTSTAND     0
action ANEWBEASTWALKING   10  4  5  1  12
action ANEWBEASTRUNNING   10  4  5  1  8
action ANEWBEASTTHINK     0   2  5  1  40
action ANEWBEASTSCRATCHING  30  3  5  1  20
action ANEWBEASTDYING     72  8  1  1  15
action ANEWBEASTFLINTCH   71  1  1  1  1
action ANEWBEASTLYINGDEAD 79  1  1
action ANEWBEASTSCREAM    50  2  5  1  40
action ANEWBEASTJUMP      80  2  5  1  50
action ANEWBEASTFALL      90  1  5
action ANEWBEASTFROZEN    10  1  5
action ANBDHEAD 196 7 1 1 30
action ANBDARM 203 7 1 1 30
action ANBDTORSO 210 7 1 1 30
action ANBHACKED 120 8 1 1 20

action ANEWBEASTHANG      0  1  5
useractor enemy NEWBEASTHANG NEWBEASTSTRENGTH
  ifaction 0
  {
    action ANEWBEASTHANG
    cstator 257

    sizeat 40 40
  }
  else
    ifhitweapon
  {
    cactor NEWBEAST
    action ANEWBEASTSTAND
    sound NEWBEAST_PAIN
  }
  else
    ifspawnedby BOSS4
      ifcount 200
        ifrnd 1
  {
    cactor NEWBEAST
    action ANEWBEASTSTAND
    sound NEWBEAST_PAIN
  }
enda

action ANEWBEASTHANGDEAD      -1  1  5
useractor enemy NEWBEASTHANGDEAD TOUGH

  ifaction 0
  {
    action ANEWBEASTHANGDEAD
    sizeat 40 40
    cstator 257
  }
  else
    ifhitweapon
  {
    ifdead
    {
      state standard_jibs
	  state nb_jibs
      spawn BLOODPOOL
      sound SQUISHED
      killit
    }
    else
    {
      guts JIBS6 1
      sound SQUISHED
    }
  }
enda

move NEWBEASTWALKVEL 182
move NEWBEASTRUNVEL 256
move NEWBEASTJUMPVEL 264
move NEWBEASTSTOP

ai AINEWBEASTGETENEMY ANEWBEASTWALKING NEWBEASTWALKVEL seekplayer
ai AINEWBEASTDODGE ANEWBEASTRUNNING NEWBEASTRUNVEL dodgebullet
ai AINEWBEASTCHARGEENEMY ANEWBEASTRUNNING NEWBEASTRUNVEL seekplayer
ai AINEWBEASTFLEENEMY ANEWBEASTWALKING NEWBEASTWALKVEL fleeenemy
ai AINEWBEASTSCRATCHENEMY ANEWBEASTSCRATCHING NEWBEASTSTOP faceplayerslow
ai AINEWBEASTJUMPENEMY ANEWBEASTJUMP NEWBEASTJUMPVEL jumptoplayer
ai AINEWBEASTTHINK ANEWBEASTTHINK NEWBEASTSTOP
// ai AINEWBEASTSHRUNK ANEWBEASTWALKING SHRUNKVELS fleeenemy
ai AINEWBEASTGROW ANEWBEASTSTAND  NEWBEASTSTOP faceplayerslow
ai AINEWBEASTDYING ANEWBEASTDYING NEWBEASTSTOP faceplayer
ai AINEWBEASTSHOOT ANEWBEASTSCREAM NEWBEASTSTOP faceplayerslow
ai AINEWBEASTFLINTCH ANEWBEASTFLINTCH NEWBEASTSTOP faceplayerslow


state newbeastseekstate

  ifactornotstayput
  {
    ifp palive
      ifcansee
        ifpdistl 1596
    {
      ai AINEWBEASTSCRATCHENEMY
      break
    }

    ifai AINEWBEASTCHARGEENEMY
    {
      ifp palive
        ifpdistl 1596
          ifcansee
      {
        ai AINEWBEASTSCRATCHENEMY
        break
      }

      ifrnd 1
        ifpdistg 4096
          ifp palive
            ifcansee
      {
        ai AINEWBEASTSHOOT
        break
      }
    }
    else
      ifpdistg 4096
    {
      ai AINEWBEASTCHARGEENEMY
      break
    }

    iffloordistl 16
    {
      ifcount 32
        ifrnd 16
      {
        ifceilingdistl 96 break
        ai AINEWBEASTJUMPENEMY
      }
      break
    }

    ifrnd 4
    {
      ifnotmoving
        operate
    }
    else
      ifrnd 16
        ifbulletnear
    {
      ifgapzl 128
        ai AINEWBEASTDODGE
      else
        ifactornotstayput
      {
        ifrnd 128
        {
          ifceilingdistl 96 break
          ai AINEWBEASTJUMPENEMY
        }
        else
          ai AINEWBEASTDODGE
      }
    }
  }
  else
  {
    ifactioncount 16
    {
      ifp palive
        ifpdistl 1596
          ifcansee
      {
        ai AINEWBEASTSCRATCHENEMY
        break
      }
    }
    ifcount 16
      ifrnd 32
        move NEWBEASTWALKVEL randomangle geth
  }

ends

/*
state newbeastshrunkstate
  ifcount SHRUNKDONECOUNT
    ai AINEWBEASTGETENEMY
  else
    ifcount SHRUNKCOUNT
      sizeto 48 40
  else
    state genericshrunkcode
ends
*/

state newbeastfleestate
  ifcount 8
  {
    ifrnd 64
      ifpdistg 3500
        ifp palive
          ifcansee
            ai AINEWBEASTSHOOT
  }
  else
  {
    iffloordistl 16
    {
      ifnotmoving
        ai AINEWBEASTGETENEMY
    }
    else
      ai AINEWBEASTGETENEMY
    break
  }
ends

state newbeastthinkstate

  ifrnd 8
    soundonce NEWBEAST_ROAM

  ifactioncount 3
  {
    ifrnd 128
    {
      ifpdistg 3500
        ifp palive
          ifcansee
            ai AINEWBEASTSHOOT
    }
    else
      ai AINEWBEASTGETENEMY
  }

  ifrnd 16
    ifbulletnear
  {
    ifgapzl 96
      ai AINEWBEASTDODGE
    else
    {
      ifrnd 128
      {
        ifceilingdistl 144 break
        ai AINEWBEASTJUMPENEMY
      }
      else
        ai AINEWBEASTDODGE
    }
  }
ends

state newbeastscratchstate
  ifcount 20
    ifrnd 8
  {
    ifcansee
      ifpdistl 2048
    {
      ifrnd 128
        ai AINEWBEASTFLEENEMY
      break
    }
    ifrnd 80
      ai AINEWBEASTTHINK
    else
      ai AINEWBEASTGETENEMY
  }

  ifactioncount 3
  {
    ifpdistg 1596
      ai AINEWBEASTTHINK
    else ifp palive ifcansee
    {
      palfrom 16 16
      addphealth NEWBEASTSCRATCHAMOUNT
      sound DUKE_GRUNT
      resetactioncount
      resetcount
    }
  }
  else
    ifcount 15
      nullop
  else
    ifcount 14
  {
    ifpdistl 1596
      soundonce NEWBEAST_ATTACK
    else
      soundonce NEWBEAST_ATTACKMISS
  }
ends

state checknewbeasthit
  spawn BLOOD
/*
  ifai AINEWBEASTSHRUNK
  {
    addkills 1
    sound SQUISHED
    state standard_jibs
    killit
  }
*/

  ifdead
  {
    ifwasweapon FREEZEBLAST
    {
      sound SOMETHINGFROZE
      spritepal 1
      move 0
      action ANEWBEASTFROZEN
      strength 0
      break
    }

    ifwasweapon GROWSPARK
    {
      cstat 0
      sound ACTOR_GROWING
      ai AINEWBEASTGROW
      break
    }

    addkills 1
	
	ifwasweapon CATERKILAR
	{
		ai AINEWBEASTDYING
		
		ifrnd 96
			action ANBDHEAD
		else ifrnd 96
		{
			action ANBDARM
			sound NEWBEAST_DYING
		}
		else ifrnd 96
		{
			action ANBDTORSO
			sound NEWBEAST_DYING
		}
		else
		{
			action ANBHACKED
			sound NEWBEAST_DYING
		}
		
		state rf
		
		state random_wall_jibs
		guts JIBS6 1
		
		ifrnd 64
			spawn BLOODPOOL
		
		break
	}
	
    ifwasweapon RPG
    {
      sound SQUISHED
      state nb_jibs
      state standard_jibs
      killit
    }
    else
      ifwasweapon RADIUSEXPLOSION
    {
		  sound SQUISHED
		  state nb_jibs
		  state standard_jibs
		  killit
    }
    else
    {
		ifwasweapon FLAMEPROJ
			state genericburn_dead_code
	
      state rf
      ai AINEWBEASTDYING
      ifrnd 64
        spawn BLOODPOOL
    }
    sound NEWBEAST_DYING
  }
  else
  {
    sound NEWBEAST_PAIN
    ifwasweapon GROWSPARK
      sound EXPANDERHIT
	  
	ifwasweapon CATERKILAR
	{
		state random_wall_jibs
		ai AINEWBEASTFLINTCH
		break
	}
	
	ifwasweapon FLAMEPROJ
		set a_flaming 1
/*
//  The alien is immune to the shrinker
    ifwasweapon SHRINKSPARK
    {
      sound ACTOR_SHRINKING
      ai AINEWBEASTSHRUNK
      break
    }
*/
    state random_wall_jibs
    ifrnd 32
      ai AINEWBEASTFLINTCH
    else
      ifrnd 32
        ifpdistg 3500
          ifp palive
            ifcansee
              ai AINEWBEASTSHOOT
  }
ends

state newbeastjumpstate
  ifaction ANEWBEASTFALL
  {
    iffloordistl 16
      ai AINEWBEASTGETENEMY
  }
  else
    ifcount 32
      action ANEWBEASTFALL
ends

state newbeastdyingstate
  ifaction ANEWBEASTLYINGDEAD
  {
    strength 0
    ifhitweapon
      ifwasweapon RADIUSEXPLOSION
    {
      sound SQUISHED
      state standard_jibs
      killit
    }
    ifcount RESPAWNACTORTIME
      ifrespawn
    {
      spawn TRANSPORTERSTAR
      cstat 257
      strength NEWBEASTSTRENGTH
      ai AINEWBEASTGETENEMY
    }
  }
  else
    ifai AINEWBEASTDYING
  {
      ifaction ANEWBEASTDYING
	  {
		  ifactioncount 7
		  {
			iffloordistl 8
			  sound THUD
			move NEWBEASTSTOP
			action 0
			cactor NBDEAD
			break
		  }
	  }
	  else ifaction ANBHACKED
	  {
		ifcount 16
		{
			guts JIBS6 2
			state random_wall_jibs
			guts JIBS3 1
			sound SQUISHED
			resetcount
		}
		
		ifactioncount 8
		{
			state SpawnShards
			action 0
			cactor NBHACKED
			sound THUD
			break
		}
	  }
	  else
	  {
	    ifcount 5
		{
			state random_wall_jibs
			guts JIBS6 2
		}
	  
		ifactioncount 7
		{
			iffloordistl 8
				sound THUD
				
			state SpawnShards	
				
			//action 0
			
			ifaction ANBDHEAD
				cactor NBDEADH
			else ifaction ANBDARM
				cactor NBDEADA
			else
				cactor NBDEADT
				
			action 0	
				
			break
		}
		else ifactioncount 3
		ife actioncheck 0
		{
			set actioncheck 1
			
			ifaction ANBDHEAD
				state nb_headjib
			else ifaction ANBDARM
				state nb_armjib
			else
				state nb_torsojib
				
			state random_wall_jibs
			state random_wall_jibs
			sound SQUISHED
		}
	  }
  }
ends

state newbeastdodgestate
  ifcount 13
    ai AINEWBEASTGETENEMY
ends

useractor enemystayput NEWBEASTSTAYPUT NEWBEASTSTRENGTH ai AINEWBEASTGETENEMY cstator 257 cactor NEWBEAST enda
useractor enemy NEWBEASTJUMP NEWBEASTSTRENGTH ai AINEWBEASTJUMPENEMY cstator 257 cactor NEWBEAST enda

state newbeastcode
  
  ifdead
	nullop
  else ifg a_flaming 0
  ifrnd 128
	ai AINEWBEASTFLINTCH

  state checksquished
  ifai 0
  {
    cstator 257
    ai AINEWBEASTGETENEMY
  }
  else
    ifaction ANEWBEASTLYINGDEAD
  {
    fall
    state newbeastdyingstate
    break
  }
  else
    ifaction ANEWBEASTFROZEN
  {
    ifcount THAWTIME
    {
      ai AINEWBEASTGETENEMY
      spritepal 0
    }
    else
      ifcount FROZENDRIPTIME
    {
      ifactioncount 26
      {
        spawn WATERDRIP
        resetactioncount
      }
    }

    ifhitweapon
    {
      ifwasweapon FREEZEBLAST
      {
        strength 0
        break
      }
      addkills 1

      ifrnd 84
        spawn BLOODPOOL
      lotsofglass 30
      sound GLASS_BREAKING
      killit
    }
    ifp pfacing
      ifpdistl FROZENQUICKKICKDIST
        pkick
    break
  }
  else
    ifai AINEWBEASTJUMPENEMY
      state newbeastjumpstate
  else
  {
    fall
    ifai AINEWBEASTGETENEMY
      state newbeastseekstate
    else
      ifai AINEWBEASTCHARGEENEMY
        state newbeastseekstate
    else
      ifai AINEWBEASTFLINTCH
    {
      ifcount 8
        ai AINEWBEASTGETENEMY
    }

    else
      ifai AINEWBEASTDODGE
        state newbeastdodgestate
    else
      ifai AINEWBEASTSCRATCHENEMY
        state newbeastscratchstate
    else
      ifai AINEWBEASTFLEENEMY
        state newbeastfleestate
    else
      ifai AINEWBEASTTHINK
        state newbeastthinkstate
/*
    else
      ifai AINEWBEASTSHRUNK
        state newbeastshrunkstate
*/
    else
      ifai AINEWBEASTGROW
        state genericgrowcode
    else
      ifai AINEWBEASTDYING
        state newbeastdyingstate
    else
      ifai AINEWBEASTSHOOT
    {
      ifp pshrunk
        ai AINEWBEASTGETENEMY
      else
        ifcount 26
          ai AINEWBEASTGETENEMY
      else
        ifcount 25
		{
			ifspritepal 17
			{
				getprojectile[GROWSPARK].extra atemp
				div atemp 2
				setprojectile[GROWSPARK].extra atemp
				shoot GROWSPARK
				setprojectile[GROWSPARK].extra GROWSPARK_WEAPON_STRENGTH
			}
			else
				shoot SHRINKER
		}
      else
      {
        ifcount 5
          nullop
        else
          ifcount 4
            sound NEWBEAST_SPIT
      }
    }
  }

  ifhitweapon
    state checknewbeasthit
ends


useractor enemy NEWBEAST NEWBEASTSTRENGTH
  fall
  ifaction 0
  {
    cstator 257
    sizeat 40 40
    ai AINEWBEASTDODGE
  }
  
  ifaction ANEWBEASTFROZEN
    state newbeastcode
  else
  {
    //spritepal 6
    state newbeastcode
    ifaction ANEWBEASTFROZEN
      break
    //getlastpal
  }
enda

