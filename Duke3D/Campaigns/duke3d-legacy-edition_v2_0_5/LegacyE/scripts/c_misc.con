/*
--------------------------------------------------------------------------------
Duke Nukem 3D - Blast Edition Version 2.0
By Marcos
2023 - Space In a Bottle
*/

//Misc vars

var uatemp 0 2
var uatemp2 0 2
var a_child 0 2
var a_burneffect 0 2
var xsize 0 2
var ysize 0 2
var a_plasmaeffect 0 2
var a_groweffect 0 2
var a_scraptime 0 2
var JibZvel 0 2
var usedmedkit 0 1
var boss1deflect 0 2
var bossmeterfilled 0 1
var SE120Active 0 0
var boss4phase 0 0
var boss4att 0 0
var boss4locator -1 0

gamearray wpnroster 20 //Nuke weapon roster
gamearray wpnrosterpwr 20 //Nuke weapon alt-fire roster

define TUTORIALTIME 180

var tutorialTime 0 1
var tutorialType 0 1
var tutorialShade 34 1
var tutorialTrans 41 1

var dtemp 0 1
var dtemp2 0 1
var dtemp3 0 1
var dtemp4 0 1
var dtemp5 0 1
var dtemp6 0 1

var projpass 0 2

var p_invul 0 1

var PlayerLives 0 1
var oneupchild -1 2

define MIDXSTRETCH 60
define MIDYSTRETCH 60

var cycloid_under_octa 0 0
var cycloid_sprite -1 0
var cycloid_beam_0 -1 0
var cycloid_beam_1 -1 0
var cycloid_beam_2 -1 0
var cycloid_final 0 2

var overlord_init 0 0
var overlord_SEpos -1 0

var boss1fx 0 0

var lastbonuslevel 0 0

var overlordrpg 0 2

var pusherowner -1 2

var commpad 0 1

var plasmasaved 0 1
var flamesaved 0 1

var testvar1 0 0
var testvar2 0 0

var eLivesSlot00 0 0
var eLivesSlot01 0 0
var eLivesSlot02 0 0
var eLivesSlot03 0 0
var eLivesSlot04 0 0
var eLivesSlot05 0 0
var eLivesSlot06 0 0
var eLivesSlot07 0 0
var eLivesSlot08 0 0
var eLivesSlot09 0 0
var curSaveSlot -1 0

define DPIGCOPSTRENGTH 110 

define ELITEPIGCOPSTRENGTH 400

define FLAMEENFORCERSTRENGTH 135

define ELITEENFORCERSTRENGTH 215

define ROBOTTROOPERSTRENGTH 75

define SNAKEHEADSTRENGTH 25

define ROBOT_RECOG 420
define ROBOT_ROAM 421
define ROBOT_DIE 422
define ROBOT_PAIN  423

define ONEUPSND 600
definesound ONEUPSND snd/gotlife.wav 0 0 254 0 0

define SHELLDROP 531
definesound SHELLDROP snd/SHELL.VOC -128 128 0 0 0

define SSHELLDROP 532
definesound SSHELLDROP snd/SHELL.VOC -768 -768 0 0 0

define SHELL_ROLL 533
definesound SHELL_ROLL snd/SHELL_ROLL.wav -128 128 0 0 0

define INVULNERABILITY 534
definesound INVULNERABILITY snd/invulnerability.ogg 0 0 254 0 0

define COMMCRAWLING 3790

define LIZTROOPHEADLESS 3687
define LIZTROOPTORSOLESS 3696

define PIGCOPLIMBLESS 3669
define DPIGCOPDEAD 5492
define ELITEPIGCOPDEAD 5750
define PIGCOPHEADLESS 3635

define PIGCOPPIECES 4084
define PIGPIECESDEAD 4089
define PIGCOPHACKED 2088

define OCTAHEADLESS 3732
define OCTAHACKED 1867
define OCTAHACKED2 1808

define ENFORCERARMLESS 3706
define FLAMEENFORCERARMLESS 3705
define ENFORCERNOARMS 3710
define FLAMEENFORCERDEAD 5559
define ELITEENFORCERDEAD 5639

define ENFORCERHEADLESS 3642
define FLAMEENFORCERHEADLESS 3649

define LIZMANTORSO 2109
define LIZMANTORSODEAD2 2113
define LIZMANTORSODEAD 2119
define LIZMANHACKED 2098

define ROBOTTROOPERDEAD 5430
define ROBOTTROOPERHEADLESS 3756
define ROBOTTROOPERARMLESS 3762
define ROBOTTROOPERTORSOLESS 3768
define ROBOTTROOPERHACKED 4856

define LIZHACKED 1763
define LIZTORSO 3688
define LIZTORSODEAD 3691

define COMMANDERDEAD 1957
define COMMANDERHEADLESS 3788
define COMMANDERHOLEDEAD 3978
define COMMHACKED 1878

define NBDEAD 4689
define NBDEADH 4812
define NBDEADA 4819
define NBDEADT 4826
define NBHACKED 4737

define SGDEAD 3907
define SGDEADA 3935
define SGDEADH 3939
define SARGEHALFDEAD 3889
define SARGEHACKED 3997

define THUD02 516
definesound THUD02 snd/THUD02.VOC 0 0 4 250 0

define TRACER 3980
define TRACER_TRAIL 3284
//define TRACER_SPAWNER 3284

defstate SavePlayerLives

	ifn curSaveSlot -1
	{
		switch curSaveSlot
		
			case 0
				set eLivesSlot00 PlayerLives
				savegamevar eLivesSlot00
				break
				
			case 1
				set eLivesSlot01 PlayerLives
				savegamevar eLivesSlot01
				break
				
			case 2
				set eLivesSlot02 PlayerLives
				savegamevar eLivesSlot02
				break
				
			case 3
				set eLivesSlot03 PlayerLives
				savegamevar eLivesSlot03
				break
				
			case 4
				set eLivesSlot04 PlayerLives
				savegamevar eLivesSlot04
				break
				
			case 5
				set eLivesSlot05 PlayerLives
				savegamevar eLivesSlot05
				break
				
			case 6
				set eLivesSlot06 PlayerLives
				savegamevar eLivesSlot06
				break
				
			case 7
				set eLivesSlot07 PlayerLives
				savegamevar eLivesSlot07
				break
				
			case 8
				set eLivesSlot08 PlayerLives
				savegamevar eLivesSlot08
				break
				
			case 9
				set eLivesSlot09 PlayerLives
				savegamevar eLivesSlot09
				break
				
		endswitch
	}

ends

//Misc actors

move NOMOVE 0

defineprojectile TRACER PROJ_WORKSLIKE 98306
defineprojectile TRACER PROJ_VEL 800
defineprojectile TRACER PROJ_VEL_MULT 3
defineprojectile TRACER PROJ_EXTRA 6
defineprojectile TRACER PROJ_EXTRA_RAND 3
defineprojectile TRACER PROJ_TRAIL -1//TRACER_TRAIL
defineprojectile TRACER PROJ_HITRADIUS 0
defineprojectile TRACER PROJ_SPAWNS SHOTSPARK1
defineprojectile TRACER PROJ_SXREPEAT 24
defineprojectile TRACER PROJ_SYREPEAT 24
defineprojectile TRACER PROJ_ISOUND -1
defineprojectile TRACER PROJ_XREPEAT 16
defineprojectile TRACER PROJ_YREPEAT 16

action ATRACER 0 1 5 1 1
useractor notenemy TRACER 0 ATRACER enda 

defstate ShootSpark

	ifactor BOSS3
	{
		displayrandvar atemp 64
		displayrandvar atemp2 -64
		geta[].ang atemp3
		//set atemp4 atemp3
		add atemp3 atemp
		add atemp3 atemp2
		//seta[].ang atemp3
		displayrandvar atemp -512
		displayrandvar atemp2 512
		add atemp atemp2
		eshoot TRACER
		seta[RETURN].ang atemp3
		geta[RETURN].zvel atemp2
		add atemp atemp2
		seta[RETURN].zvel atemp
	}
	else ifactor BOSS1
	{
		ifg PlayerLives 0
		{
			displayrandvar atemp 96
			displayrandvar atemp2 -96
		}
		else
		{
			displayrandvar atemp 128
			displayrandvar atemp2 -128
		}
		
		geta[].ang atemp3
		//set atemp4 atemp3
		add atemp3 atemp
		add atemp3 atemp2
		//seta[].ang atemp3
		ifg PlayerLives 0
		{
			displayrandvar atemp 256
			displayrandvar atemp2 -256
		}
		else
		{
			displayrandvar atemp 512
			displayrandvar atemp2 -512
		}
		add atemp atemp2
		eshoot TRACER
		seta[RETURN].ang atemp3
		geta[RETURN].zvel atemp2
		add atemp atemp2
		seta[RETURN].zvel atemp
	}
	else ife userdef.enable_nuke 1
	ife userdef.nuke_active 1
	{
		ife userdef.nuke_tracer 1
		{
			displayrandvar atemp 96
			displayrandvar atemp2 -96
			geta[].ang atemp3
			//set atemp4 atemp3
			add atemp3 atemp
			add atemp3 atemp2
			//seta[].ang atemp3
			displayrandvar atemp -1536
			displayrandvar atemp2 1536
			add atemp atemp2
			eshoot TRACER
			seta[RETURN].ang atemp3
			geta[RETURN].zvel atemp2
			add atemp atemp2
			seta[RETURN].zvel atemp
		}
		else
			shoot SHOTSPARK1
	}
	else ife userdef.player_skill 6
	{
		displayrandvar atemp 96
		displayrandvar atemp2 -96
		geta[].ang atemp3
		//set atemp4 atemp3
		add atemp3 atemp
		add atemp3 atemp2
		//seta[].ang atemp3
		displayrandvar atemp -1536
		displayrandvar atemp2 1536
		add atemp atemp2
		eshoot TRACER
		seta[RETURN].ang atemp3
		geta[RETURN].zvel atemp2
		add atemp atemp2
		seta[RETURN].zvel atemp
	}
	else
		shoot SHOTSPARK1
	
	ifactor PIGCOP
		nullop
	else ifactor ELITEPIGCOP
		nullop
	else
	{
		espawn SHELL
	
		geta[].ang atemp
		add atemp 512
		seta[RETURN].ang atemp
	}
	
ends

defstate ShootShotgun

	
	ife userdef.enable_nuke 1
	ife userdef.nuke_active 1
	{
		ife userdef.nuke_tracer 1
		{
			displayrandvar atemp 96
			displayrandvar atemp2 -96
			geta[].ang atemp3
			//set atemp4 atemp3
			add atemp3 atemp
			add atemp3 atemp2
			//seta[].ang atemp3
			displayrandvar atemp -1024
			displayrandvar atemp2 1024
			add atemp atemp2
			eshoot TRACER
			seta[RETURN].ang atemp3
			geta[RETURN].zvel atemp2
			add atemp atemp2
			seta[RETURN].zvel atemp
		}
		else
			shoot SHOTGUN
	}
	else ife userdef.player_skill 6
	{
		displayrandvar atemp 96
		displayrandvar atemp2 -96
		geta[].ang atemp3
		//set atemp4 atemp3
		add atemp3 atemp
		add atemp3 atemp2
		//seta[].ang atemp3
		displayrandvar atemp -1024
		displayrandvar atemp2 1024
		add atemp atemp2
		eshoot TRACER
		seta[RETURN].ang atemp3
		geta[RETURN].zvel atemp2
		add atemp atemp2
		seta[RETURN].zvel atemp
	}
	else
		shoot SHOTGUN
ends

//Stayput Jibs

define JibsSize 32
define JibsVel 160
define JibsDrop -384
define JibsBounces 0
define JibZvelMax -8192

define NDUKETORSO 1521
define NDUKEGUN 1529
define NDUKELEG 1537

define NHEADJIB 1769
define NARMJIB 1773
define NLEGJIB 1777

define NHEADJIB2 2202
define NARMJIB2 2206
define NLEGJIB2 2211
define NARM2JIB2 3716

define NJIBS1 2246
define NJIBS2 2251
define NJIBS3 2256
define NJIBS4 2261
define NJIBS5 2266

define NJIBS6 2287

define PIGARM1 3650
define PIGARM2 3678
define PIGHEAD 3655
define PIGLEG 3660
define PIGTORSO2 3665

define OCTATENT 3722
define OCTAHEAD 3734

define TROOPARM 3740
define TROOPTORSO 3746
define TROOPTORSODEAD 3750
define TROOPHEAD 3770

define COMMHEAD 3776

define NBHEAD 4705
define NBARM 4710
define NBLEG 4716
define NBTORSO 4720 
define NBTORSODEAD 4723

define SGARM 3940
define SGHEAD 3945

define STAYPUTJIBSPAWNER 2244

include scripts/c_se.con

action ASGARM 1700 1
action ASGHEAD 1705
action AROTSGARM 1696 4 1 1 6
action AROTSGHEAD 1697 4 1 1 6

action ANBHEAD 2465 1
action ANBARM 2470 1
action ANBLEG 2475 1
action ANBTORSO 2479 1
action AROTNBHEAD 2461 4 1 1 6
action AROTNBARM 2466 4 1 1 6
action AROTNBLEG 2471 4 1 1 6
action AROTNBTORSO 2476 3 1 1 6

action ACOMMHEAD 1536 1
action AROTCOMMHEAD 1532 4 1 1 6

action ATROOPARM 1500 1
action ATROOPTORSO 1506 1
action ATROOPHEAD 1530 1
action AROTTROOPARM 1496 4 1 1 6
action AROTTROOPTORSO 1502 4 1 1 6
action AROTTROOPHEAD 1526 4 1 1 6

action AOCTATENT 1482 1
action AROTOCTATENT 1478 4 1 1 6 
action AOCTAHEAD 1494 1
action AROTOCTAHEAD 1490 4 1 1 6

action APIGARM1 1410 1
action APIGARM2 1438 1
action APIGHEAD 1415 1
action APIGLEG 1420 1
action APIGTORSO2 1425 1
action AROTPIGARM1 1406 4 1 1 6
action AROTPIGARM2 1434 4 1 1 6
action AROTPIGHEAD 1411 4 1 1 6
action AROTPIGLEG 1416 4 1 1 6
action AROTPIGTORSO 1421 4 1 1 8

action ADUKETORSO -724 1
action ADUKEGUN -716 1
action ADUKELEG -708 1
action AROTDUKETORSO -724 8 1 1 6
action AROTDUKEGUN -716 8 1 1 6
action AROTDUKELEG -708 8 1 1 6

action AHEADJIB -476 1
action AARMJIB -472 1
action ALEGJIB -466 1
action ALEG2JIB -467 1
action AROTHEADJIB -476 3 1 1 6
action AROTARMJIB -472 3 1 1 6
action AROTLEGJIB -468 3 1 1 6

action AFALLLIZTORSO 1444 2 1 1 6
action ASPLATLIZTORSO 1444 3 1 1 6
action ASTAYLIZTORSO 1447 1


action AHEADJIB2 -43 1
action AARMJIB2 -39 1
action ALEGJIB2 -34 1
action AARM2JIB2 1476 1
action ALIZMANTORSOSTAY -131 1
action AROTHEADJIB2 -43 3 1 1 6
action AROTARMJIB2 -39 3 1 1 6
action AROTLEGJIB2 -34 3 1 1 6
action AROTARM2JIB2 1472 4 1 1 6
action AROTLIZMANTORSO -135 4 1 1 6

action AJIB1 5 1
action AJIB2 10 1
action AJIB3 15 1
action AJIB4 20 1
action AJIB5 25 1
action AROTJIB1 1 4 1 1 6
action AROTJIB2 6 4 1 1 6
action AROTJIB3 11 4 1 1 6
action AROTJIB4 16 4 1 1 6
action AROTJIB5 21 4 1 1 6

action AFALLJIB6 42 2 1 1 6
action ASPLATJIB6 43 7 1 1 6
action ASTAY1JIB6 49 1
action ASTAY2JIB6 45 1

action ABURNJIB 43 7 1 1 6
action ABURNEDJIB 49 1

defstate JibRotAction

	ifspawnedby NHEADJIB
		action AROTHEADJIB
	else ifspawnedby NARMJIB
		action AROTARMJIB
	else ifspawnedby NLEGJIB
		action AROTLEGJIB
	else ifspawnedby NHEADJIB2
		action AROTHEADJIB2
	else ifspawnedby NARMJIB2
		action AROTARMJIB2
	else ifspawnedby NARM2JIB2
		action AROTARM2JIB2
	else ifspawnedby NLEGJIB2
		action AROTLEGJIB2
	else ifspawnedby NJIBS1
		action AROTJIB1	
	else ifspawnedby NJIBS2
		action AROTJIB2
	else ifspawnedby NJIBS3
		action AROTJIB3
	else ifspawnedby NJIBS4
		action AROTJIB4
	else ifspawnedby NJIBS5
		action AROTJIB5
	else ifspawnedby NJIBS6
		action AFALLJIB6
	else ifspawnedby NDUKETORSO
		action AROTDUKETORSO
	else ifspawnedby NDUKEGUN
		action AROTDUKEGUN
	else ifspawnedby NDUKELEG
		action AROTDUKELEG
	else ifspawnedby PIGARM1
		action AROTPIGARM1
	else ifspawnedby PIGARM2
		action AROTPIGARM2
	else ifspawnedby PIGHEAD
		action AROTPIGHEAD
	else ifspawnedby PIGLEG
		action AROTPIGLEG
	else ifspawnedby PIGTORSO2
		action AROTPIGTORSO
	else ifspawnedby OCTATENT
		action AROTOCTATENT
	else ifspawnedby OCTAHEAD
		action AROTOCTAHEAD
	else ifspawnedby TROOPARM
		action AROTTROOPARM
	else ifspawnedby TROOPTORSO
		action AROTTROOPTORSO
	else ifspawnedby TROOPHEAD
		action AROTTROOPHEAD
	else ifspawnedby COMMHEAD
		action AROTCOMMHEAD
	else ifspawnedby NBHEAD
		action AROTNBHEAD
	else ifspawnedby NBARM
		action AROTNBARM
	else ifspawnedby NBLEG
		action AROTNBLEG
	else ifspawnedby NBTORSO
		action AROTNBTORSO
	else ifspawnedby SGARM
		action AROTSGARM
	else ifspawnedby SGHEAD
		action AROTSGHEAD
	else ifspawnedby LIZTORSO
		action AFALLLIZTORSO
	else ifspawnedby LIZMANTORSO
		action AROTLIZMANTORSO
		
ends

defstate JibStayAction

	ifspawnedby NHEADJIB
		action AHEADJIB
	else ifspawnedby NARMJIB
		action AARMJIB
	else ifspawnedby NLEGJIB
	{
		ifrnd 96
			action ALEGJIB
		else
			action ALEG2JIB
	}
	else ifspawnedby NHEADJIB2
		action AHEADJIB2
	else ifspawnedby NARMJIB2
		action AARMJIB2
	else ifspawnedby NARM2JIB2
		action AARM2JIB2
	else ifspawnedby NLEGJIB2
		action ALEGJIB2
	else ifspawnedby NJIBS1
		action AJIB1	
	else ifspawnedby NJIBS2
		action AJIB2
	else ifspawnedby NJIBS3
		action AJIB3
	else ifspawnedby NJIBS4
		action AJIB4
	else ifspawnedby NJIBS5
		action AJIB5
	else ifspawnedby NDUKETORSO
		action ADUKETORSO
	else ifspawnedby NDUKEGUN
		action ADUKEGUN
	else ifspawnedby NDUKELEG
		action ADUKELEG
	else ifspawnedby NJIBS6
	{
		ifaction 0
			action ASPLATJIB6
		else ifaction AFALLJIB6
			action ASPLATJIB6
	}
	else ifspawnedby LIZTORSO
	{
		ifaction 0
			action ASPLATLIZTORSO
		else ifaction AFALLLIZTORSO
			action ASPLATLIZTORSO
	}
	else ifspawnedby PIGARM1
		action APIGARM1
	else ifspawnedby PIGARM2
		action APIGARM2
	else ifspawnedby PIGHEAD
		action APIGHEAD
	else ifspawnedby PIGLEG
		action APIGLEG
	else ifspawnedby PIGTORSO2
		action APIGTORSO2
	else ifspawnedby OCTATENT
		action AOCTATENT
	else ifspawnedby OCTAHEAD
		action AOCTAHEAD
	else ifspawnedby TROOPARM
		action ATROOPARM
	else ifspawnedby TROOPTORSO
		action ATROOPTORSO
	else ifspawnedby TROOPHEAD
		action ATROOPHEAD
	else ifspawnedby COMMHEAD
		action ACOMMHEAD
	else ifspawnedby NBHEAD
		action ANBHEAD
	else ifspawnedby NBARM
		action ANBARM
	else ifspawnedby NBLEG
		action ANBLEG
	else ifspawnedby NBTORSO
		action ANBTORSO
	else ifspawnedby SGARM
		action ASGARM
	else ifspawnedby SGHEAD
		action ASGHEAD
	else ifspawnedby LIZMANTORSO
		action ALIZMANTORSOSTAY

ends

defstate JibStayAction2

	ifaction AROTHEADJIB
		action AHEADJIB
	else ifaction AROTARMJIB
		action AARMJIB
	else ifaction AROTLEGJIB
	{
		ifrnd 96
			action ALEGJIB
		else
			action ALEG2JIB
	}
	else ifaction AROTHEADJIB2
		action AHEADJIB2
	else ifaction AROTARMJIB2
		action AARMJIB2
	else ifaction AROTARM2JIB2
		action AARM2JIB2
	else ifaction AROTLEGJIB2
		action ALEGJIB2
	else ifaction AROTJIB1
		action AJIB1	
	else ifaction AROTJIB2
		action AJIB2
	else ifaction AROTJIB3
		action AJIB3
	else ifaction AROTJIB4
		action AJIB4
	else ifaction AROTJIB5
		action AJIB5
	else ifaction AROTDUKETORSO
		action ADUKETORSO
	else ifaction AROTDUKEGUN
		action ADUKEGUN
	else ifaction AROTDUKELEG
		action ADUKELEG
	else ifaction AFALLJIB6
		action ASPLATJIB6
	else ifaction AFALLLIZTORSO
		action ASPLATLIZTORSO
	else ifaction AROTPIGARM1
		action APIGARM1
	else ifaction AROTPIGARM2
		action APIGARM2
	else ifaction AROTPIGHEAD
		action APIGHEAD
	else ifaction AROTPIGLEG
		action APIGLEG
	else ifaction AROTPIGTORSO
		action APIGTORSO2
	else ifaction AROTOCTATENT
		action AOCTATENT
	else ifaction AROTOCTAHEAD
		action AOCTAHEAD
	else ifaction AROTTROOPARM
		action ATROOPARM
	else ifaction AROTTROOPTORSO
		action ATROOPTORSO
	else ifaction AROTTROOPHEAD
		action ATROOPHEAD
	else ifaction AROTCOMMHEAD
		action ACOMMHEAD
	else ifaction AROTNBHEAD
		action ANBHEAD
	else ifaction AROTNBARM
		action ANBARM
	else ifaction AROTNBLEG
		action ANBLEG
	else ifaction AROTNBTORSO
		action ANBTORSO
	else ifaction AROTSGARM
		action ASGARM
	else ifaction AROTSGHEAD
		action ASGHEAD
	else ifaction AROTLIZMANTORSO
		action ALIZMANTORSOSTAY

ends

useractor notenemy STAYPUTJIBSPAWNER 64

	fall
	sizeat 32 32
	clipdist 16
	cstat 256
	
	ifaction 0
	{
		ifg sprite[].sectnum NUMSECTORS
			killit
	
		ifspawnedby NJIBS6
		{
			ifonwater
				killit
			else ifinwater
				killit
		}
			
		state random_wall_jibs
		
		ifspawnedby LIZTORSO
		{
			iffloordistl 3
				state JibStayAction
			else ifnotmoving
				state JibStayAction
			else
				state JibRotAction
				
			resetcount
		}
		else ifspawnedby PIGTORSO2
		{
			iffloordistl 3
				state JibStayAction
			else ifnotmoving
				state JibStayAction
			else
				state JibRotAction
				
			resetcount
		}
		else ifspawnedby LIZMANTORSO
		{
			iffloordistl 3
				state JibStayAction
			else ifnotmoving
				state JibStayAction
			else
				state JibRotAction
				
			resetcount
		}
		else ifspawnedby NBTORSO
		{
			iffloordistl 3
				state JibStayAction
			else ifnotmoving
				state JibStayAction
			else
				state JibRotAction
				
			resetcount
		}
		else ifspawnedby TROOPTORSO
		{
			iffloordistl 3
				state JibStayAction
			else ifnotmoving
				state JibStayAction
			else
				state JibRotAction
				
			resetcount
		}
		else ife atemp8 1
		{
			insertspriteq
			iffloordistl 3
				state JibStayAction
			else ifnotmoving
				state JibStayAction
			else
				state JibRotAction
				
			resetcount
		}
		else ifrnd 192
		{
			insertspriteq
			iffloordistl 3
				state JibStayAction
			else ifnotmoving
				state JibStayAction
			else
				state JibRotAction
				
			resetcount
		}
		else
			killit
	}
	else ifaction ASPLATJIB6
	{
		strength 1
		ifactioncount 6
		{
			ifrnd 48
				action ASTAY2JIB6
			else
				action ASTAY1JIB6
		}
	}
	else ifaction ASPLATLIZTORSO
	{
		strength 1
		ifactioncount 3
			action ASTAYLIZTORSO
	}
	else ifaction ABURNJIB
	{
		strength 1
		spritepal 4
		ifactioncount 6
		{
			action ABURNEDJIB
			ifrnd 48
				spawn FIRE2
		}
	}
	else
	{		
		ifaction ABURNEDJIB
			spritepal 4
		
		ife atemp 0
		{
			iffloordistl 3
			{
				ifaction ABURNJIB nullop
				else ifaction ABURNEDJIB nullop
				else
					state JibStayAction2
						
				state random_wall_jibs
				ifrnd 8
					spawn BLOODPOOL
				set atemp 1
			}
			else ifceilingdistl 3
			{
				ifaction ABURNJIB nullop
				else ifaction ABURNEDJIB nullop
				else
					state JibStayAction2
						
				state random_wall_jibs
				ifrnd 8
					spawn BLOODPOOL
				set atemp 1
			}
			else ifnotmoving
			{
				ifaction ABURNJIB nullop
				else ifaction ABURNEDJIB nullop
				else
					state JibStayAction2
						
				state random_wall_jibs
					
				ifspawnedby NJIBS6 nullop
				else ifrnd 8
					spawn BLOODPOOL
				set atemp 1
			}
			else
			{
				ifaction AFALLJIB6 nullop
				else ifaction ASPLATJIB6 nullop
				else ifonwater nullop
				else ifinwater nullop
				else ifcount 15 nullop
				else ifrnd 32
				{
					state random_wall_jibs
					guts JIBS6 1
				}
			}
		}
		else
		{
			ifaction APIGTORSO2
			{
				espawn PIGCOPLIMBLESS
				seta[RETURN].xrepeat 48
				seta[RETURN].yrepeat 40
				seta[RETURN].pal sprite[].pal
				killit
			}
			
			ifaction ASTAYLIZTORSO
			{
				espawn LIZTORSODEAD
				seta[RETURN].xrepeat 41
				seta[RETURN].yrepeat 40
				seta[RETURN].pal sprite[].pal
				killit
			}
			
			ifaction ALIZMANTORSOSTAY
			{
				espawn LIZMANTORSODEAD2
				seta[RETURN].xrepeat 48
				seta[RETURN].yrepeat 40
				seta[RETURN].pal sprite[].pal
				killit
			}
			
			ifaction ATROOPTORSO
			{
				espawn TROOPTORSODEAD
				seta[RETURN].xrepeat 48
				seta[RETURN].yrepeat 40
				seta[RETURN].pal sprite[].pal
				killit
			}
			
			ifaction ANBTORSO
			{
				espawn NBTORSODEAD
				seta[RETURN].xrepeat 40
				seta[RETURN].yrepeat 40
				seta[RETURN].pal sprite[].pal
				killit
			}
			
		
			ifpdistl 768
			{
				ifp prunning
				{
					ifaction AHEADJIB
					{
						espawn NHEADJIB
		
						geta[RETURN].z atemp2
						sub atemp2 8192
						seta[RETURN].z atemp2
		
						seta[RETURN].ang player[].ang
						seta[RETURN].pal sprite[].pal
						getp[].sound_pitch atemp
						setp[].sound_pitch 512
						sound THUD
						setp[].sound_pitch atemp
						killit
					}
					else ifaction AHEADJIB2
					{
						espawn NHEADJIB2
						
						geta[RETURN].z atemp2
						sub atemp2 8192
						seta[RETURN].z atemp2
						
						seta[RETURN].ang player[].ang
						seta[RETURN].pal sprite[].pal
						getp[].sound_pitch atemp
						setp[].sound_pitch 512
						sound THUD
						setp[].sound_pitch atemp
						killit
					}
					else ifaction APIGHEAD
					{
						espawn PIGHEAD
						
						geta[RETURN].z atemp2
						sub atemp2 8192
						seta[RETURN].z atemp2
						
						seta[RETURN].ang player[].ang
						seta[RETURN].pal sprite[].pal
						getp[].sound_pitch atemp
						setp[].sound_pitch 512
						sound THUD
						setp[].sound_pitch atemp
						killit
					}
					else ifaction ATROOPHEAD
					{
						espawn TROOPHEAD
						
						geta[RETURN].z atemp2
						sub atemp2 8192
						seta[RETURN].z atemp2
						
						seta[RETURN].ang player[].ang
						seta[RETURN].pal sprite[].pal
						getp[].sound_pitch atemp
						setp[].sound_pitch 512
						sound THUD
						setp[].sound_pitch atemp
						killit
					}
					else ifaction ASGHEAD
					{
						espawn SGHEAD
						
						geta[RETURN].z atemp2
						sub atemp2 8192
						seta[RETURN].z atemp2
						
						seta[RETURN].ang player[].ang
						seta[RETURN].pal sprite[].pal
						getp[].sound_pitch atemp
						setp[].sound_pitch 512
						sound THUD
						setp[].sound_pitch atemp
						killit
					}
					else ifaction ANBHEAD
					{
						espawn NBHEAD
						
						geta[RETURN].z atemp2
						sub atemp2 8192
						seta[RETURN].z atemp2						
						
						seta[RETURN].ang player[].ang
						seta[RETURN].pal sprite[].pal
						getp[].sound_pitch atemp
						setp[].sound_pitch 512
						sound THUD
						setp[].sound_pitch atemp
						killit
					}
					else ifaction ACOMMHEAD
					{
						espawn COMMHEAD
						
						geta[RETURN].z atemp2
						sub atemp2 8192
						seta[RETURN].z atemp2
						
						seta[RETURN].ang player[].ang
						seta[RETURN].pal sprite[].pal
						getp[].sound_pitch atemp
						setp[].sound_pitch 512
						sound THUD
						setp[].sound_pitch atemp
						killit
					}
					else
						nullop
				}
				else ifp pwalking
				{
					ifaction AHEADJIB
					{
						espawn NHEADJIB
						
						geta[RETURN].z atemp2
						sub atemp2 8192
						seta[RETURN].z atemp2
						
						seta[RETURN].yvel 1
						seta[RETURN].ang player[].ang
						seta[RETURN].pal sprite[].pal
						getp[].sound_pitch atemp
						setp[].sound_pitch 512
						sound THUD
						setp[].sound_pitch atemp
						killit
					}
					else ifaction AHEADJIB2
					{
						espawn NHEADJIB2
						
						geta[RETURN].z atemp2
						sub atemp2 8192
						seta[RETURN].z atemp2
						
						seta[RETURN].yvel 1
						seta[RETURN].ang player[].ang
						seta[RETURN].pal sprite[].pal
						getp[].sound_pitch atemp
						setp[].sound_pitch 512
						sound THUD
						setp[].sound_pitch atemp
						killit
					}
					else ifaction APIGHEAD
					{
						espawn PIGHEAD
						
						geta[RETURN].z atemp2
						sub atemp2 8192
						seta[RETURN].z atemp2
						
						seta[RETURN].yvel 1
						seta[RETURN].ang player[].ang
						seta[RETURN].pal sprite[].pal
						getp[].sound_pitch atemp
						setp[].sound_pitch 512
						sound THUD
						setp[].sound_pitch atemp
						killit
					}
					else ifaction ATROOPHEAD
					{
						espawn TROOPHEAD
						
						geta[RETURN].z atemp2
						sub atemp2 8192
						seta[RETURN].z atemp2
						
						seta[RETURN].yvel 1
						seta[RETURN].ang player[].ang
						seta[RETURN].pal sprite[].pal
						getp[].sound_pitch atemp
						setp[].sound_pitch 512
						sound THUD
						setp[].sound_pitch atemp
						killit
					}
					else ifaction ASGHEAD
					{
						espawn SGHEAD
						
						geta[RETURN].z atemp2
						sub atemp2 8192
						seta[RETURN].z atemp2
						
						seta[RETURN].yvel 1
						seta[RETURN].ang player[].ang
						seta[RETURN].pal sprite[].pal
						getp[].sound_pitch atemp
						setp[].sound_pitch 512
						sound THUD
						setp[].sound_pitch atemp
						killit
					}
					else ifaction ANBHEAD
					{
						espawn NBHEAD
						
						geta[RETURN].z atemp2
						sub atemp2 8192
						seta[RETURN].z atemp2
						
						seta[RETURN].yvel 1
						seta[RETURN].ang player[].ang
						seta[RETURN].pal sprite[].pal
						getp[].sound_pitch atemp
						setp[].sound_pitch 512
						sound THUD
						setp[].sound_pitch atemp
						killit
					}
					else ifaction ACOMMHEAD
					{
						espawn COMMHEAD
						
						geta[RETURN].z atemp2
						sub atemp2 8192
						seta[RETURN].z atemp2
						
						seta[RETURN].yvel 1
						seta[RETURN].ang player[].ang
						seta[RETURN].pal sprite[].pal
						getp[].sound_pitch atemp
						setp[].sound_pitch 512
						sound THUD
						setp[].sound_pitch atemp
						killit
					}
					else
						nullop
				}
			}
				
		
			ifhitweapon	
			{
				ifdead
				{
					ifaction ASTAY1JIB6 nullop
					else ifaction ASTAY2JIB6 nullop
					else ifaction ASPLATJIB6 nullop
					else ifaction ABURNJIB nullop
					else ifaction ABURNEDJIB nullop 
					else ifrnd 48
						guts JIBS6 1
					
					killit
				}
				else
				{	
					ifwasweapon FLAMEPROJ
						action ABURNJIB
					else ifwasweapon SONICPROJ
					{
						espawn PUSHER
						seta[RETURN].ang sprite[].htang
						seta[RETURN].owner THISACTOR
						sound THUD
						setactorvar[RETURN].pushervel 2500
						
						ifaction AHEADJIB
						{
							espawn NHEADJIB
			
							geta[RETURN].z atemp2
							sub atemp2 8192
							seta[RETURN].z atemp2
			
							seta[RETURN].ang player[].ang
							seta[RETURN].pal sprite[].pal
							getp[].sound_pitch atemp
							setp[].sound_pitch 512
							sound THUD
							setp[].sound_pitch atemp
							killit
						}
						else ifaction AHEADJIB2
						{
							espawn NHEADJIB2
							
							geta[RETURN].z atemp2
							sub atemp2 8192
							seta[RETURN].z atemp2
							
							seta[RETURN].ang player[].ang
							seta[RETURN].pal sprite[].pal
							getp[].sound_pitch atemp
							setp[].sound_pitch 512
							sound THUD
							setp[].sound_pitch atemp
							killit
						}
						else ifaction APIGHEAD
						{
							espawn PIGHEAD
							
							geta[RETURN].z atemp2
							sub atemp2 8192
							seta[RETURN].z atemp2
							
							seta[RETURN].ang player[].ang
							seta[RETURN].pal sprite[].pal
							getp[].sound_pitch atemp
							setp[].sound_pitch 512
							sound THUD
							setp[].sound_pitch atemp
							killit
						}
						else ifaction ATROOPHEAD
						{
							espawn TROOPHEAD
							
							geta[RETURN].z atemp2
							sub atemp2 8192
							seta[RETURN].z atemp2
							
							seta[RETURN].ang player[].ang
							seta[RETURN].pal sprite[].pal
							getp[].sound_pitch atemp
							setp[].sound_pitch 512
							sound THUD
							setp[].sound_pitch atemp
							killit
						}
						else ifaction ASGHEAD
						{
							espawn SGHEAD
							
							geta[RETURN].z atemp2
							sub atemp2 8192
							seta[RETURN].z atemp2
							
							seta[RETURN].ang player[].ang
							seta[RETURN].pal sprite[].pal
							getp[].sound_pitch atemp
							setp[].sound_pitch 512
							sound THUD
							setp[].sound_pitch atemp
							killit
						}
						else ifaction ANBHEAD
						{
							espawn NBHEAD
							
							geta[RETURN].z atemp2
							sub atemp2 8192
							seta[RETURN].z atemp2						
							
							seta[RETURN].ang player[].ang
							seta[RETURN].pal sprite[].pal
							getp[].sound_pitch atemp
							setp[].sound_pitch 512
							sound THUD
							setp[].sound_pitch atemp
							killit
						}
						else ifaction ACOMMHEAD
						{
							espawn COMMHEAD
							
							geta[RETURN].z atemp2
							sub atemp2 8192
							seta[RETURN].z atemp2
							
							seta[RETURN].ang player[].ang
							seta[RETURN].pal sprite[].pal
							getp[].sound_pitch atemp
							setp[].sound_pitch 512
							sound THUD
							setp[].sound_pitch atemp
							killit
						}
					}
					else ifrnd 48
						guts JIBS6 1
				}
			}
		}
	}

enda

move JIBMOVE 256
move JIBMOVEMID 192
move JIB6MOVE 84
move JIBKICKED 512

defstate NJibMovement

	fall

	ifmove 0
	{
		ifg sprite[].sectnum NUMSECTORS
			killit
	
		ifrnd 48
			add s_destruction 1
	
		ifactor NJIBS6
		{
			move JIB6MOVE randomangle getv
			set atemp4 84
		}
		else ifspawnedby STAYPUTJIBSPAWNER 
		{
			ife sprite[].yvel 1
			{
				move JIBMOVE geth getv
				set atemp4 256
			}
			else
			{
				move JIBKICKED geth getv
				set atemp4 512
			}
				
			set atemp8 1
		}
		else ife sprite[].yvel 1
		{
			move JIBMOVEMID randomangle getv
			set atemp4 192
		}
		else ife sprite[].yvel 10
		{
			move JIBKICKED geth getv
			set atemp4 512
			set atemp8 1
		}
		else ife sprite[].yvel 11
		{
			move JIBMOVE geth getv
			set atemp4 64
			set atemp8 1
		}
		else
		{
			move JIBMOVE geth getv
			set atemp4 256
		}
		
		ifactor NJIBS6
			displayrandvar JibZvel -512
		else ife sprite[].yvel 1
			displayrandvar JibZvel -5000
		else ife sprite[].yvel 10
			displayrandvar JibZvel -6144
		else ife sprite[].yvel 11
			displayrandvar JibZvel -2048
		else
			displayrandvar JibZvel JibZvelMax
			
		seta[].zvel JibZvel
		//seta[].xvel JibsVel
		
		ifactor PIGTORSO2
			sizeat 48 40
		else
		{
			seta[].xrepeat JibsSize
			seta[].yrepeat JibsSize
		}
		
		cstat 0
		
		set atemp 3
		
		insertspriteq
		
		set atmp2 0
		
		switch sprite[].picnum
			case NHEADJIB
			case NLEGJIB
			case NLEGJIB2
			case NARMJIB2
			case NARM2JIB2
			case NARMJIB
			case NBTORSO
			case PIGARM1
			case PIGARM2
			case SGARM
			case TROOPTORSO
			case NHEADJIB2
			case NDUKETORSO
			case NBHEAD
			case TROOPHEAD
			case PIGHEAD
			case COMMHEAD
			case SGHEAD
			case OCTAHEAD
			case NJIBS1
			case NJIBS2
			case PIGTORSO2
			case LIZTORSO
			case LIZMANTORSO
				seta[].yvel 2
				break
		
		endswitch
	}
	
	ifmove JIBMOVE
		set atmp 1
	else ifmove JIB6MOVE
		set atmp 1
	else ifmove JIBMOVEMID
		set atmp 1
	else ifmove JIBKICKED
		set atmp 1
	
	ife atmp 1
	{
		//ifl JibZvel 384
		iffloordistl 2
			nullop
		else
			sub JibZvel JibsDrop
		
		ife atemp8 1
		{
			ifg atemp4 0
				sub atemp4 4
			else
				set atemp4 0
		
		}
		else ifl atemp4 1
			set atemp4 0
			
		seta[].zvel JibZvel
		seta[].xvel atemp4
		
		iffloordistl 2
		{
			ifactor NJIBS6
				set atmp2 1
			else
			{
				ife sprite[].yvel 2
				ifg atemp4 0
					set atmp2 2
				else
					set atmp2 1
					
				ife atemp8 0
				ife atemp 0
					set atmp2 1
			}
		}
		
		ifceilingdistl 4
		{
			ifactor NJIBS6
				set atmp2 1
			else
			{
				ife sprite[].yvel 2
				ifg atemp4 0
					set atmp2 2
				else
					set atmp2 1
					
				ife atemp8 0
				ife atemp 0
					set atmp2 1
			}
		}
		
		ifnotmoving
		{
			ifactor NJIBS6	
				set atmp2 1
			else
			{		
				ife sprite[].yvel 2
				ifg atemp4 0
				{	
					ife atemp8 0
					ife atemp 0
						set atmp2 1
					
					iffloordistl 2
						set atmp2 2
						
					ifceilingdistl 4
						set atmp2 2
						
					state CheckWallNearby
					ife wallTouch 1
					{
						ifactor PIGTORSO2
							sound THUD
					
						ife atemp8 1
						ifrnd 36
						{
							sound SQUISHED
							state random_wall_jibs
							guts JIBS6 2
							
							spawn BLOODPOOL
					
							ifrnd 96
								guts JIBS2 1
								
							ifrnd 96
								guts JIBS2 1
								
							ifrnd 96
								guts JIBS3 2
								
							ifrnd 96
								guts JIBS5 1
							
							killit
						}
					
						ifrnd 72
							state random_wall_jibs
						
						add wallHitAng sprite[].ang
						seta[].ang wallHitAng
						shiftr atemp4 2
					}
					
					ife wallTouch 0
					ife atmp2 0
					ifg sprite[].htmovflag 49152
						set atmp2 2
				}
				else
					set atmp2 1
			}
		}
			
		ife atmp2 2
		{
			ifrnd 72
				state random_wall_jibs	
				
			iffloordistl 2
			ife atemp 0
				set JibZvel 0
			else
			{	
				iffloordistl 2
					mul JibZvel -1
				else ifceilingdistl 4
				ifl JibZvel 0
					mul JibZvel -1
				
				sub atemp 1
				
				set atemp2 atemp
				shiftl atemp2 3
				
				add JibZvel atemp2
				
				ifactor PIGTORSO2
					sound THUD
				
				ife atemp8 1
				ifrnd 8
				{
					sound SQUISHED
					state random_wall_jibs
					guts JIBS6 2
					spawn BLOODPOOL
					
					ifrnd 96
						guts JIBS2 1
						
					ifrnd 96
						guts JIBS2 1
						
					ifrnd 96
						guts JIBS3 1
						
					ifrnd 96
						guts JIBS5 1
					
					killit
				}
				
				ifrnd 72
					guts JIBS6 1
			}
								
			sub atemp4 8
				
			set atmp2 0
		}
		else ife atmp2 1
		{
			espawn STAYPUTJIBSPAWNER
			seta[RETURN].pal sprite[].pal
			ife atemp8 1
				setactorvar[RETURN].atemp8 1
			
			ifactor NJIBS6
				nullop
			else
				guts JIBS6 1
				
			killit
		}
	}

ends

action ROTATINGJIBS -1 4 1 1 6
action ROTATINGJIBS2 -1 3 1 1 6
action ROTATINGJIBS3 0 4 1 1 6
action ROTATINGJIBS4 0 3 1 1 6
action FALLJIB6 -1 2 1 1 6
action DUKEJIBS -1 8 1 1 6

useractor notenemy NHEADJIB 0 ROTATINGJIBS2 state NJibMovement enda
useractor notenemy NARMJIB 0 ROTATINGJIBS2 state NJibMovement enda
useractor notenemy NLEGJIB 0 ROTATINGJIBS2 state NJibMovement enda
useractor notenemy NHEADJIB2 0 ROTATINGJIBS2 state NJibMovement enda
useractor notenemy NARMJIB2 0 ROTATINGJIBS2 state NJibMovement enda
useractor notenemy NARM2JIB2 0 ROTATINGJIBS3 state NJibMovement enda
useractor notenemy NLEGJIB2 0 ROTATINGJIBS2 state NJibMovement enda
useractor notenemy LIZMANTORSO 0 ROTATINGJIBS3 state NJibMovement enda
useractor notenemy NJIBS1 0 ROTATINGJIBS state NJibMovement enda
useractor notenemy NJIBS2 0 ROTATINGJIBS state NJibMovement enda
useractor notenemy NJIBS3 0 ROTATINGJIBS state NJibMovement enda
useractor notenemy NJIBS4 0 ROTATINGJIBS state NJibMovement enda
useractor notenemy NJIBS5 0 ROTATINGJIBS state NJibMovement enda
useractor notenemy NJIBS6 0 FALLJIB6 state NJibMovement enda
useractor notenemy NDUKETORSO 0 DUKEJIBS state NJibMovement enda
useractor notenemy NDUKEGUN 0 DUKEJIBS state NJibMovement enda
useractor notenemy NDUKELEG 0 DUKEJIBS state NJibMovement enda
useractor notenemy PIGARM1 0 ROTATINGJIBS3 state NJibMovement enda
useractor notenemy PIGARM2 0 ROTATINGJIBS3 state NJibMovement enda
useractor notenemy PIGHEAD 0 ROTATINGJIBS3 state NJibMovement enda
useractor notenemy PIGLEG 0 ROTATINGJIBS3 state NJibMovement enda
useractor notenemy PIGTORSO2 0 ROTATINGJIBS3 state NJibMovement enda
useractor notenemy OCTATENT 0 ROTATINGJIBS3 state NJibMovement enda
useractor notenemy OCTAHEAD 0 ROTATINGJIBS3 state NJibMovement enda
useractor notenemy TROOPARM 0 ROTATINGJIBS3 state NJibMovement enda
useractor notenemy TROOPTORSO 0 ROTATINGJIBS3 state NJibMovement enda
useractor notenemy TROOPHEAD 0 ROTATINGJIBS3 state NJibMovement enda
useractor notenemy LIZTORSO 0 ROTATINGJIBS4 state NJibMovement enda
useractor notenemy COMMHEAD 0 ROTATINGJIBS3 state NJibMovement enda
useractor notenemy NBHEAD 0 ROTATINGJIBS3 state NJibMovement enda
useractor notenemy NBARM 0 ROTATINGJIBS3 state NJibMovement enda
useractor notenemy NBLEG 0 ROTATINGJIBS3 state NJibMovement enda
useractor notenemy NBTORSO 0 ROTATINGJIBS4 state NJibMovement enda
useractor notenemy SGARM 0 ROTATINGJIBS3 state NJibMovement enda
useractor notenemy SGHEAD 0 ROTATINGJIBS3 state NJibMovement enda


var gutAng 0 2
var gutPic -1 2
var gutNum 0 2

defstate GutSlow

	espawn gutPic
	seta[RETURN].yvel 1
		
	geta[RETURN].z atemp2
	sub atemp2 8192
	seta[RETURN].z atemp2
		
	geta[].ang atemp2
	add atemp2 gutAng
	seta[RETURN].ang atemp2
	
	seta[RETURN].pal sprite[].pal
	
ends

defstate GutsSlow

	set atemp 0
	whilen atemp gutNum
	{
		espawn gutPic
		seta[RETURN].yvel 1
		
		geta[RETURN].z atemp2
		sub atemp2 8192
		seta[RETURN].z atemp2
		
		geta[].ang atemp2
		displayrandvarvar atemp3 gutAng
		add atemp2 gutAng
		seta[RETURN].ang atemp2
		
		seta[RETURN].pal sprite[].pal
		
		add atemp 1
	}
	
ends

defstate GutFast

	set atemp 0
	whilen atemp gutNum
	{
		espawn gutPic
		
		geta[RETURN].z atemp2
		sub atemp2 8192
		seta[RETURN].z atemp2
		
		geta[].ang atemp2
		displayrandvarvar atemp3 gutAng
		add atemp2 gutAng
		seta[RETURN].ang atemp2
		
		seta[RETURN].pal sprite[].pal
		
		add atemp 1
	}

ends

defstate pig_jibs

	set gutAng 2048
	set gutNum 1
	set gutPic PIGARM1
	state GutFast
	
	set gutAng 2048
	set gutNum 1
	set gutPic PIGARM2
	state GutFast
	
	set gutAng 2048
	set gutNum 2
	set gutPic PIGLEG
	state GutFast
	
	ifactor PIGCOPLIMBLESS
		nullop
	else ifactor PIGCOPHACKED
		nullop
	else ifrnd 128
	{
		set gutAng 2048
		set gutNum 1
		set gutPic PIGTORSO2
		state GutFast
	}
	
	ifactor PIGCOPHEADLESS
		nullop
	else
	{
		set gutAng 2048
		set gutNum 1
		set gutPic PIGHEAD
		state GutFast
	}

ends

defstate octa_jibs

	set gutAng 2048
	displayrandvarvar gutNum 6
	set gutPic OCTATENT
	state GutFast
	
	ifactor OCTAHACKED
		nullop
	else
	{
		set gutAng 2048
		set gutPic OCTAHEAD
		set gutNum 1
		state GutFast
	}

ends

defstate octa_1jib

	displayrandvarvar gutAng 512
	displayrandvarvar atemp 512
	sub gutAng atemp
	set gutPic OCTATENT
	state GutSlow

ends

defstate octa_headjib

	displayrandvarvar gutAng -512
	set gutPic OCTAHEAD
	state GutSlow
	
ends

defstate troop_armjib

	displayrandvarvar gutAng -512
	set gutPic TROOPARM
	state GutSlow
	
ends

defstate troop_torsojib

	displayrandvarvar gutAng 512
	set gutPic TROOPTORSO
	state GutSlow
	
ends

defstate troop_headjib

	displayrandvarvar gutAng 1024
	set gutPic TROOPHEAD
	state GutSlow
	
ends

defstate troop_jibs

	displayrandvarvar gutAng 2048
	set gutPic TROOPHEAD
	set gutNum 1
	state GutFast
	
	displayrandvarvar gutAng 2048
	set gutPic TROOPARM
	set gutNum 2
	state GutFast
	
	displayrandvarvar gutAng 2048
	set gutPic TROOPTORSO
	set gutNum 1
	state GutFast
	
ends

defstate comm_headjib

	displayrandvarvar gutAng 2048
	set gutPic COMMHEAD
	set gutNum 1
	state GutFast

ends

defstate enforcer_armjib

	displayrandvarvar gutAng 2048
	set gutPic NARM2JIB2
	set gutNum 1
	state GutFast

ends

state liz_body_jibs
  ifrnd 128
    guts LIZMANHEAD1 1
  ifrnd 128
    guts LIZMANLEG1 2
  ifrnd 128
    guts LIZMANARM1 1
  ifrnd 64
    spawn BLOODPOOL
  ifrnd 128
  {
	displayrandvarvar gutAng 2048
	set gutPic NARM2JIB2
	set gutNum 1
	state GutFast
  }
  
  ifrnd 96
  {
	displayrandvarvar gutAng 2048
	set gutPic LIZMANTORSO
	set gutNum 1
	state GutFast
  }
ends

defstate nb_headjib

	displayrandvarvar gutAng 1024
	set gutPic NBHEAD
	state GutSlow

ends

defstate nb_armjib

	displayrandvarvar gutAng -512
	set gutPic NBARM
	state GutSlow

ends

defstate nb_torsojib

	displayrandvarvar gutAng 1024
	set gutPic NBTORSO
	state GutSlow

ends

defstate nb_jibs

	ifrnd 128
	{
		displayrandvarvar gutAng 2048
		set gutPic NBHEAD
		set gutNum 1
		state GutFast
		
		displayrandvarvar gutAng 2048
		set gutPic NBLEG
		set gutNum 2
		state GutFast
		
		displayrandvarvar gutAng 2048
		set gutPic NBARM
		set gutNum 2
		state GutFast
	}
	else
	{
		displayrandvarvar gutAng 2048
		set gutPic NBTORSO
		set gutNum 1
		state GutFast
		
		displayrandvarvar gutAng 2048
		set gutPic NBLEG
		set gutNum 2
		state GutFast
	}

ends

defstate sg_armjib

	displayrandvarvar gutAng 1024
	set gutPic SGARM
	state GutSlow

ends

defstate sg_headjib

	displayrandvarvar gutAng 1024
	set gutPic SGHEAD
	state GutSlow

ends

defstate sg_jibs

	displayrandvarvar gutAng 2048
	set gutPic SGARM
	set gutNum 2
	state GutFast
		
	displayrandvarvar gutAng 2048
	set gutPic SGHEAD
	set gutNum 1
	state GutFast
		
ends

appendevent EVENT_EGS

	switch sprite[THISACTOR].picnum
	
		case LSHELL
			sizeat 5 5
			break
			
		case LSSHELL
			ifspritepal 31
				sizeat 6 7
			else
				sizeat 5 5
			break
	
		case RPG
			ifspawnedby BOSS3
				set overlordrpg 1
			
			ife overlordrpg 1
			{
				set atemp RPG_WEAPON_STRENGTH
				
				ife userdef.player_skill 6
				ifg PlayerLives 0
					div atemp 24
				else
					div atemp 12
				
				setthisprojectile[].extra atemp
				seta[].extra atemp
			}
			
			break
			
		case FREEZEBLAST
			ifspawnedby SCORPIONTANK
			{
				setthisprojectile[].extra 4
				seta[].extra 4
			}
			
			break
	/*
		case PIGARM1
		case PIGARM2
		case PIGHEAD
		case PIGLEG
			geta[].z atemp
			sub atemp 8192
			seta[].z atemp
			break
	*/
		case HEADJIB1
			//displayrandvar JibZvel JibZvelMax
			//ezshoot JibZvel NHEADJIB
			espawn NHEADJIB
			seta[].pal sprite[sprite[].owner].pal
			seta[RETURN].pal sprite[].pal
			//setthisprojectile[RETURN].pal sprite[].pal
			break
			
		case ARMJIB1
			//displayrandvar JibZvel JibZvelMax
			//ezshoot JibZvel NARMJIB
			//setthisprojectile[RETURN].pal sprite[].pal
			espawn NARMJIB
			seta[].pal sprite[sprite[].owner].pal
			seta[RETURN].pal sprite[].pal
			break
			
		case LEGJIB1
			//displayrandvar JibZvel JibZvelMax
			//ezshoot JibZvel NLEGJIB
			//setthisprojectile[RETURN].pal sprite[].pal
			espawn NLEGJIB
			seta[].pal sprite[sprite[].owner].pal
			seta[RETURN].pal sprite[].pal
			break
			
		case LIZMANHEAD1
			//displayrandvar JibZvel JibZvelMax
			//ezshoot JibZvel NHEADJIB2
			espawn NHEADJIB2
			seta[].pal sprite[sprite[].owner].pal
			seta[RETURN].pal sprite[].pal
			//setthisprojectile[RETURN].pal sprite[].pal
			break
			
		case LIZMANARM1
			//displayrandvar JibZvel JibZvelMax
			//zshoot JibZvel NARMJIB2
			espawn NARMJIB2
			seta[].pal sprite[sprite[].owner].pal
			seta[RETURN].pal sprite[].pal
			//setthisprojectile[RETURN].pal sprite[].pal
			break
			
		case LIZMANLEG1
			//displayrandvar JibZvel JibZvelMax
			//ezshoot JibZvel NLEGJIB2
			espawn NLEGJIB2
			seta[].pal sprite[sprite[].owner].pal
			seta[RETURN].pal sprite[].pal
			//setthisprojectile[RETURN].pal sprite[].pal
			break
	
		case JIBS1
			//displayrandvar JibZvel JibZvelMax
			//ezshoot JibZvel NJIBS1
			ifspawnedby NEWBEAST
				set atemp 6
			else ifspawnedby NBDEAD
				set atemp 6
			else ifspawnedby NBDEADA
				set atemp 6
			else ifspawnedby NBDEADH
				set atemp 6
			else
				set atemp 0
				
			espawn NJIBS1
			seta[RETURN].pal atemp
			//setthisprojectile[RETURN].pal sprite[].pal
			break
			
		case JIBS2
			//displayrandvar JibZvel JibZvelMax
			//ezshoot JibZvel NJIBS2
			ifspawnedby NEWBEAST
				set atemp 6
			else ifspawnedby NBDEAD
				set atemp 6
			else ifspawnedby NBDEADA
				set atemp 6
			else ifspawnedby NBDEADH
				set atemp 6
			else
				set atemp 0
				
			espawn NJIBS2
			seta[RETURN].pal atemp
			//setthisprojectile[RETURN].pal sprite[].pal
			break
			
		case JIBS3
			//displayrandvar JibZvel JibZvelMax
			//ezshoot JibZvel NJIBS3
			ifspawnedby NEWBEAST
				set atemp 6
			else ifspawnedby NBDEAD
				set atemp 6
			else ifspawnedby NBDEADA
				set atemp 6
			else ifspawnedby NBDEADH
				set atemp 6
			else
				set atemp 0
				
			espawn NJIBS3
			seta[RETURN].pal atemp
			//setthisprojectile[RETURN].pal sprite[].pal
			break
			
		case JIBS4
			//displayrandvar JibZvel JibZvelMax
			//ezshoot JibZvel NJIBS4
			ifspawnedby NEWBEAST
				set atemp 6
			else ifspawnedby NBDEAD
				set atemp 6
			else ifspawnedby NBDEADA
				set atemp 6
			else ifspawnedby NBDEADH
				set atemp 6
			else
				set atemp 0
				
			espawn NJIBS4
			seta[RETURN].pal atemp
			//setthisprojectile[RETURN].pal sprite[].pal
			break
			
		case JIBS5
			//displayrandvar JibZvel JibZvelMax
			//ezshoot JibZvel NJIBS5
			ifspawnedby NEWBEAST
				set atemp 6
			else ifspawnedby NBDEAD
				set atemp 6
			else ifspawnedby NBDEADA
				set atemp 6
			else ifspawnedby NBDEADH
				set atemp 6
			else
				set atemp 0
				
			espawn NJIBS5
			seta[RETURN].pal atemp
			//setthisprojectile[RETURN].pal sprite[].pal
			break
			
		case JIBS6
			ifrnd 256
			{
				//displayrandvar JibZvel -512
				//ezshoot JibZvel NJIBS6
				ifspawnedby NEWBEAST
					set atemp 6
				else ifspawnedby NBDEAD
					set atemp 6
				else ifspawnedby NBDEADA
					set atemp 6
				else ifspawnedby NBDEADH
					set atemp 6
				else
					set atemp 0
					
				espawn NJIBS6
				seta[RETURN].pal atemp
				//setthisprojectile[RETURN].pal sprite[].pal
				sizeat 0 0
			}
			break
			
		case DUKETORSO
			ifrnd 256
			{
				//displayrandvar JibZvel JibZvelMax
				//ezshoot JibZvel NDUKETORSO
				spawn NDUKETORSO
				//setthisprojectile[RETURN].pal sprite[].pal
				sizeat 0 0
			}
			break
			
		case DUKEGUN
			ifrnd 256
			{
				//displayrandvar JibZvel JibZvelMax
				//ezshoot JibZvel NDUKEGUN
				spawn NDUKEGUN
				//setthisprojectile[RETURN].pal sprite[].pal
				sizeat 0 0
			}
			break
			
		case DUKELEG
			ifrnd 256
			{
				//displayrandvar JibZvel JibZvelMax
				//ezshoot JibZvel NDUKELEG
				spawn NDUKELEG
				//setthisprojectile[RETURN].pal sprite[].pal
				sizeat 0 0
			}
			break
			
	endswitch

endevent

var rpgzvel 0 2
var rpgdefinedzvel 0 2

appendevent EVENT_GAME

	//Scraps
	ifge sprite[].picnum 2390
	ifle sprite[].picnum 2418
	{
		ife atmp 0
		{
			insertspriteq
			set atmp 1
		}
		
		ife 4 sprite[].htg_t 2
			fall
	}
	
	ifge sprite[].picnum 1031
	ifle sprite[].picnum 1033
	{
		ife 3 sprite[].htg_t 2
			fall
	}

	switch sprite[THISACTOR].picnum
		
		case SHELL
			geta[].zvel atmp
			add atmp 16
			seta[].zvel atmp
			
			iffloordistl 4
			ifrnd 176
			{
				espawn LSHELL
				setactorvar[RETURN].atemp4 sprite[].xvel
				setactorvar[RETURN].atemp5 sprite[].zvel
				killit
			}
			break
			
		case SHOTGUNSHELL
			geta[].zvel atmp
			add atmp 48
			seta[].zvel atmp
		
			iffloordistl 4
			ifrnd 176
			{
				espawn LSSHELL
				setactorvar[RETURN].atemp4 sprite[].xvel
				setactorvar[RETURN].atemp5 sprite[].zvel
				seta[RETURN].pal sprite[].pal
				killit
			}
			break
			
		case TRACER
			seta[].angoff -512
			break
			
		case EXPTRACER
			seta[].angoff -512
			break
			
		case SHOTSPARK1
			ife atemp6 0
			{
				ifspawnedby TRACER	
				{
					ifrnd 96
						spawn SMALLSMOKE
						
					ifrnd 16
						sound PISTOL_RICOCHET	
						
					set atemp6 1
				}
				else ifspawnedby EXPTRACER	
				{
					ifrnd 96
						spawn SMALLSMOKE
						
					espawn EXPLOSION2
					seta[RETURN].xrepeat 8
					seta[RETURN].yrepeat 8
					hitradius 1024 2 2 2 2
						
					ifrnd 16
						sound PISTOL_RICOCHET	
						
					set atemp6 1
				}
			}
			
			break
	
		case RPG
			angoff -512
			
			findnearactor LIZTROOP 768 atemp
				
			ifn atemp -1
			{
				geta[atemp].z atemp2
				sub atemp2 sprite[].z
				abs atemp2
					
				ifl atemp2 8192
				ifg sprite[atemp].extra 0
				{
					getactorvar[atemp].projpass atemp2
						
					ife atemp2 0
					{
						ifrnd 64
						{
							seta[atemp].htextra sprite[atemp].extra
							seta[atemp].htpicnum RPG
							seta[atemp].cstat 0
							setactorvar[atemp].projpass 1
						}
					}
					else
						setactorvar[atemp].projpass 2
				}
			}
			
			findnearactor OCTABRAIN 768 atemp
				
			ifn atemp -1
			{
				geta[atemp].z atemp2
				sub atemp2 sprite[].z
				abs atemp2
					
				ifl atemp2 8192
				ifg sprite[atemp].extra 0
				{
					getactorvar[atemp].projpass atemp2
						
					ife atemp2 0
					{
						ifrnd 64
						{
							seta[atemp].htextra sprite[atemp].extra
							seta[atemp].htpicnum RPG
							seta[atemp].cstat 0
							setactorvar[atemp].projpass 1
						}
					}
					else
						setactorvar[atemp].projpass 2
				}
			}
			
			findnearactor SNAKEHEAD 768 atemp
				
			ifn atemp -1
			{
				geta[atemp].z atemp2
				sub atemp2 sprite[].z
				abs atemp2
					
				ifl atemp2 4096
				ifg sprite[atemp].extra 0
				{
					getactorvar[atemp].projpass atemp2
						
					ife atemp2 0
					{
						ifrnd 128
						{
							seta[atemp].htextra sprite[atemp].extra
							seta[atemp].htpicnum RPG
							seta[atemp].cstat 0
							setactorvar[atemp].projpass 1
						}
					}
					else
						setactorvar[atemp].projpass 2
				}
			}
			
			setactor[].xvel 900
			ife rpgdefinedzvel 0
			{
				geta[].zvel atemp
				mul atemp 900
				div atemp 644
				seta[].zvel atemp
				set rpgzvel atemp
				set rpgdefinedzvel 1
			}
			else
				seta[].zvel rpgzvel
				
			ife overlordrpg 1
			{
				set atemp RPG_WEAPON_STRENGTH
				div atemp 6
				setthisprojectile[].extra atemp
				seta[].extra atemp
			}
				
			ife boss1deflect 0
				{
					findnearactor BOSS1 1536 atemp6
					ifn atemp6 -1
					{
						getincangle atemp7 sprite[].ang sprite[atemp6].ang
						abs atemp7
						sub atemp7 1024
						abs atemp7
						
						geta[atemp].z atemp3
						sub atemp3 sprite[].z
						abs atemp3
						
						getactorvar[atemp6].a_plasmaeffect atemp8
						
						ifg sprite[atemp].extra 0
						ifl atemp3 24000
						ifle atemp7 256
						ife atemp8 0
						ifrnd 96
						{
							setactorvar[atemp6].boss1deflect 1
							geta[].ang atemp7
							sub atemp7 1024
							seta[].ang atemp7
							seta[].zvel -2048
							sound PIPEBOMB_BOUNCE
							set boss1deflect 1
						}
					}
					
				}
			
			break
		
		case ROCKETPROJ
			angoff -512
		
			ifn sprite[sprite[].owner].picnum COMMANDER
			{
				findnearactor COMMANDER 768 atemp
				
				ifn atemp -1
				{
					geta[atemp].z atemp2
					sub atemp2 sprite[].z
					abs atemp2
					
					ifl atemp2 8192
					ifg sprite[atemp].extra 0
					{
						getactorvar[atemp].projpass atemp2
						
						ife atemp2 0
						{
							ifrnd 128
							{
								setactorvar[atemp].projpass 1
								seta[atemp].cstat 0
							}
							else
								setactorvar[atemp].projpass 2
						}
					}
				}
			}
			
			findnearactor LIZTROOP 768 atemp
				
			ifn atemp -1
			{
				geta[atemp].z atemp2
				sub atemp2 sprite[].z
				abs atemp2
					
				ifl atemp2 8192
				ifg sprite[atemp].extra 0
				{
					getactorvar[atemp].projpass atemp2
						
					ife atemp2 0
					{
						ifrnd 192
						{
							seta[atemp].htextra sprite[atemp].extra
							seta[atemp].htpicnum ROCKETPROJ
							seta[atemp].cstat 0
							setactorvar[atemp].projpass 1
						}
					}
					else
						setactorvar[atemp].projpass 2
				}
			}
			
			findnearactor PIGCOP 768 atemp
				
			ifn atemp -1
			{
				geta[atemp].z atemp2
				sub atemp2 sprite[].z
				abs atemp2
					
				ifl atemp2 8192
				ifg sprite[atemp].extra 0
				{
					getactorvar[atemp].projpass atemp2
						
					ife atemp2 0
					{
						ifrnd 64
						{
							seta[atemp].htextra sprite[atemp].extra
							seta[atemp].htpicnum ROCKETPROJ
							seta[atemp].cstat 0
							setactorvar[atemp].projpass 1
						}
					}
					else
						setactorvar[atemp].projpass 2
				}
			}
			
			findnearactor OCTABRAIN 768 atemp
				
			ifn atemp -1
			{
				geta[atemp].z atemp2
				sub atemp2 sprite[].z
				abs atemp2
					
				ifl atemp2 8192
				ifg sprite[atemp].extra 0
				{
					getactorvar[atemp].projpass atemp2
						
					ife atemp2 0
					{
						ifrnd 128
						{
							seta[atemp].htextra sprite[atemp].extra
							seta[atemp].htpicnum RPG
							seta[atemp].cstat 0
							setactorvar[atemp].projpass 1
						}
					}
					else
						setactorvar[atemp].projpass 2
				}
			}
			
			findnearactor SNAKEHEAD 768 atemp
				
			ifn atemp -1
			{
				geta[atemp].z atemp2
				sub atemp2 sprite[].z
				abs atemp2
					
				ifl atemp2 4096
				ifg sprite[atemp].extra 0
				{
					getactorvar[atemp].projpass atemp2
						
					ife atemp2 0
					{
						ifrnd 192
						{
							seta[atemp].htextra sprite[atemp].extra
							seta[atemp].htpicnum RPG
							seta[atemp].cstat 0
							setactorvar[atemp].projpass 1
						}
					}
					else
						setactorvar[atemp].projpass 2
				}
			}
		
			ife boss1deflect 0
			{
				findnearactor BOSS1 1536 atemp
				ifn atemp -1
				{
					getincangle atemp2 sprite[].ang sprite[atemp].ang
					abs atemp2
					sub atemp2 1024
					abs atemp2
					
					geta[atemp].z atemp3
					sub atemp3 sprite[].z
					abs atemp3
					
					getactorvar[atemp6].a_plasmaeffect atemp8
					
					ifg sprite[atemp].extra 0
					ifl atemp3 24000
					ifle atemp2 256
					ife atemp8 0
					ifrnd 128
					{
						setactorvar[atemp].boss1deflect 1
						geta[].ang atemp2
						sub atemp2 1024
						seta[].ang atemp2
						seta[].zvel -2048
						seta[].xvel 512
						sound PIPEBOMB_BOUNCE
						set boss1deflect 1
					}
				}
				
			}
			break
			
		case REACTOR
			ife VOLUME 1
			ife LEVEL 8
			ife sprite[].hitag 300
			ifdead
			{
				set overlord_init 1
				operatemasterswitches 300
			}
				
			break
		
		case SECTOREFFECTOR
			switch sprite[].lotag
				case 60
					state SpaceLT60
					break	
				case 61
					state SpaceLT61
					break
					
				case 100
					ife sprite[].hitag 0
					ife atemp 0
					  ife player[].cursectnum sprite[].sectnum
					  {
						set fadeMusicTime 240
						ifn curr_music -1
							state FadeOutMusic
							
						set atemp 1
					  }
					else ifg sprite[].hitag 0
					ife atemp 0
					{
						ldist atemp THISACTOR player[].i
						
						ifle atemp sprite[].hitag
						{
							set fadeMusicTime 240
							ifn curr_music -1
								state FadeOutMusic
							
							set atemp 1
						}
					}
					
					ife atemp 1
					{
						ife fadeMusicStart 0
						{
							set music_load_pos 0
							setu[].configmusic fadeMusicVolumeSet
							state PlayRegularMusic
							killit
						}
					}
					
					break
					
				case 101
					ife sprite[].hitag 0
					  ife player[].cursectnum sprite[].sectnum
					    ife atemp 0
					  {
					    set fadeMusicTime 240
						ifn curr_music -1
								state FadeOutMusic
						set atemp 1
					  }
					else ifg sprite[].hitag 0
					  ife atemp 0
					{
						ldist atemp THISACTOR player[].i
						
						ifle atemp sprite[].hitag
						{
						    set fadeMusicTime 240
							ifn curr_music -1
								state FadeOutMusic
								
							set atemp 1
						}
					}
					
					ife atemp 1
					{
						ife fadeMusicStart 0
						{
							set music_load_pos 0
							setu[].configmusic fadeMusicVolumeSet
							state PlayActionMusic
							killit
						}
					}
					
					break
					
				case 102
					ife boss1fx 1
					{
						ifn atmp 60
							add atmp 1
						else
						{
							set atmp 0
							
							ifl userdef.qsize 512
							ifrnd 64
								break
								
							ifl userdef.qsize 256
							ifrnd 96
								break
							
							quake 30
							eqspawn EXPLOSION3
							seta[RETURN].xrepeat 32
							seta[RETURN].yrepeat 32
							
							eqspawn JELLYCONNECTORACTOR
							seta[RETURN].yvel 3
							geta[RETURN].z atemp2
							sub atemp2 8192
							seta[RETURN].z atemp2
								
							setactorvar[RETURN].atmp -8192
							displayrandvar atemp 2048
							seta[RETURN].ang atemp
							
							ife VOLUME 0
							{
								setprojectile[CLUSTERPROJ].extra 1
								geta[].ang atmp2
								zshoot -8192 CLUSTERPROJ
								
								add atmp2 384
								seta[].ang atmp2
								ezshoot -8192 CLUSTERPROJ
								
								add atmp2 384
								seta[].ang atmp2
								ezshoot -8192 CLUSTERPROJ
								
								add atmp2 384
								seta[].ang atmp2
								ezshoot -8192 CLUSTERPROJ
								
								add atmp2 384
								seta[].ang atmp2
								ezshoot -8192 CLUSTERPROJ
								
								add atmp2 384
								seta[].ang atmp2
								ezshoot -8192 CLUSTERPROJ
								setprojectile[CLUSTERPROJ].extra ROCKETCLUSTERDAMAGE
							}
						}
						
						ifrnd 24
						ifg userdef.qsize 96
						{
							debris SCRAP1 1
							debris SCRAP2 1
							debris SCRAP3 1
							debris SCRAP4 1
							debris SCRAP5 1
						}
					}
					else
						set atmp 0
					
					break
					
				case 103
					ife boss1fx 1
					{
						ifl atmp atmp2
							add atmp 1
						else
						{
							set atmp 0
							
							ifl userdef.qsize 512
							ifrnd 64
								break
								
							ifl userdef.qsize 256
							ifrnd 96
								break
							
							displayrandvar atmp2 60
							qspawn EXPLOSION2
							//spawn EXPLOSION2BOT
							ifrnd 24
								sound PIPEBOMB_EXPLODE
							
							ifg userdef.qsize 96
							{
								debris SCRAP1 1
								debris SCRAP2 1
								debris SCRAP3 1
								debris SCRAP4 1
								debris SCRAP5 1
							}
							
							ifrnd 64
							{
								eqspawn JELLYCONNECTORACTOR
								seta[RETURN].yvel 3
								geta[RETURN].z atemp2
								sub atemp2 8192
								seta[RETURN].z atemp2
								
								setactorvar[RETURN].atmp -8192
								displayrandvar atemp 2048
								seta[RETURN].ang atemp
							}
						}
					}
					else
					{
						set atmp2 60
						set atmp 0
					}
					
					break
					
				case 110
					
					ife overlord_init 1
					{
						ife atmp2 60
							sound BOS2_RECOG
						else ifg atmp2 120
						{
							ifrnd 1
								soundonce BOS2_ROAM
								
							ifpdistl 4096
							{
								operateactivators 20 0
								set music_load_pos 0
								state PlayActionMusic
								set overlord_init 2
								
							}
						}
					
						ifl atmp 20
							add atmp 1
						else
						{
							quake 10
							set atmp 0
						}
						
						add atmp2 1
					}
					
					break
					
				case 111
					set overlord_SEpos THISACTOR
					break
					
				case 120
					ife SE120Active 0
						set atemp6 10
					else ifge SE120Active 1
					{
						ifge atmp 1
						{
							set atmp2 atmp
							mod atmp2 15
							
							ife atmp2 0
							{
								espawn EXPLOSION2
								sound RPG_EXPLODE
								set atmp2 atmp
								shiftl atmp2 10
								geta[].z atemp
								
								ifspritepal 2
									mul atmp2 -1
								
								sub atemp atmp2
								seta[RETURN].z atemp
								
								displayrandvar atemp2 512
								displayrandvar atemp3 512
								geta[].x atemp
								add atemp atemp2
								sub atemp atemp3
								seta[RETURN].x atemp
								
								displayrandvar atemp2 512
								displayrandvar atemp3 512
								geta[].y atemp
								add atemp atemp2
								sub atemp atemp3
								seta[RETURN].y atemp
							}
							
							getsector[sprite[].sectnum].floorslope atemp
							
							displayrandvar atemp4 512
							displayrandvarvar atemp3 atemp4 
							add atemp atemp3
							
							ifspritepal 2
							{
								getsector[sprite[].sectnum].ceilingslope atemp
								displayrandvar atemp4 512
								displayrandvarvar atemp3 atemp4 
								sub atemp atemp3
								
								setsector[sprite[].sectnum].ceilingslope atemp
							}
							else
								setsector[sprite[].sectnum].floorslope atemp

							ifspritepal 2
								setsector[sprite[].sectnum].ceilingpicnum 852 
							else
								setsector[sprite[].sectnum].floorpicnum 852
								
							setsector[sprite[].sectnum].floorpal 0
							setsector[sprite[].sectnum].ceilingpal 0
							
							ifl atmp 60
								add atmp 1
							else
							{
								add SE120Active 1
								killit
							}
						}
						
						ifl atemp6 1
						ife atmp 0
						{	
							state standard_scraps
							set atmp 1
						}
						else
						{
							ife sprite[].hitag 0
							{
								findnearsprite EXPLOSION2 1536 atemp5

								ifn atemp5 -1
								{
									ife sprite[sprite[atemp5].owner].picnum SECTOREFFECTOR
									ifrnd 128
										nullop
									else
									ife sprite[sprite[atemp5].owner].picnum EXPLOSION2
										nullop
									else
									ifg sprite[atemp5].xrepeat 16
									{
										getactorvar[atemp5].atmp2 atemp7
										ife atemp7 0
										{
											state random_scraps
											espawn BOLT1
											seta[RETURN].xrepeat 16
											seta[RETURN].yrepeat 128
											
											setactorvar[atemp5].atmp2 1
											
											sub atemp6 5
										}
									}
								}
								
								findnearsprite EXPLOSION2BOT 1536 atemp5

								ifn atemp5 -1
								{
									ife sprite[atemp5].yvel 0
									{
										state random_scraps
										espawn BOLT1
										seta[RETURN].xrepeat 16
										seta[RETURN].yrepeat 128
										
										seta[atemp5].yvel 1
										
										sub atemp6 5
									}
								}
								
								findnearsprite EXPLOSION3 1536 atemp5

								ifn atemp5 -1
								{
									ifg sprite[atemp5].xrepeat 16
									ife sprite[atemp5].yvel 0
									{
										state random_scraps
										espawn BOLT1
										seta[RETURN].xrepeat 16
										seta[RETURN].yrepeat 128
										
										seta[atemp5].yvel 1
										
										sub atemp6 2
									}
								}
								
								findnearsprite SHOTSPARK1 1536 atemp5
								
								ifn atemp5 -1
								{
									getactorvar[atemp5].atmp2 atemp7
									ife atemp7 0
									{
										state random_scraps
										espawn BOLT1
										
										seta[RETURN].xrepeat 16
										seta[RETURN].yrepeat 128
											
										setactorvar[atemp5].atmp2 1
										
										ifrnd 64
											sub atemp6 1
									}
								}
							}
							
							ife boss4phase 12
							ifn sprite[].hitag 0
							{
								ifl atemp7 60
									add atemp7 1
								else
									killit
									
								set atemp6 atemp7
								
								mod atemp6 5
								
								ife atemp6 0
								{
									displayrandvar atemp 256
									displayrandvar atemp2 256
									espawn EXPLOSION2
									sound PIPEBOMB_EXPLODE
									sub atemp atemp2
									add atemp sprite[].x
									
									displayrandvar atemp2 256
									displayrandvar atemp3 256
									sub atemp3 atemp2
									add atemp3 sprite[].y
									
									displayrandvar atemp4 6144
									mul atemp4 -1
									add atemp4 sprite[].z
									
									setsprite RETURN atemp atemp3 atemp4
								}
								
								set atemp6 1
							}
							
							ife boss4att 1
							ifl boss4phase 12
							{
								ifl atemp7 3
									add atemp7 1
								else
								{
									ldist atemp2 cycloid_sprite THISACTOR
									
									ifl atemp2 12288
									{
										set atemp8 BOSS4STRENGTH
										ife userdef.enable_nuke 1
										ife userdef.nuke_active 1
										{
											mul atemp8 userdef.nuke_enemyhealth
											div atemp8 100
										}
										
										geta[cycloid_sprite].extra atemp2
										ifl atemp2 atemp8
										{
											ifl boss4phase 10
												add atemp2 100
											else
												add atemp2 10
												
											seta[cycloid_sprite].extra atemp2
										}
									}
										
									espawn JELLYCONNECTORACTOR
									
									ifg boss4phase 10
										seta[RETURN].pal 21
									
									seta[RETURN].yvel 1
									geta[RETURN].z atemp2
									sub atemp2 8192
									seta[RETURN].z atemp2
										
									set atemp7 0
								}
							}
							
						}
					}
					break
					
				case 121
					ife boss4phase 1
					ife sprite[].hitag 0
					{
						ife atemp5 0
						{
							quake 30
							
							geta[].ang atemp
							set atemp4 0
							whilen atemp4 8
							{
								espawn JELLYCONNECTORACTOR
								seta[RETURN].yvel 3
								geta[RETURN].z atemp2
								sub atemp2 8192
								seta[RETURN].z atemp2
										
								setactorvar[RETURN].atmp -12444
								add atemp 256
								seta[RETURN].ang atemp
								
								add atemp4 1
							}
							set atemp5 1
						}
						else ifl atemp5 10
							add atemp5 1
						else
						{
							state standard_scraps
							lotsofglass 120
							
							set atemp 0
							getsector[sprite[].sectnum].wallnum atemp2
							getsector[sprite[].sectnum].wallptr atmp
							
							whilel atemp atemp2
							{
								getwall[atmp].cstat atmp2
								
								ifand atmp2 1
									xor atmp2 1
									
								ifand atmp2 16
									xor atmp2 16
									
								ifand atmp2 64
									xor atmp2 64
									
								setwall[atmp].cstat atmp2
								
								getwall[atmp].nextwall atemp3
								
								getwall[atemp3].cstat atmp2
								
								ifand atmp2 1
									xor atmp2 1
									
								ifand atmp2 16
									xor atmp2 16
									
								ifand atmp2 64
									xor atmp2 64
									
								setwall[atemp3].cstat atmp2
									
								getwall[atmp].point2 atmp
									
								add atemp 1
							}
							
							killit
						}
					}
					else ife boss4phase 4
					ife sprite[].hitag 5
					{
						ldist atemp cycloid_sprite THISACTOR
						
						ifl atemp 4096
						{
							ifl atemp5 30
								add atemp5 1
							else
							{
								operatemasterswitches 6670
								ifl atmp 12
									add atmp 1
								else
								{
									add atmp2 1
									set atmp 0
									displayrandvar atemp 256
									displayrandvar atemp2 256
									espawn EXPLOSION2
									sound PIPEBOMB_EXPLODE
									sub atemp atemp2
									add atemp sprite[].x
									
									displayrandvar atemp2 256
									displayrandvar atemp3 256
									sub atemp3 atemp2
									add atemp3 sprite[].y
									
									displayrandvar atemp4 6144
									mul atemp4 -1
									add atemp4 sprite[].z
									
									setsprite RETURN atemp atemp3 atemp4
								}
								
								ife atmp2 6
									killit
							}
						}
					}
					break
				
				case 122
					ifge boss4phase 12
					{
						getsector[sprite[].sectnum].floorz atmp
						add atmp 2048
						setsector[sprite[].sectnum].floorz atmp
						
						getsector[sprite[].sectnum].ceilingz atmp
						add atmp 2048
						setsector[sprite[].sectnum].ceilingz atmp
						
						geta[].z atmp
						add atmp 2048
						seta[].z atmp
						
						set atemp2 atemp
						mod atemp2 5
						
						ife atemp2 0
						{
							spawn EXPLOSION2
							sound RPG_EXPLODE
							spawn FIREBALL
							spawn FIREBALL
							
							state standard_scraps
						}
						
						ifl atemp 60
							add atemp 1
						else
						{
							palfrom 63 0 0 63
							
							set atemp 0
							for atemp spritesofstatus 3
							{							
								ife sprite[atemp].picnum SECTOREFFECTOR
								ife sprite[atemp].lotag 123
								ife sprite[atemp].hitag sprite[].hitag
								{
									geta[atemp].x atmp
									geta[atemp].y atmp2
									geta[atemp].z atemp3
									
									sub atmp sprite[].x
									sub atmp2 sprite[].y
									add atemp3 sprite[].z
								
									set atemp2 0
									for atemp2 spritesofsector sprite[].sectnum
									{
										geta[atemp2].x atemp4
										add atemp4 atmp
											
										geta[atemp2].y atemp5
										add atemp5 atmp2
											
										geta[atemp].z atemp6
										sub atemp6 8192
											
										setsprite atemp2 atemp4 atemp5 atemp6
									}
									
									ifn sector[player[].cursectnum].lotag 2
									{
										getp[].posx atemp4
										getp[].posy atemp5
										geta[atemp].z atemp6
										
										add atemp4 atmp
										add atemp5 atmp2
										
										sub atemp6 8192
										
										updatesector atemp4 atemp5 atemp7
										
										setp[].posx atemp4
										setp[].posy atemp5
										setp[].posz atemp6
										setp[].cursectnum atemp7
										
										setsprite player[].i atemp4 atemp5 atemp6
										
										changespritesect player[].i atemp7
										
										ifinwater
											setp[].palette 1
									}
								}
								
							}
							
							killit
						}
					}
					break
					
				case 124
					ife boss4phase 1
					ife boss4att 1
					{
						ife atemp 0
						{
							ifrnd 96
								spawn FLAMEENFORCERJUMP
							else ifrnd 128
								spawn SNAKEHEAD
							else ifrnd 64
								spawn SARGE
							else
								spawn LIZTROOP
						}
					
						ifl atemp 220
							add atemp 1
						else
							set atemp 0
						
					}
					break
					
				case 130
					ifg sprite[].hitag 0
					{
						ldist atemp player[].i THISACTOR
						
						ifl atemp sprite[].hitag
						{
							set tutorialTime TUTORIALTIME
							set tutorialType sprite[].lotag
							killit
						}
					}
					else
					{
						ife player[].cursectnum sprite[].sectnum
						{
							set tutorialTime TUTORIALTIME
							set tutorialType sprite[].lotag
							killit
						}
					}
					break
				
			endswitch
			break
			
		case BOLT1
			ifspawnedby SECTOREFFECTOR
			ife atmp 0
				set atmp 1
			
			ifge atmp 1
			{
				spritepal 0
				
				ife atmp 8
					killit
				else
					add atmp 1
			}
			break
			
		case HEADJIB1
		case ARMJIB1
		case LEGJIB1
		case LIZMANHEAD1
		case LIZMANARM1
		case LIZMANLEG1
		case JIBS1
		case JIBS2
		case JIBS3
		case JIBS4
		case JIBS5
			killit
			break
			
		case BOUNCEMINE
			add atemp 24
			angoffvar atemp
			break
			
		case APLAYER
			
			switch userdef.nuke_wpnsel
				case 0
					setarray wpnroster[SHOTGUN_WEAPON] 0
					setarray wpnroster[SHOTGUNDOUBLE_WEAPON] 0
					setarray wpnroster[CHAINGUN_WEAPON] 0
					setarray wpnroster[PLASMA_WEAPON] 0
					setarray wpnroster[RPG_WEAPON] 0
					setarray wpnroster[RPGBLAST_WEAPON] 0
					setarray wpnroster[SHRINKER_WEAPON] 0
					setarray wpnroster[GROW_WEAPON] 0
					setarray wpnroster[DEVISTATOR_WEAPON] 0
					setarray wpnroster[SONICRESONATOR_WEAPON] 0
					setarray wpnroster[FREEZE_WEAPON] 0
					setarray wpnroster[FLAME_WEAPON] 0
					setarray wpnroster[CATERKILAR_WEAPON] 0
					
					setarray wpnrosterpwr[PISTOL_WEAPON] 0
					setarray wpnrosterpwr[SHOTGUNDOUBLE_WEAPON] 0
					setarray wpnrosterpwr[PLASMA_WEAPON] 0
					setarray wpnrosterpwr[RPG_WEAPON] 0
					setarray wpnrosterpwr[DEVISTATOR_WEAPON] 0
					setarray wpnrosterpwr[FLAME_WEAPON] 0
					break
			
				case 1
					setarray wpnroster[SHOTGUN_WEAPON] 0
					setarray wpnroster[SHOTGUNDOUBLE_WEAPON] 1
					setarray wpnroster[CHAINGUN_WEAPON] 0
					setarray wpnroster[PLASMA_WEAPON] 1
					setarray wpnroster[RPG_WEAPON] 0
					setarray wpnroster[RPGBLAST_WEAPON] 1
					setarray wpnroster[SHRINKER_WEAPON] 0
					setarray wpnroster[GROW_WEAPON] 1
					setarray wpnroster[DEVISTATOR_WEAPON] 1
					setarray wpnroster[SONICRESONATOR_WEAPON] 1
					setarray wpnroster[FREEZE_WEAPON] 1
					setarray wpnroster[FLAME_WEAPON] 0
					setarray wpnroster[CATERKILAR_WEAPON] 1
					
					setarray wpnrosterpwr[PISTOL_WEAPON] 2
					setarray wpnrosterpwr[SHOTGUNDOUBLE_WEAPON] 1
					setarray wpnrosterpwr[PLASMA_WEAPON] 0
					setarray wpnrosterpwr[RPG_WEAPON] 2
					setarray wpnrosterpwr[FLAME_WEAPON] 0
					break
					
				case 2
					setarray wpnroster[SHOTGUN_WEAPON] 1
					setarray wpnroster[SHOTGUNDOUBLE_WEAPON] 1
					setarray wpnroster[CHAINGUN_WEAPON] 1
					setarray wpnroster[PLASMA_WEAPON] 0
					setarray wpnroster[RPG_WEAPON] 0
					setarray wpnroster[RPGBLAST_WEAPON] 1
					setarray wpnroster[SHRINKER_WEAPON] 0
					setarray wpnroster[GROW_WEAPON] 0
					setarray wpnroster[DEVISTATOR_WEAPON] 1
					setarray wpnroster[SONICRESONATOR_WEAPON] 1
					setarray wpnroster[FREEZE_WEAPON] 1
					setarray wpnroster[FLAME_WEAPON] 0
					setarray wpnroster[CATERKILAR_WEAPON] 1
					
					setarray wpnrosterpwr[PISTOL_WEAPON] 1
					setarray wpnrosterpwr[SHOTGUNDOUBLE_WEAPON] 1
					setarray wpnrosterpwr[PLASMA_WEAPON] 0
					setarray wpnrosterpwr[RPG_WEAPON] 2
					setarray wpnrosterpwr[FLAME_WEAPON] 0
					break
					
				case 3
					setarray wpnroster[SHOTGUN_WEAPON] 1
					setarray wpnroster[SHOTGUNDOUBLE_WEAPON] 1
					setarray wpnroster[CHAINGUN_WEAPON] 1
					setarray wpnroster[PLASMA_WEAPON] 0
					setarray wpnroster[RPG_WEAPON] 1
					setarray wpnroster[RPGBLAST_WEAPON] 0
					setarray wpnroster[SHRINKER_WEAPON] 0
					setarray wpnroster[GROW_WEAPON] 0
					setarray wpnroster[DEVISTATOR_WEAPON] 1
					setarray wpnroster[SONICRESONATOR_WEAPON] 1
					setarray wpnroster[FREEZE_WEAPON] 1
					setarray wpnroster[FLAME_WEAPON] 0
					setarray wpnroster[CATERKILAR_WEAPON] 1
					
					setarray wpnrosterpwr[PISTOL_WEAPON] 1
					setarray wpnrosterpwr[SHOTGUNDOUBLE_WEAPON] 1
					setarray wpnrosterpwr[PLASMA_WEAPON] 0
					setarray wpnrosterpwr[RPG_WEAPON] 0
					setarray wpnrosterpwr[FLAME_WEAPON] 0
					break
					
				case 4
					setarray wpnroster[SHOTGUN_WEAPON] 1
					setarray wpnroster[SHOTGUNDOUBLE_WEAPON] 1
					setarray wpnroster[CHAINGUN_WEAPON] 1
					setarray wpnroster[PLASMA_WEAPON] 0
					setarray wpnroster[RPG_WEAPON] 1
					setarray wpnroster[RPGBLAST_WEAPON] 0
					setarray wpnroster[SHRINKER_WEAPON] 0
					setarray wpnroster[GROW_WEAPON] 0
					setarray wpnroster[DEVISTATOR_WEAPON] 1
					setarray wpnroster[SONICRESONATOR_WEAPON] 0
					setarray wpnroster[FREEZE_WEAPON] 1
					setarray wpnroster[FLAME_WEAPON] 1
					setarray wpnroster[CATERKILAR_WEAPON] 0
					
					setarray wpnrosterpwr[PISTOL_WEAPON] 1
					setarray wpnrosterpwr[SHOTGUNDOUBLE_WEAPON] 1
					setarray wpnrosterpwr[PLASMA_WEAPON] 1
					setarray wpnrosterpwr[RPG_WEAPON] 0
					setarray wpnrosterpwr[FLAME_WEAPON] 1
					break
			endswitch
		
			setp[].weaponswitch 1
		
			ifg p_invul 1
			{
				setp[].palette 12
				sub p_invul 1
				
				set atemp RUNNINGSPEED
				div atemp 5
				set atemp2 RUNNINGSPEED
				sub atemp2 atemp
				setp[].runspeed atemp2
			}
			else ife p_invul 1
			{
				ifinwater
					setp[].palette 1
				else
					setp[].palette 0
				
				palfrom 10 63 63 63
					
				set p_invul 0
				setp[].sound_pitch 0
				
				stopallsounds
				
				set fadeMusicTime 120
				ifn curr_music -1
					state FadeInMusic
				
				//setmusicvolume 20
				
				setp[].runspeed RUNNINGSPEED
			}
		
			//ife LEVEL 0
			//{
			
				ife tutorialWeapon 1
				{
					set tutorialTime TUTORIALTIME
					set tutorialType 0
					set tutorialWeapon 2
					savegamevar tutorialWeapon
				}
				
				ife userdef.on_mobile 0
				ifn player[].last_used_weapon -1
				ife tutorialLastWeap 0
				{
					set tutorialTime TUTORIALTIME
					set tutorialType 9
					set tutorialLastWeap 1
					savegamevar tutorialLastWeap
				}
				
				ifg player[].actors_killed 0
				ife tutorialAltFire 0
				{
					set tutorialTime TUTORIALTIME
					set tutorialType 2
					set tutorialAltFire 1
					savegamevar tutorialAltFire
				}
			//}
			
			ifg player[].steroids_amount 0
			ife tutorialSteroids 0
			{
				set tutorialTime TUTORIALTIME
				set tutorialType 7
				set tutorialSteroids 1
				savegamevar tutorialSteroids
			}
			
			ife tutorialUseItem 1
			{
				set tutorialTime TUTORIALTIME
				set tutorialType 3
				set tutorialUseItem 2
				savegamevar tutorialUseItem
			}
			
			ife tutorialChangeItem 1
			{
				set tutorialTime TUTORIALTIME
				set tutorialType 1
				set tutorialChangeItem 2
				savegamevar tutorialChangeItem
			}
			
			ife tutorialMF 1
			{
				set tutorialTime TUTORIALTIME
				set tutorialType 6
				set tutorialMF 2
				savegamevar tutorialMF
			}
			
			ife tutorialAltWeap 0
			{
				ife gotweapons[SHOTGUN_WEAPON] 1
				ife gotweapons[SHOTGUNDOUBLE_WEAPON] 1
					set tutorialAltWeap 1
					
				ife gotweapons[CHAINGUN_WEAPON] 1
				ife gotweapons[PLASMA_WEAPON] 1
					set tutorialAltWeap 1
					
				ife gotweapons[RPG_WEAPON] 1
				ife gotweapons[RPGBLAST_WEAPON] 1
					set tutorialAltWeap 1
					
				ife gotweapons[DEVISTATOR_WEAPON] 1
				ife gotweapons[SONICRESONATOR_WEAPON] 1
					set tutorialAltWeap 1
				
				ife gotweapons[FREEZE_WEAPON] 1
				ife gotweapons[FLAME_WEAPON] 1
					set tutorialAltWeap 1
					
				ife player[].gotweapon SHRINKER_WEAPON 1
					set tutorialAltWeap 1
			}
			else ife tutorialAltWeap 1
			{
				set tutorialTime TUTORIALTIME
				set tutorialType 5
				set tutorialAltWeap 2
				savegamevar tutorialAltWeap
			}
			
			ife userdef.on_mobile 0
			ife tutorialCater 0
			ife gotweapons[CATERKILAR_WEAPON] 1
			{
				set tutorialTime TUTORIALTIME
				set tutorialType 4
				set tutorialCater 1
				savegamevar tutorialCater
			}
		
			ifg tutorialTime 0
			{
				ifl tutorialType 199
				{
					add tutorialType 200
					set tutorialTime TUTORIALTIME
					set tutorialShade 30
					set tutorialTrans 41
					
					switch tutorialType
						case 200
							getgamefuncbind RQUOTE 11
							qputs RQUOTE2 PRESS %s %s
							qsprintf 199 RQUOTE2 RQUOTE tutorialType
							break
							
						case 201
							ife userdef.on_mobile 0
							{
								getgamefuncbind RQUOTE 30
								getgamefuncbind RQUOTE3 31
								qputs RQUOTE2 USE %s or %s %s
								qsprintf 199 RQUOTE2 RQUOTE3 RQUOTE tutorialType
							}
							else
								qputs 199 USE      TO CHANGE AND USE YOUR INVENTORY ITEMS
							break
						
						case 202
							ife userdef.on_mobile 0
							{
								getgamefuncbind RQUOTE 5
								qputs RQUOTE2 %s %s
								qsprintf 199 RQUOTE2 RQUOTE tutorialType
							}
							else
							{
								qputs RQUOTE2 USE      %s
								qsprintf 199 RQUOTE2 tutorialType
							}
							
							break	

						case 203
							getgamefuncbind RQUOTE 29
							qputs RQUOTE2 %s %s
							qsprintf 199 RQUOTE2 RQUOTE tutorialType
							break
							
						case 204
							getgamefuncbind RQUOTE 12
							qputs RQUOTE2 %s %s
							qsprintf 199 RQUOTE2 RQUOTE tutorialType
							break
							
						case 205
							ife userdef.on_mobile 0
							{
								getgamefuncbind RQUOTE 60
								qputs RQUOTE2 %s %s
								qsprintf 199 RQUOTE2 RQUOTE tutorialType
							}
							else
							{
								qputs RQUOTE2 USE      %s
								qsprintf 199 RQUOTE2 tutorialType
							}
							break
							
						case 206
							getgamefuncbind RQUOTE 49
							qputs RQUOTE2 %s %s
							qsprintf 199 RQUOTE2 RQUOTE tutorialType
							break
							
						case 209
							getgamefuncbind RQUOTE 57
							qputs RQUOTE2 %s %s
							qsprintf 199 RQUOTE2 RQUOTE tutorialType
							break
							
						default
							qstrcpy 199 tutorialType
							break
							
					endswitch
				}
			
				ifge tutorialTime 150
					sub tutorialShade 1
				
				ife tutorialTime 170
					sub tutorialTrans 32
					
				ife tutorialTime 160
					sub tutorialTrans 1
					
				ifle tutorialTime 30
					add tutorialShade 1
					
				ife tutorialTime 20
					add tutorialTrans 1
					
				ife tutorialTime 10
					add tutorialTrans 32
				
				sub tutorialTime 1
			}
			else
			{
				ife userdef.on_mobile 0
				ife tutorialLastWeap 1
				ife tutorialWeapon 0
					set tutorialWeapon 1
					
				ife tutorialSteroids 1
				ife tutorialChangeItem 0
					set tutorialChangeItem 1
					
				ife userdef.on_mobile 0
				ife tutorialChangeItem 2
				ife tutorialUseItem 0
					set tutorialUseItem 1
					
				ife userdef.on_mobile 0
				ife tutorialAltFire 1
				ife tutorialMF 0
					set tutorialMF 1
			}
		
			ife player[].curr_weapon CHAINGUN_WEAPON
			ife 1 player[].bsubweapon CHAINGUN_WEAPON
			{
				ife player[].kickback_pic WEAPON3_FIREDELAY
				ife alt_start 2
				{
					espawn SHOTGUNSHELL
					espawn SHOTGUNSHELL
					espawn SHOTGUNSHELL
					espawn SHOTGUNSHELL
				}
			}
		
			ife userdef.weaponshake 1
			{
				ife player[].curr_weapon SHRINKER_WEAPON
				{
					set horizfire 4
					set horizcnt 2
					
					set angfire 4
					set angcnt 1
				}
				else ife player[].curr_weapon GROW_WEAPON
				{
					set horizfire 4
					set horizcnt 3
					
					set angfire 4
					set angcnt 2
				}
			
				ifg player[].kickback_pic 1
				{
					switch player[].curr_weapon
						case PISTOL_WEAPON
						case SHOTGUN_WEAPON
						case RPG_WEAPON
						case SHRINKER_WEAPON
						case GROW_WEAPON
						case DEVISTATOR_WEAPON
						case FREEZE_WEAPON
						
							ife player[].curr_weapon PISTOL_WEAPON
								set atemp WEAPON1_FIREDELAY
							else ife player[].curr_weapon SHOTGUN_WEAPON
								set atemp WEAPON2_FIREDELAY
							else ife player[].curr_weapon RPG_WEAPON
								set atemp WEAPON4_FIREDELAY
							else ife player[].curr_weapon SHRINKER_WEAPON
								set atemp WEAPON6_FIREDELAY
							else ife player[].curr_weapon GROW_WEAPON
								set atemp WEAPON11_FIREDELAY
							else ife player[].curr_weapon DEVISTATOR_WEAPON
								set atemp WEAPON7_FIREDELAY
						
							ife player[].kickback_pic atemp
							{
								set horizseek horizfire
									
								set angseek angfire
								displayrandvar angdir 1
								
								ife player[].curr_weapon SHOTGUN_WEAPON
								ife 1 player[].bsubweapon SHOTGUN_WEAPON
									set horizcur 0
							}
							
							break
					endswitch
				}
			
				ifg horizseek 0
				{
					ifl horizcur horizseek
					{
						set horiztmp horizfire
						div horiztmp 2
						
						ifl horizcur horiztmp
						{
							getp[].horiz horiztmp
							add horiztmp horizcnt
							setp[].horiz horiztmp
						}
						else
						{
							getp[].horiz horiztmp
							sub horiztmp horizcnt
							setp[].horiz horiztmp
						}
						
						add horizcur 1
					}
					else
					{
						set horizcur 0
						set horizseek 0
					}
				}
				
				ifg angseek 0
				{
					ifl angcur angseek
					{
						set angtmp angfire
						div angtmp 2
						
						ifl angcur angtmp
						{
							getp[].ang angtmp
							
							ife angdir 0
								add angtmp angcnt
							else
								sub angtmp angcnt
								
							setp[].ang angtmp
						}
						else
						{
							getp[].ang angtmp
							
							ife angdir 0
								sub angtmp angcnt
							else
								add angtmp angcnt
								
							setp[].ang angtmp
						}
						
						add angcur 1
					}
					else
					{
						set angcur 0
						set angseek 0
					}
				}
			}
		
		/*
			ifn catergot 0
			{
				ifg catergot 7
				ifle catergot  10
					set catergot 7
					
				ifg catergot 10
				ifle catergot  12
					set catergot 13
					
				ife caterhit 0
				{
					ifn player[].kickback_pic 0
						setp[].kickback_pic catergot
						
					set catergot 0
				}
				else ife player[].kickback_pic 0
				{
					setp[].kickback_pic catergot
					set catergot 0
				}
			}
			*/
			ifn caterhit 0
				sub caterhit 1
			/*
			ife userdef.player_skill 6
			{
				setu[].auto_run 0
			
				ifand player[].aim_mode 1
					set medieval_pause 1
				else
					set medieval_pause 0
					
				ife medieval_pause 1
					setu[].pause_on 1
				else
					setu[].pause_on 0
			}
		*/
			ife in_space 1
			{
				set atemp GRAVITATIONALCONSTANT
				mul atemp 13
				div atemp 10
				
				iffloordistl 3
					nullop
				else ifn player[].poszv 0
				ife player[].jetpack_on 0
				{
					getp[].poszv atemp2
					sub atemp2 atemp
					setp[].poszv atemp2
				}
			}
		
			ifg a_plasmaeffect 0
			{	
				ife a_plasmaeffect 72
				{
					set a_plasmaeffect 0
					setp[].runspeed RUNNINGSPEED
				}
				else
				{
					set atemp a_plasmaeffect
					mod atemp 12
					
					ife atemp 0
					{
						palfrom 56 24 0 48
						
						ifrnd 64
							sound DUKE_LONGTERM_PAIN5
						  else ifrnd 64
							sound DUKE_LONGTERM_PAIN6
						  else ifrnd 64
							sound DUKE_LONGTERM_PAIN7
						  else
							sound DUKE_LONGTERM_PAIN8
						
						sound PLASMA_EFFECT
						state random_wall_jibs
						guts JIBS6 1
						wackplayer
						wackplayer
						setp[].runspeed 35000
					}
					
					add a_plasmaeffect 1
				}	
			}
		
			ifg a_flaming 0
			{	
				ifl sprite[].extra 5
					set a_flaming 0
			
				getp[].extra_extra8 atemp
				add atemp 16
				setp[].extra_extra8  atemp
				
				ife a_flaming 240
					set a_flaming 0
				else
				{
					set atemp a_flaming
					mod atemp 16
					
					ife atemp 0
					{
						state random_wall_jibs
						guts JIBS6 1
						palfrom 24 32
						sound DUKE_LONGTERM_PAIN
					}
					
					add a_flaming 1
				}
				
				ifonwater
					set a_flaming 0
					
				ifinwater
					set a_flaming 0
					
				ife in_space 1
					set a_flaming 0
					
			}
			break
		
		case DRONE
		case SNAKEHEAD
		case ROBOTTROOPER
		case LIZTROOP
		case LIZMAN
		case FLAMEENFORCER
		case ELITEENFORCER
		case DPIGCOP
		case PIGCOP
		case ELITEPIGCOP
		case OCTABRAIN
		case EGG
		case COMMANDER
		case SNAKEDRONE
		case BOSS1
		case BOSS3
		case FIREFLY
		case JELLYPROTECTOR
		case NEWBEAST
		case SARGE
			
			ifdead
				nullop
			else ifactor NEWBEAST
				nullop
			else
			{
				findnearactor FIRE 768 atemp
				
				ifn atemp -1
				ifrnd 64
				{
					ife sprite[atemp].yvel 1
					{
						set a_flaming 1
						
						state random_wall_jibs
						geta[].htextra atemp2
						add atemp2 3
						seta[].htextra atemp2
							
						ifle sprite[].extra 3
							seta[].htpicnum FLAMEPROJ
						else
							seta[].htpicnum SHOTSPARK1
							
						set a_burneffect 1
							
						ife userdef.player_skill 6
						ifrnd 72
						{
							espawn DROPPER
							seta[RETURN].pal 3
						}
					}	
				}
			}
		
			ifaction 0 nullop
			else ife actorlife -1
				set actorlife sprite[].extra
		
			ifg a_groweffect 0
			{
				ife a_groweffect 6
				{
					set a_groweffect 0
					ife userdef.player_skill 6
						state SpawnShards2
				}
				else
				{
					ifdead nullop
					else
					{
						spawn FRAMEEFFECT1
						sizeto MIDXSTRETCH MIDYSTRETCH
					}
					
					add a_groweffect 1
				}
			}
		
			ifg a_plasmaeffect 0
			{			
				ife a_plasmaeffect 50
					set a_plasmaeffect 0
				else
				{
					set atemp a_plasmaeffect
					mod atemp 3
					ife atemp 0
					{
						state random_wall_jibs
						state random_wall_jibs
						
						geta[].shade atemp2
						add atemp2 16
						seta[].shade atemp2
						
						ifactor DRONE
							debris SCRAP1 1
						else
							guts JIBS6 1
							
						ife userdef.player_skill 6
						ifrnd 64
						{
							espawn DROPPER
							seta[RETURN].pal 21
						}
					}
					else ife atemp 2
					{
						state random_wall_jibs
						state random_wall_jibs
						
						geta[].shade atemp2
						sub atemp2 16
						seta[].shade atemp2
						
						sound PLASMA_EFFECT
					}
					
					add a_plasmaeffect 1
				}
			}
		
			ifg a_flaming 0
			{	
				ife a_flaming 1
				{
					espawn FIRE
					setactor[RETURN].xrepeat 16
					setactor[RETURN].yrepeat 16
					
					set a_child RETURN
				}
				
				geta[].z atemp
				
				setsprite a_child sprite[].x sprite[].y atemp
				
				ife a_flaming 43
				{
					set a_flaming 0
					
					//Kill the Robot Trooper
					ifactor ROBOTTROOPER
						seta[].htextra 100
				}
				else
				{
					set atemp a_flaming
					mod atemp 7
					ife atemp 0
					{
						spawn FIRE
						state random_wall_jibs
						state random_wall_jibs
						geta[].htextra atemp2
						add atemp2 5
						seta[].htextra atemp2
						
						ifle sprite[].extra 3
							seta[].htpicnum FLAMEPROJ
						else
							seta[].htpicnum SHOTSPARK1
						
						set a_burneffect 1
						
						ife userdef.player_skill 6
						ifrnd 96
						{
							espawn DROPPER
							seta[RETURN].pal 3
						}
					}
					
					ifg a_burneffect 0
					{
						ife a_burneffect 6
							set a_burneffect 0
						else
						{
							geta[].shade atemp2
							add atemp2 5
							seta[].shade atemp2
							
							add a_burneffect 1
						}
					}
					
					add a_flaming 1
				}
				
				ifonwater
					set a_flaming 0
			}
			break
	endswitch
	
endevent

appendevent EVENT_PREACTORDAMAGE

	switch sprite[THISACTOR].picnum	
		case LIZTROOP
		case LIZMAN
		case FLAMEENFORCER
		case DPIGCOP
		case PIGCOP
		case OCTABRAIN
		case COMMANDER
		case SARGE
		case NEWBEAST
			ife userdef.enable_nuke 1
			ife userdef.nuke_active 1
			ife nuke_n3 1
				nullop
			else
			ife sprite[].htpicnum SHOTSPARK1
			ifn sprite[].htextra -1
			{
				geta[].htextra atemp
				geta[].extra atemp2
				
				ifg atemp2 0
					div atemp atemp2
				
				ifactor LIZTROOP
				{
					ifg atemp2 20
						ifge atemp 2
							ifrnd 192
					{
						seta[].htpicnum RADIUSEXPLOSION
						add s_shotblowkills SCORE_SHOTBLOWKILL
						ife userdef.player_skill 6
							state SpawnShards3
					}
					else ifge atemp 4
					ifg atemp2 6
						ifrnd 220
					{
						seta[].htpicnum RADIUSEXPLOSION
						add s_shotblowkills SCORE_SHOTBLOWKILL
						
						ife userdef.player_skill 6
							state SpawnShards3
					}
				}
				else ifge atemp 3
				ifg atemp2 6
					ifrnd 220
				{
					seta[].htpicnum RADIUSEXPLOSION
					add s_shotblowkills SCORE_SHOTBLOWKILL
					
					ife userdef.player_skill 6
							state SpawnShards3
				}
			}
			break
			
		case JELLYPROTECTOR
			ifn sprite[].htextra -1
			ife sprite[sprite[].htowner].picnum BOSS2RED
				seta[].htextra -1
			break
			
		case BOSS2RED
			ifn sprite[].htextra -1
			ifn sprite[].htpicnum JELLYCONNECTOR
			ifl cycloid_under_octa 3
			{
				espawn FORCERIPPLE
				sound SOMETHINGHITFORCE
				
				geta[RETURN].z atemp6
				sub atemp6 8192
				seta[RETURN].z atemp6
				
				seta[RETURN].xrepeat 32
				seta[RETURN].yrepeat 32
				geta[sprite[].htowner].x atemp
				geta[sprite[].htowner].y atemp2
				sub atemp sprite[].x
				sub atemp2 sprite[].y
				getangle atemp3 atemp atemp2
				
				seta[RETURN].ang atemp3
				geta[RETURN].x atemp
				geta[RETURN].y atemp2
				
				set atemp6 2048
				cos atemp4 atemp3
				mul atemp6 atemp4
				shiftr atemp6 14
				
				set atemp7 2048
				sin atemp4 atemp3
				mul atemp7 atemp4
				shiftr atemp7 14
				
				add atemp atemp6
				add atemp2 atemp7
				
				seta[RETURN].x atemp
				seta[RETURN].y atemp2
				
				seta[].htextra -1
				shoot sprite[].htpicnum
			}
			/*
			ife sprite[].htpicnum JELLYCONNECTOR
			{
				seta[].htextra -1
				seta[].htpicnum -1
				seta[].htang sprite[].ang
				seta[].htowner -1
			}
			*/
			break
		
	endswitch

endevent

appendevent EVENT_KILLIT
	//set RETURN 1
	
	switch sprite[].picnum
		case EGG
		case LIZTROOP
		case PIGCOP
		case DPIGCOP
		case ELITEPIGCOP
		case ROBOTTROOPER
		case LIZMAN
		case FLAMEENFORCER
		case ELITEENFORCER
		case OCTABRAIN
		case COMMANDER
		case BOSS1
		case BOSS3
		case SARGE
		case NEWBEAST
		case SHARK
			ife sprite[].htpicnum KNEE
			ifspritepal 1
				state SpawnShards4
				
			set RETURN 0
			
			break
			
		case MASTERSWITCH
			ife LEVEL 9
			ife VOLUME 3
			ife sprite[].lotag 6666
			{
				set boss4phase 1
				set SE120Active 1
				globalsound BOSS4_FIRSTSEE
			}
			
			break
	
	endswitch
	/*
	ifge sprite[].picnum 2390
	ifle sprite[].picnum 2418
	{
		ifspawnedby BLIMP
			nullop
		else
		{
			updatesectorz sprite[].x sprite[].y sprite[].z atemp
			
			ife atemp -1
				set RETURN 0
			else
			{
				getflorzofslope atemp sprite[].x sprite[].y atemp2
				seta[].z atemp2
				
				ife a_scraptime 0
					iffloordistl 2
						ifrnd 128
							set a_scraptime 1
					else
						set RETURN 0
				
				ifl a_scraptime 1024
				ifg a_scraptime 0
				{
					set RETURN 1
					add a_scraptime 1
				}
				else ife a_scraptime 1024
					set RETURN 0
			}
		}
	}
	*/
	ifge sprite[].picnum 1031
	ifle sprite[].picnum 1033
	{
		updatesectorz sprite[].x sprite[].y sprite[].z atemp
		
		ife atemp -1
			set RETURN 0
		else
		{
			getflorzofslope atemp sprite[].x sprite[].y atemp2
			seta[].z atemp2
			
			sizeat 16 16
			
			ife a_scraptime 0
				iffloordistl 2
					ifrnd 128
						set a_scraptime 1
				else
					set RETURN 0
			
			ifl a_scraptime 1024
			ifg a_scraptime 0
			{
				set RETURN 1
				add a_scraptime 1
			}
			else ife a_scraptime 1024
				set RETURN 0
		}
	}
	
endevent

var hurtself 0 1

onevent EVENT_INCURDAMAGE
			
			ifg p_invul 0
			{
				setp[].last_extra 100
				seta[].extra 100
				seta[].htpicnum -1
				seta[].htextra -1
				set RETURN -1
				break
			}
			
			ife sprite[].htpicnum SONICPROJ
			{
				set atemp RETURN
				espawn PUSHERPLAYER
				seta[RETURN].ang sprite[].htang
				setactorvar[RETURN].pushervel 5000
				seta[RETURN].yvel 1
				set RETURN atemp
			}
			
			ifp pshrunk
				nullop
			else
			ifn sprite[].extra player[].last_extra
			ife p_invul 0
			ife usedmedkit 0
			ifg player[].steroids_amount 0
			{
				getp[].last_extra atemp
				sub atemp sprite[].extra
				ifg atemp 0
				{
					mul atemp 650
					divru atemp 1000
					
					getp[].last_extra atemp2
					sub atemp2 atemp
					seta[].extra atemp2
				}
			}
			
			ifge userdef.player_skill 4
			ife p_invul 0
			ife userdef.god 0
			ife usedmedkit 0
			{
				ifn sprite[].extra player[].last_extra
				ife player[].falling_counter 0
				{
					geta[].extra atmp
					getp[].last_extra atmp2
					
					sub atmp2 atmp
					
					switch userdef.player_skill
							
						case 4
							mul atmp2 210
							break
							
						case 5
							mul atmp2 300
							break
							
						case 6
							mul atmp2 400
							break
					
					endswitch
					
					div atmp2 100
					
					ife userdef.enable_nuke 1
					ife userdef.nuke_active 1
					{
						mul atmp2 userdef.nuke_dmg
						div atmp2 100
					}
					
					getp[].last_extra atmp
					sub atmp atmp2
					seta[].extra atmp
				}
			}
			
			ife userdef.player_skill 1
			ife p_invul 0
			ife userdef.god 0
			ife usedmedkit 0
			{
				ifn sprite[].extra player[].last_extra
				ife player[].falling_counter 0
				{
					geta[].extra atmp
					getp[].last_extra atmp2
					
					sub atmp2 atmp
					
					mul atmp2 65
					
					div atmp2 100
					
					getp[].last_extra atmp
					sub atmp atmp2
					seta[].extra atmp
				}
			}
			
			ife sprite[].htpicnum FIRELASER
			ifn sprite[].extra player[].last_extra
			ifg player[].shield_amount FIRELASER_WEAPON_STRENGTH
			ifrnd 96
			{
				seta[].extra player[].last_extra
				getp[].shield_amount atemp
				sub atemp FIRELASER_WEAPON_STRENGTH
				setp[].shield_amount atemp
			}
			else ife sprite[].htpicnum PLASMAMICROPROJ
			ifn sprite[].extra player[].last_extra
			ifg player[].shield_amount PLASMAMICRO_DAMAGE
			ifrnd 96
			{
				seta[].extra player[].last_extra
				getp[].shield_amount atemp
				sub atemp PLASMAMICRO_DAMAGE
				setp[].shield_amount atemp
			}
			else ife sprite[].htpicnum PLASMAPROJ
			ifn sprite[].extra player[].last_extra
			ifg player[].shield_amount PLASMA_DAMAGE
			ifrnd 96
			{
				seta[].extra player[].last_extra
				getp[].shield_amount atemp
				sub atemp PLASMAMICRO_DAMAGE
				setp[].shield_amount atemp
				seta[].htpicnum FIRELASER
			}
			else ifn sprite[].extra player[].last_extra
			ife usedmedkit 0
			ife p_invul 0
			ifg player[].shield_amount 0
			{
				getp[].last_extra atemp
				sub atemp sprite[].extra
				ifg atemp 0
				{
					divru atemp 2
					getp[].last_extra atemp2
					sub atemp2 atemp
					seta[].extra atemp2
					
					getp[].shield_amount atemp2
					sub atemp2 atemp
					
					ifl atemp2 1
						set atemp2 0
						
					setp[].shield_amount atemp2
				}
			}
			
			ifn sprite[].extra player[].last_extra
			ife p_invul 0
			ife usedmedkit 0
			{
				ife player[].shield_amount 0
				{
					add s_damage SCOREN_DAMAGE
					
					ife userdef.player_skill 6
					{
						add s_damage SCOREN_DAMAGE
						add s_damage SCOREN_DAMAGE
					}
				
					switch sprite[].htpicnum
						case ROCKETPROJ
						case RPG
						case RADIUSEXPLOSION
							add s_blowdamage SCOREN_BLOWDAMAGE
							
							ife userdef.player_skill 6
							{
								add s_blowdamage SCOREN_BLOWDAMAGE
								add s_blowdamage SCOREN_BLOWDAMAGE
							}
							
							break
					
					endswitch
				}
			}
			
			ife p_invul 0
			ifl sprite[].extra 1
			ifn sprite[].pal 1 //Frozen
			ifg PlayerLives 0
			{
				seta[].extra 100
				setp[].last_extra 100
				setp[].dead_flag 0
				seta[].htextra 0
				seta[].htg_t 0 0
				seta[].htg_t 1 0
				seta[].htg_t 2 0
				seta[].htg_t 3 0
				seta[].htg_t 4 0
				seta[].htg_t 5 0
				seta[].cstat 257
				
				sub PlayerLives 1
				palfrom 64 63 63 63
				quote 135
				stopallsounds
				globalsound GETATOMICHEALTH
				setp[].extra_extra8 0
				set a_flaming 0
				set a_plasmaeffect 0
				setp[].runspeed RUNNINGSPEED
				set p_invul 150
				globalsound INVULNERABILITY
				setp[].sound_pitch -1024
				add s_killed SCOREN_KILLED
				setmusicvolume 20
				
				state SavePlayerLives
			}

endevent

//This comes before INCURDAMAGE, if the player extra is 0, INCURDAMAGE is not executed
appendevent EVENT_PROCESSINPUT

	ifg p_invul 0
	{
		setp[].last_extra 100
		seta[].extra 100
		seta[].htpicnum -1
		seta[].htextra -1
	}
	else
	{
		ifl sprite[].extra 1
		ifn sprite[].pal 1 //Frozen
		ifg PlayerLives 0
		{
			seta[].extra 100
			setp[].last_extra 100
			setp[].dead_flag 0
			seta[].htextra 0
			seta[].htg_t 0 0
			seta[].htg_t 1 0
			seta[].htg_t 2 0
			seta[].htg_t 3 0
			seta[].htg_t 4 0
			seta[].htg_t 5 0
			seta[].cstat 257
			
			sub PlayerLives 1
			palfrom 64 63 63 63
			quote 135
			stopallsounds
			globalsound GETATOMICHEALTH
			setp[].extra_extra8 0
			set a_flaming 0
			set a_plasmaeffect 0
			setp[].runspeed RUNNINGSPEED
			set p_invul 150
			globalsound INVULNERABILITY
			setp[].sound_pitch -1024
			add s_killed SCOREN_KILLED
			setmusicvolume 20
			
			state SavePlayerLives
		}
	}
	
	ife userdef.eog 1
	{
		setsector[player[].cursectnum].lotag 0
		setp[].palette 0
	}

endevent

appendevent EVENT_PREACTORDAMAGE

	switch sprite[THISACTOR].picnum
		case EGG
		case LIZTROOP
		case PIGCOP
		case DPIGCOP
		case ELITEPIGCOP
		case ROBOTTROOPER
		case LIZMAN
		case FLAMEENFORCER
		case ELITEENFORCER
		case OCTABRAIN
		case COMMANDER
		case ORGANTIC
		case ROTATEGUN
		case DRONE
		case SNAKEHEAD
		case BOSS1
		case BOSS2
		case BOSS2RED
		case BOSS3
		case BOSS4
		case SNAKEDRONE
		case JELLYPROTECTOR
		case SARGE
		case NEWBEAST
		case COMMCRAWLING
		case SARGECRAWLING
		case SHARK
		case TANK
		case SCORPIONTANK
		case RECON
		case FIREFLY
			
			ifactor BOSS1
			{
				ifg sprite[].htextra 0
				ife sprite[].htowner THISACTOR
					seta[].htextra 0
			
				ifg sprite[].htextra 0
				{
					ife num_bosspalfight 0
					{
						geta[].extra dtemp4
						add dtemp4 sprite[].htextra
						
						set dtemp2 xdim
						mul dtemp2 2500
						div dtemp2 10000
						
						set dtemp3 xdim
						sub dtemp3 dtemp2
						sub dtemp3 dtemp2
						
						mul dtemp4 100
						
						set dtemp5 BOSS1STRENGTH
						ife userdef.enable_nuke 1
							ife userdef.nuke_active 1
							{
								mul dtemp5 userdef.nuke_enemyhealth
								div dtemp5 100
							}
						
						div dtemp4 dtemp5
						
						mul dtemp4 dtemp3
						div dtemp4 100
						add dtemp4 dtemp2
						
						ifg dtemp4 bossmeterfilled
							set bossmeterfilled dtemp4
					}
					else
					{
						set dtemp4 0
						set dtemp2 0
						set dtemp5 -1
						whilel dtemp2 num_bosspalfight
						{
							ife THISACTOR bosspal[dtemp2]
							{
								set dtemp5 bosspal[dtemp2]
								set dtemp2 num_bosspalfight
							}
								
							add dtemp2 1
						}
						
						ife dtemp5 -1
						ife bossfighton THISACTOR
							set dtemp5 THISACTOR
						
						ifn dtemp5 -1
						{
							add dtemp4 sprite[].extra
							add dtemp4 sprite[].htextra
							
							set dtemp2 xdim
							mul dtemp2 2500
							div dtemp2 10000
							
							set dtemp3 xdim
							sub dtemp3 dtemp2
							sub dtemp3 dtemp2
							
							mul dtemp4 100
							
							set dtemp5 0
							set dtemp 0
							for dtemp range num_bosspalfight
							{
								ifl bosspal[dtemp] 0
								{
									set dtemp6 bosspal[dtemp]
									mul dtemp6 -1
								}
								else
									geta[bosspal[dtemp]].picnum dtemp6
							
								switch dtemp6
									case BOSS1
										add dtemp5 BOSS1PALSTRENGTH
										break
										
									case BOSS3
										add dtemp5 BOSS3PALSTRENGTH
										break
										
									case FIREFLY
										add dtemp5 1000
										break
								endswitch
							}
							
							ifn bossfighton -1
							{
								switch sprite[bossfighton].picnum
									case BOSS1
										add dtemp5 BOSS1STRENGTH
										break
										
									case BOSS3
										add dtemp5 BOSS3STRENGTH
										break
										
									case BOSS2
										add dtemp5 BOSS2STRENGTH
										break
										
									case BOSS2RED
										add dtemp5 BOSS2STRENGTH
										break
										
									case BOSS4
										add dtemp5 BOSS4STRENGTH
										break
										
									case FIREFLY
										add dtemp5 3500
										break
								endswitch
							}
							
							ife userdef.enable_nuke 1
							ife userdef.nuke_active 1
							{
								mul dtemp5 userdef.nuke_enemyhealth
								div dtemp5 100
							}
							
							div dtemp4 dtemp5
							
							mul dtemp4 dtemp3
							div dtemp4 100
							add dtemp4 dtemp2
							
							ifg dtemp4 bossmeterfilled
								set bossmeterfilled dtemp4
						}
					}
				}
			}
			else ifactor BOSS2
			{
				ifg sprite[].htextra 0
				{
					ife num_bosspalfight 0
					{
						geta[].extra dtemp4
						add dtemp4 sprite[].htextra
						
						set dtemp2 xdim
						mul dtemp2 2500
						div dtemp2 10000
						
						set dtemp3 xdim
						sub dtemp3 dtemp2
						sub dtemp3 dtemp2
						
						mul dtemp4 100
						
						set dtemp5 BOSS2STRENGTH
						ife userdef.enable_nuke 1
						ife userdef.nuke_active 1
						{
							mul dtemp5 userdef.nuke_enemyhealth
							div dtemp5 100
						}
						
						div dtemp4 dtemp5
						
						mul dtemp4 dtemp3
						div dtemp4 100
						add dtemp4 dtemp2
						
						ifg dtemp4 bossmeterfilled
							set bossmeterfilled dtemp4
					}
					else
					{
						set dtemp4 0
						set dtemp2 0
						set dtemp5 -1
						whilel dtemp2 num_bosspalfight
						{
							ife THISACTOR bosspal[dtemp2]
							{
								set dtemp5 bosspal[dtemp2]
								set dtemp2 num_bosspalfight
							}
								
							add dtemp2 1
						}
						
						ife dtemp5 -1
						ife bossfighton THISACTOR
							set dtemp5 THISACTOR
						
						ifn dtemp5 -1
						{
							add dtemp4 sprite[].extra
							add dtemp4 sprite[].htextra
							
							set dtemp2 xdim
							mul dtemp2 2500
							div dtemp2 10000
							
							set dtemp3 xdim
							sub dtemp3 dtemp2
							sub dtemp3 dtemp2
							
							mul dtemp4 100
							
							set dtemp5 0
							set dtemp 0
							for dtemp range num_bosspalfight
							{
								ifl bosspal[dtemp] 0
								{
									set dtemp6 bosspal[dtemp]
									mul dtemp6 -1
								}
								else
									geta[bosspal[dtemp]].picnum dtemp6
							
								switch dtemp6
									case BOSS1
										add dtemp5 BOSS1PALSTRENGTH
										break
										
									case BOSS3
										add dtemp5 BOSS3PALSTRENGTH
										break
										
									case FIREFLY
										add dtemp5 1000
										break
								endswitch
							}
							
							ifn bossfighton -1
							{
								switch sprite[bossfighton].picnum
									case BOSS1
										add dtemp5 BOSS1STRENGTH
										break
										
									case BOSS3
										add dtemp5 BOSS3STRENGTH
										break
										
									case BOSS2
										add dtemp5 BOSS2STRENGTH
										break
										
									case BOSS2RED
										add dtemp5 BOSS2STRENGTH
										break
										
									case BOSS4
										add dtemp5 BOSS4STRENGTH
										break
										
									case FIREFLY
										add dtemp5 3500
										break
								endswitch
							}
							
							ife userdef.enable_nuke 1
							ife userdef.nuke_active 1
							{
								mul dtemp5 userdef.nuke_enemyhealth
								div dtemp5 100
							}
							
							div dtemp4 dtemp5
							
							mul dtemp4 dtemp3
							div dtemp4 100
							add dtemp4 dtemp2
							
							ifg dtemp4 bossmeterfilled
								set bossmeterfilled dtemp4
						}
					}
				}
			}
			else ifactor BOSS2RED
			{
				ifspritepal 0
				ifg sprite[].htextra 0
				{
					ife num_bosspalfight 0
					{
						geta[].extra dtemp4
						add dtemp4 sprite[].htextra
						
						set dtemp2 xdim
						mul dtemp2 2500
						div dtemp2 10000
						
						set dtemp3 xdim
						sub dtemp3 dtemp2
						sub dtemp3 dtemp2
						
						mul dtemp4 100
						
						set dtemp5 BOSS2STRENGTH
						ife userdef.enable_nuke 1
							ife userdef.nuke_active 1
							{
								mul dtemp5 userdef.nuke_enemyhealth
								div dtemp5 100
							}
						
						div dtemp4 dtemp5
						
						mul dtemp4 dtemp3
						div dtemp4 100
						add dtemp4 dtemp2
						
						ifg dtemp4 bossmeterfilled
							set bossmeterfilled dtemp4
					}
					else
					{
						set dtemp4 0
						set dtemp2 0
						set dtemp5 -1
						whilel dtemp2 num_bosspalfight
						{
							ife THISACTOR bosspal[dtemp2]
							{
								set dtemp5 bosspal[dtemp2]
								set dtemp2 num_bosspalfight
							}
								
							add dtemp2 1
						}
						
						ife dtemp5 -1
						ife bossfighton THISACTOR
							set dtemp5 THISACTOR
						
						ifn dtemp5 -1
						{
							add dtemp4 sprite[].extra
							add dtemp4 sprite[].htextra
							
							set dtemp2 xdim
							mul dtemp2 2500
							div dtemp2 10000
							
							set dtemp3 xdim
							sub dtemp3 dtemp2
							sub dtemp3 dtemp2
							
							mul dtemp4 100
							
							set dtemp5 0
							set dtemp 0
							for dtemp range num_bosspalfight
							{
								ifl bosspal[dtemp] 0
								{
									set dtemp6 bosspal[dtemp]
									mul dtemp6 -1
								}
								else
									geta[bosspal[dtemp]].picnum dtemp6
							
								switch dtemp6
									case BOSS1
										add dtemp5 BOSS1PALSTRENGTH
										break
										
									case BOSS3
										add dtemp5 BOSS3PALSTRENGTH
										break
										
									case FIREFLY
										add dtemp5 1000
										break
								endswitch
							}
							
							ifn bossfighton -1
							{
								switch sprite[bossfighton].picnum
									case BOSS1
										add dtemp5 BOSS1STRENGTH
										break
										
									case BOSS3
										add dtemp5 BOSS3STRENGTH
										break
										
									case BOSS2
										add dtemp5 BOSS2STRENGTH
										break
										
									case BOSS2RED
										add dtemp5 BOSS2STRENGTH
										break
										
									case BOSS4
										add dtemp5 BOSS4STRENGTH
										break
										
									case FIREFLY
										add dtemp5 3500
										break
								endswitch
							}
							
							ife userdef.enable_nuke 1
							ife userdef.nuke_active 1
							{
								mul dtemp5 userdef.nuke_enemyhealth
								div dtemp5 100
							}
							
							div dtemp4 dtemp5
							
							mul dtemp4 dtemp3
							div dtemp4 100
							add dtemp4 dtemp2
							
							ifg dtemp4 bossmeterfilled
								set bossmeterfilled dtemp4
						}
					}
				}
			}
			else ifactor BOSS3
			{
				ifg sprite[].htextra 0
				{
					ife num_bosspalfight 0
					{
						geta[].extra dtemp4
						add dtemp4 sprite[].htextra
						
						set dtemp2 xdim
						mul dtemp2 2500
						div dtemp2 10000
						
						set dtemp3 xdim
						sub dtemp3 dtemp2
						sub dtemp3 dtemp2
						
						mul dtemp4 100
						
						set dtemp5 BOSS3STRENGTH
						ife userdef.enable_nuke 1
							ife userdef.nuke_active 1
							{
								mul dtemp5 userdef.nuke_enemyhealth
								div dtemp5 100
							}
						
						div dtemp4 dtemp5
						
						mul dtemp4 dtemp3
						div dtemp4 100
						add dtemp4 dtemp2
						
						ifg dtemp4 bossmeterfilled
							set bossmeterfilled dtemp4
					}
					else
					{
						set dtemp4 0
						set dtemp2 0
						set dtemp5 -1
						whilel dtemp2 num_bosspalfight
						{
							ife THISACTOR bosspal[dtemp2]
							{
								set dtemp5 bosspal[dtemp2]
								set dtemp2 num_bosspalfight
							}
								
							add dtemp2 1
						}
						
						ife dtemp5 -1
						ife bossfighton THISACTOR
							set dtemp5 THISACTOR
						
						ifn dtemp5 -1
						{
							add dtemp4 sprite[].extra
							add dtemp4 sprite[].htextra
							
							set dtemp2 xdim
							mul dtemp2 2500
							div dtemp2 10000
							
							set dtemp3 xdim
							sub dtemp3 dtemp2
							sub dtemp3 dtemp2
							
							mul dtemp4 100
							
							set dtemp5 0
							set dtemp 0
							for dtemp range num_bosspalfight
							{
								ifl bosspal[dtemp] 0
								{
									set dtemp6 bosspal[dtemp]
									mul dtemp6 -1
								}
								else
									geta[bosspal[dtemp]].picnum dtemp6
							
								switch dtemp6
									case BOSS1
										add dtemp5 BOSS1PALSTRENGTH
										break
										
									case BOSS3
										add dtemp5 BOSS3PALSTRENGTH
										break
										
									case FIREFLY
										add dtemp5 1000
										break
								endswitch
							}
							
							ifn bossfighton -1
							{
								switch sprite[bossfighton].picnum
									case BOSS1
										add dtemp5 BOSS1STRENGTH
										break
										
									case BOSS3
										add dtemp5 BOSS3STRENGTH
										break
										
									case BOSS2
										add dtemp5 BOSS2STRENGTH
										break
										
									case BOSS2RED
										add dtemp5 BOSS2STRENGTH
										break
										
									case BOSS4
										add dtemp5 BOSS4STRENGTH
										break
										
									case FIREFLY
										add dtemp5 3500
										break
								endswitch
							}
							
							ife userdef.enable_nuke 1
							ife userdef.nuke_active 1
							{
								mul dtemp5 userdef.nuke_enemyhealth
								div dtemp5 100
							}
							
							div dtemp4 dtemp5
							
							mul dtemp4 dtemp3
							div dtemp4 100
							add dtemp4 dtemp2
							
							ifg dtemp4 bossmeterfilled
								set bossmeterfilled dtemp4
						}
					}
				}
			}
			else ifactor BOSS4
			{
				ifg sprite[].htextra 0
				{
					ife num_bosspalfight 0
					{
						geta[].extra dtemp4
						add dtemp4 sprite[].htextra
						
						set dtemp2 xdim
						mul dtemp2 2500
						div dtemp2 10000
						
						set dtemp3 xdim
						sub dtemp3 dtemp2
						sub dtemp3 dtemp2
						
						mul dtemp4 100
						
						set dtemp5 BOSS4STRENGTH
						ife userdef.enable_nuke 1
							ife userdef.nuke_active 1
							{
								mul dtemp5 userdef.nuke_enemyhealth
								div dtemp5 100
							}
						
						div dtemp4 dtemp5
						
						mul dtemp4 dtemp3
						div dtemp4 100
						add dtemp4 dtemp2
						
						ifg dtemp4 bossmeterfilled
							set bossmeterfilled dtemp4
					}
					else
					{
						set dtemp4 0
						set dtemp2 0
						set dtemp5 -1
						whilel dtemp2 num_bosspalfight
						{
							ife THISACTOR bosspal[dtemp2]
							{
								set dtemp5 bosspal[dtemp2]
								set dtemp2 num_bosspalfight
							}
								
							add dtemp2 1
						}
						
						ife dtemp5 -1
						ife bossfighton THISACTOR
							set dtemp5 THISACTOR
						
						ifn dtemp5 -1
						{
							add dtemp4 sprite[].extra
							add dtemp4 sprite[].htextra
							
							set dtemp2 xdim
							mul dtemp2 2500
							div dtemp2 10000
							
							set dtemp3 xdim
							sub dtemp3 dtemp2
							sub dtemp3 dtemp2
							
							mul dtemp4 100
							
							set dtemp5 0
							set dtemp 0
							for dtemp range num_bosspalfight
							{
								ifl bosspal[dtemp] 0
								{
									set dtemp6 bosspal[dtemp]
									mul dtemp6 -1
								}
								else
									geta[bosspal[dtemp]].picnum dtemp6
							
								switch dtemp6
									case BOSS1
										add dtemp5 BOSS1PALSTRENGTH
										break
										
									case BOSS3
										add dtemp5 BOSS3PALSTRENGTH
										break
										
									case FIREFLY
										add dtemp5 1000
										break
								endswitch
							}
							
							ifn bossfighton -1
							{
								switch sprite[bossfighton].picnum
									case BOSS1
										add dtemp5 BOSS1STRENGTH
										break
										
									case BOSS3
										add dtemp5 BOSS3STRENGTH
										break
										
									case BOSS2
										add dtemp5 BOSS2STRENGTH
										break
										
									case BOSS2RED
										add dtemp5 BOSS2STRENGTH
										break
										
									case BOSS4
										add dtemp5 BOSS4STRENGTH
										break
										
									case FIREFLY
										add dtemp5 3500
										break
								endswitch
							}
							
							ife userdef.enable_nuke 1
							ife userdef.nuke_active 1
							{
								mul dtemp5 userdef.nuke_enemyhealth
								div dtemp5 100
							}
							
							div dtemp4 dtemp5
							
							mul dtemp4 dtemp3
							div dtemp4 100
							add dtemp4 dtemp2
							
							ifg dtemp4 bossmeterfilled
								set bossmeterfilled dtemp4
						}
					}
				}
			}
			else ifactor FIREFLY
			{
				ifg sprite[].htextra 0
				{
					ife num_bosspalfight 0
					{
						geta[].extra dtemp4
						add dtemp4 sprite[].htextra
						
						set dtemp2 xdim
						mul dtemp2 2500
						div dtemp2 10000
						
						set dtemp3 xdim
						sub dtemp3 dtemp2
						sub dtemp3 dtemp2
						
						mul dtemp4 100
						
						set dtemp5 3500
						ife userdef.enable_nuke 1
							ife userdef.nuke_active 1
							{
								mul dtemp5 userdef.nuke_enemyhealth
								div dtemp5 100
							}
						
						div dtemp4 dtemp5
						
						mul dtemp4 dtemp3
						div dtemp4 100
						add dtemp4 dtemp2
						
						ifg dtemp4 bossmeterfilled
							set bossmeterfilled dtemp4
					}
					else
					{
						set dtemp4 0
						set dtemp2 0
						set dtemp5 -1
						whilel dtemp2 num_bosspalfight
						{
							ife THISACTOR bosspal[dtemp2]
							{
								set dtemp5 bosspal[dtemp2]
								set dtemp2 num_bosspalfight
							}
								
							add dtemp2 1
						}
						
						ife dtemp5 -1
						ife bossfighton THISACTOR
							set dtemp5 THISACTOR
						
						ifn dtemp5 -1
						{
							add dtemp4 sprite[].extra
							add dtemp4 sprite[].htextra
							
							set dtemp2 xdim
							mul dtemp2 2500
							div dtemp2 10000
							
							set dtemp3 xdim
							sub dtemp3 dtemp2
							sub dtemp3 dtemp2
							
							mul dtemp4 100
							
							set dtemp5 0
							set dtemp 0
							for dtemp range num_bosspalfight
							{
								ifl bosspal[dtemp] 0
								{
									set dtemp6 bosspal[dtemp]
									mul dtemp6 -1
								}
								else
									geta[bosspal[dtemp]].picnum dtemp6
							
								switch dtemp6
									case BOSS1
										add dtemp5 BOSS1PALSTRENGTH
										break
										
									case BOSS3
										add dtemp5 BOSS3PALSTRENGTH
										break
										
									case FIREFLY
										add dtemp5 1000
										break
								endswitch
							}
							
							ifn bossfighton -1
							{
								switch sprite[bossfighton].picnum
									case BOSS1
										add dtemp5 BOSS1STRENGTH
										break
										
									case BOSS3
										add dtemp5 BOSS3STRENGTH
										break
										
									case BOSS2
										add dtemp5 BOSS2STRENGTH
										break
										
									case BOSS2RED
										add dtemp5 BOSS2STRENGTH
										break
										
									case BOSS4
										add dtemp5 BOSS4STRENGTH
										break
										
									case FIREFLY
										add dtemp5 3500
										break
								endswitch
							}
							
							ife userdef.enable_nuke 1
							ife userdef.nuke_active 1
							{
								mul dtemp5 userdef.nuke_enemyhealth
								div dtemp5 100
							}
							
							div dtemp4 dtemp5
							
							mul dtemp4 dtemp3
							div dtemp4 100
							add dtemp4 dtemp2
							
							ifg dtemp4 bossmeterfilled
								set bossmeterfilled dtemp4
						}
					}
				}
			}
			
			ife sprite[].htpicnum CATERKILAR
			ifg sprite[].htextra 0
			{
				geta[].htextra atemp
				
				divru atemp CATERDAMAGE
				
				add catertimes atemp
				
				ifg sprite[].htextra sprite[].extra
					set caterkilled 1
			}
			
			ifactor NEWBEAST
			{
				ifspritepal 17
				{
					ife sprite[].htpicnum FREEZEBLAST
					ifg sprite[].htextra 0
					{
						set atemp RETURN
						shoot FREEZEBLAST
						
						set RETURN atemp
						
						seta[].htextra -1
						seta[].htpicnum -1
					}
				}
				else
				{
					ife sprite[].htpicnum FLAMEPROJ
					ifg sprite[].htextra 0
					{
						set atemp RETURN
						shoot FLAMEPROJ
						
						set RETURN atemp
						
						seta[].htextra -1
						seta[].htpicnum -1
					}
				}
				
				ife sprite[].htpicnum SHRINKER
				{
					set atemp RETURN
					shoot SHRINKER
					set RETURN atemp
						
					seta[].htextra -1
					seta[].htpicnum -1
				}
			}
			
			ifactor BOSS2
				nullop
			else
			{
				ifactor TANK
					nullop
				else ifactor SCORPIONTANK
					nullop
				else ifactor RECON
					nullop
				else
				ife sprite[].htpicnum GROWSPARK
				ifg sprite[].htextra 0
				{
					ifactor BOSS1
					ifspritepal 0
						nullop
					else ifactor BOSS3 
					ifspritepal 0
						nullop
					else
					{
						guts JIBS6 1
						
						ifrnd 192
							ifl sprite[].extra 300
						{
							set a_groweffect 1
							sound EXPANDER_WAVE
							guts JIBS6 12
							spawn BLOOD
							
							ifrnd 32
								seta[].htextra sprite[].extra
						}
					}
				}
				
				ife sprite[].htpicnum SONICPROJ
				ifg sprite[].htextra 0
				{
					ifactor COMMANDER
						set commpad 1
					else ifactor SARGE
					ifrnd 196
						set commpad 1
					else ifactor PIGCOP
					{
						set atemp RETURN
						ifrnd 128
						{
							action 0
							move 0
							cactor PIGCOPPIECES
							state standard_jibs
							
							set gutAng 2048
							set gutNum 1
							set gutPic PIGHEAD
							state GutFast
							sound SQUISHED
							seta[].htpicnum -1
							seta[].htextra 0
						}
						else
						{
							espawn PUSHER
							seta[RETURN].ang sprite[].htang
							seta[RETURN].owner THISACTOR
							sound THUD
							setactorvar[RETURN].pushervel 5500
						}
						
						set RETURN atemp
					}
					else ifactor DPIGCOP
					{
						set atemp RETURN
						ifrnd 128
						{
							action 0
							move 0
							cactor PIGCOPPIECES
							state standard_jibs
							
							set gutAng 2048
							set gutNum 1
							set gutPic PIGHEAD
							state GutFast
							sound SQUISHED
							seta[].htpicnum -1
							seta[].htextra 0
						}
						else
						{
							espawn PUSHER
							seta[RETURN].ang sprite[].htang
							seta[RETURN].owner THISACTOR
							sound THUD
							setactorvar[RETURN].pushervel 5500
						}
						
						set RETURN atemp
					}
					else ifactor ELITEPIGCOP
					{
						set atemp RETURN
						ifrnd 64
						{
							action 0
							move 0
							cactor PIGCOPPIECES
							state standard_jibs
							
							set gutAng 2048
							set gutNum 1
							set gutPic PIGHEAD
							state GutFast
							sound SQUISHED
							seta[].htpicnum -1
							seta[].htextra 0
						}
						else
						{
							espawn PUSHER
							seta[RETURN].ang sprite[].htang
							seta[RETURN].owner THISACTOR
							sound THUD
							setactorvar[RETURN].pushervel 5500
						}
						
						set RETURN atemp
					}
					else
					{
						set atemp RETURN
						espawn PUSHER
						seta[RETURN].ang sprite[].htang
						seta[RETURN].owner THISACTOR
						sound THUD
						
						ifactor TANK
							setactorvar[RETURN].pushervel 4500
						else ifactor SCORPIONTANK
							setactorvar[RETURN].pushervel 4500
							else ifactor RECON
							setactorvar[RETURN].pushervel 4500
						else ifactor BOSS1
							setactorvar[RETURN].pushervel 4500
						else ifactor BOSS3
							setactorvar[RETURN].pushervel 4500
						else ifactor BOSS4
							setactorvar[RETURN].pushervel 512
						else ifactor BOSS2
							setactorvar[RETURN].pushervel 512
						else ifactor BOSS2RED
							setactorvar[RETURN].pushervel 1000
						else
							setactorvar[RETURN].pushervel 5500
						
						set RETURN atemp
					}
				}
			}
		
			//Nuke mode
			ife userdef.enable_nuke 1
			ife userdef.nuke_active 1
			{
				ifg sprite[].htextra 0
				ife sprite[].htowner player[].i
				{
					set atemp userdef.nuke_wpndmg
					mul atemp sprite[].htextra
					div atemp 100
					seta[].htextra atemp
				}
			}
		
			ifl player[].steroids_amount 400
			ifg player[].steroids_amount 0
			{
				ifg sprite[].htextra 0
				ife sprite[].htowner player[].i
				{
					geta[].htextra atmp
					
					sound THUD02
					palfrom 10 64 64 64
					
					ifactor BOSS1
						mul atmp 145
					else ifactor BOSS2
						mul atmp 125
					else ifactor BOSS3
						mul atmp 135
					else ifactor FIREFLY
						mul atmp 135
					else ifactor BOSS4
						mul atmp 145
					else
						mul atmp 200
						
					div atmp 100
					
					seta[].htextra atmp
				}
			}
			break
	
	endswitch

endevent

appendevent EVENT_LOADACTOR
	
	ife VOLUME 0
	ife LEVEL 4
	{
		ife BOSSFIGHT_LEVEL 1
		ife THISACTOR 548
		{
			set atemp sprite[].z
			add atemp 65536
			setarray SEBOSSFIGHT[0] sprite[].x
			setarray SEBOSSFIGHT[1] sprite[].y
			setarray SEBOSSFIGHT[2] atemp
		}
		else ife BOSSFIGHT_LEVEL 2
		ife THISACTOR 1106
		{
			set atemp sprite[].z
			add atemp 65536
			add atemp 16384
			setarray SEBOSSFIGHT[0] sprite[].x
			setarray SEBOSSFIGHT[1] sprite[].y
			setarray SEBOSSFIGHT[2] atemp
		}
	}
	else ife VOLUME 1
	ife LEVEL 8
	ife BOSSFIGHT_LEVEL 1
	ife THISACTOR 522
	{
		set atemp sprite[].z
		add atemp -16384
		setarray SEBOSSFIGHT[0] sprite[].x
		setarray SEBOSSFIGHT[1] sprite[].y
		setarray SEBOSSFIGHT[2] atemp
	}
	else ife VOLUME 3
	ife LEVEL 9
	ife BOSSFIGHT_LEVEL 1
	ife THISACTOR 1165
	{
		set atemp sprite[].z
		add atemp -16384
		setarray SEBOSSFIGHT[0] sprite[].x
		setarray SEBOSSFIGHT[1] sprite[].y
		setarray SEBOSSFIGHT[2] atemp
	}


	switch sprite[].picnum
	
		case SECTOREFFECTOR
			ifspritepal 50
			ife sprite[].lotag 7
			ifn userdef.player_skill 6
				killit
				
			ifspritepal 51
			ife sprite[].lotag 7
			ife userdef.player_skill 6
				killit
			
		break
	
	endswitch

endevent

appendevent EVENT_SPAWN

	switch sprite[].picnum
		
		case SHOTGUNSHELL
			ife player[].curr_weapon SHOTGUN_WEAPON
			ife 0 player[].bsubweapon SHOTGUN_WEAPON
			{
				geta[].zvel atmp
				sub atmp 64
				seta[].zvel atmp
				
				geta[].ang atmp
				add atmp 1024
				seta[].ang atmp
			}
			
			ife player[].curr_weapon CHAINGUN_WEAPON
			ife 1 player[].bsubweapon CHAINGUN_WEAPON
			{
				geta[].zvel atmp
				sub atmp 256
				seta[].zvel atmp
				
				geta[].xvel atmp
				add atmp 16
				seta[].xvel atmp
				
				geta[].ang atmp
				add atmp 1024
				seta[].ang atmp
				
				seta[].xrepeat 5 
				seta[].yrepeat 6
				
				spritepal 31
			}
			
			break
		
		case ORGANTIC
			sizeat 36 36
			cstator 257
			
			ifand sprite[].cstat 128
			{
				geta[].cstat atemp6
				xor atemp6 128
				seta[].cstat atemp6
			}	
			
			geta[].htflags atemp
			or atemp 1048576
			seta[].htflags atemp
			
			getsector[sprite[].sectnum].ceilingz atemp6
			add atemp6 3072
			seta[].z atemp6
			break
			
		case FIREFLY
			geta[].htflags atemp
			or atemp 1048576
			seta[].htflags atemp
			
			break
		
		case BOSS4
			sizeat 64 64
			break
		
		case ROBOTTROOPER
		case ROBOTTROOPERSTAYPUT
		case ROBOTTROOPERJETPACK
		case ROBOTTROOPERSHOOT
			sizeat 42 38
			spritepal 21
			break
			
		case SCORPIONTANK
			sizeat 48 48
			break
			
		case DPIGCOP
		case DPIGCOPSTAYPUT
		case DPIGCOPDIVE
		case FLAMEENFORCER
		case FLAMEENFORCERSTAYPUT
		case FLAMEENFORCERSPITTING
		case FLAMEENFORCERJUMP
		case ELITEENFORCER
		case ELITEENFORCERSTAYPUT
		case ELITEENFORCERSPITTING
		case ELITEENFORCERJUMP
		case SNAKEHEAD
		case BOSS3STAYPUT
			sizeat 40 40
			break
			
		case SARGE
			sizeat 40 38
			break
		
		case SNAKEDRONE
			sizeat 58 48
			break
			
		case ELITEPIGCOP
		case ELITEPIGCOPSTAYPUT
		case ELITEPIGCOPDIVE
			sizeat 55 45
			break
		
		case SHOTGUNBETASPRITE
			cstat 0
			sizeat 14 14
			break
	
		case PLASMASPRITE
			cstat 0
			sizeat 38 32
			break
		
		case PLASMAAMMO
		case ULTRARPGSPRITE
		case ULTRARPGAMMO
		case FUEL
			cstat 0
			sizeat 24 24
			break
			
		case SPACESUIT
			ifspritepal 3 nullop
			else sizeat 32 32
			break
			
		case FLAMETHROWERSPRITE
		case CATERKILARSPRITE
		case SONICSPRITE
			cstat 0
			sizeat 32 32
			break
			
		case SONICAMMO
			cstat 0
			sizeat 16 16
			break
			
		case ONEUP
			sizeat 32 32
			espawn ONEUPTITLE
			set oneupchild RETURN
			break
			
		case COLA
			ifn sprite[].owner -1
			{
				displayrandvar atemp 2048
				seta[].ang atemp
			}
			break
			
	endswitch

endevent

onevent EVENT_RECOGSOUND

	ife sprite[THISACTOR].picnum BOSS2
		set RETURN -1

endevent

move ONEUPTITLEMOVE 0 -16

useractor notenemy ONEUPTITLE

	sizeat 32 32
	
	ifmove 0
	{
		cstat 0
		move NOMOVE
	}
	
	ife oneupchild -2
	{
		ifmove NOMOVE
		{
			move ONEUPTITLEMOVE geth getv
			resetcount
		}
			
		ifmove ONEUPTITLEMOVE
		{
			ifcount 9
				killit
			else ifcount 7 nullop
			else ifcount 6
				cstator 512
			else ifcount 4 nullop
			else ifcount 3
				cstator 2
		}
	}

enda

useractor notenemy ONEUP

	ife oneupchild -1
	{
		espawn ONEUPTITLE
		set oneupchild RETURN
	}

	setsprite oneupchild sprite[].x sprite[].y sprite[].z
	
	sizeat 32 32
	spritepal 2
	cstat 0
	
	ifp pshrunk nullop
	else ifp palive
	  ifpdistl RETRIEVEDISTANCE
	    ifcount 6
	      ifcanseetarget
			ifl PlayerLives 10
	{
		add PlayerLives 1
		quote 134
		globalsound JIBBED_ACTOR5
		getp[].sound_pitch atemp
		setp[].sound_pitch 0
		globalsound ONEUPSND
		setp[].sound_pitch atemp
		palfrom 64 0 32 16
		setactorvar[oneupchild].oneupchild -2
		
		state SavePlayerLives
		
		killit
	}

enda

action ADAMMO 0 1
action AD2AMMO 3 1
action AD3AMMO 4 1
action AD31AMMO 5 1
action AD4AMMO 8 1
action AD41AMMO 9 1
action AD6AMMO 10 1
action AD61AMMO 11 1
action AD7AMMO 12 1
action AD71AMMO -5 1
action AD9AMMO 13 1
action AD91AMMO -1 1

action ADARMOR 1 1
action ADARMORROT -1044 1
action ADLIFE 2 1
action ADCOLAROT -123 1

move DROPPERVEL 0
move DROPPERSTOP 0

define DROPPERTRAIL 5760

spritenoshade DROPPERTRAIL

useractor notenemy DROPPERTRAIL

	ifmove 0
	{
		cstat 0
		sizeat 4 4
		move DROPPERSTOP
		
		ife sprite[].pal 3
			action ADARMOR
		else ife sprite[].pal 21
			action ADLIFE
	}
	else
	{
		spawn FRAMEEFFECT1
		sizeto 0 0
	}

enda

spritenoshade DROPPER

useractor notenemy DROPPER 0

	fall
	
	set atemp3 totalclock
	shiftl atemp3 5
	and atemp3 2047
	sin atemp3 atemp3
	shiftr atemp3 11
	
	seta[].shade atemp3

	ifaction 0
	{
		ifspritepal 0
		{
			ife sprite[].yvel 0
			{
				ifrnd 32
				ife 1 player[].gotweapon GROW_WEAPON
				ifl player[].ammo_amount GROW_WEAPON MAXGROWAMMO
					action AD61AMMO
				else ifrnd 64
				ife 1 player[].gotweapon SHOTGUN_WEAPON
				ifl player[].ammo_amount SHOTGUN_WEAPON MAXSHOTGUNAMMO
					action AD2AMMO
				else ifrnd 72
				ife gotweapons[CHAINGUN_WEAPON] 1
				ifl ripperammo MAXCHAINGUNAMMO
					action AD3AMMO
				else ifrnd 48
				ife gotweapons[RPG_WEAPON] 1
				ifl rpgammo MAXRPGAMMO
					action AD4AMMO
				else ifrnd 48
				ife gotweapons[FREEZE_WEAPON] 1
				ifl freezeammo MAXFREEZEAMMO
					action AD9AMMO
				else ifrnd 72
				ife gotweapons[PLASMA_WEAPON] 1
				ifl plasmaammo MAXPLASMAAMMO
				{
					action AD31AMMO
					spritepal 31
				}
				else ifrnd 48
				ife gotweapons[RPGBLAST_WEAPON] 1
				ifl urpgammo MAXURPGAMMO
					action AD41AMMO
				else ifrnd 32
				ife 1 player[].gotweapon SHRINKER_WEAPON
				ifl player[].ammo_amount SHRINKER_WEAPON MAXSHRINKERAMMO
					action AD6AMMO
				else ifrnd 64
				ife gotweapons[FLAME_WEAPON] 1
				ifl flameammo MAXFLAMEAMMO
						action AD91AMMO
				else ifrnd 64
				ife gotweapons[DEVISTATOR_WEAPON] 1
				ifl devistatorammo MAXDEVISTATORAMMO
					action AD7AMMO
				else ifrnd 32
				ife gotweapons[SONICRESONATOR_WEAPON] 1
				ifl sonicammo MAXSONICAMMO
					action AD71AMMO
				else ifrnd 128
				ife gotweapons[CATERKILAR_WEAPON] 1
				ifl plasmaammo MAXPLASMAAMMO
				{
					action AD31AMMO
					spritepal 31
				}
				else ifl player[].ammo_amount PISTOL_WEAPON MAXPISTOLAMMO
					action ADAMMO
				else ifrnd 196
				{
					spritepal 3
					action ADARMORROT
				}
				else
				{
					spritepal 21
					action ADCOLAROT
				}
			}
			else
			{
				ife sprite[].yvel 10
					action ADAMMO
				else ife sprite[].yvel 20
					action AD2AMMO
				else ife sprite[].yvel 30
					action AD3AMMO
				else ife sprite[].yvel 31
				{
					action AD31AMMO
					spritepal 31
				}
				else ife sprite[].yvel 40
					action AD4AMMO
				else ife sprite[].yvel 41
					action AD41AMMO
				else ife sprite[].yvel 60
					action AD6AMMO
				else ife sprite[].yvel 61
					action AD61AMMO
				else ife sprite[].yvel 81
					action AD71AMMO
				else ife sprite[].yvel 90
					action AD9AMMO
				else ife sprite[].yvel 91
					action AD91AMMO
			}
		}
		else ifspritepal 3
			action ADARMORROT
		else ifspritepal 21
			action ADCOLAROT
		
		sizeat 2 2
		cstat 0
		
		ifmove 0
		{
			move DROPPERVEL geth getv
			
			displayrandvarvar atemp 2048
			seta[].ang atemp
			
			displayrandvar atmp -8192
			seta[].zvel atmp
			
			displayrandvar atmp2 256
			
			
			switch sprite[].owner
				case BOSS1
				case BOSS2
				case BOSS3
				case FIREFLY
					add atmp2 384
					break
					
				case BOSS4
					add atmp2 768
					break
					
				default
					add atmp2 64
					break
			endswitch
			
			seta[].xvel atmp2
			
			set atemp2 0
		}
	}
	else
	{	
		ifaction AD31AMMO
			sizeto 34 34
		else ifaction AD71AMMO
			sizeto 12 12
		else ifaction AD2AMMO
			sizeto 28 28
		else ifaction ADAMMO
			sizeto 32 24
		else ifaction AD3AMMO
			sizeto 32 24
		else ifaction ADLIFE
			sizeto 19 16
		else ifaction ADCOLAROT
			sizeto 19 16
		else
			sizeto 16 16
		
		ifmove DROPPERVEL
		{
			ife sprite[].yvel 0
			{
				//spawn FRAMEEFFECT1
				espawn DROPPERTRAIL
				
				ifaction ADLIFE
					seta[RETURN].pal 21
				else ifaction ADCOLAROT
					seta[RETURN].pal 21
				else ifaction ADARMOR
					seta[RETURN].pal 3
				else ifaction ADARMORROT
					seta[RETURN].pal 3
			}
			
			sub atmp -384
			seta[].zvel atmp
				
			iffloordistl 3
			ifl atemp2 3
			{
				add atemp2 1
				set atmp -2048
			}
				
			ifg atmp2 1
			{			
				sub atmp2 4
				seta[].xvel atmp2
			}
			else
				set atmp2 0
				
			geta[].angoff atemp
			add atemp atmp2
			seta[].angoff atemp	
				
			iffloordistl 3
			ife atemp2 3
			ife atmp2 0
			{
				move DROPPERSTOP geth
				
				ifaction ADCOLAROT
					action ADLIFE
					
				ifaction ADARMORROT
					action ADARMOR
			}
		}
		
		ifp pshrunk
			nullop
		else
			ifp palive
			ifcount 6
			ifcansee
			ifcanseetarget
			ifpdistl 1536
			{
				ifspritepal 0
				{
					ifaction AD61AMMO
						addammo GROW_WEAPON 1
					else ifaction AD2AMMO
							addammo SHOTGUN_WEAPON 1
					else ifaction AD3AMMO
					{
						ifl ripperammo MAXCHAINGUNAMMO
							add ripperammo 4
						else
							break
					}
					else ifaction AD4AMMO
					{
						ifl rpgammo MAXRPGAMMO
							add rpgammo 1
						else
							break
					}
					else ifaction AD9AMMO
					{
						ifl freezeammo MAXFREEZEAMMO
							add freezeammo 2
						else
							break
					}
					else ifaction AD41AMMO
					{
						ifl urpgammo MAXURPGAMMO
							add urpgammo 1
						else
							break
					}
					else ifaction AD6AMMO
							addammo SHRINKER_WEAPON 1
					else ifaction AD91AMMO
					{
						ifl flameammo MAXFLAMEAMMO
							add flameammo 2
						else
							break
					}
					else ifaction AD7AMMO
					{
						ifl devistatorammo MAXDEVISTATORAMMO
							add devistatorammo 2
						else
							break
					}
					else ifaction AD71AMMO
					{
						ifl sonicammo MAXSONICAMMO
							add sonicammo 1
						else
							break
					}
					else ifaction ADAMMO
						addammo PISTOL_WEAPON 3
					
					quote 138
					state quikget
				}
				else ifspritepal 31
				{
					ifl plasmaammo MAXPLASMAAMMO
						add plasmaammo 2
					else
						break
						
					quote 138
					state quikget
				}
				else ifaction ADARMOR
				ifpinventory GET_SHIELD SHIELD_AMOUNT
				{
					addinventory GET_SHIELD 6
					quote 136
					state quikget
				}
				else ifaction ADARMORROT
				ifpinventory GET_SHIELD SHIELD_AMOUNT
				{
					addinventory GET_SHIELD 6
					quote 136
					state quikget
				}
				else ifaction ADCOLAROT
				ifphealthl MAXPLAYERHEALTH
				{
					addphealth 3
					quote 137
					state quikget
				}
				else ifaction ADLIFE
				ifphealthl MAXPLAYERHEALTH
				{
					addphealth 3
					quote 137
					state quikget
				}
			}
			
		ifcount 900
			killit
	}

enda

action APIGPIECES 0 5 1 1 20

useractor notenemy PIGCOPPIECES

	cstat 0
	
	ifaction 0
		action APIGPIECES
	else
	{
		ifactioncount 5
		{
			action 0
			cactor PIGPIECESDEAD
			break
		}
	}

enda

//DEAD BODIES CODE

action DEADBODY 0 1

defstate bodyjibs

	switch sprite[].picnum
		case LIZTROOPDSPRITE
		case LIZTROOPHEADLESS
		case LIZTROOPTORSOLESS
		case LIZHACKED
		case LIZTORSODEAD
			state troop_body_jibs
			break
			
		case PIGCOPHEADLESS
		case PIGCOPDEADSPRITE
		case DPIGCOPDEAD
		case ELITEPIGCOPDEAD
		case PIGCOPLIMBLESS
		case PIGCOPHACKED
			state pig_jibs
			break
			
		case OCTADEADSPRITE
		case OCTAHEADLESS
		case OCTAHACKED
		case OCTAHACKED2
			state octa_jibs
			break
			
		case LIZMANDEADSPRITE
		case FLAMEENFORCERDEAD
		case ELITEENFORCERDEAD
		case ENFORCERARMLESS
		case ENFORCERNOARMS
		case FLAMEENFORCERARMLESS
		case LIZMANHACKED
			state liz_body_jibs
			break
			
		case ROBOTTROOPERDEAD
		case ROBOTTROOPERHEADLESS
		case ROBOTTROOPERARMLESS
		case ROBOTTROOPERTORSOLESS
		case ROBOTTROOPERHACKED
			state troop_jibs
			break
			
		case COMMANDERDEAD
		case COMMANDERHEADLESS
		case COMMANDERHOLEDEAD
		case COMMHACKED
			state comm_headjib
			break
			
		case NBDEAD
		case NBDEADH
		case NBDEADA
		case NBTORSODEAD
		case NBHACKED
			state nb_jibs
			break
			
		case NBDEADT
			displayrandvarvar gutAng 2048
			set gutPic NBLEG
			set gutNum 2
			state GutFast
			break
			
		case SGDEAD
			state sg_jibs
			break
			
		case SGDEADA
		case SARGEHACKED
			state sg_headjib
			state sg_armjib
			break
			
		case SGDEADH
			state sg_armjib
			break
	
	endswitch
	
	ifge userdef.player_skill 3
	ifrnd 192
		spawn COLA
				
	ife userdef.player_skill 6
		ifrnd 64
			spawn DROPPER
				
	add s_bodies 1

ends

defstate deadbody

	fall

	ifaction 0
	{
		move 0
		cstator 256
		action DEADBODY
		strength 100
		
		geta[].htflags atemp
		ifand atemp 2
			nullop
		else
		{
			add atemp 2
			seta[].htflags 2
		}
			
		
		geta[].cstat atemp
		ifand atemp 1
		{
			sub atemp 1
			seta[].cstat atemp
		}
		
		ifspritepal 30
		{
			gettiledata[sprite[].picnum].xsize atmp
			div atmp 4
			
			gettiledata[sprite[].picnum].ysize atmp2
			
			espawn SMOKE2
			seta[RETURN].xrepeat 32
			seta[RETURN].yrepeat 32
			seta[RETURN].yoffset atmp2
			seta[RETURN].xoffset atmp
			seta[RETURN].yvel 1
			
			espawn SMOKE2
			seta[RETURN].xrepeat 32
			seta[RETURN].yrepeat 32
			sub atmp2 4
			seta[RETURN].yoffset atmp2
			mulvar atmp 2
			seta[RETURN].xoffset atmp
			seta[RETURN].yvel 1
			
			espawn SMOKE2
			seta[RETURN].xrepeat 32
			seta[RETURN].yrepeat 32
			add atmp2 4
			seta[RETURN].yoffset atmp2
			div atmp 2 
			mulvar atmp -1
			seta[RETURN].xoffset atmp
			seta[RETURN].yvel 1
			
			espawn SMOKE2
			seta[RETURN].xrepeat 32
			seta[RETURN].yrepeat 32
			add atmp2 4
			seta[RETURN].yoffset atmp2
			add atmp atmp
			seta[RETURN].xoffset atmp
			seta[RETURN].yvel 1
		}
	}
	
	ifactor LIZTROOPDSPRITE
	ife sprite[].yvel 2
	{
		ifcount PLAYDEADTIME
		{
			cactor LIZTROOP
			action 0
			ai 0
		    cstat 257
			strength 1
			break
		}
		else
		ifp pfacing
			resetcount
	}

	ifhitweapon
	{
		ifdead
		{
			ifactor LIZTROOPDSPRITE
			ife sprite[].yvel 2
				addkills 1
				
			state standard_jibs
			state random_wall_jibs
			state bodyjibs
			sound SQUISHED
			killit
		}
	
		ifwasweapon RADIUSEXPLOSION
		{
			ifactor LIZTROOPDSPRITE
			ife sprite[].yvel 2
				addkills 1	
				
			ifactor PIGCOPLIMBLESS
			{
				seta[].ang sprite[].htang
				action ROTATINGJIBS3
				cactor PIGTORSO2
				seta[].yvel 10
				geta[].z atemp
				sub atemp 8192
				seta[].z atemp
				break
			}
			
			ifactor LIZMANTORSODEAD2
			{
				seta[].ang sprite[].htang
				action ROTATINGJIBS3
				cactor LIZMANTORSO
				seta[].yvel 10
				geta[].z atemp
				sub atemp 8192
				seta[].z atemp
				break
			}
			
			ifactor TROOPTORSODEAD
			{
				seta[].ang sprite[].htang
				action ROTATINGJIBS3
				cactor TROOPTORSO
				seta[].yvel 10
				geta[].z atemp
				sub atemp 8192
				seta[].z atemp
				break
			}
			
			ifactor NBTORSODEAD
			{
				seta[].ang sprite[].htang
				action ROTATINGJIBS4
				cactor NBTORSO
				seta[].yvel 10
				geta[].z atemp
				sub atemp 8192
				seta[].z atemp
				break
			}
				
			state standard_jibs
			state random_wall_jibs
			state bodyjibs
			sound SQUISHED
			killit
		}
		else ifwasweapon SHOTSPARK1
		ifrnd 64
		{
			ifactor PIGCOPLIMBLESS
			{
				seta[].ang sprite[].htang
				action ROTATINGJIBS3
				cactor PIGTORSO2
				seta[].yvel 11
				geta[].z atemp
				sub atemp 8192
				seta[].z atemp
				break
			}
			
			ifactor LIZMANTORSODEAD2
			{
				seta[].ang sprite[].htang
				action ROTATINGJIBS3
				cactor LIZMANTORSO
				seta[].yvel 11
				geta[].z atemp
				sub atemp 8192
				seta[].z atemp
				break
			}
			
			ifactor TROOPTORSODEAD
			{
				seta[].ang sprite[].htang
				action ROTATINGJIBS3
				cactor TROOPTORSO
				seta[].yvel 11
				geta[].z atemp
				sub atemp 8192
				seta[].z atemp
				break
			}
			
			ifactor NBTORSODEAD
			{
				seta[].ang sprite[].htang
				action ROTATINGJIBS4
				cactor NBTORSO
				seta[].yvel 11
				geta[].z atemp
				sub atemp 8192
				seta[].z atemp
				break
			}
		}
		else ifwasweapon KNEE
		{
			ifactor PIGCOPLIMBLESS
			{
				seta[].ang sprite[].htang
				action ROTATINGJIBS3
				cactor PIGTORSO2
				seta[].yvel 11
				geta[].z atemp
				sub atemp 8192
				seta[].z atemp
				break
			}
			
			ifactor LIZMANTORSODEAD2
			{
				seta[].ang sprite[].htang
				action ROTATINGJIBS3
				cactor LIZMANTORSO
				seta[].yvel 11
				geta[].z atemp
				sub atemp 8192
				seta[].z atemp
				break
			}
			
			ifactor TROOPTORSODEAD
			{
				seta[].ang sprite[].htang
				action ROTATINGJIBS3
				cactor TROOPTORSO
				seta[].yvel 11
				geta[].z atemp
				sub atemp 8192
				seta[].z atemp
				break
			}
			
			ifactor NBTORSODEAD
			{
				seta[].ang sprite[].htang
				action ROTATINGJIBS4
				cactor NBTORSO
				seta[].yvel 11
				geta[].z atemp
				sub atemp 8192
				seta[].z atemp
				break
			}
		}
		else ifwasweapon RPG
		{
			ifactor PIGCOPLIMBLESS
			{
				seta[].ang sprite[].htang
				action ROTATINGJIBS3
				cactor PIGTORSO2
				seta[].yvel 10
				geta[].z atemp
				sub atemp 8192
				seta[].z atemp
				break
			}
			
			ifactor LIZMANTORSODEAD2
			{
				seta[].ang sprite[].htang
				action ROTATINGJIBS3
				cactor LIZMANTORSO
				seta[].yvel 10
				geta[].z atemp
				sub atemp 8192
				seta[].z atemp
				break
			}
			
			ifactor TROOPTORSODEAD
			{
				seta[].ang sprite[].htang
				action ROTATINGJIBS3
				cactor TROOPTORSO
				seta[].yvel 10
				geta[].z atemp
				sub atemp 8192
				seta[].z atemp
				break
			}
			
			ifactor NBTORSODEAD
			{
				seta[].ang sprite[].htang
				action ROTATINGJIBS4
				cactor NBTORSO
				seta[].yvel 10
				geta[].z atemp
				sub atemp 8192
				seta[].z atemp
				break
			}
		}
		else ifwasweapon SONICPROJ
		{
			espawn PUSHER
			seta[RETURN].ang sprite[].htang
			seta[RETURN].owner THISACTOR
			sound THUD
			setactorvar[RETURN].pushervel 2500
			
			ifactor PIGCOPLIMBLESS
			{
				seta[].ang sprite[].htang
				action ROTATINGJIBS3
				cactor PIGTORSO2
				seta[].yvel 10
				geta[].z atemp
				sub atemp 8192
				seta[].z atemp
				break
			}
			
			ifactor LIZMANTORSODEAD2
			{
				seta[].ang sprite[].htang
				action ROTATINGJIBS3
				cactor LIZMANTORSO
				seta[].yvel 10
				geta[].z atemp
				sub atemp 8192
				seta[].z atemp
				break
			}
			
			ifactor TROOPTORSODEAD
			{
				seta[].ang sprite[].htang
				action ROTATINGJIBS3
				cactor TROOPTORSO
				seta[].yvel 10
				geta[].z atemp
				sub atemp 8192
				seta[].z atemp
				break
			}
			
			ifactor NBTORSODEAD
			{
				seta[].ang sprite[].htang
				action ROTATINGJIBS4
				cactor NBTORSO
				seta[].yvel 10
				geta[].z atemp
				sub atemp 8192
				seta[].z atemp
				break
			}
		}
		
		ifrnd 64
		{
			ifactor LIZTROOPDSPRITE
			ife sprite[].yvel 2
				addkills 1
			
			state standard_jibs
			state random_wall_jibs
			state bodyjibs
			sound SQUISHED
			killit
		}
		
		guts JIBS6 1
	}

ends

//useractor notenemy [ACTOR_NAME] state deadbody enda

useractor notenemy LIZTROOPDSPRITE state deadbody enda
useractor notenemy LIZTROOPHEADLESS state deadbody enda
useractor notenemy LIZTROOPTORSOLESS state deadbody enda
useractor notenemy LIZHACKED state deadbody enda
useractor notenemy LIZTORSODEAD state deadbody enda

useractor notenemy PIGCOPDEADSPRITE state deadbody enda
useractor notenemy PIGCOPLIMBLESS state deadbody enda
useractor notenemy DPIGCOPDEAD state deadbody enda
useractor notenemy ELITEPIGCOPDEAD state deadbody enda
useractor notenemy PIGPIECESDEAD state deadbody enda
useractor notenemy PIGCOPHEADLESS state deadbody enda
useractor notenemy PIGCOPHACKED state deadbody enda

useractor notenemy OCTADEADSPRITE state deadbody enda
useractor notenemy OCTAHEADLESS state deadbody enda
useractor notenemy OCTAHACKED state deadbody enda
useractor notenemy OCTAHACKED2 state deadbody enda

useractor notenemy LIZMANDEADSPRITE state deadbody enda
useractor notenemy ENFORCERARMLESS state deadbody enda
useractor notenemy FLAMEENFORCERARMLESS state deadbody enda
useractor notenemy ENFORCERNOARMS state deadbody enda
useractor notenemy FLAMEENFORCERDEAD state deadbody enda
useractor notenemy ELITEENFORCERDEAD state deadbody enda
useractor notenemy LIZMANTORSODEAD state deadbody enda
useractor notenemy LIZMANTORSODEAD2 state deadbody enda
useractor notenemy LIZMANHACKED state deadbody enda

useractor notenemy ROBOTTROOPERDEAD state deadbody enda
useractor notenemy ROBOTTROOPERHEADLESS state deadbody enda
useractor notenemy ROBOTTROOPERARMLESS state deadbody enda
useractor notenemy ROBOTTROOPERTORSOLESS state deadbody enda
useractor notenemy TROOPTORSODEAD state deadbody enda
useractor notenemy ROBOTTROOPERHACKED state deadbody enda

useractor notenemy COMMANDERDEAD state deadbody enda
useractor notenemy COMMANDERHEADLESS state deadbody enda
useractor notenemy COMMANDERHOLEDEAD state deadbody enda
useractor notenemy COMMHACKED state deadbody enda

useractor notenemy NBDEAD state deadbody enda
useractor notenemy NBDEADH state deadbody enda
useractor notenemy NBDEADA state deadbody enda
useractor notenemy NBDEADT state deadbody enda
useractor notenemy NBTORSODEAD state deadbody enda
useractor notenemy NBHACKED state deadbody enda

useractor notenemy SGDEAD state deadbody enda
useractor notenemy SGDEADA state deadbody enda
useractor notenemy SGDEADH state deadbody enda
useractor notenemy SARGEHALFDEAD state deadbody enda
useractor notenemy SARGEHACKED state deadbody enda

useractor notenemy BOSS1DEAD state deadbody enda
useractor notenemy BOSS3DEAD state deadbody enda

action ACOMMCRAWL 0 5 5 1 15
action ACOMMCRAWLSHRUNK 0 5 5 1 15

move COMMCRAWLVEL 32
move COMMCRAWLSTOP

useractor enemy COMMCRAWLING

	fall

	ifaction 0
	{
		cstat 257
		strength 30
		action ACOMMCRAWL
		move COMMCRAWLVEL furthestdir geth
	}
	else
	{
		ifaction ACOMMCRAWLSHRUNK
		{
			 ifcount SHRUNKDONECOUNT
				action ACOMMCRAWL
			  else
				ifcount SHRUNKCOUNT
				  sizeto 48 40
			  else
				state genericshrunkcode
		}
		else
		{
			ifmove COMMCRAWLVEL
			{
				ifcount 32
				ifnotmoving
					move COMMCRAWLVEL randomangle geth
					//resetcount
			}
				
			ifactioncount 5
			{
				ifrnd 72
					spawn BLOODPOOL
					
				ifrnd 148
				{
					guts JIBS6 1
					state random_wall_jibs
				}
				
				soundonce COMM_PAIN
				
				resetactioncount
				
				//move COMMCRAWLVEL furthestdir geth
			}
		}
	}
	
	ifhitweapon
	{
		ifdead
		{
			state standard_jibs
			state random_wall_jibs
			state comm_headjib
			sound SQUISHED
			add s_bodies 1
			
			ifge userdef.player_skill 3
			ifrnd 192
				spawn COLA
						
			ife userdef.player_skill 6
				ifrnd 64
					spawn DROPPER
			
			killit
		}
		else
		{
			state random_wall_jibs
			guts JIBS6 1
			spawn BLOOD
			soundonce COMM_PAIN
			
			ifwasweapon SHRINKSPARK
			{
				sound ACTOR_SHRINKING
				action ACOMMCRAWLSHRUNK
				move COMMCRAWLSTOP
				break
			}
		}
	}

enda

move PUSHERMOV 256

action APUSHER 0 1

useractor notenemy PUSHER 0

	cstat 32769

	ifmove 0
	{
		move PUSHERMOV geth
		geta[].owner pusherowner
		//geta[pusherowner].ang atemp
		//sub atemp 1024
		//seta[].ang atemp
		seta[].xvel pushervel
		
		geta[].z atemp
		sub atemp 8192
		seta[].z atemp
		
		resetcount
	}
	else
	{
		ifcount 8
			killit
		
		setsprite pusherowner sprite[].x sprite[].y sprite[pusherowner].z
		
		sub pushervel pushercounter
		seta[].xvel pushervel
		
		ifg pushervel 0
		{
			set wallDist 512
			state CheckWallNearby
			
			set atemp 0
			
			ife wallTouch 1
			{
				ife sectorID -1
					set atemp 1
				else
				{
					//Compare heights
					set atmp sector[sectorID].floorz
					
					geta[pusherowner].z atmp2
					sub atmp2 16384

					ifl atmp atmp2 //Wall height is heigher
						set atemp 1
					else
					{
						set atmp sector[sectorID].ceilingz
						
						ifg atmp atmp2 //Wall height is heigher
							set atemp 1
					}
				}
			}
			
			ifnotmoving
				set atemp 1
			
			ife atemp 1
			{
				shiftr pushervel 5
				hitradius 1024 pushervel pushervel pushervel pushervel
				killit
			}
		}
	}

enda

useractor notenemy PUSHERPLAYER 0

	fall
	cstat 32768

	ifmove 0
	{
		move PUSHERMOV geth
		//getp[].i pusherowner
		//geta[pusherowner].ang atemp
		//sub atemp 1024
		//seta[].ang atemp
		seta[].xvel pushervel
		resetcount
	}
	else
	{
		ifcount 8
			killit
			
		setp[].posx sprite[].x
		setp[].posy sprite[].y

		setp[].cursectnum sprite[].sectnum
		
		sub pushervel pushercounter
		seta[].xvel pushervel
		
		ife sprite[].yvel 1
		{
			ifg pushervel 0
			{
				set wallDist 512
				state CheckWallNearby
				
				set atemp 0
				
				ife wallTouch 1
				{
					ife sectorID -1
						set atemp 1
					else
					{
						//Compare heights
						set atmp sector[sectorID].floorz
						
						geta[pusherowner].z atmp2
						sub atmp2 16384

						ifl atmp atmp2 //Wall height is heigher
							set atemp 1
						else
						{
							set atmp sector[sectorID].ceilingz
							
							ifg atmp atmp2 //Wall height is heigher
								set atemp 1
						}
					}
				}
				
				ifnotmoving
					set atemp 1
				
				ife atemp 1
				{
					shiftr pushervel 10
					hitradius 1024 pushervel pushervel pushervel pushervel
					killit
				}
			}
		}
	}

enda

action ALSHELL_REST1 5 1
action ALSHELL_REST2 11 1
action ALSHELL_REST3 12 1
action ALSSHELL_REST2 10 1
action ALSSHELL_REST1 4 1

move LSHELLVELDROP 0
move LSHELLSTOPPED 0

defstate ShellCode

	ifmove 0
	{
		//sizeat 5 5
		
		ife userdef.qsize 96
		ifrnd 128
			killit
		
		move LSHELLVELDROP geth
		
		displayrandvar atemp2 96
		add atemp2 atemp4
		
		displayrandvar atemp 768
		add atemp atemp5
		
		mul atemp -1
		
		displayrandvar atmp 2048
		seta[].ang atmp
		
		seta[].xvel atemp2
		seta[].zvel atemp
		set atmp 0
		cstat 0
		insertspriteq
		
		ifrnd 96
		{
			ifactor LSSHELL
			ifspritepal 0
				sound SSHELLDROP
			else
				sound SHELLDROP
		}
	}
	else ifmove LSHELLVELDROP
	{
		ifg atemp 0
		ifg sprite[].htmovflag 16383
		{
			add atmp 1
			mul atemp -1
			
			ife atmp 1
			{
				displayrandvar atmp2 1024
				add atemp atmp2
				add atemp 384
			}
			
			ifg atemp -400
				set atmp 5
			
			displayrandvar atmp2 64
			
			ifl atemp2 atmp2
				set atmp 5
			else
				sub atemp2 atmp2
		}
			
		ifl atemp2 5
			set atmp 5
		
		ifn atmp 5
		{
			add atemp 256
			
			sub atemp2 4
			
		}
		else
		{
			move LSHELLSTOPPED
			strength 0
			cstat 256
			
			ifrnd 128
			{
				ifactor LSSHELL
					action ALSSHELL_REST1
				else
					action ALSHELL_REST1
			}
			else ifrnd 128
			{
				ifactor LSSHELL
					action ALSSHELL_REST2
				else
					action ALSHELL_REST2
			}
			else
				action ALSHELL_REST3
				
			ifspritepal 31
			{
				espawn SMOKE2
				seta[RETURN].xrepeat 8
				seta[RETURN].yrepeat 8
				
				ifaction ALSHELL_REST3
					seta[RETURN].yoffset 8
				else
					seta[RETURN].xoffset 16
			}
				
			break
		}
		
		seta[].zvel atemp
		seta[].xvel atemp2
		
	}
	else
	{
		fall
		
		ifp prunning
			set atemp7 1
		else ifp pwalking
			set atemp7 1
		else
			set atemp7 0
			
		ifhitweapon
		{
			ifwasweapon RADIUSEXPLOSION
			{
				ifrnd 96
					set atemp7 2
				else
					killit
			}
			else ifwasweapon RPG
			{
				ifrnd 96
					set atemp7 2
				else
					killit
			}
			else ifwasweapon ROCKETPROJ
			{
				ifrnd 96
					set atemp7 2
				else
					killit
			}
			else ifwasweapon PLASMAPROJ
			{
				ifrnd 96
					set atemp7 2
				else
					killit
			}
		}
		
		ife atemp7 2
		{
			move LSHELLVELDROP geth
			action 0
		
			displayrandvar atemp2 256
			add atemp2 64
			
			displayrandvar atemp 2048
			add atemp 1536
			
			mul atemp -1
			
			displayrandvar atmp 2048
			seta[].ang atmp
			
			seta[].xvel atemp2
			seta[].zvel atemp
			set atmp 0
			cstat 0
			
			set atemp7 0
			set atemp6 0
			
			ifrnd 96
			{
				ifactor LSSHELL
					sound SSHELLDROP
				else
					sound SHELLDROP
			}
			
			break
		}
		
		ifpdistl 512
		ife atemp7 1
		ife atemp6 0
		ifrnd 24
		{
			ifaction ALSHELL_REST3
				action 0
			
			set atemp6 1
			displayrandvar atemp2 24
			add atemp2 8
			
			ifg atemp2 26
				set atemp2 26
			
			displayrandvar atemp 128
			displayrandvar atmp -128
			add atemp atmp
			
			getp[].posxv atemp4
			getp[].posyv atemp5
			
			getangle atmp atemp4 atemp5
			
			add atemp atmp
			seta[].ang atemp
			
			move LSHELLSTOPPED geth
			seta[].xvel atemp2
			ifrnd 96
				soundonce SHELL_ROLL
		}
		
		ife atemp6 1
		{
			seta[].xvel atemp2
			
			ifaction ALSHELL_REST1
			ifrnd 32
				action ALSHELL_REST2
			else ifaction ALSHELL_REST2
			ifrnd 32
				action ALSHELL_REST1
				
			ifaction ALSSHELL_REST1
			ifrnd 32
				action ALSSHELL_REST2
			else ifaction ALSSHELL_REST2
			ifrnd 32
				action ALSSHELL_REST1
			
			ifg atemp2 0
				sub atemp2 1
			else
			{
				move LSHELLSTOPPED
				set atemp6 0
				set atemp2 0
				
				ifaction 0
				{
					ifrnd 128
					{
						ifactor LSSHELL
							action ALSSHELL_REST1
						else
							action ALSHELL_REST1
					}
					else
					{
						ifactor LSSHELL
							action ALSSHELL_REST2
						else
							action ALSHELL_REST2
					}
				}
			}
		}
	}
	
ends

useractor notenemy LSHELL 0 state ShellCode enda
useractor notenemy LSSHELL 0 state ShellCode enda

action ASMOKE2 0 9 1 1 8
action ASMOKEF2 0 9 1 1 2
action ASMOKES2 0 9 1 1 24

useractor notenemy SMOKE2 0 ASMOKE2

	cstat 514
	
	ifaction ASMOKE2
	ife sprite[].yvel 1
		action ASMOKES2
	
	ifactioncount 9
		killit

enda

action ABALLEXPLODE 0 5 1 1 8

move FIREBALLVEL

useractor notenemy FIREBALL 0

	fall

	ifmove 0
	{
		ifl userdef.qsize 512
		ifrnd 72
			killit
	
		move FIREBALLVEL geth getv
		sizeat 32 32
		displayrandvar atemp 6144
		add atemp 2048
		mul atemp -1
		displayrandvar atemp2 512
		add atemp2 96
		displayrandvar atemp3 2048
		seta[].ang atemp3
		set atemp3 0
		insertspriteq
	}
	else
	{
		seta[].xvel atemp2
		seta[].zvel atemp
		sizeto 1 1
		
		ifcount 2
		{
			eqspawn BALLEXPLODE
			seta[RETURN].yvel 1
			resetcount
		}
		
		add atemp 256
		
		ifg atemp2 0
			sub atemp2 2
		
		iffloordistl 4
		{
			qspawn BALLEXPLODE
			
			eqspawn EXPLOSION2BOT
			seta[RETURN].xrepeat 12
			seta[RETURN].yrepeat 12
			
			ifrnd 48
				spawn FIRE
				
			killit
		}
	}

enda

useractor notenemy BALLEXPLODE 0 ABALLEXPLODE

	ife sprite[].yvel 1
		sizeat 14 14
	else
		sizeat 24 24

	ifactioncount 5
		killit

enda
