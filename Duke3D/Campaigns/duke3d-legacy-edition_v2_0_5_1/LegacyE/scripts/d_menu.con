/*
--------------------------------------------------------------------------------
Duke Nukem 3D - Blast Edition Version 2.0
By Marcos
2023 - Space In a Bottle
*/

//Menu and Title

var title 0 0
var title_count 360 0

var t_test 35 0

var musicpos 0 0
var musicpos2 0 0

var skip_count 0 0

var fadec 255 0
var fades 8 0 //1 second fade
var fader 0 0
var fadeg 0 0
var fadeb 0 0

var loadfade 0 0

var loadtip 0 0

var t_temp 0 0
var t_temp2 0 0 
var t_temp3 0 0
var t_temp4 0 0
var t_temp5 0 0
var t_temp6 0 0
var t_temp7 0 0
var t_temp8 0 0
var t_temp9 0 0
var t_temp10 0 0
var t_temp11 0 0
var t_temp12 0 0
var t_temp13 0 0
var t_temp14 0 0
var t_temp15 0 0
var t_temp16 0 0
var t_temp17 0 0
var t_temp18 0 0
var t_temp19 0 0
var t_temp20 0 0

var fpscont 0 0
var lastclock 0 0

var startMenu 0 0
var startMenuTime 0 0


var legacypal 0 0
var legacysize 73728 0
var titlesize 65536 0
var titlesizelock 0 0

var spark00 0 0
var spark01 0 0
var spark02 0 0
var spark03 0 0
var spark04 0 0
var spark05 0 0

var precacher 0 0

var endgamecount 330 0
var endcounter 0 0
var skipend 0 0

var EPLOCK 0 131072
var EP1LOCKS 0 131072
var EP2LOCKS 0 131072
var EP22LOCKS 0 131072
var EP3LOCKS 0 131072
var EP32LOCKS 0 131072
var EP4LOCKS 0 131072
var EP42LOCKS 0 131072

var ratebase 0 0

define LEVELFADEOUTTIME 240

var StartLevelFadeout 255 1

gamearray bonustile 5

gamearray sortedscores_ids 8
gamearray sortedscores_t 8
gamearray sortedscores 8

define D3DBETASCREEN 2488
define MENUBG 3628

define SIZE1X 65536
define HALFX 160
define HALFY 100
define MENUBIT 0x8

define MENU_NULL                        -2147483648
define MENU_CLOSE                       -2
define MENU_PREVIOUS                    -1
define MENU_MAIN                        0
define MENU_MAIN_INGAME                 50
define MENU_EPISODE                     100
define MENU_USERMAP                     101
define MENU_NEWGAMECUSTOM               102
define MENU_NEWGAMECUSTOMSUB            103
define MENU_NEWGAMECUSTOML3             104
define MENU_SKILL                       110
define MENU_GAMESETUP                   200
define MENU_OPTIONS                     202
define MENU_VIDEOSETUP                  203
define MENU_KEYBOARDSETUP               204
define MENU_MOUSESETUP                  205
define MENU_JOYSTICKSETUP               206
define MENU_JOYSTICKBTNS                207
define MENU_JOYSTICKAXES                208
define MENU_KEYBOARDKEYS                209
define MENU_MOUSEBTNS                   210
define MENU_MOUSEADVANCED               212
define MENU_JOYSTICKAXIS                213
define MENU_TOUCHSETUP                  214
define MENU_TOUCHSENS                   215
define MENU_TOUCHBUTTONS                216
define MENU_CONTROLS                    220
define MENU_POLYMOST                    230
define MENU_COLCORR                     231
define MENU_COLCORR_INGAME              232
define MENU_SCREENSETUP                 233
define MENU_DISPLAYSETUP                234
define MENU_POLYMER                     240
define MENU_LOAD                        300
define MENU_SAVE                        350
define MENU_STORY                       400
define MENU_F1HELP                      401
define MENU_QUIT                        500
define MENU_QUITTOTITLE                 501
define MENU_QUIT_INGAME                 502
define MENU_NETSETUP                    600
define MENU_NETWAITMASTER               601
define MENU_NETWAITVOTES                603
define MENU_SOUND                       700
define MENU_SOUND_INGAME                701
define MENU_ADVSOUND                    702
define MENU_SAVESETUP                   750
define MENU_SAVECLEANVERIFY             751
define MENU_RESETSTATSVERIFY            752
define MENU_CHEATS                      800
define MENU_CHEATENTRY                  801
define MENU_CHEAT_WARP                  802
define MENU_CHEAT_SKILL                 803
define MENU_CREDITS                     990
define MENU_CREDITS2                    991
define MENU_CREDITS3                    992
define MENU_CREDITS4                    993
define MENU_CREDITS5                    994
define MENU_LOADVERIFY                  1000
define MENU_LOADDELVERIFY               1100
define MENU_NEWVERIFY                   1500
define MENU_SAVEVERIFY                  2000
define MENU_SAVEDELVERIFY               2100
define MENU_COLCORRRESETVERIFY          2200
define MENU_KEYSRESETVERIFY             2201
define MENU_KEYSCLASSICVERIFY           2202
define MENU_JOYSTANDARDVERIFY           2203
define MENU_JOYPROVERIFY                2204
define MENU_JOYCLEARVERIFY              2205
define MENU_ADULTPASSWORD               10001
define MENU_RESETPLAYER                 15000
define MENU_BUYDUKE                     20000
define MENU_NETWORK                     20001
define MENU_PLAYER                      20002
define MENU_MACROS                      20004
define MENU_NETHOST                     20010
define MENU_NETOPTIONS                  20011
define MENU_NETUSERMAP                  20012
define MENU_NETJOIN                     20020

define FLY_BY_ECHO 500
definesound FLY_BY_ECHO snd/fly_by_echo.wav 0 0 3 0 0

define LOGO_NOISE 502
definesound LOGO_NOISE snd/logo_noise.ogg 0 0 3 0 0

define FIRST_BEAT 503
definesound FIRST_BEAT snd/first_beat.ogg 0 0 3 0 0

define SECOND_BEAT 504
definesound SECOND_BEAT snd/second_beat.ogg 0 0 3 0 0

var MENU_TILE 0 0
var MENU_TILE_CURR MENUBG 0
var menu_next_frame -1 0

defstate TimeClock

	ifn lastclock totalclock
	{
		set lastclock totalclock
		set fpscont 1
	}
	else
		set fpscont 0

ends

defstate TitleCounter

	//state TimeClock

	//ife fpscont 1
	{
		ife title_count 0
		ife loadfade 0
			add title 1
		else ife title_count 0
		ife loadfade 1
			add loadfade 1
		else ifg title_count 0
			sub title_count 1
	}

ends

defstate FadeOutScreen

	screenpal fader fadeg fadeb fadec
	
	//state TimeClock
	
	//ife fpscont 1
	{
		ifg fadec 0
			sub fadec fades
			
		ifl fadec 0
			set fadec 0
	}

ends

defstate FadeInScreen

	screenpal fader fadeg fadeb fadec
	
	//state TimeClock
	
	//ife fpscont 1
	{
		ifl fadec 255
			add fadec fades
			
		ifg fadec 255
			set fadec 255
	}
	
ends

defstate CSFadeOutScreen

	screenpal fader fadeg fadeb fadec
	
		ifg fadec 0
			sub fadec fades
			
		ifl fadec 0
			set fadec 0

ends

defstate CSFadeInScreen

	screenpal fader fadeg fadeb fadec
	
		ifl fadec 255
			add fadec fades
			
		ifg fadec 255
			set fadec 255
	
ends

defstate EPSortScores

	set t_temp 0
	whilen t_temp 8
	{
		set t_temp2 0
		whilen t_temp2 16
		{
			set t_temp3	0
			whilen t_temp3 4
			{
				set t_temp4 72
				mul t_temp4 t_temp2
				add t_temp4 t_temp3
				add t_temp4 66
				
				//Greater than the current score
				ifl sortedscores[t_temp] record_scores[t_temp4]
				{
					///Must be less than the last one
					ifg t_temp 0
					{
						set t_temp5 t_temp
						sub t_temp5 1
						
						ifg sortedscores[t_temp5] record_scores[t_temp4]
						{
							setarray sortedscores[t_temp] record_scores[t_temp4]
							setarray sortedscores_t[t_temp] t_temp3
							setarray sortedscores_ids[t_temp] t_temp2
						}
					}
					else
					{
						setarray sortedscores[t_temp] record_scores[t_temp4]
						setarray sortedscores_t[t_temp] t_temp3
						setarray sortedscores_ids[t_temp] t_temp2
					}
				}
				
				add t_temp3 1
			}
		
			add t_temp2 1
		}

		add t_temp 1
	}

ends

//Specific episode
//set t_temp3 to the episode number
defstate EP_SPC_SortScores

	set t_temp 0
	whilen t_temp 8
	{
		set t_temp2 0
		whilen t_temp2 16
		{
			set t_temp4 72
			mul t_temp4 t_temp2
			add t_temp4 t_temp3
			add t_temp4 66
			
			//Greater than the current score
			ifl sortedscores[t_temp] record_scores[t_temp4]
			{
				///Must be less than the last one
				ifg t_temp 0
				{
					set t_temp5 t_temp
					sub t_temp5 1
						
					ifg sortedscores[t_temp5] record_scores[t_temp4]
					{
						setarray sortedscores[t_temp] record_scores[t_temp4]
						setarray sortedscores_t[t_temp] t_temp3
						setarray sortedscores_ids[t_temp] t_temp2
					}
				}
				else
				{
					setarray sortedscores[t_temp] record_scores[t_temp4]
					setarray sortedscores_t[t_temp] t_temp3
					setarray sortedscores_ids[t_temp] t_temp2
				}
			}
		
			add t_temp2 1
		}
		
		add t_temp 1
	}

ends

defstate LVLSortScores

	set t_temp 0
	whilen t_temp 8
	{
		set t_temp2 0
		whilen t_temp2 16
		{
			set t_temp3	0
			whilen t_temp3 60
			{
				set t_temp4 72
				mul t_temp4 t_temp2
				add t_temp4 t_temp3
				
				//Greater than the current score
				ifl sortedscores[t_temp] record_scores[t_temp4]
				{
					///Must be less than the last one
					ifg t_temp 0
					{
						set t_temp5 t_temp
						sub t_temp5 1
						
						ifg sortedscores[t_temp5] record_scores[t_temp4]
						{
							setarray sortedscores[t_temp] record_scores[t_temp4]
							setarray sortedscores_t[t_temp] t_temp3
							setarray sortedscores_ids[t_temp] t_temp2
						}
					}
					else
					{
						setarray sortedscores[t_temp] record_scores[t_temp4]
						setarray sortedscores_t[t_temp] t_temp3
						setarray sortedscores_ids[t_temp] t_temp2
					}
				}
				
				add t_temp3 1
			}
		
			add t_temp2 1
		}
		
		add t_temp 1
	}

ends

//Specific level
//set t_temp3 to the level number
defstate LVL_SPC_SortScores

	set t_temp 0
	whilen t_temp 8
	{
		set t_temp2 0
		whilen t_temp2 16
		{
			set t_temp4 72
			mul t_temp4 t_temp2
			add t_temp4 t_temp3
			
			//Greater than the current score
			ifl sortedscores[t_temp] record_scores[t_temp4]
			{
				///Must be less than the last one
				ifg t_temp 0
				{
					set t_temp5 t_temp
					sub t_temp5 1
						
					ifg sortedscores[t_temp5] record_scores[t_temp4]
					{
						setarray sortedscores[t_temp] record_scores[t_temp4]
						setarray sortedscores_t[t_temp] t_temp3
						setarray sortedscores_ids[t_temp] t_temp2
					}
				}
				else
				{
					setarray sortedscores[t_temp] record_scores[t_temp4]
					setarray sortedscores_t[t_temp] t_temp3
					setarray sortedscores_ids[t_temp] t_temp2
				}
			}
		
			add t_temp2 1
		}
		
		add t_temp 1
	}

ends

defstate CheckIfSlotsWereUsed
	
	qstrcpy RQUOTE SLOTFILE
	readarrayfromfile s_slotused RQUOTE
	
	set t_temp 0
	set t_temp2 0
	
	whilen t_temp 6
	{
		ife s_slotused[t_temp] 1
		{
			set t_temp2 1
			set t_temp 6
		}
		else
			add t_temp 1
	}

ends

defstate ClearScore

	set t_temp 0
	whilen t_temp 72
	{
		set t_temp2 72
		mul t_temp2 score_id
		add t_temp t_temp2
		
		setarray record_scores[t_temp] 0
		
		sub t_temp t_temp2
		
		ifl t_temp 6
		{
			set t_temp2 6
			mul t_temp2 score_id
			add t_temp t_temp2
			
			setarray ep_deaths[t_temp] 0
		}
		
		add t_temp 1
	}

ends

onevent EVENT_MAINMENUSCREEN

	set title 0
	set fadec 255
	set title_count 600
	set fades 8
	set t_temp 0
	set t_temp2 0
	set skip_count 0
	set precacher 3584
	
	readgamevar EPLOCK
	readgamevar score_id
	
	state RandomSeedGen
	
	ife score_id -2
	{
		set score_id -1
		savegamevar score_id
		
		qstrcpy RQUOTE NAMESFILE
		writequotestofile RQUOTE 9000 9015
		
		set t_temp 0
		whilen t_temp 1152
		{
			rand t_temp3 32768
		
			set t_temp2 t_temp
			mod t_temp2 72
			
			ifge t_temp2 66
			{
				rand t_temp2 32768
				mul t_temp3 t_temp2
			}
			
			setarray record_scores[t_temp] t_temp3
			
			add t_temp 1
		}
		
		qstrcpy RQUOTE SCOREFILE
		writearraytofile record_scores RQUOTE
	}
	else
	{
		//Load slots used
		state CheckIfSlotsWereUsed
		
		//Load score names
		qstrcpy RQUOTE NAMESFILE
		readquotesfromfile RQUOTE 9000 9015 YES
	}
	
	//Load scores
	qstrcpy RQUOTE SCOREFILE
	readarrayfromfile record_scores RQUOTE
			
	startscreen
	set startMenu 0
	set startMenuTime 0

	ife enable_nuke 0
	{
		ifg EP4LOCKS 0x1F
		ifg EP42LOCKS 0x1F
		{
			set enable_nuke 1
			setu[].enable_nuke enable_nuke
			savegamevar enable_nuke
			set title 9999
			set fadec 254
			set skipend 0
			startscreen
		}
	}

endevent

var endingscene 0 0

onevent EVENT_SCREEN

	ife endgame 3
	{
		ife BOSSFIGHT_LEVEL 1
			set endingscene 0
		else ife BOSSFIGHT_LEVEL 2
			set endingscene 1
		else ife userdef.player_skill 6
			set endingscene 1
	
		ife endingscene 0
		{	
			rotatesprite 0 50 SIZE1X 0 VICTORY1 0 0 88 0 0 xdim ydim
			set t_temp 0
			
			set ratebase endcounter
			mul ratebase 10
			div ratebase framerate
			
			ifl ratebase 37
				set t_temp 1
			
			ifge ratebase 62
				set t_temp 1
			
			ifg ratebase 32
			ifl ratebase 65
			{
				set t_temp3 VICTORY1
				add t_temp3 2
				
				set t_temp2 ratebase
				sub t_temp2 32
				
				ifle t_temp2 10
					add t_temp3 1
				else ifge t_temp2 18
				ifl t_temp2 21
					add t_temp3 2
				else ifge t_temp2 21
				ifl t_temp2 24
					add t_temp3 3
				else ifge t_temp2 24
				ifl t_temp2 27
					add t_temp3 4
				else ifge t_temp2 27
				ifl t_temp2 30
					add t_temp3 5
				else ifge t_temp2 30
				ifle t_temp2 33
					add t_temp3 6
					
				ifg t_temp2 10
				ifl t_temp2 18
					nullop
				else
					rotatesprite 86 59 SIZE1X 0 t_temp3 0 0 88 0 0 xdim ydim
			}
			
			ife ratebase 5
			ife t_temp4 0
			{
				add t_temp4 1  
				screensound BOSSTALKTODUKE
			}
				
			ife ratebase 50
			ife t_temp4 1
			{
				add t_temp4 1
				screensound SHOTGUN_FIRE
				screensound SQUISHED
			}
				
			ife ratebase 66
			ife t_temp4 2
			{
				add t_temp4 1
				screensound DUKETALKTOBOSS
			}
			
			ife t_temp 1
			{
				set t_temp ratebase
				div t_temp 5
				set t_temp2 t_temp
				
				mod t_temp 2
				
				set t_temp3 VICTORY1
				
				ifge ratebase 62
				{
					add t_temp3 8
					rotatesprite 86 59 SIZE1X 0 t_temp3 0 0 88 0 0 xdim ydim
					sub t_temp3 8
				}
				
				ifn t_temp 0
				{
					add t_temp3 1
					
					mod t_temp2 3
					
					ife t_temp2 0
						add t_temp3 1
					
					rotatesprite 176 59 SIZE1X 0 t_temp3 0 0 88 0 0 xdim ydim
				}
			}
			
			ife skipend 1
			{
				set t_temp framerate
				mul t_temp 19
				set endcounter t_temp
				set skipend 2
			}
			
			ifl endcounter 32
				state FadeOutScreen
			
			ifge ratebase 189
				state FadeInScreen
			
			ifl ratebase 200
				add endcounter 1
				
			ife ratebase 200
			{
				set endgame 4
				set endcounter 0
				set t_temp4 0
				set fades 4
				stopallsounds
				set skipend 0
			}
		}
		else
		{
			set t_temp 3305
			
			set t_temp2 totalclock
			sub t_temp2 ratebase
			
			ifl t_temp2 480
			{
				set t_temp3 t_temp2
				div t_temp3 60
				
				mod t_temp3 2
				
				ife t_temp3 0
					add t_temp 1
			}
			else ifge t_temp2 480
			ifl t_temp2 520
				add t_temp 2
			else ifge t_temp2 520
			ifl t_temp2 560
				add t_temp 3
			else ifge t_temp2 560
			ifl t_temp2 600
				add t_temp 4
			else ifge t_temp2 600
			ifl t_temp2 640
				add t_temp 5
			else ifge t_temp2 640
			ifl t_temp2 680
				add t_temp 6
			else ifge t_temp2 680
			ifl t_temp2 720
				add t_temp 7
			else ifge t_temp2 720
			ifl t_temp2 760
				add t_temp 8
			else ifge t_temp2 760
			{
				add t_temp 9
				
				set t_temp3 t_temp2
				div t_temp3 60
				
				mod t_temp3 2
				
				ife t_temp3 0
					add t_temp 1
			}
			
			ifg t_temp2 560
			ife t_temp4 0
			{
				add t_temp4 1
				screensound SHOTGUN_FIRE
				screensound SQUISHED
			}
			
			ifg t_temp2 680
			ife t_temp4 1
			{
				add t_temp4 1
				screensound SHOTGUN_COCK
				screensound DUKETALKTOBOSS
			}
			
			rotatesprite 0 0 65536 0 t_temp 0 0 88 0 0 xdim ydim
			
			ife skipend 1
			{
				set endcounter 119
				set skipend 2
			}
			
			ifl endcounter 120
			ifg endcounter 0
			{
				sub endcounter 1 
				state FadeInScreen
			}
			
			ifl t_temp2 120
				state FadeOutScreen
				
			ife endcounter 0
			{
				set endgame 4
				set endcounter 0
				set t_temp4 0
				set fades 4
				stopallsounds
				set skipend 0
			}
		}
	}
	else ife endgame 4
	{
		ifg fadec 254
			setp[].palette 0
		
		rotatesprite 160 100 SIZE1X 0 3292 0 0 8 0 0 xdim ydim
		
		ifg fadec 0
		ife skipend 0
			state FadeOutScreen
		
		ife skipend 1
			set skipend 2
		else ife skipend 2
			state FadeInScreen
			
		ifg fadec 254
		{
			set endgame 5
			set skipend 0
			set fadec 0
			set t_temp 64
			set t_temp2 127
			set t_temp3 127
			set t_temp4 127
			screensound PIPEBOMB_EXPLODE
			set fades 8
			set endcounter 0
		}
	}
	else ife endgame 5
	{
		ife t_temp 64
			state FadeOutScreen
	
		redefinequote RQUOTE ALL LEVELS OF EPISODE 1 ARE UNLOCKED
		screentext STARTALPHANUM 160 88 SIZE1X 0 0 RQUOTE t_temp 0 8 0 5 8 0 0 10 0 0 xdim ydim 
		
		redefinequote RQUOTE NOW PREPARE YOURSELF TO FIGHT
		screentext STARTALPHANUM 160 100 SIZE1X 0 0 RQUOTE t_temp2 0 8 0 5 8 0 0 10 0 0 xdim ydim 
		
		redefinequote RQUOTE IN THE COSMIC WASTELAND OF
		screentext STARTALPHANUM 160 112 SIZE1X 0 0 RQUOTE t_temp3 0 8 0 5 8 0 0 10 0 0 xdim ydim 
		
		redefinequote RQUOTE LUNAR APOCALYPSE
		screentext BIGALPHANUM 160 136 SIZE1X 0 0 RQUOTE t_temp4 0 8 0 5 16 0 0 1048586 0 0 xdim ydim
		
		ifg t_temp 0
			sub t_temp 1
			
		ife t_temp 0
		ifg t_temp2 0
			sub t_temp2 1
			
		ife t_temp2 0
		ifg t_temp3 0
			sub t_temp3 1
			
		ife t_temp3 0
		ifg t_temp4 0
			sub t_temp4 1
		
		ife skipend 1
			set skipend 2
		else ife skipend 2
		{
			set t_temp 0
			set t_temp2 0
			set t_temp3 0
			set t_temp4 0
			state FadeInScreen
		}
			
		ifg fadec 254
		{
			set endgame 6
			set skipend 0
			set RETURN 1
		}
	}
	else ife endgame 10
	{
		redefinequote RQUOTE movies/CINEOV2.ANM
		startcutscene RQUOTE
		
		screensound PIPEBOMB_EXPLODE
		set endgame 11
		set fadec 254
		set fades 1
		set RETURN 0
	}
	else ife endgame 11
	{
		rotatesprite 160 100 SIZE1X 0 3293 0 0 8 0 0 xdim ydim
		
		ifg fadec 0
		ife skipend 0
			state FadeOutScreen
		
		ife skipend 1
			set skipend 2
		else ife skipend 2
			state FadeInScreen
			
		ifg fadec 254
		ife skipend 2
		{
			set endgame 12
			set skipend 0
			set fadec 0
			set t_temp 64
			set t_temp2 127
			set t_temp3 127
			set t_temp4 127
			screensound PIPEBOMB_EXPLODE
			set fades 8
			set endcounter 0
		}
	}
	else ife endgame 12
	{
		ife t_temp 64
			state FadeOutScreen
	
		redefinequote RQUOTE ALL LEVELS OF EPISODE 2 ARE UNLOCKED
		screentext STARTALPHANUM 160 88 SIZE1X 0 0 RQUOTE t_temp 0 8 0 5 8 0 0 10 0 0 xdim ydim 
		
		redefinequote RQUOTE THE TIME HAS COME.
		screentext STARTALPHANUM 160 100 SIZE1X 0 0 RQUOTE t_temp2 0 8 0 5 8 0 0 10 0 0 xdim ydim 
		
		redefinequote RQUOTE THE BATTLE IS ABOUT TO BEGIN AT
		screentext STARTALPHANUM 160 112 SIZE1X 0 0 RQUOTE t_temp3 0 8 0 5 8 0 0 10 0 0 xdim ydim 
		
		redefinequote RQUOTE SHRAPNEL CITY
		screentext BIGALPHANUM 160 136 SIZE1X 0 0 RQUOTE t_temp4 0 8 0 5 16 0 0 1048586 0 0 xdim ydim
		
		ifg t_temp 0
			sub t_temp 1
			
		ife t_temp 0
		ifg t_temp2 0
			sub t_temp2 1
			
		ife t_temp2 0
		ifg t_temp3 0
			sub t_temp3 1
			
		ife t_temp3 0
		ifg t_temp4 0
			sub t_temp4 1
		
		ife skipend 1
			set skipend 2
		else ife skipend 2
		{
			set t_temp 0
			set t_temp2 0
			set t_temp3 0
			set t_temp4 0
			state FadeInScreen
		}
			
		ifg fadec 254
		{
			set endgame 6
			set skipend 0
			set RETURN 1
		}
	}
	else ife endgame 30
	{
		redefinequote RQUOTE VOL4E1.ANM
		startcutscene RQUOTE
		
		redefinequote RQUOTE VOL4E2.ANM
		startcutscene RQUOTE
		
		redefinequote RQUOTE VOL4E3.ANM
		startcutscene RQUOTE
		
		set title_count 0
		
		stopallsounds
		rotatesprite 160 100 65536 0 3281 32 4 MENUBIT 0 0 xdim ydim
		screensound PIPEBOMB_EXPLODE
		set endgame 14
		set skipend 0
		set fadec 0
		set t_temp 64
		set t_temp2 127
		set t_temp3 127
		set t_temp4 127
		set fades 8
		set endcounter 0
		screensound ENDSEQVOL3SND4
		setp[].palette 0
	}
	else ife endgame 13
	{
		redefinequote RQUOTE CINEOV3.ANM
		startcutscene RQUOTE
		
		set title_count 0
		
		redefinequote RQUOTE RADLOGO.ANM
		startcutscene RQUOTE
		stopallsounds
		rotatesprite 160 100 65536 0 3281 32 4 MENUBIT 0 0 xdim ydim
		screensound PIPEBOMB_EXPLODE
		set endgame 31
		set skipend 0
		set fadec 0
		set t_temp 64
		set t_temp2 127
		set t_temp3 127
		set t_temp4 127
		set fades 8
		set endcounter 0
		//screensound ENDSEQVOL3SND4
	}
	else ife endgame 31
	{
		ife t_temp 64
			state FadeOutScreen
	
		redefinequote RQUOTE ALL LEVELS OF EPISODE 3 ARE UNLOCKED
		screentext STARTALPHANUM 160 88 SIZE1X 0 0 RQUOTE t_temp 0 8 0 5 8 0 0 10 0 0 xdim ydim 
		
		redefinequote RQUOTE GET YOURSELF READY
		screentext STARTALPHANUM 160 100 SIZE1X 0 0 RQUOTE t_temp2 0 8 0 5 8 0 0 10 0 0 xdim ydim 
		
		redefinequote RQUOTE DUKE IS ABOUT TO GO TOTAL MELTDOWN IN
		screentext STARTALPHANUM 160 112 SIZE1X 0 0 RQUOTE t_temp3 0 8 0 5 8 0 0 10 0 0 xdim ydim 
		
		redefinequote RQUOTE THE BIRTH
		screentext BIGALPHANUM 160 136 SIZE1X 0 0 RQUOTE t_temp4 0 8 0 5 16 0 0 1048586 0 0 xdim ydim
		
		ifg t_temp 0
			sub t_temp 1
			
		ife t_temp 0
		ifg t_temp2 0
			sub t_temp2 1
			
		ife t_temp2 0
		ifg t_temp3 0
			sub t_temp3 1
			
		ife t_temp3 0
		ifg t_temp4 0
			sub t_temp4 1
		
		ife skipend 1
			set skipend 2
		else ife skipend 2
		{
			set t_temp 0
			set t_temp2 0
			set t_temp3 0
			set t_temp4 0
			state FadeInScreen
		}
			
		ifg fadec 254
		{
			set endgame 6
			set skipend 0
			set RETURN 1
		}
	}
	else ife endgame 14
	{
		ife t_temp 64
			state FadeOutScreen
	
		redefinequote RQUOTE THANK YOU FOR PLAYING
		screentext STARTALPHANUM 160 76 SIZE1X 0 0 RQUOTE t_temp 0 8 0 5 8 0 0 10 0 0 xdim ydim 
		
		redefinequote RQUOTE DUKE NUKEM 3D LEGACY EDITION
		screentext STARTALPHANUM 160 88 SIZE1X 0 0 RQUOTE t_temp 0 8 0 5 8 0 0 10 0 0 xdim ydim 
		
		redefinequote RQUOTE HOPE YOU ALL LIKE IT!
		screentext STARTALPHANUM 160 100 SIZE1X 0 0 RQUOTE t_temp2 0 8 0 5 8 0 0 10 0 0 xdim ydim 
		
		redefinequote RQUOTE NUKE MODE IS UNLOCKED NOW
		screentext STARTALPHANUM 160 112 SIZE1X 0 0 RQUOTE t_temp3 0 8 0 5 8 0 0 10 0 0 xdim ydim 
		
		redefinequote RQUOTE CHECK THE SECOND PAGE OF THE GAME SETUP MENU
		screentext STARTALPHANUM 160 124 SIZE1X 0 0 RQUOTE t_temp3 0 8 0 5 8 0 0 10 0 0 xdim ydim 
		
		ifg t_temp 0
			sub t_temp 1
			
		ife t_temp 0
		ifg t_temp2 0
			sub t_temp2 1
			
		ife t_temp2 0
		ifg t_temp3 0
			sub t_temp3 1
			
		ife t_temp3 0
		ifg t_temp4 0
			sub t_temp4 1
		
		ife skipend 1
			set skipend 2
		else ife skipend 2
		{
			set t_temp 0
			set t_temp2 0
			set t_temp3 0
			set t_temp4 0
			state FadeInScreen
		}
			
		ifg fadec 254
		{
			set endgame 15
			set skipend 0
			
			set t_temp2 ydim
			div t_temp2 120
			set t_temp 0
			
			set t_temp3 840
			//set RETURN 1
		}
	}
	else ife endgame 15
	{
		rotatesprite HALFX HALFY SIZE1X 0 MENUSCREEN 16 0 8 0 0 xdim ydim
		
		qputs RQUOTE CREDITS
		screentext STARTALPHANUM HALFX 20 SIZE1X 0 0 RQUOTE 0 0 8 0 5 8 0 0 10 0 0 xdim ydim 
		
		
		qputs RQUOTE CONCEPT AND DEVELOPMENT BY
		screentext STARTALPHANUM HALFX 40 SIZE1X 0 0 RQUOTE 0 0 8 0 5 8 0 0 10 0 0 xdim ydim 
		
		qputs RQUOTE MARCOS
		screentext MINIFONT HALFX 46 SIZE1X 0 0 RQUOTE 0 8 8 0 4 6 1 1 10 0 0 xdim ydim 
		
		
		qputs RQUOTE BETA ENFORCERS AND PIG COP ART BY
		screentext STARTALPHANUM HALFX 70 SIZE1X 0 0 RQUOTE 0 0 8 0 5 8 0 0 10 0 0 xdim ydim 
		
		qputs RQUOTE CAGE
		screentext MINIFONT HALFX 76 SIZE1X 0 0 RQUOTE 0 8 8 0 4 6 1 1 10 0 0 xdim ydim 
		
		
		qputs RQUOTE BETA OVERLORD, PIGCOP, SHOTGUN,
		screentext STARTALPHANUM HALFX 100 SIZE1X 0 0 RQUOTE 0 0 8 0 5 8 0 0 10 0 0 xdim ydim 
		
		qputs RQUOTE SONIC RES. ART AND LEGACY UPSCALE BY
		screentext STARTALPHANUM HALFX 112 SIZE1X 0 0 RQUOTE 0 0 8 0 5 8 0 0 10 0 0 xdim ydim 
		
		qputs RQUOTE MARCOS
		screentext MINIFONT HALFX 118 SIZE1X 0 0 RQUOTE 0 8 8 0 4 6 1 1 10 0 0 xdim ydim 
		
		
		qputs RQUOTE DUKE NUKEM 3D UPSCALE PACK BY
		screentext STARTALPHANUM HALFX 140 SIZE1X 0 0 RQUOTE 0 0 8 0 5 8 0 0 10 0 0 xdim ydim 
		
		qputs RQUOTE PHREDREEKE
		screentext MINIFONT HALFX 146 SIZE1X 0 0 RQUOTE 0 8 8 0 4 6 1 1 10 0 0 xdim ydim 
		
		
		qputs RQUOTE MUSIC BY
		screentext STARTALPHANUM HALFX 170 SIZE1X 0 0 RQUOTE 0 0 8 0 5 8 0 0 10 0 0 xdim ydim 
		
		qputs RQUOTE MIKE NORVAK, LEE JACKSON, BRANDOM BLUME, VERTEX GUY (OVERLORD FIGHT),
		screentext MINIFONT HALFX 176 SIZE1X 0 0 RQUOTE 0 8 8 0 4 6 1 1 10 0 0 xdim ydim 
		
		qputs RQUOTE ANDREW HULSHULT (CYCLOID FIGHT), CAPTAIN MEATSHIELD (QUEEN FIGHT)
		screentext MINIFONT HALFX 182 SIZE1X 0 0 RQUOTE 0 8 8 0 4 6 1 1 10 0 0 xdim ydim 
		
		rotatesprite HALFX HALFY SIZE1X 0 MENUSCREEN 16 0 8 0 t_temp xdim ydim
		
		ife skipend 0
		ifl t_temp ydim
			add t_temp t_temp2
		
		ifg t_temp3 0
			sub t_temp3 1
			
		ifl t_temp3 1
		ife skipend 0
			set skipend 1
		
		ifg fadec 0
		ife skipend 0
			state FadeOutScreen
		
		ife skipend 1
			set skipend 2
		else ife skipend 2
		{
			ifg t_temp 0
				sub t_temp t_temp2
			else
			{
				set endgame 16
				set t_temp3 840
				set skipend 0
			}
		}
	}
	else ife endgame 16
	{
		rotatesprite HALFX HALFY SIZE1X 0 MENUSCREEN 16 0 8 0 0 xdim ydim
		
		qputs RQUOTE CREDITS
		screentext STARTALPHANUM HALFX 20 SIZE1X 0 0 RQUOTE 0 0 8 0 5 8 0 0 10 0 0 xdim ydim 
		
		qputs RQUOTE DUKE NUKEM 3D VOXEL PACK BY
		screentext STARTALPHANUM HALFX 40 SIZE1X 0 0 RQUOTE 0 0 8 0 5 8 0 0 10 0 0 xdim ydim 
		
		qputs RQUOTE REAPERMAN AND DUKE4.NET COMMUNITY
		screentext MINIFONT HALFX 46 SIZE1X 0 0 RQUOTE 0 8 8 0 4 6 1 1 10 0 0 xdim ydim 
		
		qputs RQUOTE BIG THANKS TO
		screentext STARTALPHANUM HALFX 70 SIZE1X 0 0 RQUOTE 0 0 8 0 5 8 0 0 10 0 0 xdim ydim 
		
		qputs RQUOTE TERMINX, HENDRICKS256 AND EVERYONE ENVOLVED
		screentext MINIFONT HALFX 76 SIZE1X 0 0 RQUOTE 0 8 8 0 4 6 1 1 10 0 0 xdim ydim 
		
		qputs RQUOTE FOR SHOWING BETA AND ALPHA CONTENT TO THE COMMUNITY
		screentext STARTALPHANUM HALFX 84 32768 0 0 RQUOTE 0 0 8 0 5 8 0 0 10 0 0 xdim ydim 
		
		qputs RQUOTE AND DEVELOPING THIS AWESOME PORT
		screentext STARTALPHANUM HALFX 88 32768 0 0 RQUOTE 0 0 8 0 5 8 0 0 10 0 0 xdim ydim 
		
		
		qputs RQUOTE TO THE ENTIRE COMMUNITY
		screentext STARTALPHANUM HALFX 100 SIZE1X 0 0 RQUOTE 0 0 8 0 5 8 0 0 10 0 0 xdim ydim 
		
		qputs RQUOTE THANK YOU ALL FOR KEEPING THIS GAME ALIVE
		screentext MINIFONT HALFX 106 SIZE1X 0 0 RQUOTE 0 8 8 0 4 6 1 1 10 0 0 xdim ydim 
		
		
		qputs RQUOTE TO MY WIFE LANA
		screentext STARTALPHANUM HALFX 130 SIZE1X 0 0 RQUOTE 0 0 8 0 5 8 0 0 10 0 0 xdim ydim 
		
		qputs RQUOTE THANK YOU FOR ALWAYS INSPIRING AND MOTIVATING ME
		screentext MINIFONT HALFX 136 SIZE1X 0 0 RQUOTE 0 8 8 0 4 6 1 1 10 0 0 xdim ydim 
		
		qputs RQUOTE SPECIAL THANKS TO
		screentext STARTALPHANUM HALFX 160 SIZE1X 0 0 RQUOTE 0 0 8 0 5 8 0 0 10 0 0 xdim ydim 
		
		qputs RQUOTE MRJOHNREVIEWS
		screentext MINIFONT HALFX 166 SIZE1X 0 0 RQUOTE 0 8 8 0 4 6 1 1 10 0 0 xdim ydim 
		
		
		qputs RQUOTE AND THANK YOU (AGAIN)
		screentext STARTALPHANUM HALFX 185 SIZE1X 0 0 RQUOTE 0 0 8 0 5 8 0 0 10 0 0 xdim ydim 
		
		qputs RQUOTE FOR PLAYING THIS MOD
		screentext MINIFONT HALFX 191 SIZE1X 0 0 RQUOTE 0 8 8 0 4 6 1 1 10 0 0 xdim ydim 
		
		
		rotatesprite HALFX HALFY SIZE1X 0 MENUSCREEN 16 0 8 0 t_temp xdim ydim
		
		ife skipend 0
		ifl t_temp ydim
			add t_temp t_temp2
		
		ifg t_temp3 0
			sub t_temp3 1
			
		ifl t_temp3 1
		ife skipend 0
			set skipend 1
		
		ifg fadec 0
		ife skipend 0
			state FadeOutScreen
		
		ife skipend 1
			set skipend 2
		else ife skipend 2
			state FadeInScreen
		
		ifg fadec 254
		{
			set endgame 100
			set t_temp3 720
			//set RETURN 1
			set skipend 0
		}
	}
	else ife endgame 100
	{
		rotatesprite HALFX HALFY SIZE1X 0 MENUSCREEN 16 0 8 0 0 xdim ydim
		
		qputs RQUOTE IN LOVING MEMORY OF
		screentext STARTALPHANUM HALFX 20 SIZE1X 0 0 RQUOTE 0 0 8 0 5 8 0 0 10 0 0 xdim ydim 
		
		qputs RQUOTE ROMEU
		screentext STARTALPHANUM HALFX 30 SIZE1X 0 0 RQUOTE 0 0 8 0 5 8 0 0 10 0 0 xdim ydim 
		
		rotatesprite 160 100 11264 0 BESTCATEVER 0 0 8 0 0 xdim ydim
		
		qputs RQUOTE THE BEST CAT AND MY DEAREST FRIEND EVER
		screentext STARTALPHANUM HALFX 180 SIZE1X 0 0 RQUOTE 0 0 8 0 5 8 0 0 10 0 0 xdim ydim 
		
		ifg t_temp3 0
			sub t_temp3 1
			
		ifl t_temp3 1
		ife skipend 0
			set skipend 1
		
		ifg fadec 0
		ife skipend 0
			state FadeOutScreen
		
		ife skipend 1
			set skipend 2
		else ife skipend 2
			state FadeInScreen
		
		ifg fadec 254
		{
			set endgame 17
			//set RETURN 1
			set t_temp3 360
			set skipend 0
		}
	}
	else ife endgame 17
	{
		rotatesprite HALFX HALFY SIZE1X 0 2504 0 0 8 0 0 xdim ydim
		
		ifg t_temp3 0
			sub t_temp3 1
			
		ifl t_temp3 1
		ife skipend 0
			set skipend 1
		
		ifg fadec 0
		ife skipend 0
			state FadeOutScreen
		
		ife skipend 1
			set skipend 2
		else ife skipend 2
			state FadeInScreen
		
		ifg fadec 254
		{
			set endgame 18
			//set RETURN 1
			set t_temp3 360
			set skipend 0
		}
	}
	else ife endgame 18
	{
		rotatesprite HALFX HALFY SIZE1X 0 2505 0 0 8 0 0 xdim ydim
		
		ifg t_temp3 0
			sub t_temp3 1
			
		ifl t_temp3 1
		ife skipend 0
			set skipend 1
		
		ifg fadec 0
		ife skipend 0
			state FadeOutScreen
		
		ife skipend 1
			set skipend 2
		else ife skipend 2
			state FadeInScreen
		
		ifg fadec 254
		{
			set endgame 19
			//set RETURN 1
			set t_temp3 360
			set skipend 0
		}
	}
	else ife endgame 19
	{
		rotatesprite HALFX HALFY SIZE1X 0 2506 0 0 8 0 0 xdim ydim
		
		ifg t_temp3 0
			sub t_temp3 1
			
		ifl t_temp3 1
		ife skipend 0
			set skipend 1
		
		ifg fadec 0
		ife skipend 0
			state FadeOutScreen
		
		ife skipend 1
			set skipend 2
		else ife skipend 2
			state FadeInScreen
		
		ifg fadec 254
		{
			ife current_menu MENU_CREDITS
			{
				screenpal 0 0 0 0
				set endgame 6
				set RETURN 1
			}
			else
			{
				set endgame 20
				//set RETURN 1
				set t_temp3 360
				set skipend 0
			}
		}
	}
	else ife endgame 20
	{
		rotatesprite HALFX HALFY SIZE1X 0 MENUSCREEN 16 0 8 0 0 xdim ydim
		credits MENU_CREDITS4
		
		ifg t_temp3 0
			sub t_temp3 1
			
		ifl t_temp3 1
		ife skipend 0
			set skipend 1
		
		ifg fadec 0
		ife skipend 0
			state FadeOutScreen
		
		ife skipend 1
			set skipend 2
		else ife skipend 2
			state FadeInScreen
		
		ifg fadec 254
		{
			set endgame 21
			//set RETURN 1
			set t_temp3 360
			set skipend 0
		}
	}
	else ife endgame 21
	{
		rotatesprite HALFX HALFY SIZE1X 0 MENUSCREEN 16 0 8 0 0 xdim ydim
		credits MENU_CREDITS5
		
		ifg t_temp3 0
			sub t_temp3 1
			
		ifl t_temp3 1
		ife skipend 0
			set skipend 1
		
		ifg fadec 0
		ife skipend 0
			state FadeOutScreen
		
		ife skipend 1
			set skipend 2
		else ife skipend 2
			state FadeInScreen
		
		ifg fadec 254
		{
			screenpal 0 0 0 0
			set endgame 6
			set RETURN 1
			//set t_temp3 360
			set skipend 0
		}
	}
	else
	{
		ife title 9999
		{
			ife userdef.on_mobile 1
				set t_temp4 3584
			else
			{
				set t_temp2 300
				div t_temp2 44
				
				ifg totalclock menu_next_frame
				{
					sub MENU_TILE_CURR 1
					set menu_next_frame totalclock
					add menu_next_frame t_temp2
				}
				else
				{
					set t_temp menu_next_frame
					sub t_temp totalclock
					ifg t_temp 480
					{
						set menu_next_frame totalclock
						add menu_next_frame t_temp2
					}
				}
		
				set t_temp4 MENU_TILE_CURR
				
				set t_temp MENUBG
				sub t_temp 44
				
				ife MENU_TILE_CURR t_temp
					set MENU_TILE_CURR MENUBG
			}	
			
			set t_temp ydim
			set t_temp2 24
			mul t_temp2 400
			div t_temp2 200
			mul t_temp2 ydim
			div t_temp2 100
			
			rotatesprite HALFX HALFY SIZE1X 0 t_temp4 0 0 8 0 0 xdim ydim
			
			qputs RQUOTE YOU'VE UNLOCKED NUKE MODE
			screentext STARTALPHANUM 161 89 32768 0 0 RQUOTE 32 4 8 0 5 8 0 0 10 0 0 xdim ydim 
			screentext STARTALPHANUM HALFX 88 32768 0 0 RQUOTE 0 0 8 0 5 8 0 0 10 0 0 xdim ydim 
			
			qputs RQUOTE GET TO THE SECOND PAGE OF THE GAME SETUP MENU
			screentext STARTALPHANUM 161 96 32768 0 0 RQUOTE 32 4 8 0 5 8 0 0 10 0 0 xdim ydim 
			screentext STARTALPHANUM HALFX 95 32768 0 0 RQUOTE 0 0 8 0 5 8 0 0 10 0 0 xdim ydim 
			
			qputs RQUOTE AND SET UP THE GAME THE WAY YOU WANT PLAY!
			screentext STARTALPHANUM 161 103 32768 0 0 RQUOTE 32 4 8 0 5 8 0 0 10 0 0 xdim ydim 
			screentext STARTALPHANUM HALFX 102 32768 0 0 RQUOTE 0 0 8 0 5 8 0 0 10 0 0 xdim ydim 
			
			qputs RQUOTE DON'T FORGET TO CHECK OUT THE USER CONTENT MENU
			screentext STARTALPHANUM 161 110 32768 0 0 RQUOTE 32 4 8 0 5 8 0 0 10 0 0 xdim ydim 
			screentext STARTALPHANUM HALFX 109 32768 0 0 RQUOTE 0 0 8 0 5 8 0 0 10 0 0 xdim ydim 
			
			qputs RQUOTE PRESS ANY KEY TO CONTINUE
			screentext STARTALPHANUM 161 123 54000 0 0 RQUOTE 32 4 8 0 5 8 0 0 10 0 0 xdim ydim 
			screentext STARTALPHANUM HALFX 122 54000 0 0 RQUOTE 0 1 8 0 5 8 0 0 10 0 0 xdim ydim 
			
			ifg fadec 0
			ife skipend 0
				state FadeOutScreen
			
			ife skipend 1
				set skipend 2
			else ife skipend 2
				state FadeInScreen
			
			ifg fadec 254
			{
				screenpal 0 0 0 0
				set title 8
				set RETURN 1
				set skipend 1
			}
		}
		else ife title 0
		{
			setp[].palette 0
		
			ifg title_count 120
			{
				ife title_count 600
				{
					ife  userdef.upscaledtextures 1
					{
						//Preload area
						rotatesprite 320 200 65536 0 2493 32 60 74 0 0 xdim ydim  //TITLE SCREEN
						rotatesprite 320 200 65536 0 precacher 32 60 74 0 0 xdim ydim
						
						set t_temp4 precacher
						mod t_temp4 3
						
						ife t_temp4 0
							qputs RQUOTE LOADING.
						else ife t_temp4 1
							qputs RQUOTE LOADING..
						else ife t_temp4 2
							qputs RQUOTE LOADING...
						
						screentext STARTALPHANUM 130 100 65536 0 0 RQUOTE 0 0 8 0 5 8 0 0 8 0 0 xdim ydim 
						
						add precacher 1
						
						ifn precacher 3629
						{
							ifn RETURN 0
							{
								startscreen
					
								set RETURN 0
							}
							else
								break
						}
						
						//End of preload
					}
					
					ifg rendmode 0 //HAAAAAAACK for non-Software modes
					{
						redefinequote RQUOTE sys/BANM.ANM
						startcutscene RQUOTE
					}
					
					set t_temp5 65536
					set t_temp4 60
				}
				else ifg title_count 360
				{
					ifg title_count 539
						sub t_temp4 1
					else ifl title_count 420
						add t_temp4 1
						
					ife title_count 570
						screensound LOGO_NOISE
					
					qputs RQUOTE A MOD BY MARCOLINO123
					screentext STARTALPHANUM 160 100 t_temp5 0 0 RQUOTE t_temp4 0 8 0 5 8 0 0 10 0 0 xdim ydim 
					
					add t_temp5 16
					
					ife title_count 361
					{
						set t_temp4 60
						set t_temp6 30
					}
				}
				else
				{
					ifg title_count 329
						sub t_temp6 1
					else ifl title_count 210
						add t_temp6 1
					
					ifg title_count 299
						sub t_temp4 1
					else ifl title_count 180
						add t_temp4 1
					
					qputs RQUOTE THE COMPLETE VERSION OF THIS MOD INCLUDES:
					screentext MINIFONT HALFX 70 SIZE1X 0 0 RQUOTE t_temp6 21 8 0 4 6 1 1 10 0 0 xdim ydim 
					
					qputs RQUOTE UPSCALE PACK BY PHREDREEKE
					screentext STARTALPHANUM 160 90 55000 0 0 RQUOTE t_temp4 0 8 0 5 8 0 0 10 0 0 xdim ydim 
					
					qputs RQUOTE VOXEL PACK BY REAPERMAN AND DUKE4.NET COMMUNITY
					screentext STARTALPHANUM 160 110 55000 0 0 RQUOTE t_temp4 0 8 0 5 8 0 0 10 0 0 xdim ydim 
				}
			}
			else
			{
				ife title_count 120
					screensound RPG_EXPLODE
				
				ife title_count 15
					screensound FLY_BY_ECHO
				
				set t_temp title_count
				mod t_temp 26
				div t_temp 2
				add t_temp 2270
				
				rotatesprite 100 50 SIZE1X 0 t_temp 0 0 MENUBIT 0 0 xdim ydim
				rotatesprite 150 50 SIZE1X 0 t_temp 0 0 MENUBIT 0 0 xdim ydim
				rotatesprite 200 50 SIZE1X 0 t_temp 0 0 MENUBIT 0 0 xdim ydim
				rotatesprite 250 50 SIZE1X 0 t_temp 0 0 MENUBIT 0 0 xdim ydim
				
				add t_temp 40
				
				rotatesprite 80 70 SIZE1X 0 t_temp 0 0 MENUBIT 0 0 xdim ydim
				rotatesprite 130 70 SIZE1X 0 t_temp 0 0 MENUBIT 0 0 xdim ydim
				rotatesprite 180 70 SIZE1X 0 t_temp 0 0 MENUBIT 0 0 xdim ydim
				rotatesprite 230 70 SIZE1X 0 t_temp 0 0 MENUBIT 0 0 xdim ydim
				
				sub t_temp 40
				
				rotatesprite 100 110 SIZE1X 0 t_temp 0 0 MENUBIT 0 0 xdim ydim
				rotatesprite 140 110 SIZE1X 0 t_temp 0 0 MENUBIT 0 0 xdim ydim
				rotatesprite 180 110 SIZE1X 0 t_temp 0 0 MENUBIT 0 0 xdim ydim
				rotatesprite 220 110 SIZE1X 0 t_temp 0 0 MENUBIT 0 0 xdim ydim
				rotatesprite 260 110 SIZE1X 0 t_temp 0 0 MENUBIT 0 0 xdim ydim
				
				add t_temp 40
				
				rotatesprite 80 130 SIZE1X 0 t_temp 0 0 MENUBIT 0 0 xdim ydim
				rotatesprite 120 130 SIZE1X 0 t_temp 0 0 MENUBIT 0 0 xdim ydim
				rotatesprite 160 130 SIZE1X 0 t_temp 0 0 MENUBIT 0 0 xdim ydim
				rotatesprite 200 130 SIZE1X 0 t_temp 0 0 MENUBIT 0 0 xdim ydim
				rotatesprite 240 130 SIZE1X 0 t_temp 0 0 MENUBIT 0 0 xdim ydim
				
				sub t_temp 40
				
				rotatesprite 100 170 SIZE1X 0 t_temp 0 0 MENUBIT 0 0 xdim ydim
				rotatesprite 150 170 SIZE1X 0 t_temp 0 0 MENUBIT 0 0 xdim ydim
				rotatesprite 200 170 SIZE1X 0 t_temp 0 0 MENUBIT 0 0 xdim ydim
				rotatesprite 250 170 SIZE1X 0 t_temp 0 0 MENUBIT 0 0 xdim ydim
				
				add t_temp 40
				
				rotatesprite 80 190 SIZE1X 0 t_temp 0 0 MENUBIT 0 0 xdim ydim
				rotatesprite 130 190 SIZE1X 0 t_temp 0 0 MENUBIT 0 0 xdim ydim
				rotatesprite 180 190 SIZE1X 0 t_temp 0 0 MENUBIT 0 0 xdim ydim
				rotatesprite 230 190 SIZE1X 0 t_temp 0 0 MENUBIT 0 0 xdim ydim
				
				rotatesprite HALFX HALFY SIZE1X 0 TITLE 0 0 MENUBIT 0 0 xdim ydim
			}
			
			set fader 255
			set fadeg 255
			set fadeb 255

			state TitleCounter
		}
		else ife title 1
		{
			//set fadeg 0
			//set fadeb 0
			set title_count 300
			set title 2
			set skip_count 0
			stopsound LOGO_NOISE
			
			set RETURN 0
		}
		else ife title 2
		{
			//state FadeOutScreen
			redefinequote RQUOTE LOGO.ANM
			startcutscene RQUOTE

			set fadec 255
			set fadeg 0
			set fadeb 0
			set fades 8
			set title 3
			screensound FIRST_BEAT
			
			set RETURN 0
		}
		else ife title 3
		{
			setp[].palette 3
			rotatesprite 0 0 16384 0 3316 /*DREALMS*/ 0 0 88 0 0 xdim ydim 
			
			ifg title_count 200
				state FadeOutScreen
				
			state TitleCounter
			
			ife title_count 100
				screensound SECOND_BEAT
			
			ifl title_count 30
			{
				set fadeg 255
				set fadeb 255
				state FadeInScreen
			}
		}
		else ife title 4
		{
			set fadeg 0
			set fadeb 0
			set title_count 490
			set fades 16
			set title 5
			set skip_count 0
			set fadec 255
			set t_temp 262144
			set t_temp2 t_temp
			set t_temp9 t_temp
			set t_temp10 t_temp
			set t_temp5 72
			set t_temp6 72
			set t_temp7 41
			set t_temp8 41
			set t_temp12 0
			set t_temp19 3161
			set t_temp20 3161
			set t_temp16 0
			set t_temp17 0
			set spark00 3136
			set spark01 3136
			set spark02 3136
			set spark03 3136
			set spark04 3136
			set spark05 3136
			set legacypal 72
			set titlesize 65536
			set titlesizelock 0
			set legacysize 73728
			
			set RETURN 0
		}
		else ife title 5
		{
			ife title_count 440
				screensound RPG_EXPLODE
				
			ifl title_count 440
			{		
				setp[].palette 4
				rotatesprite 160 100 titlesize 0 2493 0 0 8 0 0 xdim ydim 
				
				add titlesize 16
			}
			
			ife title_count 355
				screensound FIRST_BEAT
			
			ife title_count 315
			{
				screensound PIPEBOMB_EXPLODE
				//screensound FIRST_BEAT
			}
				
			ife title_count 285
				screensound PIPEBOMB_EXPLODE
				
			ifl title_count 250
			{	
				ife title_count 249
					screensound PIPEBOMB_EXPLODE
					
				ife title_count 243
					screensound PIPEBOMB_EXPLODE
					
				ife title_count 237
				//{
					screensound PIPEBOMB_EXPLODE
					//screensound SECOND_BEAT
				//}
					
				ife title_count 231
					screensound PIPEBOMB_EXPLODE
					
				ife title_count 225
					screensound PIPEBOMB_EXPLODE
					
				ife title_count 219
					screensound PIPEBOMB_EXPLODE
					
				ife title_count 213
				{
					screensound FLY_BY
					//screensound SECOND_BEAT
					//starttrackslot 7 0
				}
				
				ife userdef.upscaledtextures 0
						rotatesprite 161 171 legacysize 0 2488 32 4 8 0 0 xdim ydim
					else
						rotatesprite 161 171 legacysize 0 2488 0 60 8 0 0 xdim ydim
				
				rotatesprite 160 170 legacysize 0 2488 0 legacypal 8 0 0 xdim ydim
				
				set t_temp3 t_temp
				set t_temp4 t_temp2
				
				set t_temp2 421 //add 27 for each letter
				
				ifg legacypal 60
					sub legacypal 1
				else
					set legacypal 0
					
				ifl legacysize 73728
					add legacysize 820
				//else
					//set legacysize 73728
				/*
				ifge title_count 249
				{
					set t_temp xdim
					mul t_temp t_temp2
					div t_temp 1000
					
					rotatesprite 160 100 titlesize 0 2493 0 0 24 t_temp 0 xdim ydim
				}
				*/
				
				add t_temp2 27
				
				ifge title_count 243
				{
					set t_temp xdim
					mul t_temp t_temp2
					div t_temp 1000
					
					rotatesprite 160 100 titlesize 0 2493 0 0 8 t_temp 0 xdim ydim
				}
				
				add t_temp2 27
				
				ifge title_count 237
				{
					set t_temp xdim
					mul t_temp t_temp2
					div t_temp 1000
					
					rotatesprite 160 100 titlesize 0 2493 0 0 8 t_temp 0 xdim ydim
				}
				
				add t_temp2 27
				
				ifge title_count 231
				{
					set t_temp xdim
					mul t_temp t_temp2
					div t_temp 1000
					
					rotatesprite 160 100 titlesize 0 2493 0 0 8 t_temp 0 xdim ydim
				}
				
				add t_temp2 27
				
				ifge title_count 225
				{
					set t_temp xdim
					mul t_temp t_temp2
					div t_temp 1000
					
					rotatesprite 160 100 titlesize 0 2493 0 0 8 t_temp 0 xdim ydim
				}
				
				add t_temp2 27
				
				ifge title_count 219
				{
					set t_temp xdim
					mul t_temp t_temp2
					div t_temp 1000
					
					rotatesprite 160 100 titlesize 0 2493 0 0 8 t_temp 0 xdim ydim
				}
				
				add t_temp2 27
				
				ifge title_count 213
				{
					set t_temp xdim
					mul t_temp t_temp2
					div t_temp 1000
					
					rotatesprite 160 100 titlesize 0 2493 0 0 8 t_temp 0 xdim ydim
				}
				
				switch title_count
					case 249
					case 243
					case 237
					case 231
					case 225
					case 219
						set legacypal 71
						set legacysize 65536
						break
					
				endswitch
				
				ifl title_count 249
				ifl spark00 3160
					{
						rotatesprite 140 180 14000 0 spark00 0 68 9 0 0 xdim ydim
							
						ifge t_temp13 2
						{
							set t_temp13 0
							add spark00 1
						}
						else
							add t_temp13 1
					}
					
				ifl title_count 243
				 ifl spark01 3160
					{
						rotatesprite 150 180 14000 0 spark01 0 68 9 0 0 xdim ydim
							
						ifge t_temp14 2
						{
							set t_temp14 0
							add spark01 1
						}
						else
							add t_temp14 1
					}	
					
				ifl title_count 237
				ifl spark02 3160
					{
						rotatesprite 160 180 14000 0 spark02 0 68 9 0 0 xdim ydim
							
						ifge t_temp15 2
						{
							set t_temp15 0
							add spark02 1
						}
						else
							add t_temp15 1
					}
					
				ifl title_count 231
				ifl spark03 3160
					{
						rotatesprite 170 180 14000 0 spark03 0 68 9 0 0 xdim ydim
							
						ifge t_temp16 2
						{
							set t_temp16 0
							add spark03 1
						}
						else
							add t_temp16 1
					}	
					
				ifl title_count 225
				 ifl spark04 3160
					{
						rotatesprite 180 180 14000 0 spark04 0 68 9 0 0 xdim ydim
							
						ifge t_temp17 2
						{
							set t_temp17 0
							add spark04 1
						}
						else
							add t_temp17 1
					}
				
				ifl title_count 219
				ifl spark05 3160
					{
						rotatesprite 190 180 14000 0 spark05 0 68 9 0 0 xdim ydim
							
						ifge t_temp18 2
						{
							set t_temp18 0
							add spark05 1
						}
						else
							add t_temp18 1
					}
				
				set t_temp t_temp3
				set t_temp2 t_temp4
			}
			
			ifl title_count 355
			{
				/*
				ifg title_count 90
				ifl title_count 355
				ifl t_temp SIZE1X
					add t_temp 3500
					
				ifl title_count 90
				ifl t_temp 524288
					add t_temp 5120
					
				ifg title_count 90
				ifl title_count 300
				ifl t_temp2 SIZE1X
					add t_temp2 4500
					
				ifl title_count 90
				ifl t_temp2 524288
					add t_temp2 5120
				*/
				
				ifg title_count 90
				ifl title_count 355
				{
					ifg t_temp9 SIZE1X
					ife titlesizelock 0
					{
						sub t_temp9 4917
						set t_temp4 4917
						
						set t_temp3 262144
						sub t_temp3 t_temp9
						div t_temp3 4917
						mul t_temp3 100
						div t_temp3 45
						
						ifl t_temp3 70
						{
							set t_temp4 t_temp3
							mul t_temp4 t_temp4
							mul t_temp4 t_temp3
							mul t_temp4 t_temp3
							mul t_temp4 t_temp3
							div t_temp4 10000000
							mul t_temp4 4
							mul t_temp4 196608
							div t_temp4 1000
							
							set t_temp 262144
							sub t_temp t_temp4
						}
						else
						{
							set t_temp11 t_temp3
							sub t_temp11 100
							set t_temp4 t_temp11
							mul t_temp11 t_temp11
							mul t_temp11 t_temp4
							mul t_temp11 t_temp4
							mul t_temp11 t_temp4
							div t_temp11 10000000
							mul t_temp11 -135
							set t_temp4 t_temp11
							set t_temp11 1000
							sub t_temp11 t_temp4
							mul t_temp11 196608
							div t_temp11 1000
							
							set t_temp 262144
							sub t_temp t_temp11
							
						}
						
						ifl t_temp9 108000
						ifg t_temp9 100000
						{
							add t_temp12 6
						}
						else ifl t_temp9 100000
						ifg t_temp9 92000
						{
							sub t_temp12 8
						}
						else
						{
							set t_temp12 0
						}
						
						//sub t_temp t_temp10
						
						ifl t_temp9 240000
						ifg t_temp9 217000
							set t_temp7 9
						else ifl t_temp9 217000
							set t_temp7 8
							
						ifg t_temp9 104800
						{
							set t_temp3 262144
							sub t_temp3 t_temp9
							mod t_temp3 9834
							
							ife t_temp3 0
							ifg t_temp5 60
								sub t_temp5 1
						}
						
						ife t_temp5 60
							set t_temp5 0
					}
					
					ifl t_temp 67000
					ife t_temp19 3161
						set t_temp19 3136
						
					
						ifl t_temp19 3160
						{
							rotatesprite 100 120 24000 0 t_temp19 0 68 9 0 0 xdim ydim
							rotatesprite 220 120 24000 0 t_temp19 0 68 9 0 0 xdim ydim
							
							ife t_temp16 2
							{
								set t_temp16 0
								add t_temp19 1
							}
							else
								add t_temp16 1
						}
					//}
				}
					
				ifg title_count 90
				ifl title_count 325
				{
					ifg t_temp10 SIZE1X
					ife titlesizelock 0
					{
						sub t_temp10 4917
						set t_temp4 4917
						
						set t_temp3 262144
						sub t_temp3 t_temp10
						div t_temp3 4917
						mul t_temp3 100
						div t_temp3 45
						
						ifl t_temp3 70
						{
							set t_temp4 t_temp3
							mul t_temp4 t_temp4
							mul t_temp4 t_temp3
							mul t_temp4 t_temp3
							mul t_temp4 t_temp3
							div t_temp4 10000000
							mul t_temp4 4
							mul t_temp4 196608
							div t_temp4 1000
							
							set t_temp2 262144
							sub t_temp2 t_temp4
						}
						else
						{
							set t_temp11 t_temp3
							sub t_temp11 100
							set t_temp4 t_temp11
							mul t_temp11 t_temp11
							mul t_temp11 t_temp4
							mul t_temp11 t_temp4
							mul t_temp11 t_temp4
							div t_temp11 10000000
							mul t_temp11 -135
							set t_temp4 t_temp11
							set t_temp11 1000
							sub t_temp11 t_temp4
							mul t_temp11 196608
							div t_temp11 1000
							
							set t_temp2 262144
							sub t_temp2 t_temp11
							
						}
						
						ifl t_temp10 108000
						ifg t_temp10 100000
						{
							add t_temp12 6
							sub t_temp 4096
						}
						else ifl t_temp10 100000
						ifg t_temp10 92000
						{
							sub t_temp12 8
							sub t_temp 1536
						}
						else
						{
							set t_temp12 0
							set t_temp 65536
						}
						
						ifl t_temp10 240000
						ifg t_temp10 217000
							set t_temp8 9
						else ifl t_temp2 217000
							set t_temp8 8
							
						ifg t_temp10 104800
						{
							set t_temp3 262144
							sub t_temp3 t_temp10
							mod t_temp3 9834
							
							ife t_temp3 0
							ifg t_temp6 60
								sub t_temp6 1
						}
						
						ife t_temp6 60
							set t_temp6 0
					}
					
					ifl t_temp2 67000
					ife t_temp20 3161
						set t_temp20 3136
						
						ifl t_temp20 3160
						{
							rotatesprite 160 150 24000 0 t_temp20 0 68 9 0 0 xdim ydim
							
							ife t_temp17 2
							{
								set t_temp17 0
								add t_temp20 1
							}
							else
								add t_temp17 1
						}
					//}
				}
				
				ifle t_temp9 65536
				ifle t_temp10 65536
				ife titlesizelock 0
					set titlesizelock 1
				else
				ife titlesizelock 1
				{
					add t_temp 64
					add t_temp2 64
					add legacysize 64
				}
				
				ife rendmode 0
				{
					set t_temp7 8
					set t_temp8 8
				}
				
				rotatesprite 160 120 t_temp t_temp12 2497 0 t_temp5 t_temp7 0 0 xdim ydim 
				
				ifl title_count 325
					rotatesprite 160 145 t_temp2 0 2498 0 t_temp6 t_temp8 0 0 xdim ydim

				ifl title_count 199
				{
					ife userdef.upscaledtextures 0
						rotatesprite 161 171 legacysize 0 2488 32 4 8 0 0 xdim ydim
					else
						rotatesprite 161 171 legacysize 0 2488 0 60 8 0 0 xdim ydim
					
					rotatesprite 160 170 legacysize 0 2488 0 0 8 0 0 xdim ydim
				}
			}
			
			ifge title_count 460
				state FadeOutScreen
				
			ife title_count 150
				screensound SECOND_BEAT
			
			ife title_count 441
			{
				set fadeg 255
				set fadeb 255
				set fadec 255
			}
			
			ifle title_count 440
			ifge title_count 410
				state FadeOutScreen
				
			state TitleCounter
			
			ifl title_count 30
			{		
				set fadeg 0
				set fadeb 0
				state FadeInScreen
			}
		}
		else ife title 6
		{
			stopsound FIRST_BEAT
			stopsound SECOND_BEAT
			starttrackslot 7 0
			setp[].palette 0
			set fader 0
			set fadeg 0
			set fadeb 0
			set title_count 390
			set fades 8
			set title 7
			set skip_count 0
			set fadec 255
			
			set t_temp 0
			
			set t_temp2 ydim
			div t_temp2 120
			
			state RandomSeedGen
			randvar t_temp6 8
			
			switch t_temp6
				case 0
					state EPSortScores
					break
					
				case 1
				case 4
					state RandomSeedGen
					randvar t_temp3 3
					state EP_SPC_SortScores
					set t_temp6 1
					break
					
				case 2
				case 5
				case 6
					state LVLSortScores
					set t_temp6 2
					break
					
				case 3
				case 7
				case 8
					state RandomSeedGen
					randvar t_temp3 30
					state LVL_SPC_SortScores
					set t_temp6 3
					break
			
			endswitch
			
			set t_temp7 t_temp3
			
			set RETURN 0
		}
		else ife title 7
		{
			rotatesprite 160 100 SIZE1X 0 MENUSCREEN 0 0 8 0 0 xdim ydim
			
			//ife title_count 290
				//starttrackslot 7 0
			
			switch t_temp6
				case 0
					qputs RQUOTE EPISODE SCOREBOARD
					break
					
				case 1
					qputs RQUOTE %s SCORES
					set t_temp3 t_temp7
					setu[].volume_number t_temp3
					qgetsysstr RQUOTE2 STR_VOLUMENAME
					qsprintf RQUOTE RQUOTE RQUOTE2
					break
					
				case 2
					qputs RQUOTE LEVEL SCOREBOARD
					break
					
				case 3
					qputs RQUOTE %s
					set t_temp3 t_temp7
					div t_temp3 10
					setu[].volume_number t_temp3
					set t_temp3 t_temp7
					mod t_temp3 11
					setu[].level_number t_temp3
					qgetsysstr RQUOTE2 STR_MAPNAME
					qsprintf RQUOTE RQUOTE RQUOTE2
					break
			
			endswitch
			
			
			rotatesprite 160 25 SIZE1X 0 MENUBAR 0 0 8 0 0 xdim ydim
			screentext BIGALPHANUM 160 29 49152 0 0 RQUOTE 0 0 8 0 5 8 0 0 1056770 0 0 xdim ydim
				
			set t_temp3 0
			whilen t_temp3 8
			{
				set t_temp4 60
				set t_temp5 15
				mul t_temp5 t_temp3
				add t_temp4 t_temp5	
				
				set t_temp5 9000
				add t_temp5 sortedscores_ids[t_temp3]
				//al t_temp5
				//echo 9012
				
				set t_temp8 8
				
				ife sortedscores_ids[t_temp3] score_id
				{
					set t_temp8 title_count
					mod t_temp8 20
					
					ifge t_temp8 10
						set t_temp8 8
					else
						set t_temp8 0
				}
				
				screentext STARTALPHANUM 30 t_temp4 SIZE1X 0 0 t_temp5 t_temp8 0 8 0 5 24 0 0 1032 0 0 xdim ydim
				
				qputs RQUOTE %d
				qsprintf RQUOTE RQUOTE sortedscores[t_temp3]
				
				screentext STARTALPHANUM 220 t_temp4 SIZE1X 0 0 RQUOTE t_temp8 0 8 0 5 24 0 0 1032 0 0 xdim ydim
				
				
				ife t_temp6 0
				{
					setu[].volume_number sortedscores_t[t_temp3]
					qgetsysstr RQUOTE STR_VOLUMENAME
					
					add t_temp4 2
						
					screentext STARTALPHANUM 120 t_temp4 32768 0 0 RQUOTE t_temp8 0 8 0 5 24 0 0 1032 0 0 xdim ydim
				}
				else ife t_temp6 2
				{
					set t_temp5 sortedscores_t[t_temp3]
					mod t_temp5 11
					setu[].level_number t_temp5
					qgetsysstr RQUOTE STR_MAPNAME
					
					add t_temp4 2
						
					screentext STARTALPHANUM 120 t_temp4 32768 0 0 RQUOTE t_temp8 0 8 0 5 24 0 0 1032 0 0 xdim ydim
				}
				
				add t_temp3 1
			}
			
			rotatesprite 160 100 SIZE1X 0 MENUSCREEN 0 0 8 0 t_temp xdim ydim
			rotatesprite 160 25 SIZE1X 0 MENUBAR 0 0 8 0 t_temp xdim ydim
			
			ifl t_temp ydim
				add t_temp t_temp2
		
			state TitleCounter
			
			ifg title_count 320
				state FadeOutScreen
				
			ifle title_count 34
				state FadeInScreen
				
			//ife title_count 30
				//starttrackslot 7 0
		}
		else ife title 10
		{
			rotatesprite 160 100 SIZE1X 0 MENUSCREEN 0 0 8 0 0 xdim ydim
			
			qgetsysstr RQUOTE STR_VOLUMENAME
			
			rotatesprite 160 25 SIZE1X 0 MENUBAR 0 0 8 0 0 xdim ydim
			screentext BIGALPHANUM 160 29 49152 0 0 RQUOTE 0 0 8 0 5 8 0 0 1056770 0 0 xdim ydim
				
			ife userdef.volume_number 0
				set t_temp6 6
			else
				set t_temp6 11
				
			set t_temp3 0
			whilen t_temp3 t_temp6
			{
				set t_temp4 45
				set t_temp5 13
				mul t_temp5 t_temp3
				add t_temp4 t_temp5	
				
				setu[].level_number t_temp3
				qgetsysstr RQUOTE STR_MAPNAME
				
				screentext STARTALPHANUM 30 t_temp4 SIZE1X 0 0 RQUOTE 0 0 0 0 5 24 0 0 1032 0 0 xdim ydim
				
				qputs RQUOTE %d
				set t_temp8 72
				mul t_temp8 score_id
				set t_temp7 11
				mul t_temp7 userdef.volume_number
				add t_temp7 t_temp3
				add t_temp7 t_temp8
				qsprintf RQUOTE RQUOTE record_scores[t_temp7]
				
				screentext STARTALPHANUM 220 t_temp4 SIZE1X 0 0 RQUOTE 0 0 0 0 5 24 0 0 1032 0 0 xdim ydim
				
				add t_temp3 1
			}
			
			rotatesprite 160 100 SIZE1X 0 MENUSCREEN 0 0 8 0 t_temp xdim ydim
			rotatesprite 160 25 SIZE1X 0 MENUBAR 0 0 8 0 t_temp xdim ydim
			
			ifl t_temp ydim
				add t_temp t_temp2
		
			state TitleCounter
			
			ifg title_count 320
				state FadeOutScreen
				
			ifle title_count 34
				state FadeInScreen
		}
		else ife title 12
		{
			rotatesprite HALFX HALFY SIZE1X 0 TEXTSTORY 0 0 8 0 0 xdim ydim
			
			sub t_temp 1
			
			ifg t_temp 1160
				state FadeOutScreen
				
			ifle t_temp 40
				state FadeInScreen
				
			ife skipend 1
				set skipend 2
			else ife skipend 2
			ifg t_temp 50
				set t_temp 50
				
			ife t_temp 0
			{
				add title 1
				set skipend 0
			}
			
		}
		else ife title 13
		{
			set t_temp 840
			set fader 0
			set fadeg 0
			set fadeb 0
			set fadec 254
			set fades 6
			set title 14
			set skipend 0
		}
		else ife title 14
		{
			rotatesprite HALFX HALFY SIZE1X 0 F1HELP 0 0 8 0 0 xdim ydim
			
			sub t_temp 1
			
			ifg t_temp 800
				state FadeOutScreen
				
			ifle t_temp 40
				state FadeInScreen
			
			ife skipend 1
				set skipend 2
			else ife skipend 2
			ifg t_temp 50
				set t_temp 50
				
			ife t_temp 0
			{
				add title 1
				set skipend 0
			}
		}
		else ife title 15
		{
			set t_temp 1200
			set fader 0
			set fadeg 0
			set fadeb 0
			set fadec 254
			set fades 6
			set title 16
			set skipend 0
		}
		else ife title 16
		{
			rotatesprite HALFX HALFY SIZE1X 0 MENUSCREEN 0 0 8 0 0 xdim ydim
			
			qputs RQUOTE NEW DEFAULT KEYS
			screentext STARTALPHANUM 160 22 65536 0 0 RQUOTE 0 0 8 0 5 8 0 0 10 0 0 xdim ydim 
			
			qputs RQUOTE CHECK THE KEY BINDS IN THE OPTIONS MENU
			screentext STARTALPHANUM 160 27 30000 0 0 RQUOTE 0 5 8 0 5 8 0 0 10 0 0 xdim ydim 
			
			qputs RQUOTE ^2MOVEMENT
			screentext MINIFONT 31 41 SIZE1X 0 0 RQUOTE 32 0 24 0 4 6 1 1 0 0 0 xdim ydim
			screentext MINIFONT 30 40 SIZE1X 0 0 RQUOTE -31 0 24 0 4 6 1 1 0 0 0 xdim ydim
			
			qputs RQUOTE ^23FOWARD:^1 W
			//getkeyname RQUOTE2 0 2
			//qstrcat RQUOTE RQUOTE2
			screentext MINIFONT 31 51 SIZE1X 0 0 RQUOTE 32 0 24 0 4 6 1 1 0 0 0 xdim ydim
			screentext MINIFONT 30 50 SIZE1X 0 0 RQUOTE 0 0 24 0 4 6 1 1 0 0 0 xdim ydim
			
			qputs RQUOTE ^23BACK:^1 S
			//getkeyname RQUOTE2 1 2
			//qstrcat RQUOTE RQUOTE2
			screentext MINIFONT 31 61 SIZE1X 0 0 RQUOTE 32 0 24 0 4 6 1 1 0 0 0 xdim ydim
			screentext MINIFONT 30 60 SIZE1X 0 0 RQUOTE 0 0 24 0 4 6 1 1 0 0 0 xdim ydim
			
			qputs RQUOTE ^23STRAFE LEFT:^1 A
			//getkeyname RQUOTE2 15 2
			//qstrcat RQUOTE RQUOTE2
			screentext MINIFONT 31 71 SIZE1X 0 0 RQUOTE 32 0 24 0 4 6 1 1 0 0 0 xdim ydim
			screentext MINIFONT 30 70 SIZE1X 0 0 RQUOTE 0 0 24 0 4 6 1 1 0 0 0 xdim ydim
			
			qputs RQUOTE ^23STRAFE RIGHT:^1 D
			//getkeyname RQUOTE2 16 2
			//qstrcat RQUOTE RQUOTE2
			screentext MINIFONT 31 81 SIZE1X 0 0 RQUOTE 32 0 24 0 4 6 1 1 0 0 0 xdim ydim
			screentext MINIFONT 30 80 SIZE1X 0 0 RQUOTE 0 0 24 0 4 6 1 1 0 0 0 xdim ydim
			
			qputs RQUOTE ^23JUMP:^1 SPACE
			//getkeyname RQUOTE2 9 2
			//qstrcat RQUOTE RQUOTE2
			screentext MINIFONT 31 91 SIZE1X 0 0 RQUOTE 32 0 24 0 4 6 1 1 0 0 0 xdim ydim
			screentext MINIFONT 30 90 SIZE1X 0 0 RQUOTE 0 0 24 0 4 6 1 1 0 0 0 xdim ydim
			
			qputs RQUOTE ^23CROUCH:^1 C
			//getkeyname RQUOTE2 10 2
			//qstrcat RQUOTE RQUOTE2
			screentext MINIFONT 31 101 SIZE1X 0 0 RQUOTE 32 0 24 0 4 6 1 1 0 0 0 xdim ydim
			screentext MINIFONT 30 100 SIZE1X 0 0 RQUOTE 0 0 24 0 4 6 1 1 0 0 0 xdim ydim 
			
			qputs RQUOTE ^23USE/OPEN:^1 E
			//getkeyname RQUOTE2 6 2
			//qstrcat RQUOTE RQUOTE2
			screentext MINIFONT 31 111 SIZE1X 0 0 RQUOTE 32 0 24 0 4 6 1 1 0 0 0 xdim ydim
			screentext MINIFONT 30 110 SIZE1X 0 0 RQUOTE 0 0 24 0 4 6 1 1 0 0 0 xdim ydim
			
			
			qputs RQUOTE ^2WEAPONS
			screentext MINIFONT 111 41 SIZE1X 0 0 RQUOTE 32 0 24 0 4 6 1 1 0 0 0 xdim ydim
			screentext MINIFONT 110 40 SIZE1X 0 0 RQUOTE -31 0 24 0 4 6 1 1 0 0 0 xdim ydim

			qputs RQUOTE ^23WEAPON WHEEL:^1 Q
			//getkeyname RQUOTE2 11 2
			//qstrcat RQUOTE RQUOTE2
			screentext MINIFONT 111 51 SIZE1X 0 0 RQUOTE 32 0 24 0 4 6 1 1 0 0 0 xdim ydim
			screentext MINIFONT 110 50 SIZE1X 0 0 RQUOTE 0 0 24 0 4 6 1 1 0 0 0 xdim ydim
			
			qputs RQUOTE ^23FIRE:^1 LMB
			//getkeyname RQUOTE2 8 2
			//qstrcat RQUOTE RQUOTE2
			screentext MINIFONT 111 61 SIZE1X 0 0 RQUOTE 32 0 24 0 4 6 1 1 0 0 0 xdim ydim
			screentext MINIFONT 110 60 SIZE1X 0 0 RQUOTE 0 0 24 0 4 6 1 1 0 0 0 xdim ydim
			
			qputs RQUOTE ^23ALT. FIRE:^1 RMB
			//getkeyname RQUOTE2 8 2
			//qstrcat RQUOTE RQUOTE2
			screentext MINIFONT 111 71 SIZE1X 0 0 RQUOTE 32 0 24 0 4 6 1 1 0 0 0 xdim ydim
			screentext MINIFONT 110 70 SIZE1X 0 0 RQUOTE 0 0 24 0 4 6 1 1 0 0 0 xdim ydim
			
			qputs RQUOTE ^23ALT. WEAPON:^1 R
			//getkeyname RQUOTE2 60 2
			//qstrcat RQUOTE RQUOTE2
			screentext MINIFONT 111 81 SIZE1X 0 0 RQUOTE 32 0 24 0 4 6 1 1 0 0 0 xdim ydim
			screentext MINIFONT 110 80 SIZE1X 0 0 RQUOTE 0 0 24 0 4 6 1 1 0 0 0 xdim ydim
			
			qputs RQUOTE ^23LAST WEAPON:^1 X
			//getkeyname RQUOTE2 57 2
			//qstrcat RQUOTE RQUOTE2
			screentext MINIFONT 111 91 SIZE1X 0 0 RQUOTE 32 0 24 0 4 6 1 1 0 0 0 xdim ydim
			screentext MINIFONT 110 90 SIZE1X 0 0 RQUOTE 0 0 24 0 4 6 1 1 0 0 0 xdim ydim
			
			qputs RQUOTE ^23QUICK KICK:^1 F
			//getkeyname RQUOTE2 49 2
			//qstrcat RQUOTE RQUOTE2
			screentext MINIFONT 111 101 SIZE1X 0 0 RQUOTE 32 0 24 0 4 6 1 1 0 0 0 xdim ydim
			screentext MINIFONT 110 100 SIZE1X 0 0 RQUOTE 0 0 24 0 4 6 1 1 0 0 0 xdim ydim
			
			qputs RQUOTE ^23QUICK LASER CHAINSAW:^1 G
			//getkeyname RQUOTE2 49 2
			//qstrcat RQUOTE RQUOTE2
			screentext MINIFONT 111 111 SIZE1X 0 0 RQUOTE 32 0 24 0 4 6 1 1 0 0 0 xdim ydim
			screentext MINIFONT 110 110 SIZE1X 0 0 RQUOTE 0 0 24 0 4 6 1 1 0 0 0 xdim ydim
			
			qputs RQUOTE ^23MIGHTY FOOT/LASER CHAINSAW:^1 1
			//getkeyname RQUOTE2 49 2
			//qstrcat RQUOTE RQUOTE2
			screentext MINIFONT 61 126 SIZE1X 0 0 RQUOTE 32 0 24 0 4 6 1 1 0 0 0 xdim ydim
			screentext MINIFONT 60 125 SIZE1X 0 0 RQUOTE 0 0 24 0 4 6 1 1 0 0 0 xdim ydim
			
			qputs RQUOTE ^23PISTOL:^1 2
			//getkeyname RQUOTE2 49 2
			//qstrcat RQUOTE RQUOTE2
			screentext MINIFONT 61 136 SIZE1X 0 0 RQUOTE 32 0 24 0 4 6 1 1 0 0 0 xdim ydim
			screentext MINIFONT 60 135 SIZE1X 0 0 RQUOTE 0 0 24 0 4 6 1 1 0 0 0 xdim ydim
			
			qputs RQUOTE ^23SHOTGUN/DOUBLE SHOTGUN:^1 3
			//getkeyname RQUOTE2 49 2
			//qstrcat RQUOTE RQUOTE2
			screentext MINIFONT 61 146 SIZE1X 0 0 RQUOTE 32 0 24 0 4 6 1 1 0 0 0 xdim ydim
			screentext MINIFONT 60 145 SIZE1X 0 0 RQUOTE 0 0 24 0 4 6 1 1 0 0 0 xdim ydim
			
			qputs RQUOTE ^23CHAINGUN/PLASMA GUN:^1 4
			//getkeyname RQUOTE2 49 2
			//qstrcat RQUOTE RQUOTE2
			screentext MINIFONT 61 156 SIZE1X 0 0 RQUOTE 32 0 24 0 4 6 1 1 0 0 0 xdim ydim
			screentext MINIFONT 60 155 SIZE1X 0 0 RQUOTE 0 0 24 0 4 6 1 1 0 0 0 xdim ydim
			
			qputs RQUOTE ^23RPG/ULTRA RPG:^1 5
			//getkeyname RQUOTE2 49 2
			//qstrcat RQUOTE RQUOTE2
			screentext MINIFONT 61 166 SIZE1X 0 0 RQUOTE 32 0 24 0 4 6 1 1 0 0 0 xdim ydim
			screentext MINIFONT 60 165 SIZE1X 0 0 RQUOTE 0 0 24 0 4 6 1 1 0 0 0 xdim ydim
			
			qputs RQUOTE ^23PIPEBOMB:^1 6
			//getkeyname RQUOTE2 49 2
			//qstrcat RQUOTE RQUOTE2
			screentext MINIFONT 181 126 SIZE1X 0 0 RQUOTE 32 0 24 0 4 6 1 1 0 0 0 xdim ydim
			screentext MINIFONT 180 125 SIZE1X 0 0 RQUOTE 0 0 24 0 4 6 1 1 0 0 0 xdim ydim
			
			qputs RQUOTE ^23SHRINKER/EXPANDER:^1 7
			//getkeyname RQUOTE2 49 2
			//qstrcat RQUOTE RQUOTE2
			screentext MINIFONT 181 136 SIZE1X 0 0 RQUOTE 32 0 24 0 4 6 1 1 0 0 0 xdim ydim
			screentext MINIFONT 180 135 SIZE1X 0 0 RQUOTE 0 0 24 0 4 6 1 1 0 0 0 xdim ydim
			
			qputs RQUOTE ^23DEVASTATOR/SONIC RESONATOR:^1 8
			//getkeyname RQUOTE2 49 2
			//qstrcat RQUOTE RQUOTE2
			screentext MINIFONT 181 146 SIZE1X 0 0 RQUOTE 32 0 24 0 4 6 1 1 0 0 0 xdim ydim
			screentext MINIFONT 180 145 SIZE1X 0 0 RQUOTE 0 0 24 0 4 6 1 1 0 0 0 xdim ydim
			
			qputs RQUOTE ^23TRIPBOMB:^1 9
			//getkeyname RQUOTE2 49 2
			//qstrcat RQUOTE RQUOTE2
			screentext MINIFONT 181 156 SIZE1X 0 0 RQUOTE 32 0 24 0 4 6 1 1 0 0 0 xdim ydim
			screentext MINIFONT 180 155 SIZE1X 0 0 RQUOTE 0 0 24 0 4 6 1 1 0 0 0 xdim ydim
			
			qputs RQUOTE ^23FREEZE/FLAME THROWER:^1 0
			//getkeyname RQUOTE2 49 2
			//qstrcat RQUOTE RQUOTE2
			screentext MINIFONT 181 166 SIZE1X 0 0 RQUOTE 32 0 24 0 4 6 1 1 0 0 0 xdim ydim
			screentext MINIFONT 180 165 SIZE1X 0 0 RQUOTE 0 0 24 0 4 6 1 1 0 0 0 xdim ydim
			
			
			qputs RQUOTE ^2INVENTORY
			screentext MINIFONT 191 41 SIZE1X 0 0 RQUOTE 32 0 24 0 4 6 1 1 0 0 0 xdim ydim
			screentext MINIFONT 190 40 SIZE1X 0 0 RQUOTE -31 0 24 0 4 6 1 1 0 0 0 xdim ydim
			
			qputs RQUOTE ^23USE INVENTORY:^1 CTRL
			//getkeyname RQUOTE2 29 2
			//qstrcat RQUOTE RQUOTE2
			screentext MINIFONT 191 51 SIZE1X 0 0 RQUOTE 32 0 24 0 4 6 1 1 0 0 0 xdim ydim
			screentext MINIFONT 190 50 SIZE1X 0 0 RQUOTE 0 0 24 0 4 6 1 1 0 0 0 xdim ydim
			
			qputs RQUOTE ^23INVENTORY LEFT:^1 WHEEL UP
			//getkeyname RQUOTE2 30 2
			//qstrcat RQUOTE RQUOTE2
			screentext MINIFONT 191 61 SIZE1X 0 0 RQUOTE 32 0 24 0 4 6 1 1 0 0 0 xdim ydim
			screentext MINIFONT 190 60 SIZE1X 0 0 RQUOTE 0 0 24 0 4 6 1 1 0 0 0 xdim ydim
			
			qputs RQUOTE ^23INVENTORY RIGHT:^1 WHEEL DOWN
			screentext MINIFONT 191 71 SIZE1X 0 0 RQUOTE 32 0 24 0 4 6 1 1 0 0 0 xdim ydim
			screentext MINIFONT 190 70 SIZE1X 0 0 RQUOTE 0 0 24 0 4 6 1 1 0 0 0 xdim ydim
			
			qputs RQUOTE ^2STEROIDS INCREASE YOUR DAMAGE OUTPUT
			screentext MINIFONT 191 81 46000 0 0 RQUOTE 32 0 24 0 4 6 1 1 0 0 0 xdim ydim
			screentext MINIFONT 190 80 46000 0 0 RQUOTE 0 0 24 0 4 6 1 1 0 0 0 xdim ydim
			
			qputs RQUOTE ^2AND GIVES YOU 35 EXTRA HEALTH POINTS
			screentext MINIFONT 191 86 46000 0 0 RQUOTE 32 0 24 0 4 6 1 1 0 0 0 xdim ydim
			screentext MINIFONT 190 85 46000 0 0 RQUOTE 0 0 24 0 4 6 1 1 0 0 0 xdim ydim
			
			qputs RQUOTE ^2THE PISTOL, DOUBLE SHOTGUN, PLASMA GUN, RPG, DEVISTATOR AND THE FLAMETHROWER
			screentext MINIFONT 161 181 46000 0 0 RQUOTE 32 0 24 0 4 6 1 1 10 0 0 xdim ydim
			screentext MINIFONT 160 180 46000 0 0 RQUOTE -31 0 24 0 4 6 1 1 10 0 0 xdim ydim
			
			qputs RQUOTE ^2ALL HAVE ALTERNATE FIRE FUNCTION
			screentext MINIFONT 161 186 46000 0 0 RQUOTE 32 0 24 0 4 6 1 1 10 0 0 xdim ydim
			screentext MINIFONT 160 185 46000 0 0 RQUOTE -31 0 24 0 4 6 1 1 10 0 0 xdim ydim
			
			sub t_temp 1
			
			ifg t_temp 800
				state FadeOutScreen
				
			ifle t_temp 40
				state FadeInScreen
			
			ife skipend 1
				set skipend 2
			else ife skipend 2
			ifg t_temp 50
				set t_temp 50
				
			ife t_temp 0
			{
				set title 8
				screenpal 0 0 0 0
				set skipend 0
				set RETURN 1
			}
		}
		else
		{
			setp[].palette 0
			set RETURN 1
		}
	}
	
	ife loadfade 1
	{
		ife title_count 60
		{
			state LevelMusicDefs
			state PlayLoadingMusic
		}
	
		rotatesprite 160 100 SIZE1X 0 LOADSCREEN 0 0 8 0 0 xdim ydim
		
		redefinequote RQUOTE ENTERING
		screentext BIGALPHANUM 160 85 SIZE1X 0 0 RQUOTE 0 0 0 0 5 16 0 0 1056770 0 0 xdim ydim
		
		qgetsysstr RQUOTE STR_MAPNAME
		screentext BIGALPHANUM 160 110 SIZE1X 0 0 RQUOTE 0 0 0 0 5 16 0 0 1056770 0 0 xdim ydim
	
		state TitleCounter
		state FadeOutScreen
		
		ife title_count 0
		{
			set loadfade 2
			set RETURN 1
		}
		else
			set RETURN 0
	}
	else ife loadfade 2
	{
		rotatesprite 160 100 SIZE1X 0 LOADSCREEN 0 0 8 0 0 xdim ydim
		
		redefinequote RQUOTE ENTERING
		screentext BIGALPHANUM 160 85 SIZE1X 0 0 RQUOTE 0 0 0 0 5 16 0 0 1056770 0 0 xdim ydim
		
		qgetsysstr RQUOTE STR_MAPNAME
		screentext BIGALPHANUM 160 110 SIZE1X 0 0 RQUOTE 0 0 0 0 5 16 0 0 1056770 0 0 xdim ydim
	
		state TitleCounter
		
		ifl title_count 20
			state FadeInScreen
		
		ife title_count 0
		{
			set loadfade 0
			set RETURN 1
		}
		else
			set RETURN 0
	}
	
	ifn RETURN 0
	ifl title 8
	ifn loadfade 1
	{
		add title 1
			
		startscreen
				
		set RETURN 0
	}
	else ifn RETURN 0
	ifl title 8
	ifg loadfade 0
	ifn title_count 0
	{
		startscreen
		set RETURN 0
	}
	else ifn RETURN 0
	ifge title 12
	{
		ife skipend 0
			set skipend 1
		startscreen
		set RETURN 0
	}
	else ifn RETURN 0
	ifge title 10
	ifg loadfade 0
	ifn title_count 0
	{
		startscreen
		set RETURN 0
	}
	else ifn RETURN 0
	ifg endgame 0
	ifn endgame 6
	{
		ife skipend 0
			set skipend 1
		
		startscreen
		set RETURN 0
	}
	
	ife title 11
		set title 8

endevent


onevent EVENT_CUTSCENE

	redefinequote RQUOTE LOGO.ANM
	redefinequote RQUOTE2 movies/CINEOV2.ANM
	redefinequote RQUOTE3 CINEOV3.ANM
	qputs 199 VOL4E1.ANM
	qputs TESTQ VOL41A.ANM
	
	ifcutscene RQUOTE
		ife title 2
	{
		set fades 24
		state CSFadeOutScreen
	}
	else ifcutscene RQUOTE2
	{
		set fades 24
		state CSFadeOutScreen
	}
	else ifcutscene RQUOTE3
	{
		set fades 24
		state CSFadeOutScreen
	}
	else ifcutscene 199
	{
		set fades 24
		state CSFadeOutScreen
	}
	else ifcutscene TESTQ
	{
		set fades 24
		state CSFadeOutScreen
	}
	
	redefinequote RQUOTE RADLOGO.ANM
	
	ifcutscene RQUOTE
	{
		ife title_count 1
			screensound ENDSEQVOL3SND5
		else ife title_count 22
			screensound ENDSEQVOL3SND6
		else ife title_count 68
			screensound ENDSEQVOL3SND7
		else ife title_count 97
			screensound ENDSEQVOL3SND8
		else ife title_count 140
			screensound ENDSEQVOL3SND9
			
		ifg title_count 210
		{
			set fades 24
			state CSFadeInScreen
		}
			
		add title_count 1
		
		ifl title_count 225
			set RETURN 0
	}

endevent

onevent EVENT_DISPLAYLOADINGSCREEN
	/*
	rotatesprite HALFX HALFY SIZE1X 0 LOADSCREEN 0 4 8 0 0 xdim ydim //Black screen
	
	ifl RETURN 0 
	ife loadfade 0
	{
		set loadfade 1
		set fadec 255
		set title_count 60
		set fades 17
		set fader 0
		set fadeg 0
		set fadeb 0
		set t_temp 0
		set t_temp2 0
		set title 9

		startscreen
	}
	*/
	
	ife loadtip 0
	{
		displayrandvar loadtip 35
		add loadtip 300
	}
	
	screentext MINIFONT 161 161 65536 0 0 loadtip 0 4 8 0 4 6 1 1 8194 0 0 xdim ydim
	screentext MINIFONT HALFX 160 65536 0 0 loadtip 0 23 8 0 4 6 1 1 8194 0 0 xdim ydim
	
	ife RETURN -2
	{
		set curr_music -1
		state LevelMusicDefs
		ife LEVEL 8
		ife VOLUME 2
			nullop
		else
		{
			ife userdef.user_map 1
			{
				ifn userdef.um_music 9000
					state PlayLoadingMusic
			}
			else
				state PlayLoadingMusic
		}
	}
	
endevent


onevent EVENT_PRELEVEL

	ife loadfade 2
	{
		set title_count 40

		startscreen
	}

endevent


onevent EVENT_NEWGAMECUSTOM

    setu[].m_volume_number userdef.return 0
	ife userdef.return 2 -1 
	{
		setu[].m_level_number userdef.return 1
		
		ife userdef.m_volume_number 0
		ife 5 userdef.return 1
		{
			setu[].m_level_number 4
			set BOSSFIGHT_LEVEL 1
		}
		else ife userdef.m_volume_number 0
		ife 6 userdef.return 1
		{
			setu[].m_level_number 4
			set BOSSFIGHT_LEVEL 2
		}
		else
			set BOSSFIGHT_LEVEL 0
	}
	else
	{
		set t_temp userdef.return 2
		add t_temp 5
		setu[].m_level_number t_temp
		
		ife userdef.m_volume_number 1
		ife 4 userdef.return 2
		{
			setu[].m_level_number 8
			set BOSSFIGHT_LEVEL 1
		}
		else ife userdef.m_volume_number 3
		ife 5 userdef.return 2
		{
			setu[].m_level_number 9
			set BOSSFIGHT_LEVEL 1
		}
		else
			set BOSSFIGHT_LEVEL 0
	}

endevent

onevent EVENT_NEWGAMESCREEN
	
	ife userdef.m_volume_number 0
	ife userdef.m_level_number 0
	ife userdef.tutorial 1
	{
		set title 12
		set t_temp 1200
		set fader 0
		set fadeg 0
		set fadeb 0
		set fadec 254
		set fades 6
		startscreen
	}

endevent

appendevent EVENT_DISPLAYMENUREST

	ife userdef.return 0 102
	{
		setu[].newgamecustomopen EPLOCK
		setu[].newgamecustomsubopen 0 EP1LOCKS
		setu[].newgamecustomsubopen 1 EP2LOCKS
		setu[].newgamecustomsubopen 2 EP3LOCKS
		setu[].newgamecustomsubopen 3 EP4LOCKS
		setu[].newgamecustoml3_1 5 EP22LOCKS
		setu[].newgamecustoml3_2 5 EP32LOCKS
		setu[].newgamecustoml3_3 5 EP42LOCKS
		/*
		ife userdef.return 3 1
		{
			ifvarand EPLOCK 0x2
				nullop
			else
			{
				redefinequote RQUOTE LOCKED UNTIL THE PREVIOUS EPISODE IS FINISHED
				screentext STARTALPHANUM 160 180 32768 0 0 RQUOTE 0 0 8 0 5 8 0 0 10 0 0 xdim ydim
			}
		}
		else ife userdef.return 3 2
		{
			ifvarand EPLOCK 0x4
				nullop
			else
			{
				redefinequote RQUOTE LOCKED UNTIL THE PREVIOUS EPISODE IS FINISHED
				screentext STARTALPHANUM 160 180 32768 0 0 RQUOTE 0 0 8 0 5 8 0 0 10 0 0 xdim ydim
			}
		}
		else ife userdef.return 3 3
		{
			ifvarand EPLOCK 0x8
				nullop
			else
			{
				redefinequote RQUOTE LOCKED UNTIL THE PREVIOUS EPISODE IS FINISHED
				screentext STARTALPHANUM 160 180 32768 0 0 RQUOTE 0 0 8 0 5 8 0 0 10 0 0 xdim ydim
			}
		}
		*/
	}
	else
	{	
		ifand player[].gm 4
			set t_temp12 65536
		else
		{
			ife startMenu 0
			{	
				set t_temp9 startMenuTime
				mul t_temp9 100
				div t_temp9 40
				
				ifl t_temp9 70
				{
					set t_temp10 t_temp9
					mul t_temp10 t_temp10
					mul t_temp10 t_temp9
					mul t_temp10 t_temp9
					mul t_temp10 t_temp9
					div t_temp10 10000000
					mul t_temp10 4
					set t_temp13 t_temp10
					
					mul t_temp13 196608
					div t_temp13 1000
								
					set t_temp12 262144
					sub t_temp12 t_temp13
					
					mul t_temp10 70
					div t_temp10 1000
					
					set t_temp7 100
					sub t_temp7 t_temp10
				}
				else
				{
					set t_temp11 t_temp9
					sub t_temp11 100
					set t_temp10 t_temp11
					mul t_temp11 t_temp11
					mul t_temp11 t_temp10
					mul t_temp11 t_temp10
					mul t_temp11 t_temp10
					div t_temp11 10000000
					mul t_temp11 -135
					set t_temp10 t_temp11
					set t_temp11 1000
					sub t_temp11 t_temp10
					set t_temp13 t_temp11
					
					mul t_temp13 196608
					div t_temp13 1000
								
					set t_temp12 262144
					sub t_temp12 t_temp13
					
					mul t_temp11 70
					div t_temp11 1000
					
					set t_temp7 100
					sub t_temp7 t_temp11
				}
				
				ifl startMenuTime 40
					add startMenuTime 1
				else
				{
					screensound RPG_EXPLODE
					set startMenuTime 0
					set startMenu 1
				}
			}
			else
				set t_temp12 65536
		}
		
		set t_temp6 160
		set t_temp8 userdef.return 1
		shiftr t_temp8 16
		add t_temp6 t_temp8
		set t_temp7 30
			
	
		switch userdef.return 0
			case MENU_CREDITS
			case MENU_CREDITS2
			case MENU_CREDITS3
				set endgame 15
				set t_temp 0
				set t_temp2 ydim
				div t_temp2 120
				set t_temp3 840
				set skipend 0
				startscreen
				cmenu MENU_CREDITS4
				break
				
			case MENU_STORY
				set title 12
				set t_temp 1200
				set fader 0
				set fadeg 0
				set fadeb 0
				set fadec 254
				set fades 6
				startscreen
				cmenu MENU_PREVIOUS
				break
				
			case MENU_MAIN_INGAME
				add t_temp7 4
			case MENU_MAIN
				rotatesprite t_temp6 t_temp7 t_temp12 0 INGAMEDUKETHREEDEE 0 0 10 0 0 xdim ydim
				break
				
			case 201 //MENU_GAMESETUP2
				ife 2 userdef.return 3
				{
					redefinequote RQUOTE DISABLE THE SWITCH VOXELS IN USER MAPS (FIX VISUAL GLITCHES, MAP MUST BE RESTARTED)
					screentext STARTALPHANUM 160 195 32768 0 0 RQUOTE 0 0 8 0 5 8 0 0 10 0 0 xdim ydim
				}
				break
				
			case 40000 //MENU_GAMESETUP3
				switch userdef.return 3
					case 0	
						qputs RQUOTE BE CAREFUL! ENABLING NUKE MODE UNBALANCES THE GAME AND DISABLES THE SCORE
						screentext STARTALPHANUM 160 195 32768 0 0 RQUOTE 0 0 8 0 5 8 0 0 10 0 0 xdim ydim
						break
					
					case 1	
						qputs RQUOTE SPAWN PACKS OF ENEMIES (MAY BE 3, 2 OR ONE)
						screentext STARTALPHANUM 160 195 32768 0 0 RQUOTE 0 0 8 0 5 8 0 0 10 0 0 xdim ydim
						break
						
					case 2	
						qputs RQUOTE ENEMY HEALTH MULTIPLIER (IN PERCENTAGE)
						screentext STARTALPHANUM 160 195 32768 0 0 RQUOTE 0 0 8 0 5 8 0 0 10 0 0 xdim ydim
						break
					
					case 3
						qputs RQUOTE RANDOMIZES ENEMIES AND/OR WEAPONS IN THE MAP
						screentext STARTALPHANUM 160 195 32768 0 0 RQUOTE 0 0 8 0 5 8 0 0 10 0 0 xdim ydim
						break
						
					case 4
						qputs RQUOTE DAMAGE TAKEN MULTIPLIER (IN PERCENTAGE - DOESN'T OVERRIDE SKILL MULTIPLIER)
						screentext STARTALPHANUM 160 195 32768 0 0 RQUOTE 0 0 8 0 5 8 0 0 10 0 0 xdim ydim
						break	
						
					case 6	
						qputs RQUOTE HOW THE PLAYER STARTS
						screentext STARTALPHANUM 160 195 32768 0 0 RQUOTE 0 0 8 0 5 8 0 0 10 0 0 xdim ydim
						break
					
					case 8
						qputs RQUOTE WHICH WEAPONS YOU START WITH
						screentext STARTALPHANUM 160 195 32768 0 0 RQUOTE 0 0 8 0 5 8 0 0 10 0 0 xdim ydim
						break
						
					case 9	
						qputs RQUOTE WEAPON DAMAGE MULTIPLIER (IN PERCENTAGE)
						screentext STARTALPHANUM 160 195 32768 0 0 RQUOTE 0 0 8 0 5 8 0 0 10 0 0 xdim ydim
						break		
					
				endswitch
				break
				
			case 40001 //MENU_GAMESETUP4
				switch userdef.return 3
					case 0	
						qputs RQUOTE PLAYER DOES NOT LOSE AMMO UPON THE NEXT LEVEL
						screentext STARTALPHANUM 160 195 32768 0 0 RQUOTE 0 0 8 0 5 8 0 0 10 0 0 xdim ydim
						break
						
					case 3
						qputs RQUOTE CHANGE HITSCANNING WITH TRACERS
						screentext STARTALPHANUM 160 195 32768 0 0 RQUOTE 0 0 8 0 5 8 0 0 10 0 0 xdim ydim
						break
						
					case 5
						qputs RQUOTE LIMIT MAXIMUM AMMO THE PLAYER CAN CARRY
						screentext STARTALPHANUM 160 195 32768 0 0 RQUOTE 0 0 8 0 5 8 0 0 10 0 0 xdim ydim
						break
						
					case 6
						qputs RQUOTE NOT LASER CHAINSAW WHEN YOU START IN SEE YOU IN HELL OR CUSTOM MAP
						screentext STARTALPHANUM 160 195 32768 0 0 RQUOTE 0 0 8 0 5 8 0 0 10 0 0 xdim ydim
						break
					
				endswitch
				
				break
				
			case MENU_DISPLAYSETUP
				ife 7 userdef.return 3
				{
					redefinequote RQUOTE YOU MUST RESTART THE GAME TO TAKE EFFECT
					screentext STARTALPHANUM 160 195 32768 0 0 RQUOTE 0 0 8 0 5 8 0 0 10 0 0 xdim ydim
				}
				break
		
		endswitch
	}

endevent

defstate EndGameEpisode

	set endgame 2
	set fader 0
	set fadeg 0
	set fadeb 0
	set fades 4
	set fadec 0
	set title 8
	set t_temp4 0
	
	ife VOLUME 1
		set endgamecount 450
	
	ife VOLUME 2
		set endgamecount 300
		
	ife VOLUME 3
		set endgamecount 800

ends

appendevent EVENT_DISPLAYREST

	ife endgame 1
		state EndGameEpisode

	ife endgame 2
	{
		state TimeClock
		
		ife fpscont 1
		{
			ifle endgamecount 90
				state CSFadeInScreen
			
			ifg endgamecount 0
				sub endgamecount 1
			else
			{
				stopallsounds
				stopallmusic
				
				ifg p_invul 0
				{
					set p_invul 0
					setp[].sound_pitch 0
					setp[].palette 0
					setu[].god 0
				}
			
				ife userdef.volume_number 0
				{
					set endgame 3
					ife userdef.player_skill 6
					ife BOSSFIGHT_LEVEL 0
					{
						screensound BOSSTALKTODUKE
						setp[].palette 11
						set ratebase totalclock
						set endcounter 150
					}
					else ife userdef.player_skill 6
					ife BOSSFIGHT_LEVEL 2
					{
						screensound BOSSTALKTODUKE
						setp[].palette 11
						set ratebase totalclock
						set endcounter 150
					}
					else ife BOSSFIGHT_LEVEL 2
					{
						screensound BOSSTALKTODUKE
						setp[].palette 11
						set ratebase totalclock
						set endcounter 150
					}
					else
						setp[].palette 5
						
					readgamevar EPLOCK
					readgamevar EP1LOCKS
					or EP1LOCKS 0x1F
					or EPLOCK 0x2
					savegamevar EPLOCK
					savegamevar EP1LOCKS
				}
				else ife userdef.volume_number 1
				{
					set endgame 10
					readgamevar EPLOCK
					readgamevar EP2LOCKS
					readgamevar EP22LOCKS
					or EP2LOCKS 0x1F
					or EP22LOCKS 0x1F
					or EPLOCK 0x4
					savegamevar EPLOCK
					savegamevar EP2LOCKS
					savegamevar EP22LOCKS
				}
				else ife userdef.volume_number 2
				{
					set endgame 13
					readgamevar EPLOCK
					readgamevar EP3LOCKS
					readgamevar EP32LOCKS
					or EP3LOCKS 0x1F
					or EP32LOCKS 0x1F
					or EPLOCK 0x8
					savegamevar EPLOCK
					savegamevar EP3LOCKS
					savegamevar EP32LOCKS
				}
				else ife userdef.volume_number 3
				{
					set endgame 30
					readgamevar EPLOCK
					readgamevar EP4LOCKS
					readgamevar EP42LOCKS
					or EP4LOCKS 0x1F
					or EP42LOCKS 0x1F
					or EPLOCK 0xF
					savegamevar EPLOCK
					savegamevar EP4LOCKS
					savegamevar EP42LOCKS
					
					//Unlock "Boss Fight" only levels
					ife userdef.player_skill 6
					{
						or EP1LOCKS 0x7F
						or EP22LOCKS 0x1F
						or EP42LOCKS 0x3F
						
						savegamevar EP1LOCKS
						savegamevar EP22LOCKS
						savegamevar EP42LOCKS
					}
					
					set enable_nuke 1
					setu[].enable_nuke enable_nuke
					savegamevar enable_nuke
					
					setsector[player[].cursectnum].lotag 0
					setp[].palette 0
				}
				
				set endgamecount 330
				set fades 8
				
				startscreen
				
				setsector[player[].cursectnum].lotag 0
				setp[].palette 0
				setuserdef[].eog 1
				setplayer[].gm 8
			}
		}
	}
	
	/*
	ife userdef.pause_on 1
	ife medieval_pause 1
	{
		qputs RQUOTE DISABLE MOUSE AIM TO PLAY THIS MODE
		screentext STARTALPHANUM 160 130 49152 0 0 RQUOTE 0 0 0 0 5 8 0 0 10 0 0 xdim ydim
	}
*/
endevent

//Level fadeout
appendevent EVENT_DISPLAYEND

	state TimeClock

	ife fpscont 1
	ifg StartLevelFadeout 0
	ife player[].gm 4
	{	
		screenpal 0 0 0 StartLevelFadeout
		
		set t_temp 255
		divru t_temp LEVELFADEOUTTIME
		sub StartLevelFadeout t_temp
	}

endevent

onevent EVENT_GETBONUSTILE

	setarray bonustile[0] userdef.return 0
	setarray bonustile[1] userdef.return 1
	setarray bonustile[2] userdef.return 2
	setarray bonustile[3] userdef.return 3
	setarray bonustile[4] userdef.return 4

endevent

var bonuscnt 0 0
var curlevel 0 0

onevent EVENT_DISPLAYBONUSSCREEN

	//digitalnumber DIGITALNUM 10 10 totalclock 0 0 16 0 0 xdim ydim
	
	set pulseshade totalclock
	shiftl pulseshade 5
	and pulseshade 2047
	sin pulseshade pulseshade
	shiftr pulseshade 11
	
	rotatesprite 160 100 SIZE1X 0 bonustile[0] 0 0 72 0 0 xdim ydim
	
	ife userdef.volume_number 0
	ife userdef.last_level 6
		set lastbonuslevel 1
	else ifg userdef.volume_number 0
	ifge userdef.last_level 10
	ifl userdef.last_level 12
		set lastbonuslevel 1
	else
		set lastbonuslevel 0
	
	ifl totalclock 10
	{
		ife userdef.enable_nuke 1
		ife userdef.nuke_active 1
			nullop
		else
		{
			//Calculate Episode score
			set t_temp 0
			set s_epscore 0
			whilen t_temp 11
			{
				set t_temp2 11
				mul t_temp2 userdef.volume_number
				set t_temp3 72
				mul t_temp3 score_id
				add t_temp2 t_temp
				add t_temp2 t_temp3
				
				add s_epscore record_scores[t_temp2]
				add t_temp 1
			}
			/*
			set t_temp userdef.volume_number
			add t_temp 66
			set t_temp3 72
			mul t_temp3 score_id
			add t_temp t_temp3
			set s_epscore record_scores[t_temp]
			*/
		}
		
		set t_temp userdef.level_number
		ifg t_temp 0
		{
			ifn userdef.eog 1
			{			
				set t_temp8 userdef.last_level
				sub t_temp8 1
				setu[].level_number t_temp8
				set curlevel t_temp8
			}
			else
				set curlevel userdef.level_number
			
			getp[].max_actors_killed t_temp8
			
			ifg player[].actors_killed t_temp8
				set t_temp8 player[].actors_killed
				
			getp[].max_secret_rooms t_temp9
			qgetsysstr RQUOTE2 STR_MAPNAME
			setu[].level_number t_temp
		}
		
		set t_temp7 0
	}
	
	ifge totalclock 1000000000
	ifl totalclock 1000000320
	{
		ife t_temp7 0
		{
			switch userdef.volume_number
				case 0
					set t_temp 1
					shiftl t_temp curlevel
					readgamevar EP1LOCKS
					or EP1LOCKS t_temp
					savegamevar EP1LOCKS
					break
					
				case 1
					readgamevar EP2LOCKS
					readgamevar EP22LOCKS
					ifg curlevel 5
					{
						set t_temp 1
						set t_temp2 curlevel
						sub t_temp2 5
						shiftl t_temp t_temp2
						or EP22LOCKS t_temp
						savegamevar EP22LOCKS
					}
					else
					{
						set t_temp 1
						shiftl t_temp curlevel
						or EP2LOCKS t_temp
						savegamevar EP2LOCKS
					}
					break
					
				case 2
					readgamevar EP3LOCKS
					readgamevar EP32LOCKS
					ifg curlevel 5
					{
						set t_temp 1
						set t_temp2 curlevel
						sub t_temp2 5
						shiftl t_temp t_temp2
						or EP32LOCKS t_temp
						savegamevar EP32LOCKS
					}
					else
					{
						set t_temp 1
						shiftl t_temp curlevel
						or EP3LOCKS t_temp
						savegamevar EP3LOCKS
					}
					break
					
				case 3
					readgamevar EP4LOCKS
					readgamevar EP42LOCKS
					ifg curlevel 5
					{
						set t_temp 1
						set t_temp2 curlevel
						sub t_temp2 5
						shiftl t_temp t_temp2
						or EP42LOCKS t_temp
						savegamevar EP42LOCKS
					}
					else
					{
						set t_temp 1
						shiftl t_temp curlevel
						or EP4LOCKS t_temp
						savegamevar EP4LOCKS
					}
					break
				
			endswitch
			
			ife userdef.enable_nuke 1
			ife userdef.nuke_active 1
				nullop
			else
			{
				set t_temp curlevel
				
				set t_temp2 11
				mul t_temp2 userdef.volume_number
				set t_temp3 72
				mul t_temp3 score_id
				add t_temp t_temp2
				add t_temp t_temp3
		
				setarray record_scores[t_temp] s_lvscore
				/*
				set t_temp3 6
				mul t_temp3 score_id
				add t_temp3 userdef.volume_number
				
				set s_kills s_lastkill
			
				mul s_kills SCORE_KILL
				getp[].secret_rooms s_secrets
				mul s_secrets SCORE_SECRET
				
				set s_temp s_doublekills
				mul s_temp 2
				mul s_temp SCORE_KILL
				
				add s_kills s_temp
				
				set s_temp s_multkills
				mul s_temp 4
				mul s_temp SCORE_KILL
				
				add s_kills s_temp
				
				set s_lvscore s_kills
				add s_lvscore s_secrets
				
				set s_temp s_items
				mul s_temp SCORE_ITEM
				add s_lvscore s_temp
				add s_lvscore s_destruction
				add s_lvscore s_weapshot
				
				set s_temp s_bosskill
				mul s_temp SCORE_BOSSKILL
				add s_lvscore s_temp
				
				add s_lvscore SCORE_LEVELFINISH
				
				add s_lvscore s_blowkills
				add s_lvscore s_shotblowkills
				
				set s_temp s_bodies
				mul s_temp SCORE_BODYDESTROY
				add s_lvscore s_temp
				
				add s_epscore s_lvscore
				
				set s_temp s_damage
				add s_temp s_blowdamage
				add s_temp s_killed
				
				set s_temp2 s_babekilled
				mul s_temp2 SCOREN_BABEKILLED
				add s_temp s_temp2
				
				mul s_temp -1
				
				sub s_lvscore s_damage
				sub s_lvscore s_blowdamage
				sub s_lvscore s_killed
					
				add s_lvscore s_score
				
				ifge s_bodies t_temp8
					add s_lvscore SCORE_NOBODIES
				
				ifge player[].secret_rooms t_temp9
					add s_lvscore SCORE_ALLSECRETS
				
				ifge s_destruction 100
					add s_lvscore SCORE_LVLWRECKED
				
				ifge s_lastkill t_temp8
					add s_lvscore SCORE_ALLKILLS
				
				ife s_damage 0
				ife s_blowdamage 0
					add s_lvscore SCORE_NODAMAGE
					
				mul s_lvscore s_mult
				*/
				set t_temp userdef.volume_number
				add t_temp 66
				set t_temp3 72
				mul t_temp3 score_id
				add t_temp t_temp3
				setarray record_scores[t_temp] s_epscore
				
				qstrcpy RQUOTE SCOREFILE
				writearraytofile record_scores RQUOTE
			}
			
			ife VOLUME 2
			ife userdef.player_skill 6
			ife userdef.last_level 4
				setu[].level_number 11
				
			ife VOLUME 2
			ife userdef.player_skill 6
			ife userdef.last_level 12
				setu[].level_number 5
			
			ife userdef.eog 1
			{
				set title 10
				set fader 0
				set fadeg 0
				set fadeb 0
				set fadec 0
				set fades 16
				set title_count 390
			}
			
			set t_temp7 1
		}
	
		set t_temp totalclock
		shiftr t_temp 4
		mod t_temp 15
		
		switch t_temp
			case 1
			case 4
			case 5
				rotatesprite 199 31 SIZE1X 0 bonustile[3] 0 0 88 0 0 xdim ydim
				break
			case 2
			case 3
				rotatesprite 199 31 SIZE1X 0 bonustile[4] 0 0 88 0 0 xdim ydim
				break
		endswitch
		
		ife userdef.customep 0
		ife userdef.eog 1
		ifg totalclock 1000000200
		{
			state FadeInScreen
			set t_temp 0
			set t_temp2 ydim
			div t_temp2 120
			
			ifg fadec 254
				startscreen
		}
	}
	else ifg totalclock 1000000360
		nullop
	else
	{
		set t_temp totalclock
		shiftr t_temp 5
		mod t_temp 3
	
		switch t_temp
			case 1
			case 3
				rotatesprite 199 31 SIZE1X 0 bonustile[1] 0 0 88 0 0 xdim ydim
				break
				
			case 2
				rotatesprite 199 31 SIZE1X 0 bonustile[2] 0 0 88 0 0 xdim ydim
				break
		endswitch
	}
	
	//qgetsysstr RQUOTE STR_MAPNAME
	screentext BIGALPHANUM 160 10 SIZE1X 0 0 RQUOTE2 0 0 16 0 5 16 0 0 1056778 0 0 xdim ydim
	
	redefinequote RQUOTE COMPLETED
	screentext BIGALPHANUM 160 25 SIZE1X 0 0 RQUOTE 0 0 16 0 5 16 0 0 1056778 0 0 xdim ydim
	
	redefinequote RQUOTE Press any key or button to continue
	screentext STARTALPHANUM 160 192 SIZE1X 0 0 RQUOTE pulseshade 0 16 0 5 8 0 0 2 0 0 xdim ydim
	
	ife totalclock 179
		set t_temp6 0
	
	ifg totalclock 180
	{
		redefinequote RQUOTE SECRETS FOUND:
		screentext STARTALPHANUM 10 68 65536 0 0 RQUOTE 0 0 16 0 5 8 0 0 0 0 0 xdim ydim
		
		redefinequote RQUOTE ENEMIES KILLED:
		screentext STARTALPHANUM 10 78 65536 0 0 RQUOTE 0 0 16 0 5 8 0 0 0 0 0 xdim ydim
		
		redefinequote RQUOTE ENEMIES BLOWN:
		screentext STARTALPHANUM 10 88 65536 0 0 RQUOTE 0 0 16 0 5 8 0 0 0 0 0 xdim ydim
		
		ifg totalclock 240
		{
			redefinequote RQUOTE %d/%d
			qsprintf RQUOTE RQUOTE player[].secret_rooms t_temp9
			screentext STARTALPHANUM 150 68 65536 0 0 RQUOTE 0 0 16 0 5 8 0 0 0 0 0 xdim ydim
		
			redefinequote RQUOTE %d/%d
			qsprintf RQUOTE RQUOTE s_lastkill t_temp8
			screentext STARTALPHANUM 150 78 65536 0 0 RQUOTE 0 0 16 0 5 8 0 0 0 0 0 xdim ydim
			
			set s_temp s_bodies
			
			redefinequote RQUOTE %d
			qsprintf RQUOTE RQUOTE s_temp
			screentext STARTALPHANUM 150 88 65536 0 0 RQUOTE 0 0 16 0 5 8 0 0 0 0 0 xdim ydim
		}
		
		ifg totalclock 360
		{
			redefinequote RQUOTE LEVEL SCORE:
			screentext STARTALPHANUM 10 103 65536 0 0 RQUOTE 0 0 16 0 5 8 0 0 0 0 0 xdim ydim
		
			redefinequote RQUOTE DAMAGE/DEATHS:
			screentext STARTALPHANUM 10 113 65536 0 0 RQUOTE 0 0 16 0 5 8 0 0 0 0 0 xdim ydim
			
			set t_temp 0
			
			set t_temp3 0
			
			ifge s_bodies t_temp8
			{
				set t_temp 1
				
				add t_temp3 SCORE_NOBODIES
				
				ifg totalclock 375
				{
					redefinequote RQUOTE NO BODIES
					screentext STARTALPHANUM 65 125 32768 0 0 RQUOTE 0 0 16 0 5 8 0 0 0 0 0 xdim ydim
				}
				
				set bodiesprize 1
			}
			
			ifge player[].secret_rooms t_temp9
			{
				set t_temp 1
				
				add t_temp3 SCORE_ALLSECRETS
				
				ifg totalclock 405
				{
					redefinequote RQUOTE ALL SECRETS
					screentext STARTALPHANUM 160 125 32768 0 0 RQUOTE 0 0 16 0 5 8 0 0 0 0 0 xdim ydim
				}
				
				set secretprize 1
			}
			
			ifge s_destruction 1000
			{
				set t_temp 1
				
				add t_temp3 SCORE_LVLWRECKED
				
				ifg totalclock 390
				{
					redefinequote RQUOTE WRECKED MAP
					screentext STARTALPHANUM 107 125 32768 0 0 RQUOTE 0 0 16 0 5 8 0 0 0 0 0 xdim ydim
				}
				
				set itemsprize 1
			}
			
			ifge s_lastkill t_temp8
			{
				set t_temp 1
				
				add t_temp3 SCORE_ALLKILLS
				
				ifg totalclock 420
				{
					redefinequote RQUOTE ALL KILLS
					screentext STARTALPHANUM 213 125 32768 0 0 RQUOTE 0 0 16 0 5 8 0 0 0 0 0 xdim ydim
				}
				
				set killsprize 1
			}
			
			ife s_damage 0
			ife s_blowdamage 0
			{
				set t_temp 1
				
				add t_temp3 SCORE_NODAMAGE
				
				ifg totalclock 420
				{
					redefinequote RQUOTE NO DAMAGE
					screentext STARTALPHANUM 210 68 SIZE1X 0 0 RQUOTE 0 0 16 0 5 8 0 0 0 0 0 xdim ydim
				}
				
				set damageprize 1
			}
			
			ife t_temp 1
			{
				redefinequote RQUOTE BONUS!
				screentext STARTALPHANUM 10 123 65536 0 0 RQUOTE 0 0 16 0 5 8 0 0 0 0 0 xdim ydim
			}
		}
		
		ifg totalclock 420
		{
			ife userdef.enable_nuke 1
			ife userdef.nuke_active 1
			{
				redefinequote RQUOTE NO POINTS (NUKE MODE ON)
				qsprintf RQUOTE RQUOTE s_lvscore
				screentext STARTALPHANUM 150 103 SIZE1X 0 0 RQUOTE 0 0 16 0 5 8 0 0 0 0 0 xdim ydim
				screentext STARTALPHANUM 150 113 SIZE1X 0 0 RQUOTE 0 0 16 0 5 8 0 0 0 0 0 xdim ydim
			}
			else
			{
				set s_kills s_lastkill
			
				mul s_kills SCORE_KILL
				getp[].secret_rooms s_secrets
				mul s_secrets SCORE_SECRET
				
				set s_temp s_doublekills
				mul s_temp 2
				mul s_temp SCORE_KILL
				
				add s_kills s_temp
				
				set s_temp s_multkills
				mul s_temp 4
				mul s_temp SCORE_KILL
				
				add s_kills s_temp
				
				set s_lvscore s_kills
				add s_lvscore s_secrets
				
				set s_temp s_items
				mul s_temp SCORE_ITEM
				add s_lvscore s_temp
				add s_lvscore s_destruction
				add s_lvscore s_weapshot
				
				set s_temp s_bosskill
				mul s_temp SCORE_BOSSKILL
				add s_lvscore s_temp
				
				add s_lvscore SCORE_LEVELFINISH
				
				add s_lvscore s_blowkills
				add s_lvscore s_shotblowkills
				
				set s_temp s_bodies
				mul s_temp SCORE_BODYDESTROY
				add s_lvscore s_temp
				
				set s_temp s_babesaved
				mul s_temp SCORE_BABESAVED
				add s_lvscore s_temp
				add s_lvscore t_temp3
			
				redefinequote RQUOTE %d POINTS
				qsprintf RQUOTE RQUOTE s_lvscore
				screentext STARTALPHANUM 150 103 SIZE1X 0 0 RQUOTE 0 0 16 0 5 8 0 0 0 0 0 xdim ydim
				
				set s_temp s_damage
				
				//ife userdef.player_skill 6
					//mul s_temp 2
				
				add s_temp s_blowdamage
				add s_temp s_killed
				
				set s_temp2 s_babekilled
				mul s_temp2 SCOREN_BABEKILLED
				add s_temp s_temp2
				
				mul s_temp -1
				
				redefinequote RQUOTE %d POINTS
				qsprintf RQUOTE RQUOTE s_temp
				screentext STARTALPHANUM 150 113 SIZE1X 0 0 RQUOTE 0 0 16 0 5 8 0 0 0 0 0 xdim ydim
				
				ifg totalclock 600
				{
					redefinequote RQUOTE TOTAL (%dX):
					qsprintf RQUOTE RQUOTE s_mult
					screentext STARTALPHANUM 10 142 65536 0 0 RQUOTE 0 0 16 0 5 8 0 0 0 0 0 xdim ydim
					
					set s_temp s_damage
				
					//ife userdef.player_skill 6
						//mul s_temp 2
					
					sub s_lvscore s_temp
					sub s_lvscore s_blowdamage
					sub s_lvscore s_killed
					
					add s_lvscore s_score
					
					mul s_lvscore s_mult
					
					set s_temp s_lvscore
					
					sub s_temp t_temp6
					
					set s_temp2 16
					
					ifg s_temp 512
						set s_temp2 32
					
					ifg s_temp 1024
						set s_temp2 64
					
					ifl s_temp 16
						set t_temp6 s_lvscore
					else
						add t_temp6 s_temp2
						
					ifge totalclock 1000000000
						set t_temp6 s_lvscore
						
					redefinequote RQUOTE %d POINTS
					qsprintf RQUOTE RQUOTE t_temp6
					screentext STARTALPHANUM 150 142 65536 0 0 RQUOTE 0 0 16 0 5 8 0 0 0 0 0 xdim ydim
					
					ife userdef.eog 1
					{
						redefinequote RQUOTE EPISODE TOTAL:
						screentext STARTALPHANUM 10 162 SIZE1X 0 0 RQUOTE 0 0 16 0 5 8 0 0 0 0 0 xdim ydim
						
						set t_temp s_lvscore
						add t_temp s_epscore
						
						redefinequote RQUOTE %d POINTS
						qsprintf RQUOTE RQUOTE t_temp
						screentext STARTALPHANUM 150 162 SIZE1X 0 0 RQUOTE 0 0 16 0 5 8 0 0 0 0 0 xdim ydim
					}
				}
			}
		}
	}

endevent

var slotdefine 0 0
var menushade 0 0
var orx 0 0
var ory 0 0
var cursortilel 0 0
var cursortiler 0 0
var menuentry 0 0
var cursorentry 0 0
var lastcursorentry 0 0
var entermenuskill 0 0

onevent EVENT_CHANGEMENU

	state getNukePowerup

	ife RETURN MENU_NEWGAMECUSTOM
	{
		ife current_menu MENU_MAIN
		{
			state CheckIfSlotsWereUsed
			
			ife t_temp2 0
			{
				setpname 9000 THISACTOR
				set slotdefine 1
				set score_id 0
				set RETURN MENU_PLAYER
			}
			else
			{
				ife score_id -1
					set RETURN MENU_EPISODE
				else
					set RETURN MENU_NEWGAMECUSTOM
			}
		}
		else ife current_menu MENU_NEWVERIFY
		{
			state CheckIfSlotsWereUsed
			
			ife t_temp2 0
			{
				setpname 9000 THISACTOR
				set score_id 0
				set slotdefine 2
				set RETURN MENU_PLAYER
			}
			else
			{
				ife score_id -1
					set RETURN MENU_EPISODE
				else
					set RETURN MENU_NEWGAMECUSTOM
			}
		}
	}	

	ife RETURN MENU_OPTIONS
	ife current_menu MENU_PLAYER
	{
		ife slotdefine 1
			set RETURN MENU_MAIN
		else ife slotdefine 2
			set RETURN MENU_MAIN_INGAME
		else ife slotdefine 3
			set RETURN MENU_EPISODE
			
		ifg slotdefine 0
		{	
			set score_id -1
		
			set slotdefine 0
		}
		else
		{
			getpname RQUOTE THISACTOR
			set t_temp 9000
			add t_temp score_id
			
			qputs RQUOTE2 %s
			
			qsprintf t_temp RQUOTE2 RQUOTE
			
			qstrcpy RQUOTE NAMESFILE
			writequotestofile RQUOTE 9000 9015
		}
	}
	
	ife RETURN MENU_MACROS
	ife current_menu MENU_PLAYER
	{
		ifg slotdefine 0
			set RETURN MENU_NEWGAMECUSTOM
		
		setarray s_slotused[score_id] 1
		
		qstrcpy RQUOTE SLOTFILE
		writearraytofile s_slotused RQUOTE
		
		getpname RQUOTE THISACTOR
		set t_temp 9000
		add t_temp score_id
		
		qputs RQUOTE2 %s
		
		qsprintf t_temp RQUOTE2 RQUOTE
		
		qstrcpy RQUOTE NAMESFILE
		writequotestofile RQUOTE 9000 9015
		
		state ClearScore
		
		qstrcpy RQUOTE SCOREFILE
		writearraytofile record_scores RQUOTE
		
		savegamevar score_id
		
		set slotdefine 0
	}
	
	ife RETURN MENU_SKILL
	{
		ife current_menu MENU_EPISODE
		{	
			ife menuentry 6
				set menuentry 5
				
			set t_temp 9000
			add t_temp menuentry
			setpname t_temp THISACTOR
			
			ife s_slotused[menuentry] 0
			{
				set score_id menuentry
				set RETURN MENU_PLAYER
				set slotdefine 3
			}
			else
			{
				set score_id menuentry
				set RETURN MENU_NEWGAMECUSTOM
			}
			
			savegamevar score_id
			
		}
		else ife current_menu MENU_NEWGAMECUSTOM
		{
			ife menuentry 5
			{
				set score_id -1
				set RETURN MENU_EPISODE
			}
		}
		else ife current_menu MENU_NEWGAMECUSTOMSUB
		{
			set entermenuskill 1
		}
		else ife current_menu MENU_NEWGAMECUSTOML3
			set entermenuskill 1
		else ife current_menu 30000
			set entermenuskill 1
	}
	else
		set entermenuskill 0
	
	ife RETURN MENU_USERMAP
	{
		ife current_menu MENU_EPISODE
		{	
			ife menuentry 6
				set menuentry 5
			
			ife s_slotused[menuentry] 0
			{
				set score_id menuentry
				set RETURN MENU_PLAYER
				set slotdefine 3
			}
			else
			{
				set score_id menuentry
				set RETURN MENU_NEWGAMECUSTOM
			}
			
		}
	}
	
endevent

onevent EVENT_MENUSHADESELECTED

	set menushade RETURN

endevent

appendevent EVENT_DISPLAYMENU

	switch userdef.nuke_wpnsel
		case 0
			setarray wpnroster[SHOTGUN_WEAPON] 0
			setarray wpnroster[SHOTGUNDOUBLE_WEAPON] 0
			setarray wpnroster[CHAINGUN_WEAPON] 0
			setarray wpnroster[PLASMA_WEAPON] 0
			setarray wpnroster[RPG_WEAPON] 0
			setarray wpnroster[RPGBLAST_WEAPON] 0
			setarray wpnroster[SHRINKER_WEAPON] 0
			setarray wpnroster[GROW_WEAPON] 0
			setarray wpnroster[DEVISTATOR_WEAPON] 0
			setarray wpnroster[SONICRESONATOR_WEAPON] 0
			setarray wpnroster[FREEZE_WEAPON] 0
			setarray wpnroster[FLAME_WEAPON] 0
			setarray wpnroster[CATERKILAR_WEAPON] 0
			
			setarray wpnrosterpwr[PISTOL_WEAPON] 0
			setarray wpnrosterpwr[SHOTGUNDOUBLE_WEAPON] 0
			setarray wpnrosterpwr[PLASMA_WEAPON] 0
			setarray wpnrosterpwr[RPG_WEAPON] 0
			setarray wpnrosterpwr[DEVISTATOR_WEAPON] 0
			setarray wpnrosterpwr[FLAME_WEAPON] 0
			break
	
		case 1
			setarray wpnroster[SHOTGUN_WEAPON] 0
			setarray wpnroster[SHOTGUNDOUBLE_WEAPON] 1
			setarray wpnroster[CHAINGUN_WEAPON] 0
			setarray wpnroster[PLASMA_WEAPON] 1
			setarray wpnroster[RPG_WEAPON] 0
			setarray wpnroster[RPGBLAST_WEAPON] 1
			setarray wpnroster[SHRINKER_WEAPON] 0
			setarray wpnroster[GROW_WEAPON] 1
			setarray wpnroster[DEVISTATOR_WEAPON] 1
			setarray wpnroster[SONICRESONATOR_WEAPON] 1
			setarray wpnroster[FREEZE_WEAPON] 1
			setarray wpnroster[FLAME_WEAPON] 0
			setarray wpnroster[CATERKILAR_WEAPON] 1
			
			setarray wpnrosterpwr[PISTOL_WEAPON] 2
			setarray wpnrosterpwr[SHOTGUNDOUBLE_WEAPON] 1
			setarray wpnrosterpwr[PLASMA_WEAPON] 0
			setarray wpnrosterpwr[RPG_WEAPON] 2
			setarray wpnrosterpwr[FLAME_WEAPON] 0
			break
			
		case 2
			setarray wpnroster[SHOTGUN_WEAPON] 1
			setarray wpnroster[SHOTGUNDOUBLE_WEAPON] 1
			setarray wpnroster[CHAINGUN_WEAPON] 1
			setarray wpnroster[PLASMA_WEAPON] 0
			setarray wpnroster[RPG_WEAPON] 0
			setarray wpnroster[RPGBLAST_WEAPON] 1
			setarray wpnroster[SHRINKER_WEAPON] 0
			setarray wpnroster[GROW_WEAPON] 0
			setarray wpnroster[DEVISTATOR_WEAPON] 1
			setarray wpnroster[SONICRESONATOR_WEAPON] 1
			setarray wpnroster[FREEZE_WEAPON] 1
			setarray wpnroster[FLAME_WEAPON] 0
			setarray wpnroster[CATERKILAR_WEAPON] 1
			
			setarray wpnrosterpwr[PISTOL_WEAPON] 1
			setarray wpnrosterpwr[SHOTGUNDOUBLE_WEAPON] 1
			setarray wpnrosterpwr[PLASMA_WEAPON] 0
			setarray wpnrosterpwr[RPG_WEAPON] 2
			setarray wpnrosterpwr[FLAME_WEAPON] 0
			break
			
		case 3
			setarray wpnroster[SHOTGUN_WEAPON] 1
			setarray wpnroster[SHOTGUNDOUBLE_WEAPON] 1
			setarray wpnroster[CHAINGUN_WEAPON] 1
			setarray wpnroster[PLASMA_WEAPON] 0
			setarray wpnroster[RPG_WEAPON] 1
			setarray wpnroster[RPGBLAST_WEAPON] 0
			setarray wpnroster[SHRINKER_WEAPON] 0
			setarray wpnroster[GROW_WEAPON] 0
			setarray wpnroster[DEVISTATOR_WEAPON] 1
			setarray wpnroster[SONICRESONATOR_WEAPON] 1
			setarray wpnroster[FREEZE_WEAPON] 1
			setarray wpnroster[FLAME_WEAPON] 0
			setarray wpnroster[CATERKILAR_WEAPON] 1
			
			setarray wpnrosterpwr[PISTOL_WEAPON] 1
			setarray wpnrosterpwr[SHOTGUNDOUBLE_WEAPON] 1
			setarray wpnrosterpwr[PLASMA_WEAPON] 0
			setarray wpnrosterpwr[RPG_WEAPON] 0
			setarray wpnrosterpwr[FLAME_WEAPON] 0
			break
			
		case 4
			setarray wpnroster[SHOTGUN_WEAPON] 1
			setarray wpnroster[SHOTGUNDOUBLE_WEAPON] 1
			setarray wpnroster[CHAINGUN_WEAPON] 1
			setarray wpnroster[PLASMA_WEAPON] 0
			setarray wpnroster[RPG_WEAPON] 1
			setarray wpnroster[RPGBLAST_WEAPON] 0
			setarray wpnroster[SHRINKER_WEAPON] 0
			setarray wpnroster[GROW_WEAPON] 0
			setarray wpnroster[DEVISTATOR_WEAPON] 1
			setarray wpnroster[SONICRESONATOR_WEAPON] 0
			setarray wpnroster[FREEZE_WEAPON] 1
			setarray wpnroster[FLAME_WEAPON] 1
			setarray wpnroster[CATERKILAR_WEAPON] 0
			
			setarray wpnrosterpwr[PISTOL_WEAPON] 1
			setarray wpnrosterpwr[SHOTGUNDOUBLE_WEAPON] 1
			setarray wpnrosterpwr[PLASMA_WEAPON] 1
			setarray wpnrosterpwr[RPG_WEAPON] 0
			setarray wpnrosterpwr[FLAME_WEAPON] 1
			break
	endswitch

	set orx userdef.return 1
	set ory userdef.return 2
	set menuentry userdef.return 3
	
	screenpal 0 0 0 0

	ife RETURN MENU_PLAYER
	ifg slotdefine 0
		rotatesprite orx ory SIZE1X 0 MENUSCREEN 16 0 24 0 0 xdim ydim
		
	ife RETURN MENU_EPISODE
	{
		setu[].return 2 13107200
	}
	else ife RETURN MENU_MAIN
	{
		ifand player[].gm 4
			nullop
		else
		{
			ife startMenu 0
				setu[].return 2 13107200
			else ife startMenu 1
			{			
				set t_temp9 60
				sub t_temp9 startMenuTime
				
				screenpal 255 255 255 t_temp9
				
				set t_temp9 startMenuTime
				mul t_temp9 100
				div t_temp9 60
					
				set t_temp11 t_temp9
				sub t_temp11 100
				set t_temp10 t_temp11
				mul t_temp11 t_temp11
				mul t_temp11 t_temp10
				mul t_temp11 -1
				div t_temp11 1000
				set t_temp10 t_temp11
				set t_temp11 100
				sub t_temp11 t_temp10
				set t_temp13 t_temp11
						
				mul t_temp13 200
				div t_temp13 100
									
				set t_temp14 200
				sub t_temp14 t_temp13
				shiftl t_temp14 16
						
				setu[].return 2 t_temp14
				
				ifl startMenuTime 60
					add startMenuTime 1
				else
				{
					set startMenu 2
					screensound SHOTGUN_COCK
				}
			}
		}
	}
	

endevent

onevent EVENT_MENUCURSORLEFT

	set cursortilel RETURN

endevent

onevent EVENT_MENUCURSORRIGHT

	set cursortiler RETURN

endevent

defstate CursorChange

	ifn lastcursorentry cursorentry
	{
		setu[].return 5 cursorentry
		screensound KICK_HIT
	}
	
	ife userdef.m_mouseclickstate 2
	ifge orx 70
	ifle orx 250
	{
		setu[].m_mouseclickstate 0
		screensound PISTOL_BODYHIT
		cmenu t_temp5
		set t_temp 5
	}

ends

onevent EVENT_DISPLAYCURSOR

	ife current_menu MENU_EPISODE
	{
		set t_temp 0
		set t_temp5 MENU_SKILL
		
		whilen t_temp 6
		{
			set t_temp2 50
			set t_temp3 18
			mul t_temp3 t_temp
			add t_temp2 t_temp3
				
			set t_temp4 t_temp2
			add t_temp4 18
			
			set orx userdef.return 1
			set ory userdef.return 2
			shiftr orx 16
			shiftr ory 16
			
			ifge ory t_temp2
			ifle ory t_temp4
			{
				ife t_temp 5
					set cursorentry 6
				else
					set cursorentry t_temp
					
				state CursorChange
			}
			else ife t_temp 5
			ifge ory t_temp2
			{
				set cursorentry 6
				state CursorChange
			}
			else ife t_temp 0
			ifle ory t_temp2
			{
				set cursorentry 0
				state CursorChange
			}
			
			add t_temp 1
		}
	}
	
	set lastcursorentry cursorentry

endevent

appendevent EVENT_DISPLAYMENUREST

	set orx userdef.m_origin_x
	set ory userdef.m_origin_y
		
	shiftr orx 16
	shiftr ory 16
	
	ife RETURN MENU_SKILL
	{
		ife entermenuskill 1
			set entermenuskill 2
			
		ife userdef.return 3 3
		{
			qputs RQUOTE ENEMIES DO 2X MORE DAMAGE TO YOU
			screentext STARTALPHANUM 160 180 32768 0 0 RQUOTE 0 0 8 0 5 8 0 0 10 0 0 xdim ydim
		}
		else ife userdef.return 3 4
		{
			qputs RQUOTE ENEMIES DO 3X MORE DAMAGE TO YOU
			screentext STARTALPHANUM 160 180 32768 0 0 RQUOTE 0 0 8 0 5 8 0 0 10 0 0 xdim ydim
			qputs RQUOTE (VETERANS ONLY)
			screentext STARTALPHANUM 160 184 32768 0 0 RQUOTE 0 0 8 0 5 8 0 0 10 0 0 xdim ydim
		}
		else ife userdef.return 3 5
		{
			qputs RQUOTE ENEMIES DO 4X MORE DAMAGE TO YOU,
			screentext STARTALPHANUM 160 180 32768 0 0 RQUOTE 0 0 8 0 5 8 0 0 10 0 0 xdim ydim
			qputs RQUOTE MAPS ARE MIRRORED, LESS AMMO FROM PICKUPS
			screentext STARTALPHANUM 160 184 32768 0 0 RQUOTE 0 0 8 0 5 8 0 0 10 0 0 xdim ydim
			qputs RQUOTE PLAYER STARTS WITH THE LASER CHAINSAW
			screentext STARTALPHANUM 160 188 32768 0 0 RQUOTE 0 0 8 0 5 8 0 0 10 0 0 xdim ydim
			qputs RQUOTE (BUILD ENGINE VETERANS ONLY)
			screentext STARTALPHANUM 160 192 32768 0 0 RQUOTE 0 0 8 0 5 8 0 0 10 0 0 xdim ydim
		}
	}

	ife RETURN MENU_PLAYER
	ifg slotdefine 0
	{
		set t_temp ydim
		mul t_temp 35
		div t_temp 100
		
		set t_temp2 xdim
		mul t_temp2 93
		div t_temp2 1000
		
		set t_temp3 xdim
		mul t_temp3 60
		div t_temp3 100
		
		rotatesprite orx ory SIZE1X 0 MENUSCREEN 16 0 24 t_temp2 t_temp t_temp3 ydim
		
		add orx 32
		add ory 77
		set t_temp3 8
		
		ife userdef.return 3 6
			set t_temp3 menushade	
		
		qputs RQUOTE APPLY
		screentext STARTALPHANUM orx ory SIZE1X 0 0 RQUOTE t_temp3 0 24 0 5 8 0 0 0 0 0 xdim ydim
	}
	
	ife RETURN MENU_EPISODE
	{
		//qstrcpy RQUOTE 9000
		
		add orx 160
		
		//Title bar
		rotatesprite orx 19 SIZE1X 0 MENUBAR 16 0 8 0 0 xdim ydim
		qputs RQUOTE SELECT A PLAYER
		screentext BIGALPHANUM orx 24 SIZE1X 0 0 RQUOTE 0 0 8 0 5 8 0 0 1056770 0 0 xdim ydim
		/*
		ifn cursorentry -1
		{
			set t_temp4 cursorentry
			setu[].return 5 cursorentry
		}
		else
		*/
		set t_temp4 userdef.return 3
		
		//Slots
		ife t_temp4 0
			set t_temp3 menushade
		else
			set t_temp3 8
		
		screentext BIGALPHANUM orx 60 SIZE1X 0 0 9000 t_temp3 0 8 0 5 8 0 0 1056770 0 0 xdim ydim
		
		ife t_temp4 1
			set t_temp3 menushade
		else
			set t_temp3 8
		
		screentext BIGALPHANUM orx 78 SIZE1X 0 0 9001 t_temp3 0 8 0 5 8 0 0 1056770 0 0 xdim ydim
		
		ife t_temp4 2
			set t_temp3 menushade
		else
			set t_temp3 8
		
		screentext BIGALPHANUM orx 96 SIZE1X 0 0 9002 t_temp3 0 8 0 5 8 0 0 1056770 0 0 xdim ydim
		
		ife t_temp4 3
			set t_temp3 menushade
		else
			set t_temp3 8
		
		screentext BIGALPHANUM orx 114 SIZE1X 0 0 9003 t_temp3 0 8 0 5 8 0 0 1056770 0 0 xdim ydim
		
		ife t_temp4 4
			set t_temp3 menushade
		else
			set t_temp3 8
		
		screentext BIGALPHANUM orx 132 SIZE1X 0 0 9004 t_temp3 0 8 0 5 8 0 0 1056770 0 0 xdim ydim
		
		ife t_temp4 6
			set t_temp3 menushade
		else
			set t_temp3 8
		
		screentext BIGALPHANUM orx 150 SIZE1X 0 0 9005 t_temp3 0 8 0 5 8 0 0 1056770 0 0 xdim ydim
		
		//Cursor
		sub orx 160
		add orx 50
		
		set ory 55
		set t_temp3 18
		
		ife t_temp4 6
			mul t_temp3 5
		else
			mul t_temp3 t_temp4
			
		add ory t_temp3
		
		rotatesprite orx ory SIZE1X 0 cursortilel 0 0 8 0 0 xdim ydim
		
		add orx 220
		
		rotatesprite orx ory SIZE1X 0 cursortiler 0 0 8 0 0 xdim ydim
	}
	
	//set cursorentry -1

endevent

onevent EVENT_DISPLAYINACTIVEMENU

	set orx userdef.return 1
	set ory userdef.return 2

	ife RETURN MENU_PLAYER
	ifg slotdefine 0
		rotatesprite orx ory SIZE1X 0 MENUSCREEN 16 0 24 0 0 xdim ydim
		
	ife RETURN MENU_EPISODE
	{
		setu[].return 2 13107200
	}

endevent

onevent EVENT_DISPLAYINACTIVEMENUREST

	ife RETURN MENU_PLAYER
	ifg slotdefine 0
	{
		set t_temp ydim
		mul t_temp 35
		div t_temp 100
		
		set t_temp2 xdim
		mul t_temp2 93
		div t_temp2 1000
		
		set t_temp3 xdim
		mul t_temp3 70
		div t_temp3 100
		
		set orx userdef.return 1
		set ory userdef.return 2
		
		shiftr orx 16
		shiftr ory 16
		
		add t_temp2 orx
		add t_temp3 orx
		
		rotatesprite orx ory SIZE1X 0 MENUSCREEN 16 0 24 t_temp2 t_temp t_temp3 ydim
		
		add orx 32
		add ory 77
		set t_temp3 0
		
		ife userdef.return 3 6
			set t_temp3 menushade	
		
		qputs RQUOTE APPLY
		screentext STARTALPHANUM orx ory SIZE1X 0 0 RQUOTE t_temp3 0 24 0 5 8 0 0 0 0 0 xdim ydim
	}
	
	set t_temp6 160
	set t_temp8 userdef.return 1
	shiftr t_temp8 16
	add t_temp6 t_temp8
	set t_temp7 30
	
	switch RETURN
	
		case MENU_MAIN_INGAME
			add t_temp7 4
		case MENU_MAIN
			rotatesprite t_temp6 t_temp7 65536 0 INGAMEDUKETHREEDEE 0 0 10 0 0 xdim ydim
			break
		
	endswitch

endevent

onevent EVENT_GETMENUTILE
	
	ife userdef.on_mobile 1
		set RETURN 3584
	else
	{
		set t_temp2 300
		div t_temp2 44
		
		ifg totalclock menu_next_frame
		{
			sub MENU_TILE_CURR 1
			set menu_next_frame totalclock
			add menu_next_frame t_temp2
		}
		else
		{
			set t_temp menu_next_frame
			sub t_temp totalclock
			ifg t_temp 480
			{
				set menu_next_frame totalclock
				add menu_next_frame t_temp2
			}
		}
		
		set RETURN MENU_TILE_CURR
		
		set t_temp MENUBG
		sub t_temp 44
		
		ife MENU_TILE_CURR t_temp
			set MENU_TILE_CURR MENUBG
	}	

endevent

appendevent EVENT_SOUND

	ife entermenuskill 2
	{
		//set entermenuskill 0
		
		ife RETURN JIBBED_ACTOR6
		ife userdef.m_player_skill 1
			set RETURN DUKE_GETWEAPON3
		else ife RETURN BONUS_SPEECH1
		ife userdef.m_player_skill 2
			set RETURN JIBBED_ACTOR6
		else ife RETURN DUKE_GETWEAPON2
		ife userdef.m_player_skill 3
			set RETURN BONUS_SPEECH1
		else ife RETURN JIBBED_ACTOR5
		ife userdef.m_player_skill 4
			set RETURN DUKE_GETWEAPON2
		else ife RETURN PISTOL_BODYHIT
		ife userdef.m_player_skill 5
			set RETURN JIBBED_ACTOR5
		else ife RETURN PISTOL_BODYHIT
		ife userdef.m_player_skill 6
		{
			set RETURN JIBBED_ACTOR11
			
			ife userdef.m_volume_number 2
			ife userdef.m_level_number 4
				setu[].m_level_number 11
		}
			
		
	}

endevent
