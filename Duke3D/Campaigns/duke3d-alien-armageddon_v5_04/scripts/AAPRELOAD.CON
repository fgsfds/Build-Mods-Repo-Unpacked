onevent EVENT_NEWGAME

	gettimedate temp tempb tempc x x x x x
	add temp 1 add tempb 1 add tempc 1
	mul temp tempb
	mul temp tempc
	shiftvarr temp 6
	whilevarn temp 0
    {
    ifrnd 1 { }
    subvar temp 1
    }
	readgamevar attbosses
	
	readgamevar attbeaten
	ifl attbeaten 5 set attbeaten 5
	readgamevar randomstart
	readgamevar charlocked
	orvar charlocked 1
	orvar charlocked 4
	
	readgamevar disable_tips
	readgamevar radaron 
	readgamevar MONHUD ife MONHUD NO set MONHUD YES
	readgamevar SHOWPOINTS ife SHOWPOINTS NO set SHOWPOINTS YES
	readgamevar STEPSOUNDS ife STEPSOUNDS NO set STEPSOUNDS YES
	readgamevar AUTOSAVE ife AUTOSAVE NO set AUTOSAVE YES
	readgamevar disable_doubletap
	readgamevar disable_kickheads
	
	ifn marathon 2
	{
	readgamevar avoid_melee
	readgamevar disable_infighting
	readgamevar jibs_duration ife jibs_duration 0 set jibs_duration 1800
	readgamevar mirror_maps
	readgamevar random_items
	readgamevar NEWENEMIES ife NEWENEMIES NO set NEWENEMIES RANDOMENEMIES
	}
	setarray highscores[0] 200000
	setarray highscores[1] 180000
	setarray highscores[2] 160000
	setarray highscores[3] 140000
	setarray highscores[4] 120000
	setarray highscores[5] 100000
	setarray highscores[6] 80000
	setarray highscores[7] 60000
	setarray highscores[8] 40000
	setarray highscores[9] 20000
	setarray highscores[10] 10000
	setarray highscores[11] 5000
	readarrayfromfile recentmaps 1250
	readarrayfromfile highscores 3106
	addvar randomstart 1
	andvar randomstart 65535
	setvarvar temp randomstart
	xorvar temp 43690
	whilevarn temp 0
    {
    ifrnd 1 { }
    subvar temp 1
    }
    savegamevar randomstart
	
	rand pigcount 3
	rand troopcount 3
	rand commcount 3
	rand lizcount 3
	rand octacount 3
	rand dronecount 3
	rand beastcount 3
	rand termcount 6
	rand mechcount 3
	rand antcount 3
	// setuserdef[].textscale 300
	
	getuserdef[].player_skill SKILL
	ife SKILL 4 setuserdef[].player_skill 5
	al SKILL

	setarray dukeupgrades[TRIPBOMB_WEAPON] YES
	setarray shellyupgrades[TRIPBOMB_WEAPON] YES
	setarray mandoupgrades[TRIPBOMB_WEAPON] YES
	setarray novaupgrades[TRIPBOMB_WEAPON] YES
	// setarray wesupgrades[PISTOL_WEAPON] 4
	
	set temp MAXSHOTGUNAMMO, add temp 1
	smaxammo SHOTGUN_WEAPON temp
	
	// set the default weapons as "owned" so that the player doesn't have to buy them as upgrades
	setarray weap_owned[0] YES // duke pistol
	setarray weap_owned[4] YES // regular alien pistol
	setarray weap_owned[100] YES // shelly pistol
	setarray weap_owned[104] YES // regular alien pistol
	setarray weap_owned[200] YES // pistol
	setarray weap_owned[204] YES // regular alien pistol
	setarray weap_owned[300] YES // mando pistol
	setarray weap_owned[304] YES // regular alien pistol
	setarray weap_owned[400] YES // Dea pistol
	setarray weap_owned[404] YES  // dea alien pistol
	setarray weap_owned[10] YES // duke shotgun
	setarray weap_owned[12] YES // duke DB shotgun
	setarray weap_owned[110] YES // shelly shotgun
	setarray weap_owned[114] YES // shelly bow
	setarray weap_owned[210] YES // wes shotgun
	setarray weap_owned[214] YES // wes bow
	setarray weap_owned[310] YES // mando shotgun
	setarray weap_owned[314] YES // mando DB shotgun
	setarray weap_owned[410] YES // Dea shotgun
	setarray weap_owned[414] YES // dea xbow
	setarray weap_owned[20] YES // duke chaingun
	setarray weap_owned[120] YES // shelly chaingun
	setarray weap_owned[220] YES // wes chaingun
	setarray weap_owned[320] YES // mando chaingun
	setarray weap_owned[420] YES // dea chaingun
	setarray weap_owned[30] YES // duke RPG
	setarray weap_owned[130] YES // shelly RPG
	setarray weap_owned[230] YES // wes RPG
	setarray weap_owned[330] YES // mando RPG
	setarray weap_owned[430] YES // dea RPG
	setarray weap_owned[40] YES // duke PIPES
	setarray weap_owned[140] YES // shelly turrets
	setarray weap_owned[240] YES // wes bombs
	setarray weap_owned[340] YES // mando detonators
	setarray weap_owned[440] YES // mando detonators
	setarray weap_owned[50] YES // duke SHRINKER
	setarray weap_owned[54] YES // duke BABIFIER
	setarray weap_owned[57] YES // duke PLASMA RIFLE
	setarray weap_owned[150] YES // shelly SHRINKER
	setarray weap_owned[154] YES // shelly BABIFIER
	setarray weap_owned[157] YES // shelly PLASMA RIFLE
	setarray weap_owned[250] YES // wes scar
	setarray weap_owned[254] YES // wes leach gun
	setarray weap_owned[257] YES // wes plasma
	setarray weap_owned[350] YES // mando SHRINKER
	setarray weap_owned[354] YES // mando BABIFIER
	setarray weap_owned[357] YES // mando PLASMA RIFLE
	setarray weap_owned[450] YES // dea chronolator
	setarray weap_owned[454] YES // dea eviscerator
	setarray weap_owned[457] YES // dea PLASMA RIFLE
	setarray weap_owned[60] YES // duke DEVASTATOR
	setarray weap_owned[160] YES // shelly DEVASTATOR
	setarray weap_owned[260] YES // wes DEVASTATOR
	setarray weap_owned[360] YES // mando DEVASTATOR
	setarray weap_owned[460] YES // dea DEVASTATOR
	setarray weap_owned[70] YES // duke RAILGUN
	setarray weap_owned[170] YES // shelly RAILGUN
	setarray weap_owned[270] YES // wes RAILGUN
	setarray weap_owned[370] YES // mando RAILGUN
	setarray weap_owned[470] YES // dea RAILGUN
	setarray weap_owned[80] YES // duke tripbombs
	setarray weap_owned[81] YES // duke SPIDERMINES
	setarray weap_owned[180] YES // shelly tripmines
	setarray weap_owned[181] YES // shelly SPIDERMINES
	setarray weap_owned[280] YES // wes tripbombs
	setarray weap_owned[281] YES // wes SPIDERMINES
	setarray weap_owned[380] YES // mando tripbombs
	setarray weap_owned[381] YES // mando SPIDERMINES
	setarray weap_owned[480] YES // dea tripbombs
	setarray weap_owned[481] YES // dea SPIDERMINES
	setarray weap_owned[90] YES // duke FREEZER
	setarray weap_owned[190] YES // shelly INCINERATOR
	setarray weap_owned[290] YES // wes blade launcher
	setarray weap_owned[390] YES // mando carbonite rifle
	setarray weap_owned[490] YES // dea goop gun
	
	setarray weap_owned[500] NO // EMT TRAINING
	setarray weap_owned[502] YES // normal goggles
	setarray weap_owned[504] NO // COVER CUBE CRUSHER
	setarray weap_owned[506] YES // normal boots
	
	setarray novaupgrades[SHOTGUN_WEAPON] 16
	setarray dukeupgrades[SHOTGUN_WEAPON] 16
	setarray mandoupgrades[SHOTGUN_WEAPON] 16
	set gotDB 1
	
	setarray shellyupgrades[SHOTGUN_WEAPON] 36
	setarray wesupgrades[SHOTGUN_WEAPON] 36
	set gotbow 1
	
	setarray wesupgrades[RPG_WEAPON] 1
	setarray wesupgrades[TRIPBOMB_WEAPON] 1
	
	state setshieldarrays 
	setarray targetlock[0] -1
	setarray targetlock[1] -1
	setarray targetlock[2] -1
	
	// readgamevar vendorupgrade
	// readgamevar perks
	readgamevar dukepal
	readgamevar shellypal
	readgamevar wespal
	readgamevar mandopal
	readgamevar altcostume
	ife altcostume 0 set altcostume 18
	
	smaxammo PISTOL_WEAPON MAXPISTOLAMMO
	smaxammo CHAINGUN_WEAPON MAXCHAINGUNAMMO
	
	ife LEVEL 7
	ife VOLUME 0
	{
		al LEVEL
		set switchmode YES
			
		set credits 10000
		set lastcredits 10000
		set LOGO_FLAGS 522495
		set NEWENEMIES YES
		set epselect 0
		ife PROGRESSION NO
		{
			set NEWENEMIES NO
			set attmode NO
			set vendorupgrade NO
			set credits 0
			set lastcredits 0
		}
		else
		{
			set ATTVOLUME 1
			set ATTLEVEL -1
			set vendor_used 1
			set attmode 2 // YES	
			// set attmid 1
			set vendorupgrade YES
			set credits 10000
			set lastcredits 10000
		}
	}
	orvar LOGO_FLAGS 63488 // disables hardcoded anims
	orvar LOGO_FLAGS 262144 // disables that extra shit after ep 3 cutscene
	orvar LOGO_FLAGS 524288
	orvar LOGO_FLAGS 1048576


endevent

eventloadactor SECTOREFFECTOR

getactor[THISACTOR].lotag SPRITELOTAG
geta[].hitag initsprite
getactor[THISACTOR].xvel startx
getactor[THISACTOR].yvel starty
getactor[THISACTOR].zvel stun

ifvare SPRITELOTAG 114
{
	// startx starting tile minus 1
	// starty last tile plus 1
	// stun number to add
	
	setvar spriteid 0
	whilevarn spriteid 16384
	{
		getactor[spriteid].picnum picnum
		ifvarvarg picnum startx ifvarvarl picnum starty
		{
			addvarvar picnum stun
			setactor[spriteid].picnum picnum
		}
		addvar spriteid 1
	}

	setvar spriteid 0
	whilevarvarn spriteid NUMSECTORS
	{
		getsector[spriteid].floorpicnum picnum
		ifvarvarg picnum startx ifvarvarl picnum starty
		{
			addvarvar picnum stun
			setsector[spriteid].floorpicnum picnum
		}
		getsector[spriteid].ceilingpicnum picnum
		ifvarvarg picnum startx ifvarvarl picnum starty
		{
			addvarvar picnum stun
			setsector[spriteid].ceilingpicnum picnum
		}
		addvar spriteid 1
	}
	setvar spriteid 0
	whilevarvarn spriteid NUMWALLS
	{
		getwall[spriteid].picnum picnum
		ifvarvarg picnum startx ifvarvarl picnum starty
		{
			addvarvar picnum stun
			setwall[spriteid].picnum picnum
		}
		getwall[spriteid].overpicnum picnum
		ifvarvarg picnum startx ifvarvarl picnum starty
		{
			addvarvar picnum stun
			setwall[spriteid].overpicnum picnum
		}
		addvar spriteid 1
	}
	cstat 32768
	cactor SMALLSMOKE
}

enda


onevent EVENT_LOADACTOR

/*
ife CULLCODE YES
{
	ifle sprite[].picnum 100
	setarray NOCULL[THISACTOR] YES
	else
	ifn sprite[].lotag 0 setarray NOCULL[THISACTOR] YES
	else
	ifn sprite[].hitag 0 setarray NOCULL[THISACTOR] YES
}
*/

switch sprite[].picnum

	case SECTOREFFECTOR
		// ife sprite[].lotag 10 // DOOR AUTO-CLOSE
		// ife userdef[].player_skill 4 // increased game speed
		// {
			// geta[].hitag temp
			// mul temp 4
			// div temp 3
			// seta[].hitag temp
		// }
		geta[].hitag starty
		ife sprite[].lotag 88 // view projector
		{
			
			setvar spriteid 0
			whilevarn spriteid 16384
			{
				ifn sprite[spriteid].statnum 1024
				ife sprite[spriteid].picnum SECTOREFFECTOR
				ife sprite[spriteid].lotag sprite[].lotag
				ife sprite[spriteid].hitag sprite[].hitag
				ifn spriteid THISACTOR
				{
					setvarvar teamspawned spriteid
					setvar spriteid 16383
				}
				addvar spriteid 1
			}
			
			// ifvare activator 0 setvar peractor1 1
		}
		ife sprite[].lotag 60 rand initsprite 99999
	
	break
	
	case TOUCHPLATE
		ifn sprite[].extra -1
		geta[].extra SPRITELOTAG
		seta[].extra -1
	break

	case JUMPAD
		// extra = z velocity
		// lotag = x velocity
		// hitag = flight time
		geta[].extra shotpitch
		ifvare shotpitch -1 set shotpitch 512
		mul shotpitch -8
		geta[].lotag startx
		ife startx 0 set startx 512
		seta[].lotag 0
		geta[].hitag starty
		seta[].hitag 0
		ifvare starty 0 set starty 20
		geta[].yvel SPRITELOTAG
		cstat 32768
		
	break
	
	case CHECKPOINT
		geta[].lotag SPRITELOTAG
		seta[].lotag 0
		cstat 32768
		set checkpoints YES // disables auto-save
	break
	
	case FAKETILE
		geta[].lotag initsprite // initial picnum
		seta[].lotag 0
		geta[].hitag mtype // new picnum
		seta[].hitag 0
		geta[].shade countvar // number in set before activation
		seta[].shade 0
		geta[].extra SPRITELOTAG // channel it activates
		ife SPRITELOTAG -1 set SPRITELOTAG 0
		seta[].extra -1
		// if channel not set, then it won't change at all
		geta[].xvel myspawner // optional external channel to change it
		
	break
	
	case CAMPAIGNSETTINGS
		set attmode 2
		set marathon 2
		set switchmode YES // NO
		set vendorupgrade NO
		set PROGRESSION YES
		set NEWENEMIES NO
		
		set disable_infighting NO
		set random_items NO
		set jibs_duration 1800
		set avoid_melee NO
		set mirror_maps NO
		geta[].lotag SPRITELOTAG
		seta[].lotag 0
		ifspritepal 2 
		{ 
			set startmode -1 
			set charsel 0 set numchars 0 
			ifn secretexit YES
			ife startguns -1 set startguns 0
			ifg SPRITELOTAG 0 set charmax SPRITELOTAG 
		}
		cstat 32768
		// sizeat 0 0
		// cactor SMALLSMOKE
	break
	
	case BOMBPART1
	case BOMBPART2
	case BOMBPART3
	case BOMBPART4
	case BOMBPART5
		geta[].lotag SPRITELOTAG
		seta[].lotag 0
		geta[].hitag initsprite
		seta[].hitag 0
		sizeat 32 32
		ifn initsprite 3
		cstator 32768
	break
	
	case EDFCHEST
	case ITEMCHEST
		geta[].lotag SPRITELOTAG
		seta[].lotag 0
		geta[].hitag initsprite
		sizeat 32 32
		cstator 257
	break
	
	case FAKEDOOR
		ifspritepal 4 cstat 32768
		ifspritepal 33 cstat 32768
		getactor[THISACTOR].hitag initsprite // must match hitag on another FAKEDOOR
		setactor[THISACTOR].hitag 0
		getactor[THISACTOR].lotag SPRITELOTAG // sound played (will play default sound if not set)
		setactor[THISACTOR].lotag 0
		ifn sprite[].extra -1 geta[].extra initflags
	break
	
	case SLOTDOOR
	case LIGHTSWITCH
	case SPACEDOORSWITCH
	case SPACELIGHTSWITCH
	case FRANKENSTINESWITCH
	case DIPSWITCH
	case DIPSWITCH2
	case DIPSWITCH3
	case TECHSWITCH
	case ALIENSWITCH
	case POWERSWITCH1
	case POWERSWITCH2
	case LOCKSWITCH1
	case LIGHTSWITCH2
	case HANDSWITCH
	case PULLSWITCH
	case 133
	case 135
	case 137
	case 139
	case 141
	case 163
	case 165
	case 167
	case 169
	case 713
	case 861
	case 863
	case 865
	case 1112
	case 1123
	case 1143
		ifge sprite[].pal 29 ifle sprite[].pal 30
		ifg sprite[].lotag 0
		{
			set initflags sprite[].pal
			set ikicked sprite[].cstat
			seta[].pal 0
			set droptile sprite[].lotag
		}
	break
	
	case BOX
	case TIRE
	case BMWM4 case COPCAR case TAXI case CRUZ case CIVIC case PORSCHE case LAMBO90
	case BEETLE case HUMMER case JEEP case LIMO case PICKUP case PICKUP2 case VAN1
	case VAN2 case WRECKEDCAR case DODGECAR case FORD case ROVER
	case BMWM3 case NANOCOOPER case TOWTRUCK case CHEVELLE case OLDCAR
	case MICROBUS case AUDIA
	case EDFTANKWRECK
		ifn sprite[].shade 0
		{
			orvar initflags 4
			geta[].shade droptile
		}
	break

	case NEWTOILET
		cactor TOILET
		seta[].mdflags 16
		set initsprite NEWTOILET
	break
	
	case CHAIR1
		cactor CHAIR1_AA
		cstator 257
	break
	case CHAIR2
		geta[].ang angvar
		add angvar 1024
		seta[].ang angvar
		cactor CHAIR1_AA
		cstator 257
	break
	
	case DOMELITE
		ife sprite[].extra 1
		{
			set initsprite 1
			seta[].extra -1
			seta[].shade -80
			spriteflags 4
		}
	break

	case NUKEBUTTON
		
		ifn sprite[].pal 0
		{
			ife epselect 0
			{
				geta[].lotag temp
				add temp 1
				seta[].lotag temp
			}
			else
			ife epselect 1
			{
				geta[].lotag temp
				add temp 8
				seta[].lotag temp
			}
			else ife epselect 2
			{
				geta[].lotag temp
				add temp 19
				seta[].lotag temp
			}
			else ife epselect 3
			{
				geta[].lotag temp
				add temp 30
				seta[].lotag temp
			}
			ife attmode YES
			{
				ifvarn sprite[THISACTOR].pal 0
				ifvarn sprite[THISACTOR].lotag 0
				{
					setactor[THISACTOR].lotag 32767
					spritepal 0
				}
			}
		}
	break
	
	case CUTSCENE_CAM
	cstat 32768
	geta[].lotag SPRITELOTAG // cutscene channel
	geta[].hitag initflags // cutscene length in tics
	ife initflags 0 set initflags 90
	geta[].extra mtype // sound (optional)
	seta[].lotag 0
	seta[].hitag 0
	ifn SPRITELOTAG 0
	{
		ifspritepal 122 { set droptile 122 spritepal 0 }
		ifspritepal 121
		{
			set droptile 121
			spritepal 0
			set spriteid 0
			whilevarvarn spriteid Numsprites
			{
				ifn sprite[spriteid].picnum CUTSCENE_CAM
				{
					ife actorvar[spriteid].SPRITELOTAG SPRITELOTAG set myspawner spriteid
					ife sprite[spriteid].lotag SPRITELOTAG set myspawner spriteid
					ife sprite[spriteid].picnum DRPROTON al spriteid
				}
				add spriteid 1
				ifn myspawner -1 set spriteid Numsprites
			}
		}
		else set myspawner 0
	}
	break
	
	case FANACTIVATE
		geta[].lotag SPRITELOTAG
		seta[].lotag 0
	break
	
	case RESPAWN
		
		geta[].extra SPRITELOTAG
		ife SPRITELOTAG -1 set SPRITELOTAG 0
		ifg sprite[].shade 1 ife VOLUME 4 geta[].shade mlevel
		ifn sprite[].owner -1
		{
			geta[].owner monstflags
			seta[].owner -1
		}
		ifspritepal 121 { set team 1 spritepal 0 }
		else
		{
		switch sprite[].hitag
		case GREENSLIME
		case EGG
		case NEWPIG
		case NEWPIGSTAYPUT
		case NEWPIGGUARD
		case NEWPIGDIVE
		case NEWPIGPISS
		case NEWPIGDONUT
		case CRAZYLADY
		case NEWCOMM case NEWCOMMSTAYPUT
		case NEWTROOPSTAYPUT
		case NEWTROOPJETPACK
		case NEWTROOP
		case NEWTROOPGUARD
		case NEWTROOPDUCKING
		case NEWTROOPONTOILET
		case NEWTROOPJUSTSIT
		case NEWTROOPRUNNING
		case ARMLIZTROOP
		case ARMLIZSTAYPUT
		case ARMLIZTROOPDUCK
		case NURGLE
		case NURGLESTAYPUT
		case SYTH
		case SITH
		case LIZTROOPSTAYPUT
		case LIZTROOPJETPACK
		case LIZTROOP
		case LIZTROOPSHOOT
		case LIZTROOPRUNNING
		case LIZTROOPDUCKING
		case LIZTROOPONTOILET
		case LIZTROOPJUSTSIT
		case OCTABRAIN
		case OCTABRAINSTAYPUT
		case OCTATROOP
		case DRONE
		case COMMANDER
		case COMMANDERSTAYPUT
		case TANK
		case PIGCOP
		case PIGCOPSTAYPUT
		case PIGCOPDIVE
		case RECON case NEWRECON
		case LIZMAN
		case LIZMANSTAYPUT
		case LIZMAN2
		case LIZMAN2STAYPUT
		case LIZMAN2JUMP
		case LIZMANGUARD
		case LIZMANJUMP
		case LIZMANSPITTING
		case ROTATEGUN
		case BOSS2FLY
		case BOSS2FLYPUT
		case ROBOSHARK case ROBOSHARKSTAYPUT
		case LIZDOG case LIZDOGSTAYPUT
		case BOSS1
		case BOSS1STAYPUT
		case NEWBATLORD
		case NEWBATLORDSTAYPUT
		case BOSS2
		case BOSS2STAYPUT
		case BOSS3
		case BOSS3STAYPUT
		case BOSS4
		case CYCLOIDMAX
		case CMAXSTAYPUT
		case QUEEN
		case PIGPISSING
		case LIZTURRET
		case 8875
		case NEWBEAST
		case NEWBEASTCROUCH
		case NEWBEASTSTAYPUT
		case NEWBEASTHANG
		case NEWBEASTJUMP
		case LIZRANGER 
		case LIZRANGERDUCKING 
		case LIZRANGERSTAYPUT 
		case LIZRANGERGUARD
		case CHEERBOT
		case CHEERBOTSTAYPUT
		case ARMYANT
		case ARMYANTJUMP
		case ARMYANTCRAWL
		case ARMYANTCRAWLPUT
		case NEWSENTRY
		case LIZBOSS
		case PIGBOSS
		case PIGBOSSSTAYPUT
		case ARMPIG
		case EDFPIG
		case POLYMORPH
		case POLYPOLE
		case POLYMORPHPAD
		case POLYMORPHPOD
		case POLYGORE1 case POLYGORE2 case POLYGORE3 case POLYGORE4 case POLYGORE5
		case MECHBRAIN
		case MECHBRAINSTAYPUT
		case BATBOSS
		case PROTONSTAND
		case DRPROTON
		case PSPIDER
		case ZOMBIE
		case ZOMBIEGIDUP
		case CORRUPT
		case CYBERBEAST
		case MEGABRAIN 
		case MEGABRAINSTAYPUT
		case TERMINATOR
		case TERMINATORSTAYPUT
		case TERMINATORDUCKING
		case TERMINATORCRAWLING
		case DEVOURER
		case CANHEAD
		case NEWMECH
		case PODHEAD
		case GUNSHIP
		case LIZELITE
		case SPACEBULL	
		case SPACEBULLSTAYPUT
		case SPACEBULLDUCKING
		case SCUBATROOP
		case SCUBATROOPSIT
		case COMBINEDMEN
			add maxkills 1
		break
		endswitch
		}
	break
	
	case SOUNDPLATE	
	case MULTIPLATE
	case LEVELPLATE
	case LEVELPLATE2
	case NAVSPRITE
	case GLOBALKILLER
	case EMPERORTALK
	case MATCHSTART
	case MUSICSECTOR
		geta[].lotag SPRITELOTAG
		geta[].hitag initflags
		ifactor SOUNDPLATE ife initflags 1 set initflags 0
		geta[].extra initsprite
		geta[].pal mtype
		ifn sprite[].picnum NAVSPRITE spritepal 0
		cstat 32768
		seta[].lotag 0
		seta[].hitag 0
		geta[].z float
		ifactor LEVELPLATE ifg initsprite 20
			set float sector[].floorz
			
		ifactor LEVELPLATE2
		ife mtype 4
		ife SPRITELOTAG LAST_LEVEL
		{	
			// this does not work
			setuserdef[].m_origin_x sprite[].x
			setuserdef[].m_origin_y sprite[].y
		}
	
	break
	
	case BLOCKONLY
		geta[].cstat initsprite
		cstator 32768
	break
	
	case ANIMOPEN1
	case ANIMOPEN2
	case ANIMOPEN3
		geta[].lotag SPRITELOTAG
		geta[].hitag initflags
		geta[].extra initsprite
		geta[].xvel droptile
		geta[].pal mtype
		ifn sprite[].picnum NAVSPRITE spritepal 0
		cstat 32768
		seta[].lotag 0
		seta[].hitag 0
		geta[].z float
	
	break
	
	case TEAMSPAWNER
		cstat 32768
		ife initsprite 0 
		{
			geta[].extra mtype
			ife mtype -1 set mtype 0
			set initsprite sprite[].hitag
			set droptile sprite[].pal
			set initflags sprite[].lotag
			ife initsprite LIZTROOP set initsprite NEWTROOP
			ife initsprite PIGCOP set initsprite NEWPIG
			ife initsprite BOSS1 set initsprite NEWBATLORD
			ife initsprite BOSS4 set initsprite QUEEN
			seta[].pal 0
			seta[].hitag 0
			seta[].lotag 0
			ifg sprite[].owner 1 geta[].owner monstflags
		}
			
	break
	
	case NOFALLDMG	
		set globalnofall 2
		cstat 32768
	break
	
	case MOVECAM
	case CAMTRACK
		geta[].lotag SPRITELOTAG
		ifactor CAMTRACK ife SPRITELOTAG 1 set thiscam THISACTOR
		geta[].hitag initflags
		geta[].extra initsprite
		geta[].pal mtype
		geta[].shade stun
		ifl stun 0 set stun 0 else
		ifg stun 0 mul stun 30
		seta[].shade 0
		spritepal 0
		cstat 32768
		seta[].lotag 0
		seta[].hitag 0
		geta[].xvel angvel
	break
	
	case SECRETCOUNTSPRITE
		geta[].lotag SPRITELOTAG
		ifl SPRITELOTAG 1024 set SPRITELOTAG 1024
		seta[].lotag 0
		cstat 32768
	break
	
	case CHEATLEVEL
		geta[].lotag win
		seta[].lotag 0
		geta[].hitag initsprite
		ifl win 4 set win 4
		mul initsprite 1000
		add credits initsprite
		add lastcredits initsprite
		seta[].hitag 0
		cstat 32768
		cactor SMALLSMOKE
		changespritestat THISACTOR 1
		sizeat 0 0
	break
	
	case GENERICAMMO
		geta[].extra initsprite
		ife initsprite 1
		{
			cstat 32768
			set initsprite GENERICAMMO
			set initflags GENERICAMMO
			cactor TEAMSPAWNER
		}
	break
	
	case BOMBSECTOR
		geta[].extra initsprite
		ife initsprite 1
		{
			cstat 32768
			gets[].floorpal droptile
		}
	break
	
	case HIGHSOUND
	
		geta[].lotag SPRITELOTAG
		geta[].hitag initflags
		geta[].extra initsprite
		spritepal 0
		cstat 32768
		seta[].lotag 0
		seta[].hitag 0
		gets[].lotag mtype
		ifg mtype 2
		{
			gets[].floorz angvel
			set lastangvel angvel
			gets[].ceilingz countvar
			set countvarb countvar
		}
	break
	
	case JIBS1
	case JIBS2
	case JIBS3
	case JIBS4
	case JIBS5
	case JIBS6

	case 2246 case 2247 case 2248 case 2249
	case 2251 case 2252 case 2253 case 2254
	case 2256 case 2257 case 2258 case 2259
	case 2261 case 2262 case 2263 case 2264
	case 2266 case 2267 case 2268 case 2269
	case 2287 case 2288 case 2289 case 2290 case 2291 case 2292 case 2293
	case SCRAP1 case SCRAP2 case SCRAP3 case SCRAP4 case SCRAP5 case SCRAP6
	case 2391 case 2392 case 2393 case 2394 case 2395 case 2396 case 2397 case 2398
	case 2401 case 2402 case 2403 case 2405 case 2406 case 2407 case 2409
	case 2410 case 2411 case 2413 case 2414 case 2415 case 2417 case 2418
		geta[].xrepeat init_xrepeat
		div init_xrepeat 2
		seta[].xrepeat init_xrepeat
		geta[].yrepeat init_yrepeat
		div init_yrepeat 2
		seta[].yrepeat init_yrepeat
	break
	
	// boss statues
	case BOSS1STATUE case BOSS2STATUE case BOSS3STATUE
		ife sprite[].extra 5
		{
			geta[].extra initsprite
			seta[].extra -1
			changespritestat THISACTOR 1
			action ASTATUEFRAME
			sizeat 128 128
			spritepal 27
			cstator 257
			add maxkills 1
		}
		geta[].ang lastang
	break
	
	case EPISODESELECT
	
		cstat 32768
		set epselect -1
	
	break
	
	case ACCESSSWITCH
	ifn sprite[].lotag 0
	{
		espawn ACCESSSWITCH
		seta[RETURN].pal sprite[].pal
		setav[RETURN].myspawner THISACTOR
		set myspawner RETURN
		setav[RETURN].float 32768
		geta[].xrepeat x mul x 2
		seta[RETURN].xrepeat x
		geta[].yrepeat y mul y 2
		seta[RETURN].yrepeat y
	}
	break
	
	case ACCESSSWITCH2
	ifn sprite[].lotag 0
	{
		espawn ACCESSSWITCH2
		seta[RETURN].pal sprite[].pal
		setav[RETURN].myspawner THISACTOR
		set myspawner RETURN
		setav[RETURN].float 32768
		geta[].xrepeat x mul x 2
		seta[RETURN].xrepeat x
		geta[].yrepeat y mul y 2
		seta[RETURN].yrepeat y
	}
	break
	
	case WATERDRIP
	geta[].extra initflags 
	seta[].extra -1
	ifn initflags 0 ifn initflags -1
	{
		setvarvar rainstart initflags
		al rainstart
		geta[].cstat raincstat
		geta[].pal rainpal
		geta[].xvel rainradius
		ifl rainradius 0 mul rainradius -1
		shiftl rainradius 1
		ife rainradius 0 set rainradius 12288
		ifl rainradius 2048 set rainradius 2048
		geta[].zvel snowceiling
		ifl snowceiling 0 mul snowceiling -1
		shiftl snowceiling 4
		ife snowceiling 0 set snowceiling 131072
		ifl snowceiling 16384 set snowceiling 16384
		killit
	}
	break
	
	case HYDROPLANT cactor DPHYDROPLANT
	break
	
	case CRACK1 case CRACK2
	case CRACK3 case CRACK4
	geta[].lotag SPRITELOTAG
		seta[].lotag 0
	ifn sprite[].hitag 0
	{
		geta[].picnum temp
		espawnvar temp
		setav[RETURN].myspawner THISACTOR
		set myspawner RETURN
		setav[RETURN].float 32768
		geta[].xrepeat x mul x 2
		seta[RETURN].xrepeat x
		geta[].yrepeat y mul y 2
		seta[RETURN].yrepeat y
	}
	break
	
	case ACCESSCARD
		geta[].pal initsprite
		ifg sprite[].lotag 4 seta[].lotag 0
		geta[].picnum temp
		espawnvar temp
		setav[RETURN].myspawner THISACTOR
		set myspawner RETURN
		setav[RETURN].float 32768
		geta[].xrepeat x mul x 2
		seta[RETURN].xrepeat x
		geta[].yrepeat y mul y 2
		seta[RETURN].yrepeat y
	break
	
	case REACTOR2
		geta[].picnum temp
		espawnvar temp
		setav[RETURN].myspawner THISACTOR
		set myspawner RETURN
		setav[RETURN].float 32768
		geta[].xrepeat x mul x 2
		seta[RETURN].xrepeat x
		geta[].yrepeat y mul y 2
		seta[RETURN].yrepeat y
	break
	

	case GREENSLIME
	case EGG
	ifn sprite[].xvel 0 geta[].xvel droptile
	cstator 256
	add maxkills 1 ifl sprite[].lotag 5 ifg sprite[].lotag userdef[].player_skill sub maxkills 1
	break
	
	case FEM5
	case FEM6
	case FEM8
	case TOUGHGAL
	case NAKED1
	case PODFEM1
	case BLOODYPOLE
	case FEM6PAD
	ifn sprite[].xvel 0 geta[].xvel droptile
	ifn sprite[].hitag 0 set SPRITELOTAG sprite[].hitag
	cstator 256
	break
	
	case NEWSLIMEBABE cstator 256 cactor NEWFEM7 
	break
	case NEWHANGBABE 
	case FEM5DEAD
	case FEM6DEAD
	case SLIMEGIRLPUKE1
	case SLIMEGIRLPUKE2
	case SLIMEGIRLPUKE3
	case SLIMEGIRLPUKE4
	case SLIMEGIRLPUKE5
	case DEADSLIMEGIRL4
	case DEADSLIMEGIRL5
	case DEADSLIMEGIRL6
	case DEADSLIMEGIRL7
	cstator 256 // cactor NEWNAKED2 
	break
	case 11561 cstator 256 cactor NEWPODFEM2 break
	case FEM12 cstator 256 cactor NEWFEM8 break
	case FEM11 cstator 256 cactor NEWFEM9 break
	case 11558 cstator 256 cactor NEWFEM10 break
	case NEWSLIMEBABE2 cstator 256 cactor NEWFEM11 break
	
	case FIRSTGUNSPRITE
	case CHAINGUNSPRITE
	case RPGSPRITE
	case HBOMBAMMO
	case FREEZESPRITE
	case SHRINKERSPRITE
	case HEAVYHBOMB
	case DEVISTATORSPRITE
	case AMMO
	case GROWSPRITEICON
	case BATTERYAMMO
	case RPGAMMO
	
	case BLOODAMMO
	case CRYSTALAMMO
	case DEVISTATORAMMO
	case FREEZEAMMO
	case COLA
	case SIXPAK
	case ATOMICHEALTH
	case FIRSTAID
	case SHIELD
	case STEROIDS
	case AIRTANK
	case JETPACK
	case HEATSENSOR
	case BOOTS
	case SABERSPRITE
		
	ife sprite[].extra 1
	{
		set initsprite sprite[].picnum
		cactor TEAMSPAWNER cstat 32768
	}
	else ife random_items YES ifn sprite[].pal 1 state randomize_item
	break
	
	case GROWAMMO
	ife sprite[].extra 1
	{
		set initsprite sprite[].picnum
		cactor TEAMSPAWNER cstat 32768
	}
	else ife random_items YES ifn sprite[].pal 1 state randomize_item
	break
	
	case HOLODUKE
		ifspritepal 0 sizeat 16 16
		ife sprite[].extra 1
		{
			set initsprite sprite[].picnum
			cactor TEAMSPAWNER cstat 32768
		}
		else ife random_items YES ifn sprite[].pal 1 state randomize_item
	break
	
	case SHOTGUNSPRITE
	
	ife sprite[].extra 1
	{
		set initsprite sprite[].picnum
		cactor TEAMSPAWNER cstat 32768
	}
	else ife random_items YES state randomize_item
	
	break
	
	case DBSPRITE
	case DBAMMO
		cstat 0
		ife random_items YES state randomize_item
	break
	
	case SHOTGUNAMMO
	
	
	ife sprite[].extra 1
	{
		set initsprite sprite[].picnum
		cactor TEAMSPAWNER cstat 32768
	}
	else ife random_items YES state randomize_item

	break
	
	case TRIPBOMBSPRITE
		ifvarand dukeupgrades[TRIPBOMB_WEAPON] YES
		ifspritepal 0
		{
			cactor SPIDERMINESPRITE
			sizeat 32 32
			cstat 0
		}
		ife sprite[].extra 1
		{
			set initsprite sprite[].picnum
			cactor TEAMSPAWNER cstat 32768
		}
		else ife random_items YES state randomize_item
	break
	
	case CHAINGUNUPGRADE 
	case PISTOLUPGRADE
	case DEUPGRADE
	case FREEZEUPGRADE
	case INCINUPGRADE
	case DUALDUKE case DUALSHELLY
	
	sizeat 32 32 break
	case M4UPGRADE sizeat 40 36 break
	case SHOTGUNUPGRADE sizeat 40 40 break
	
	case PLASMASPRITE
	case PLASMAAMMO
	case GLOCKSPRITE
	case ATOMICSHOTTY
	case BOWSPRITE case QUIVERSPRITE
		sizeat 32 32
		cstat 0
		ife sprite[].extra 1
		{
			set initsprite sprite[].picnum
			cactor TEAMSPAWNER cstat 32768
		}
		else ife random_items YES state randomize_item
	break
	
	case RAILGUNAMMO
		sizeat 32 32
		cstat 0
		ife sprite[].extra 1
		{
			set initsprite sprite[].picnum
			cactor TEAMSPAWNER cstat 32768
		}
		else ife random_items YES state randomize_item
	break
	
	case NUKESPRITE
		sizeat 48 42
		
		ife sprite[].extra 1
		{
			set initsprite sprite[].picnum
			cactor TEAMSPAWNER cstat 32768
		}
		else ife random_items YES state randomize_item
	break
	
	case SAWAMMO
		
		ife sprite[].extra 1
		{
			set initsprite sprite[].picnum
			cactor TEAMSPAWNER cstat 32768
		}
		else ife random_items YES state randomize_item
		sizeat 28 28
		cstat 0
	break
	
	case YOSHIEGG
	case JARMETROID
	case JARHEART
	case OSCAR
	case WINNIEPOOH
	case PIKACHU
	case TACOHELLBAG
	case FALCONPUNCH
	case BANANABOX
	case PIGSTATUE
	case ALIENTHINGY
	case MUGBLUE
	case BLENDER
	case LOBSTER
	case ELMO
	case WHEYPROTEIN
	case BLUEMILK
	case EXOTICVASE1
	case EXOTICVASE2
	case EXOTICVASE3
	case EXOTICVASE4
	case EXOTICVASE5
	case OGAY
	case SOYB
	case BLISTERS
	case KFC
	case ELECTRICGLOBE1
	case ELECTRICGLOBE2
	case TRUCKNUTS
	case CATFOOD
	case ASIANSTATUE
	case SPRAYCAN
	case PLANTER
	case HOURGLASS
	case JACKOLANTERN
	case HERB
	case LUGGAGE1
	case LUGGAGE2
	case COOLER
	case SLIMEMOUTHMOUND
	case BBQGRILLROUND
	case BBQGRILLSQUARE
	case KICKASSGUM 
	case RECYCLEBIN
	case DUFFBEER
	case PRESENT1
	case PRESENT2
	case LAMPDC
	
		geta[].xvel droptile
	break
	
	case APLAYER
		ifspritepal 33
		{
			setarray loadx[pstarts] sprite[].x
			setarray loady[pstarts] sprite[].y
			setarray loadz[pstarts] sprite[].z
			add pstarts 1
		}
	break
	
	case NEWPIG
	case NEWPIGSTAYPUT
	case NEWPIGGUARD
	case NEWPIGDIVE
	case NEWPIGPISS
	case NEWPIGDONUT
	case CRAZYLADY
	case CORRUPT
		sizeat 28 26
		ifvarand sprite[].cstat 16 cstat 257
		ifg sprite[].lotag 4 
		{
			ifg sprite[].lotag 9
				geta[].lotag SPRITELOTAG
			seta[].lotag 0
		}
		else ife attmode YES seta[].lotag 0
		ife sprite[].extra 2 { set team 1 seta[].extra -1 } else
		ife sprite[].extra 1
		{
			set initsprite sprite[].picnum
			geta[].hitag team seta[].hitag 0 cactor TEAMSPAWNER cstat 32768
		}
		ifn sprite[].xvel 0 geta[].xvel droptile ifg sprite[].shade 1 ife VOLUME 4 geta[].shade mlevel
		ifg sprite[].owner 0 // deprecated
		{
			geta[].owner monstflags ifvarand monstflags 1 xorvar monstflags 1
			seta[].owner -1
		}
		ifn sprite[].hitag 0
		{
			geta[].hitag monstflags ifl monstflags 0 add monstflags 65536 ifvarand monstflags 1 xorvar monstflags 1
			seta[].hitag 0
		}
		ife team 0 { add maxkills 1 ifl sprite[].lotag 5 ifg sprite[].lotag userdef[].player_skill sub maxkills 1 }
	break
	
	case GUARD
		sizeat 26 24
		cstat 257
		ifg sprite[].lotag 4 
		{
			ifg sprite[].lotag 9
				geta[].lotag SPRITELOTAG
			seta[].lotag 0
		}
		else ife attmode YES seta[].lotag 0
		ife sprite[].extra 2 { set team 1 seta[].extra -1 } else ife sprite[].extra 1
		{
			set initsprite sprite[].picnum
			geta[].hitag team seta[].hitag 0 cactor TEAMSPAWNER cstat 32768
		}
		ifn sprite[].xvel 0 geta[].xvel droptile ifg sprite[].shade 1 ife VOLUME 4 geta[].shade mlevel
		ifg sprite[].owner 0 // deprecated
		{
			geta[].owner monstflags ifvarand monstflags 1 xorvar monstflags 1
			seta[].owner -1
		}
		ifn sprite[].hitag 0
		{
			geta[].hitag monstflags ifl monstflags 0 add monstflags 65536 ifvarand monstflags 1 xorvar monstflags 1
			seta[].hitag 0
		}
	break
	
	case NEWCOMM case NEWCOMMSTAYPUT
		sizeat 34 30
		ifg sprite[].lotag 4 
		{
			ifg sprite[].lotag 9
				geta[].lotag SPRITELOTAG
			seta[].lotag 0
		}
		else ife attmode YES seta[].lotag 0
		ife sprite[].extra 2 { set team 1 seta[].extra -1 } else ife sprite[].extra 1
		{
			set initsprite sprite[].picnum
			geta[].hitag team seta[].hitag 0 cactor TEAMSPAWNER cstat 32768
		}
		ifn sprite[].xvel 0 geta[].xvel droptile ifg sprite[].shade 1 ife VOLUME 4 geta[].shade mlevel
		ifg sprite[].owner 0 // deprecated
		{
			geta[].owner monstflags ifvarand monstflags 1 xorvar monstflags 1
			seta[].owner -1
		}
		ifn sprite[].hitag 0
		{
			geta[].hitag monstflags ifl monstflags 0 add monstflags 65536 ifvarand monstflags 1 xorvar monstflags 1
			seta[].hitag 0
		}
		ife team 0 { add maxkills 1 ifl sprite[].lotag 5 ifg sprite[].lotag userdef[].player_skill sub maxkills 1 }
	break
	
	case NEWTROOPSTAYPUT
	case NEWTROOPJETPACK
	case NEWTROOP
	case NEWTROOPGUARD
	case NEWTROOPDUCKING
	case NEWTROOPONTOILET
	case NEWTROOPJUSTSIT
	case NEWTROOPRUNNING
	case ARMLIZTROOP
	case ARMLIZSTAYPUT
	case ARMLIZTROOPDUCK
	// case NEWTROOPJUSTSIT
		sizeat 24 22
		ifvarand sprite[].cstat 16 cstat 257
		ifspritepal 0
		{
			ifrnd 128 spritepal 12 else
			spritepal 22
		}
		ifg sprite[].lotag 4 
		{
			ifg sprite[].lotag 9
				geta[].lotag SPRITELOTAG
			seta[].lotag 0
		}
		else ife attmode YES seta[].lotag 0
		ife sprite[].extra 2 { set team 1 seta[].extra -1 } else ife sprite[].extra 1
		{
			set initsprite sprite[].picnum
			geta[].hitag team seta[].hitag 0 cactor TEAMSPAWNER cstat 32768
		}
		ifn sprite[].xvel 0 geta[].xvel droptile ifg sprite[].shade 1 ife VOLUME 4 geta[].shade mlevel
		ifg sprite[].owner 0 // deprecated
		{
			geta[].owner monstflags ifvarand monstflags 1 xorvar monstflags 1
			seta[].owner -1
		}
		ifn sprite[].hitag 0
		{
			geta[].hitag monstflags ifl monstflags 0 add monstflags 65536 ifvarand monstflags 1 xorvar monstflags 1
			seta[].hitag 0
		}
		ife team 0 { add maxkills 1 ifl sprite[].lotag 5 ifg sprite[].lotag userdef[].player_skill sub maxkills 1 }
	break
	
	case NURGLE
	case NURGLESTAYPUT
	case SYTH
	case SITH
	
	ife VOLUME 0 ife attmode 2 nullop else set NEWENEMIES NO
	ifg sprite[].lotag 4 
	{
		ifg sprite[].lotag 9
			geta[].lotag SPRITELOTAG
		seta[].lotag 0
	}
	else ife attmode YES 
		seta[].lotag 0

	ife sprite[].extra 2 { set team 1 seta[].extra -1 } else ife sprite[].extra 1
	{
		set initsprite sprite[].picnum
		ife initsprite LIZTROOP set initsprite NEWTROOP
		ife initsprite PIGCOP set initsprite NEWPIG
		ife initsprite BOSS1 set initsprite NEWBATLORD
		ife initsprite BOSS4 set initsprite QUEEN
		geta[].hitag team seta[].hitag 0 cactor TEAMSPAWNER cstat 32768
	}
	ifn sprite[].xvel 0 geta[].xvel droptile ifg sprite[].shade 1 ife VOLUME 4 geta[].shade mlevel
	ifg sprite[].owner 0 // deprecated
		{
			geta[].owner monstflags ifvarand monstflags 1 xorvar monstflags 1
			seta[].owner -1
		}
		ifn sprite[].hitag 0
		{
			geta[].hitag monstflags ifl monstflags 0 add monstflags 65536 ifvarand monstflags 1 xorvar monstflags 1
			seta[].hitag 0
		}
		ife team 0 { add maxkills 1 ifl sprite[].lotag 5 ifg sprite[].lotag userdef[].player_skill sub maxkills 1 }
	break
	
	case COMBINEDMEN
		set NEWENEMIES NO
		sizeat 50 48 cstator 257
	ifg sprite[].lotag 4 
	{
		ifg sprite[].lotag 9
			geta[].lotag SPRITELOTAG
		seta[].lotag 0
	}
	else ife attmode YES 
		seta[].lotag 0

	ife sprite[].extra 2 { set team 1 seta[].extra -1 } else ife sprite[].extra 1
	{
		set initsprite sprite[].picnum
		geta[].hitag team seta[].hitag 0 cactor TEAMSPAWNER cstat 32768
	}
	ifn sprite[].xvel 0 geta[].xvel droptile ifg sprite[].shade 1 ife VOLUME 4 geta[].shade mlevel
	ifg sprite[].owner 0 // deprecated
		{
			geta[].owner monstflags ifvarand monstflags 1 xorvar monstflags 1
			seta[].owner -1
		}
		ifn sprite[].hitag 0
		{
			geta[].hitag monstflags ifl monstflags 0 add monstflags 65536 ifvarand monstflags 1 xorvar monstflags 1
			seta[].hitag 0
		}
		ife team 0 { add maxkills 1 ifl sprite[].lotag 5 ifg sprite[].lotag userdef[].player_skill sub maxkills 1 }
	break
	
	case LIZTROOPSTAYPUT
	case LIZTROOPJETPACK
	case LIZTROOP
	case LIZTROOPSHOOT
	case LIZTROOPRUNNING
	case LIZTROOPDUCKING
	case LIZTROOPONTOILET
	case LIZTROOPJUSTSIT
	
	case OCTABRAIN
	case OCTABRAINSTAYPUT
	case OCTATROOP
	case DRONE
	case COMMANDER
	case COMMANDERSTAYPUT
	case TANK
	case PIGCOP
	case PIGCOPSTAYPUT
	case PIGCOPDIVE
	case RECON case NEWRECON
	case LIZMAN
	case LIZMANSTAYPUT
	case LIZMAN2
	case LIZMAN2STAYPUT
	case LIZMAN2JUMP
	case LIZMANGUARD
	case LIZMANJUMP
	case LIZMANSPITTING
	case ROTATEGUN
	case BOSS2FLY
	case BOSS2FLYPUT
	case ROBOSHARK case ROBOSHARKSTAYPUT
	case LIZDOG case LIZDOGSTAYPUT
	
	ifactor LIZDOG { ifspritepal 104 sizeat 56 52 else sizeat 26 24 cstator 257 }
	ifactor LIZDOGSTAYPUT { ifspritepal 104 sizeat 56 52 else sizeat 26 24 cstator 257 }
	ifactor ROBOSHARK { ifspritepal 41 sizeat 56 52 else sizeat 26 24 cstator 257 }
	ifactor ROBOSHARKSTAYPUT { ifspritepal 41 sizeat 56 52 else sizeat 26 24 cstator 257 }
	ifactor LIZMANGUARD sizeat 28 26
	ifactor LIZMAN2 sizeat 26 24
	ifactor LIZMAN2STAYPUT sizeat 26 24
	ifactor LIZMAN2JUMP sizeat 26 24
	ifvarand sprite[].cstat 16 cstat 257
	
	
	ifg sprite[].lotag 4 
	{
		ifg sprite[].lotag 9
			geta[].lotag SPRITELOTAG
		seta[].lotag 0
	}
	else ife attmode YES 
		seta[].lotag 0

	ife sprite[].extra 2 { set team 1 seta[].extra -1 } else ife sprite[].extra 1
	{
		set initsprite sprite[].picnum
		ife initsprite LIZTROOP set initsprite NEWTROOP
		ife initsprite PIGCOP set initsprite NEWPIG
		geta[].hitag team seta[].hitag 0 cactor TEAMSPAWNER cstat 32768
	}
	ifn sprite[].xvel 0 geta[].xvel droptile ifg sprite[].shade 1 ife VOLUME 4 geta[].shade mlevel
	ifg sprite[].owner 0 // deprecated
		{
			geta[].owner monstflags ifvarand monstflags 1 xorvar monstflags 1
			seta[].owner -1
		}
	ifn sprite[].hitag 0
		{
			geta[].hitag monstflags 
			ifl monstflags 0
				add monstflags 65536
			ifvarand monstflags 1 xorvar monstflags 1
			seta[].hitag 0
		}
		ife team 0 { add maxkills 1 ifl sprite[].lotag 5 ifg sprite[].lotag userdef[].player_skill sub maxkills 1 }
	break
	
	case BOSS1
	case BOSS1STAYPUT
	case NEWBATLORD
	case NEWBATLORDSTAYPUT
	case BOSS2
	case BOSS2STAYPUT
	case BOSS3
	case BOSS3STAYPUT
	case BOSS4
	
	ifactor BOSS4 ifspritepal 0 ife marathon YES
	{
		cactor QUEEN
		sizeat 96 80
	}

	ifvarand sprite[].cstat 16 cstat 257
	ifg sprite[].lotag 4 
	{
		ifg sprite[].lotag 9
			geta[].lotag SPRITELOTAG
		seta[].lotag 0
	}
	else ife attmode YES 
		seta[].lotag 0

	ife sprite[].extra 2 { set team 1 seta[].extra -1 } else ife sprite[].extra 1
	{
		set initsprite sprite[].picnum
		ife initsprite BOSS1 set initsprite NEWBATLORD
		ife initsprite BOSS4 set initsprite QUEEN
		geta[].hitag team seta[].hitag 0 cactor TEAMSPAWNER cstat 32768
	}
	ifn sprite[].xvel 0 geta[].xvel droptile ifg sprite[].shade 1 ife VOLUME 4 geta[].shade mlevel
	ifg sprite[].owner 0 // deprecated
		{
			geta[].owner monstflags ifvarand monstflags 1 xorvar monstflags 1
			seta[].owner -1
		}
		ifn sprite[].hitag 0
		{
			geta[].hitag monstflags 
			ifl monstflags 0
				add monstflags 65536
			ifvarand monstflags 1 xorvar monstflags 1
			seta[].hitag 0
		}
		ife team 0 { add maxkills 1 ifl sprite[].lotag 5 ifg sprite[].lotag userdef[].player_skill sub maxkills 1 }
	break
	
	case CYCLOIDMAX
	case CMAXSTAYPUT
	ifg sprite[].lotag 4 
	{
		geta[].lotag SPRITELOTAG
		seta[].lotag 0
	}
	else ife attmode YES seta[].lotag 0
	ifg sprite[].extra 1
	{
		set initsprite sprite[].extra
	}
	ifn sprite[].xvel 0 geta[].xvel droptile ifg sprite[].shade 1 ife VOLUME 4 geta[].shade mlevel
	ifg sprite[].owner 0 
	{
		geta[].owner monstflags 
		ifl monstflags 0 add monstflags 65536
		ifvarand monstflags 1 xorvar monstflags 1
		ife challenge YES orvar monstflags 256
		seta[].owner -1
	}
	
	ifn sprite[].hitag 0
	{
		geta[].hitag monstflags 
		ifl monstflags 0
				add monstflags 65536
		ifvarand monstflags 1 xorvar monstflags 1
		ife challenge YES orvar monstflags 256
		seta[].hitag 0
	}
	ife team 0 { add maxkills 1 ifl sprite[].lotag 5 ifg sprite[].lotag userdef[].player_skill sub maxkills 1 }
	break
	
	case QUEEN
		ifspritepal 0 sizeat 96 80 else 
		ifspritepal 42 sizeat 124 120 else sizeat 42 40
		ifg sprite[].lotag 4 
		{
			ifg sprite[].lotag 9
				geta[].lotag SPRITELOTAG
			seta[].lotag 0
		}
		else ife attmode YES seta[].lotag 0
		ife sprite[].extra 2 { set team 1 seta[].extra -1 } else ife sprite[].extra 1
		{
			set initsprite sprite[].picnum
			geta[].hitag team seta[].hitag 0 cactor TEAMSPAWNER cstat 32768
		}
		ifn sprite[].xvel 0 geta[].xvel droptile ifg sprite[].shade 1 ife VOLUME 4 geta[].shade mlevel
		ifg sprite[].owner 0 // deprecated
		{
			geta[].owner monstflags ifvarand monstflags 1 xorvar monstflags 1
			seta[].owner -1
		}
		ifn sprite[].hitag 0
		{
			geta[].hitag monstflags ifl monstflags 0 add monstflags 65536 ifvarand monstflags 1 xorvar monstflags 1
			seta[].hitag 0
		}
		ife team 0 { add maxkills 1 ifl sprite[].lotag 5 ifg sprite[].lotag userdef[].player_skill sub maxkills 1 }
	break
	

	case PIGPISSING
	    cactor NEWPIGPISS
		sizeat 28 26
		ifg sprite[].lotag 4 
		{
			ifg sprite[].lotag 9
				geta[].lotag SPRITELOTAG
			seta[].lotag 0
		}
		else ife attmode YES seta[].lotag 0
		ife sprite[].extra 2 { set team 1 seta[].extra -1 } else ife sprite[].extra 1
		{
			set initsprite sprite[].picnum
			geta[].hitag team seta[].hitag 0 cactor TEAMSPAWNER cstat 32768
		}
		ifn sprite[].xvel 0 geta[].xvel droptile ifg sprite[].shade 1 ife VOLUME 4 geta[].shade mlevel
		ifg sprite[].owner 0 // deprecated
		{
			geta[].owner monstflags ifvarand monstflags 1 xorvar monstflags 1
			seta[].owner -1
		}
		ifn sprite[].hitag 0
		{
			geta[].hitag monstflags ifl monstflags 0 add monstflags 65536 ifvarand monstflags 1 xorvar monstflags 1
			seta[].hitag 0
		}
		cstator 257
		ife team 0 { add maxkills 1 ifl sprite[].lotag 5 ifg sprite[].lotag userdef[].player_skill sub maxkills 1 }
	break
	

	case LIZTURRET
	case 8875
	case EMPTYTURRET
	case EDFTURRET
	case EMPTYEDFTURRET
	case 8880
		set NEWENEMIES NO
		ifactor 8875 cactor LIZTURRET
		ifactor 8880 cactor EMPTYTURRET
		ifactor LIZTURRET { sizeat 26 24 add maxkills 1 } else
		ifactor EMPTYTURRET sizeat 26 24 else
		sizeat 24 22
		cstator 257
		
		ife sprite[].extra 1
		{
			set initsprite sprite[].picnum
			geta[].hitag team seta[].hitag 0 cactor TEAMSPAWNER cstat 32768
		}
		ifn sprite[].xvel 0 geta[].xvel droptile ifg sprite[].shade 1 ife VOLUME 4 geta[].shade mlevel
		ifg sprite[].owner 0 // deprecated
		{
			geta[].owner monstflags ifvarand monstflags 1 xorvar monstflags 1
			seta[].owner -1
		}
		ifn sprite[].hitag 0
		{
			geta[].hitag monstflags ifl monstflags 0 add monstflags 65536 ifvarand monstflags 1 xorvar monstflags 1
			seta[].hitag 0
		}
	break
	
	case NEWBEAST
		seta[].picnum 4625
		sizeat 32 30
		cstator 257
		ifspritepal 0 seta[].pal 15
		ife sprite[].extra 2 { set team 1 seta[].extra -1 } else ife sprite[].extra 1
		{
			set initsprite NEWBEAST
			geta[].hitag team seta[].hitag 0 cactor TEAMSPAWNER cstat 32768
		}
		ifn sprite[].xvel 0 geta[].xvel droptile ifg sprite[].shade 1 ife VOLUME 4 geta[].shade mlevel
		ifg sprite[].owner 0 // deprecated
		{
			geta[].owner monstflags ifvarand monstflags 1 xorvar monstflags 1
			seta[].owner -1
		}
		ifn sprite[].hitag 0
		{
			geta[].hitag monstflags ifl monstflags 0 add monstflags 65536 ifvarand monstflags 1 xorvar monstflags 1
			seta[].hitag 0
		}
		ife team 0 { add maxkills 1 ifl sprite[].lotag 5 ifg sprite[].lotag userdef[].player_skill sub maxkills 1 }
	break
	
	case NEWBEASTCROUCH
	case NEWBEASTSTAYPUT
	case NEWBEASTHANG
	case NEWBEASTJUMP
	ifspritepal 0 seta[].pal 15
	sizeat 32 30
	cstator 257
	ifg sprite[].lotag 4 
	{
		ifg sprite[].lotag 9
			geta[].lotag SPRITELOTAG
		seta[].lotag 0
	}
	else ife attmode YES seta[].lotag 0
	ife sprite[].extra 2 { set team 1 seta[].extra -1 } else ife sprite[].extra 1
	{
		set initsprite sprite[].picnum
		geta[].hitag team seta[].hitag 0 cactor TEAMSPAWNER cstat 32768
		set droptile sprite[].pal
	}
	ifn sprite[].xvel 0 geta[].xvel droptile ifg sprite[].shade 1 ife VOLUME 4 geta[].shade mlevel
	ifg sprite[].owner 0 // deprecated
		{
			geta[].owner monstflags ifvarand monstflags 1 xorvar monstflags 1
			seta[].owner -1
		}
		ifn sprite[].hitag 0
		{
			geta[].hitag monstflags ifl monstflags 0 add monstflags 65536 ifvarand monstflags 1 xorvar monstflags 1
			seta[].hitag 0
		}
		ife team 0 { add maxkills 1 ifl sprite[].lotag 5 ifg sprite[].lotag userdef[].player_skill sub maxkills 1 }
	break
	
	case LIZRANGER 
	case LIZRANGERDUCKING 
	case LIZRANGERSTAYPUT 
	case LIZRANGERGUARD
	case LIZRANGERSIT
	case CHEERBOT
	case CHEERBOTSTAYPUT
		sizeat 30 28
		ife VOLUME 0 ife attmode 2 nullop else
		set NEWENEMIES NO
		ifg sprite[].lotag 4 
		{
			ifg sprite[].lotag 9
				geta[].lotag SPRITELOTAG
			seta[].lotag 0
		}
		else ife attmode YES seta[].lotag 0
		ife sprite[].extra 2 { set team 1 seta[].extra -1 } else ife sprite[].extra 1
		{
			set initsprite sprite[].picnum
			geta[].hitag team seta[].hitag 0 cactor TEAMSPAWNER cstat 32768
		}
		ifn sprite[].xvel 0 geta[].xvel droptile ifg sprite[].shade 1 ife VOLUME 4 geta[].shade mlevel
		ifg sprite[].owner 0 // deprecated
		{
			geta[].owner monstflags ifvarand monstflags 1 xorvar monstflags 1
			seta[].owner -1
		}
		ifn sprite[].hitag 0
		{
			geta[].hitag monstflags ifl monstflags 0 add monstflags 65536 ifvarand monstflags 1 xorvar monstflags 1
			seta[].hitag 0
		}
		ife team 0 { add maxkills 1 ifl sprite[].lotag 5 ifg sprite[].lotag userdef[].player_skill sub maxkills 1 }
	break
	
	case ARMYANT
	case ARMYANTJUMP
		sizeat 24 24
		ifspritepal 40
			sizeat 28 26
		ife VOLUME 0 ife attmode 2 nullop else
		set NEWENEMIES NO
		ifg sprite[].lotag 4 
		{
			ifg sprite[].lotag 9
				geta[].lotag SPRITELOTAG
			seta[].lotag 0
		}
		else ife attmode YES seta[].lotag 0
		ife sprite[].extra 2 { set team 1 seta[].extra -1 } else ife sprite[].extra 1
		{
			set initsprite sprite[].picnum
			geta[].hitag team seta[].hitag 0 cactor TEAMSPAWNER cstat 32768
		}
		ifn sprite[].xvel 0 geta[].xvel droptile ifg sprite[].shade 1 ife VOLUME 4 geta[].shade mlevel
		ifg sprite[].owner 0 // deprecated
		{
			geta[].owner monstflags ifvarand monstflags 1 xorvar monstflags 1
			seta[].owner -1
		}
		ifn sprite[].hitag 0
		{
			geta[].hitag monstflags ifl monstflags 0 add monstflags 65536 ifvarand monstflags 1 xorvar monstflags 1
			seta[].hitag 0
		}
		ife team 0 { add maxkills 1 ifl sprite[].lotag 5 ifg sprite[].lotag userdef[].player_skill sub maxkills 1 }
	break
	
	case ARMYANTCRAWL
	case ARMYANTCRAWLPUT
		sizeat 24 24
		ifspritepal 40
			sizeat 28 26
		ife VOLUME 0 ife attmode 2 nullop else
		set NEWENEMIES NO
		ifg sprite[].lotag 4 
		{
			ifg sprite[].lotag 9
				geta[].lotag SPRITELOTAG
			seta[].lotag 0
		}
		else ife attmode YES seta[].lotag 0
		ifvarand sprite[].cstat 8 set initsprite YES
		ife sprite[].extra 2 { set team 1 seta[].extra -1 } else ife sprite[].extra 1
		{
			set initsprite sprite[].picnum
			geta[].hitag team seta[].hitag 0 cactor TEAMSPAWNER cstat 32768
		}
		ifn sprite[].xvel 0 geta[].xvel droptile ifg sprite[].shade 1 ife VOLUME 4 geta[].shade mlevel
		ifg sprite[].owner 0 // deprecated
		{
			geta[].owner monstflags ifvarand monstflags 1 xorvar monstflags 1
			seta[].owner -1
		}
		ifn sprite[].hitag 0
		{
			geta[].hitag monstflags ifl monstflags 0 add monstflags 65536 ifvarand monstflags 1 xorvar monstflags 1
			seta[].hitag 0
		}
		ife team 0 { add maxkills 1 ifl sprite[].lotag 5 ifg sprite[].lotag userdef[].player_skill sub maxkills 1 }
	break
	
	case EDFSNIPER
	case EDFSNIPERCROUCH
	case EDFSNIPERSTAYPUT
		sizeat 28 26
		cstator 257
		ife VOLUME 0 ife attmode 2 nullop else
		set NEWENEMIES NO
		ifg sprite[].lotag 4 
		{
			ifg sprite[].lotag 9
				geta[].lotag SPRITELOTAG
			seta[].lotag 0
		}
		else ife attmode YES seta[].lotag 0
		ife sprite[].extra 2 { set team 1 seta[].extra -1 } else ife sprite[].extra 1
		{
			set initsprite sprite[].picnum
			geta[].hitag team seta[].hitag 0 cactor TEAMSPAWNER cstat 32768
		}
		ifn sprite[].xvel 0 geta[].xvel droptile ifg sprite[].shade 1 ife VOLUME 4 geta[].shade mlevel
		ifg sprite[].owner 0 // deprecated
		{
			geta[].owner monstflags ifvarand monstflags 1 xorvar monstflags 1
			seta[].owner -1
		}
		ifn sprite[].hitag 0
		{
			geta[].hitag monstflags ifl monstflags 0 add monstflags 65536 ifvarand monstflags 1 xorvar monstflags 1
			seta[].hitag 0
		}
	break
	
	case EDFDRONE
		sizeat 36 32
		cstator 257
		ife VOLUME 0 ife attmode 2 nullop else
		set NEWENEMIES NO
		ifg sprite[].lotag 4 
		{
			ifg sprite[].lotag 9
				geta[].lotag SPRITELOTAG
			seta[].lotag 0
		}
		else ife attmode YES seta[].lotag 0
		ife sprite[].extra 1
		{
			set initsprite sprite[].picnum
			geta[].hitag team seta[].hitag 0 cactor TEAMSPAWNER cstat 32768
		}
		ifn sprite[].xvel 0 geta[].xvel droptile ifg sprite[].shade 1 ife VOLUME 4 geta[].shade mlevel
		ifg sprite[].owner 0 // deprecated
		{
			geta[].owner monstflags ifvarand monstflags 1 xorvar monstflags 1
			seta[].owner -1
		}
		ifn sprite[].hitag 0
		{
			geta[].hitag monstflags ifl monstflags 0 add monstflags 65536 ifvarand monstflags 1 xorvar monstflags 1
			seta[].hitag 0
		}
	break
	
	case NEWSENTRY
	case FIGHTFEM
	case FIGHTMALE

		ifspritepal 24 sizeat 24 21 else
		sizeat 22 20
		cstator 257
		ife VOLUME 0 ife attmode 2 nullop else
		set NEWENEMIES NO
		ifg sprite[].lotag 4 
		{
			ifg sprite[].lotag 9
				geta[].lotag SPRITELOTAG
			seta[].lotag 0
		}
		else ife attmode YES seta[].lotag 0
		ife sprite[].extra 2 
		{ 
			set team 1 seta[].extra -1 
			ifactor FIGHTMALE set droptile -1
			ifactor FIGHTFEM set droptile -1
		} 
		else 
		ife sprite[].extra 1
		{
			set initsprite sprite[].picnum
			geta[].hitag team seta[].hitag 0 cactor TEAMSPAWNER cstat 32768
		}
		ifn sprite[].xvel 0 geta[].xvel droptile ifg sprite[].shade 1 ife VOLUME 4 geta[].shade mlevel
		geta[].hitag initflags
		seta[].hitag 0
		ifg sprite[].owner 0 // deprecated
		{
			geta[].owner monstflags ifvarand monstflags 1 xorvar monstflags 1
			seta[].owner -1
		}
		ifn sprite[].hitag 0
		{
			geta[].hitag monstflags ifl monstflags 0 add monstflags 65536 ifvarand monstflags 1 xorvar monstflags 1
			seta[].hitag 0
		}
		ifactor NEWSENTRY ife team 0 { add maxkills 1 ifl sprite[].lotag 5 ifg sprite[].lotag userdef[].player_skill sub maxkills 1 }
	break
	
	case GRAVESNPC case GRAVESNOGUN
	
		sizeat 22 22
		cstator 257
		ife VOLUME 0 ife attmode 2 nullop else
		set NEWENEMIES NO
	
	break
	
	case SCHOOLGIRL
		sizeat 26 24
		cstator 257
		ife VOLUME 0 ife attmode 2 nullop else
		set NEWENEMIES NO
		ifg sprite[].lotag 4 
		{
			ifg sprite[].lotag 9
				geta[].lotag SPRITELOTAG
			seta[].lotag 0
		}
		else ife attmode YES seta[].lotag 0
		ife sprite[].extra 1
		{
			set initsprite sprite[].picnum
			geta[].hitag team seta[].hitag 0 cactor TEAMSPAWNER cstat 32768
		}
		ifn sprite[].xvel 0 geta[].xvel droptile ifg sprite[].shade 1 ife VOLUME 4 geta[].shade mlevel
		ifg sprite[].owner 0 // deprecated
		{
			geta[].owner monstflags ifvarand monstflags 1 xorvar monstflags 1
			seta[].owner -1
		}
		ifn sprite[].hitag 0
		{
			geta[].hitag monstflags ifl monstflags 0 add monstflags 65536 ifvarand monstflags 1 xorvar monstflags 1
			seta[].hitag 0
		}
	break
	
	case DANCINGBIKINIGIRL
		sizeat 26 24
		cstator 256
	break
	
	case LIZBOSS
		ife VOLUME 0 ife attmode 2 nullop else
		set NEWENEMIES NO

		cstat 257
		ifg sprite[].lotag 4 
		{
			ifg sprite[].lotag 9
				geta[].lotag SPRITELOTAG
			seta[].lotag 0
		}
		else ife attmode YES seta[].lotag 0
		ife sprite[].extra 2 { set team 1 seta[].extra -1 } else ife sprite[].extra 1
		{
			set initsprite sprite[].picnum
			geta[].hitag team seta[].hitag 0 cactor TEAMSPAWNER cstat 32768
		}
		else
		{
			ifspritepal 0 
			sizeat 64 56
			else
			{
				sizeat 32 28
				strength LIZBOSSPALSTRENGTH
			}
		}
		ifn sprite[].xvel 0 geta[].xvel droptile ifg sprite[].shade 1 ife VOLUME 4 geta[].shade mlevel
		ifg sprite[].owner 0 // deprecated
		{
			geta[].owner monstflags ifvarand monstflags 1 xorvar monstflags 1
			seta[].owner -1
		}
		ifn sprite[].hitag 0
		{
			geta[].hitag monstflags ifl monstflags 0 add monstflags 65536 ifvarand monstflags 1 xorvar monstflags 1
			seta[].hitag 0
		}
		ife team 0 { add maxkills 1 ifl sprite[].lotag 5 ifg sprite[].lotag userdef[].player_skill sub maxkills 1 }
	break
	
	case PIGBOSS
	case PIGBOSSSTAYPUT
		ife VOLUME 0 ife attmode 2 nullop else
		set NEWENEMIES NO
		cstat 257
		ifg sprite[].lotag 4 
		{
			ifg sprite[].lotag 9
				geta[].lotag SPRITELOTAG
			seta[].lotag 0
		}
		else ife attmode YES seta[].lotag 0
		ife sprite[].extra 2 { set team 1 seta[].extra -1 } else ife sprite[].extra 1
		{
			set initsprite sprite[].picnum
			geta[].hitag team seta[].hitag 0 
			cactor TEAMSPAWNER cstat 32768
		}
		else
		{
			ifspritepal 0 
			sizeat 66 60
			else
			ifspritepal 42
			sizeat 66 60
			else
			{
				sizeat 33 30
				strength PIGBOSSPALSTRENGTH
			}
		}
		ifn sprite[].xvel 0 geta[].xvel droptile ifg sprite[].shade 1 ife VOLUME 4 geta[].shade mlevel
		ifg sprite[].owner 0 // deprecated
		{
			geta[].owner monstflags ifvarand monstflags 1 xorvar monstflags 1
			seta[].owner -1
		}
		ifn sprite[].hitag 0
		{
			geta[].hitag monstflags ifl monstflags 0 add monstflags 65536 ifvarand monstflags 1 xorvar monstflags 1
			seta[].hitag 0
		}
		ife team 0 { add maxkills 1 ifl sprite[].lotag 5 ifg sprite[].lotag userdef[].player_skill sub maxkills 1 }
	break
	
	case ARMPIG
	case EDFPIG
		ife VOLUME 0 ife attmode 2 nullop else
		set NEWENEMIES NO
		sizeat 26 24
		cstator 257
		ifg sprite[].lotag 4 
		{
			ifg sprite[].lotag 9
				geta[].lotag SPRITELOTAG
			seta[].lotag 0
		}
		else ife attmode YES seta[].lotag 0
		ife sprite[].extra 2 { set team 1 seta[].extra -1 } else ife sprite[].extra 1
		{
			set initsprite sprite[].picnum
			geta[].hitag team seta[].hitag 0 cactor TEAMSPAWNER cstat 32768
		}
		ifn sprite[].xvel 0 geta[].xvel droptile ifg sprite[].shade 1 ife VOLUME 4 geta[].shade mlevel
		ifg sprite[].owner 0 // deprecated
		{
			geta[].owner monstflags ifvarand monstflags 1 xorvar monstflags 1
			seta[].owner -1
		}
		ifn sprite[].hitag 0
		{
			geta[].hitag monstflags ifl monstflags 0 add monstflags 65536 ifvarand monstflags 1 xorvar monstflags 1
			seta[].hitag 0
		}
		ife team 0 { add maxkills 1 ifl sprite[].lotag 5 ifg sprite[].lotag userdef[].player_skill sub maxkills 1 }
	break
	
	case NATURALLIGHTNING
		cactor LIGHTNING2
		cstator 32768
	break
	
	case POLYMORPH
	case POLYPOLE
	case POLYMORPHPAD
	case POLYMORPHPOD
	case POLYGORE1 case POLYGORE2 case POLYGORE3 case POLYGORE4 case POLYGORE5
		ifactor POLYMORPH sizeat 32 28 
		cstator 257 
		ife VOLUME 0 ife attmode 2 nullop else
		set NEWENEMIES NO
		ifg sprite[].lotag 4 
		{
			ifg sprite[].lotag 9
				geta[].lotag SPRITELOTAG
			seta[].lotag 0
		}
		else ife attmode YES seta[].lotag 0
		ife sprite[].extra 1
		{
			set initsprite sprite[].picnum
			geta[].hitag team seta[].hitag 0 cactor TEAMSPAWNER cstat 32768
		}
		ifn sprite[].xvel 0 geta[].xvel droptile ifg sprite[].shade 1 ife VOLUME 4 geta[].shade mlevel
		ifg sprite[].owner 0 // deprecated
		{
			geta[].owner monstflags ifvarand monstflags 1 xorvar monstflags 1
			seta[].owner -1
		}
		ifn sprite[].hitag 0
		{
			geta[].hitag monstflags ifl monstflags 0 add monstflags 65536 ifvarand monstflags 1 xorvar monstflags 1
			seta[].hitag 0
		}
		ife team 0 { add maxkills 1 ifl sprite[].lotag 5 ifg sprite[].lotag userdef[].player_skill sub maxkills 1 }
	break
	
	case MECHBRAIN
	case MECHBRAINSTAYPUT
	case BATBOSS
		ife VOLUME 0 ife attmode 2 nullop else
		set NEWENEMIES NO
		ifactor BATBOSS ifn sprite[].pal 21 sizeat 32 30
		else
		sizeat 40 38
		cstator 257
		ifspritepal 0 spritepal 12
		ifg sprite[].lotag 4 
		{
			ifg sprite[].lotag 9
				geta[].lotag SPRITELOTAG
			seta[].lotag 0
		}
		else ife attmode YES seta[].lotag 0
		ife sprite[].extra 2 { set team 1 seta[].extra -1 } else ife sprite[].extra 1
		{
			set initsprite sprite[].picnum
			geta[].hitag team seta[].hitag 0 cactor TEAMSPAWNER cstat 32768
		}
		ifn sprite[].xvel 0 geta[].xvel droptile ifg sprite[].shade 1 ife VOLUME 4 geta[].shade mlevel
		ifg sprite[].owner 0 // deprecated
		{
			geta[].owner monstflags ifvarand monstflags 1 xorvar monstflags 1
			seta[].owner -1
		}
		ifn sprite[].hitag 0
		{
			geta[].hitag monstflags ifl monstflags 0 add monstflags 65536 ifvarand monstflags 1 xorvar monstflags 1
			seta[].hitag 0
		}
		ife team 0 { add maxkills 1 ifl sprite[].lotag 5 ifg sprite[].lotag userdef[].player_skill sub maxkills 1 }
	break
	
	case PROTONSTAND
	case DRPROTON
		ife VOLUME 0 ife attmode 2 nullop else
		set NEWENEMIES NO
		sizeat 42 38
		cstator 257
		geta[].lotag SPRITELOTAG
		seta[].lotag 0
		ifg sprite[].owner 0 // deprecated
		{
			geta[].owner monstflags ifvarand monstflags 1 xorvar monstflags 1
			seta[].owner -1
		}
		ifn sprite[].hitag 0
		{
			geta[].hitag monstflags ifl monstflags 0 add monstflags 65536 ifvarand monstflags 1 xorvar monstflags 1
			seta[].hitag 0
		}
		ife team 0 { add maxkills 1 ifl sprite[].lotag 5 ifg sprite[].lotag userdef[].player_skill sub maxkills 1 }
	break
	
	case PSPIDER
		ife VOLUME 0 ife attmode 2 nullop else
		set NEWENEMIES NO
		sizeat 40 36
		ifspritepal 3 sizeat 32 30 else
		ifspritepal 46 sizeat 32 30
		cstator 257
		geta[].lotag SPRITELOTAG
		seta[].lotag 0
		ife sprite[].extra 2 { set team 1 seta[].extra -1 } else ife sprite[].extra 1
		{
			set initsprite sprite[].picnum
			geta[].hitag team seta[].hitag 0 cactor TEAMSPAWNER cstat 32768
		}
		ifg sprite[].owner 0 // deprecated
		{
			geta[].owner monstflags ifvarand monstflags 1 xorvar monstflags 1
			seta[].owner -1
		}
		ifn sprite[].hitag 0
		{
			geta[].hitag monstflags ifl monstflags 0 add monstflags 65536 ifvarand monstflags 1 xorvar monstflags 1
			seta[].hitag 0
		}
		ife team 0 { add maxkills 1 ifl sprite[].lotag 5 ifg sprite[].lotag userdef[].player_skill sub maxkills 1 }
	break
	
	case ZOMBIE
	case ZOMBIEGIDUP
		ife VOLUME 0 ife attmode 2 nullop else
		set NEWENEMIES NO
		ifg sprite[].lotag 4 
		{
			ifg sprite[].lotag 9
				geta[].lotag SPRITELOTAG
			seta[].lotag 0
		}
		else ife attmode YES seta[].lotag 0
		ife sprite[].extra 2 { set team 1 seta[].extra -1 } else ife sprite[].extra 1
		{
			set initsprite sprite[].picnum
			geta[].hitag team seta[].hitag 0 cactor TEAMSPAWNER cstat 32768
		}
		ifn sprite[].xvel 0 geta[].xvel droptile ifg sprite[].shade 1 ife VOLUME 4 geta[].shade mlevel
		ifg sprite[].owner 0 // deprecated
		{
			geta[].owner monstflags ifvarand monstflags 1 xorvar monstflags 1
			seta[].owner -1
		}
		ifn sprite[].hitag 0
		{
			geta[].hitag monstflags ifl monstflags 0 add monstflags 65536 ifvarand monstflags 1 xorvar monstflags 1
			seta[].hitag 0
		}
		ife team 0 { add maxkills 1 ifl sprite[].lotag 5 ifg sprite[].lotag userdef[].player_skill sub maxkills 1 }
	break
	
	case CYBERBEAST
	case EDFTROOP
		ife VOLUME 0 ife attmode 2 nullop else
		set NEWENEMIES NO
		cstator 257
		ifg sprite[].lotag 4 
		{
			ifg sprite[].lotag 9
				geta[].lotag SPRITELOTAG
			seta[].lotag 0
		}
		ife sprite[].extra 2 { set team 1 seta[].extra -1 } else ife sprite[].extra 1
		{
			set initsprite sprite[].picnum
			geta[].hitag team seta[].hitag 0 cactor TEAMSPAWNER cstat 32768
		}
		ifn sprite[].xvel 0 geta[].xvel droptile ifg sprite[].shade 1 ife VOLUME 4 geta[].shade mlevel
		ifg sprite[].owner 0 // deprecated
		{
			geta[].owner monstflags ifvarand monstflags 1 xorvar monstflags 1
			seta[].owner -1
		}
		ifn sprite[].hitag 0
		{
			geta[].hitag monstflags ifl monstflags 0 add monstflags 65536 ifvarand monstflags 1 xorvar monstflags 1
			seta[].hitag 0
		}
		ifactor CYBERBEAST ife team 0 { add maxkills 1 ifl sprite[].lotag 5 ifg sprite[].lotag userdef[].player_skill sub maxkills 1 }
	break
	
	case PIRATE1A
		cactor 13087
		geta[].xrepeat x
		mul x 3 div x 4
		seta[].xrepeat x
		geta[].yrepeat y
		mul y 2 div y 3
		seta[].yrepeat y
	break
	
	case PIRATE4A
		cactor 13088
		geta[].xrepeat x
		mul x 3 div x 4
		seta[].xrepeat x
		geta[].yrepeat y
		mul y 2 div y 3
		seta[].yrepeat y
	break
	
	case PIRATE3A
		cactor 13092
		geta[].xrepeat x
		mul x 3 div x 4
		seta[].xrepeat x
		geta[].yrepeat y
		mul y 2 div y 3
		seta[].yrepeat y
	break
	
	case PIRATE6A
		cactor 13093
		geta[].xrepeat x
		mul x 3 div x 4
		seta[].xrepeat x
		geta[].yrepeat y
		mul y 2 div y 3
		seta[].yrepeat y
	break
	
	case PIRATE2A
		cactor 13094
		geta[].xrepeat x
		mul x 3 div x 4
		seta[].xrepeat x
		geta[].yrepeat y
		mul y 2 div y 3
		seta[].yrepeat y
	break
	
	case PIRATE5A
		cactor 13095
		geta[].xrepeat x
		mul x 3 div x 4
		seta[].xrepeat x
		geta[].yrepeat y
		mul y 2 div y 3
		seta[].yrepeat y
	break
	
	case MAN
		geta[].xrepeat x
		mul x 3 div x 4
		seta[].xrepeat x
		geta[].yrepeat y
		mul y 2 div y 3
		seta[].yrepeat y
	break
	
	case WOMAN
		cactor 13089
		geta[].xrepeat x
		mul x 3 div x 4
		seta[].xrepeat x
		geta[].yrepeat y
		mul y 2 div y 3
		seta[].yrepeat y
	break
	
	case 4866
		cactor TOUGHGAL
		geta[].xrepeat x
		mul x 2 div x 3
		seta[].xrepeat x
		geta[].yrepeat y
		mul y 2 div y 3
		seta[].yrepeat y
	break
	
	case STRIPPER 
	case STRIPPERSTAYPUT
	case CHEERLEADER
	case HOOKER 
	case HOOKERSTAYPUT
	case NAKEDBABE
		sizeat 28 26 
		geta[].hitag initsprite
		seta[].hitag 0
		ifn sprite[].xvel 0 geta[].xvel droptile
	break
	
	case POLEDANCER
		sizeat 28 27 
		geta[].hitag initsprite
		seta[].hitag 0
		ifn sprite[].xvel 0 geta[].xvel droptile
	break
	
	
	case FEM1
		cactor STRIPPERSTAYPUT
		sizeat 28 26
		geta[].hitag initsprite
		seta[].hitag 0
		ifn sprite[].xvel 0 geta[].xvel droptile
	break
	
	case FEM2
		cactor POLEDANCER
		sizeat 28 27
		geta[].hitag initsprite
		seta[].hitag 0
		ifn sprite[].xvel 0 geta[].xvel droptile
		geta[].x startx
		geta[].y starty
	break
	
	case FEM3
		cactor HOOKERSTAYPUT
		sizeat 28 26
		geta[].hitag initsprite
		seta[].hitag 0
		ifn sprite[].xvel 0 geta[].xvel droptile
	break
	
	case FEM7
		cactor KBABESTAYPUT
		sizeat 28 26
		geta[].hitag initsprite
		seta[].hitag 0
		ifn sprite[].xvel 0 geta[].xvel droptile
	break
	
	case FEM4
		cactor CAVEGIRLSTAYPUT
		sizeat 28 26
		geta[].hitag initsprite
		seta[].hitag 0
		ifn sprite[].xvel 0 geta[].xvel droptile
	break
	
	case FEM9
		cactor CHEERLEADER
		sizeat 28 26
		geta[].hitag initsprite
		seta[].hitag 0
		ifn sprite[].xvel 0 geta[].xvel droptile
	break
	
	case FEM10
		cactor SISTERS2
		geta[].xrepeat x
		set temp x
		shiftr temp 3
		sub x temp
		seta[].xrepeat x
		geta[].yrepeat y
		set temp y
		shiftr temp 3
		sub y temp
		seta[].yrepeat y
		// geta[].hitag initsprite
		// seta[].hitag 0
	break
	
	case FOODCART
	case UFOFLOAT
		cstator 256
		geta[].lotag SPRITELOTAG
		seta[].lotag 0
	break
	case FEM13
		cstator 256
	break
	
	case MEGABRAIN 
	case MEGABRAINSTAYPUT
		ifspritepal 47 sizeat 42 38 else
		ifspritepal 19 sizeat 60 52 else
		sizeat 48 40
		ife VOLUME 0 ife attmode 2 nullop else
		set NEWENEMIES NO
		cstator 257
		ifg sprite[].lotag 4 
		{
			ifg sprite[].lotag 9
				geta[].lotag SPRITELOTAG
			seta[].lotag 0
		}
		ifn sprite[].xvel 0 geta[].xvel droptile ifg sprite[].shade 1 ife VOLUME 4 geta[].shade mlevel
		ifg sprite[].owner 0 // deprecated
		{
			geta[].owner monstflags ifvarand monstflags 1 xorvar monstflags 1
			seta[].owner -1
		}
		ifn sprite[].hitag 0
		{
			geta[].hitag monstflags ifl monstflags 0 add monstflags 65536 ifvarand monstflags 1 xorvar monstflags 1
			seta[].hitag 0
		}
		ife team 0 { add maxkills 1 ifl sprite[].lotag 5 ifg sprite[].lotag userdef[].player_skill sub maxkills 1 }
	break
	
	case TERMINATOR
	case TERMINATORSTAYPUT
	case TERMINATORDUCKING
	case TERMINATORCRAWLING
	    ifspritepal 57 sizeat 36 32 else
		sizeat 28 24 // 42 36
		cstator 257
		ife VOLUME 0 ife attmode 2 nullop else
		set NEWENEMIES NO
		ifg sprite[].lotag 4 
		{
			ifg sprite[].lotag 9
				geta[].lotag SPRITELOTAG
			seta[].lotag 0
		}
		ife sprite[].extra 2 { set team 1 seta[].extra -1 } else ife sprite[].extra 1
		{
			set initsprite sprite[].picnum
			geta[].hitag team seta[].hitag 0 cactor TEAMSPAWNER cstat 32768
		}
		action ATERMINATOROFF
		ifn sprite[].xvel 0 geta[].xvel droptile ifg sprite[].shade 1 ife VOLUME 4 geta[].shade mlevel
		ifg sprite[].owner 0 // deprecated
		{
			geta[].owner monstflags ifvarand monstflags 1 xorvar monstflags 1
			seta[].owner -1
		}
		ifn sprite[].hitag 0
		{
			geta[].hitag monstflags ifl monstflags 0 add monstflags 65536 ifvarand monstflags 1 xorvar monstflags 1
			seta[].hitag 0
		}
		ife team 0 { add maxkills 1 ifl sprite[].lotag 5 ifg sprite[].lotag userdef[].player_skill sub maxkills 1 }
	break
	
	case DEVOURER
		ifspritepal 0
		sizeat 84 72
		else
		ifspritepal 19
		sizeat 24 20
		else sizeat 18 16
		ife VOLUME 0 ife attmode 2 nullop else
		set NEWENEMIES NO
		ifg sprite[].lotag 4 
		{
			ifg sprite[].lotag 9
				geta[].lotag SPRITELOTAG
			seta[].lotag 0
		}
		ifn sprite[].xvel 0 geta[].xvel droptile ifg sprite[].shade 1 ife VOLUME 4 geta[].shade mlevel
		ifg sprite[].owner 0 // deprecated
		{
			geta[].owner monstflags ifvarand monstflags 1 xorvar monstflags 1
			seta[].owner -1
		}
		ifn sprite[].hitag 0
		{
			geta[].hitag monstflags ifl monstflags 0 add monstflags 65536 ifvarand monstflags 1 xorvar monstflags 1
			seta[].hitag 0
		}
		ife sprite[].extra 2 { set team 1 seta[].extra -1 } else ife sprite[].extra 1
		{
			set initsprite sprite[].picnum
			geta[].hitag team seta[].hitag 0 cactor TEAMSPAWNER cstat 32768
		}
		ife team 0 { add maxkills 1 ifl sprite[].lotag 5 ifg sprite[].lotag userdef[].player_skill sub maxkills 1 }
	break
	
	case CANHEAD
		ifspritepal 0 sizeat 26 26
		else
		sizeat 64 64
		cstator 257
		// set NEWENEMIES NO
		ifg sprite[].lotag 4 
		{
			ifg sprite[].lotag 9
				geta[].lotag SPRITELOTAG
			seta[].lotag 0
		}
		ifn sprite[].xvel 0 geta[].xvel droptile ifg sprite[].shade 1 ife VOLUME 4 geta[].shade mlevel
		ifg sprite[].owner 0 // deprecated
		{
			geta[].owner monstflags ifvarand monstflags 1 xorvar monstflags 1
			seta[].owner -1
		}
		ifn sprite[].hitag 0
		{
			geta[].hitag monstflags ifl monstflags 0 add monstflags 65536 ifvarand monstflags 1 xorvar monstflags 1
			seta[].hitag 0
		}
		ife team 0 { add maxkills 1 ifl sprite[].lotag 5 ifg sprite[].lotag userdef[].player_skill sub maxkills 1 }
	break
	
	case NEWMECH
	case PODHEAD
		ifspritepal 40 sizeat 64 54 else sizeat 42 36
		cstator 257
		ifg sprite[].lotag 4 
		{
			ifg sprite[].lotag 9
				geta[].lotag SPRITELOTAG
			seta[].lotag 0
		}
		ifn sprite[].xvel 0 geta[].xvel droptile ifg sprite[].shade 1 ife VOLUME 4 geta[].shade mlevel
		ifg sprite[].owner 0 // deprecated
		{
			geta[].owner monstflags ifvarand monstflags 1 xorvar monstflags 1
			seta[].owner -1
		}
		ifn sprite[].hitag 0
		{
			geta[].hitag monstflags ifl monstflags 0 add monstflags 65536 ifvarand monstflags 1 xorvar monstflags 1
			seta[].hitag 0
		}
		ife team 0 { add maxkills 1 ifl sprite[].lotag 5 ifg sprite[].lotag userdef[].player_skill sub maxkills 1 }
	break
	
	case GUNSHIP
		sizeat 128 128
		cstator 257
		ifg sprite[].lotag 4 
		{
			ifg sprite[].lotag 9
				geta[].lotag SPRITELOTAG
			seta[].lotag 0
		}
		ifn sprite[].xvel 0 geta[].xvel droptile ifg sprite[].shade 1 ife VOLUME 4 geta[].shade mlevel
		ifn sprite[].hitag 0
		{
			geta[].hitag monstflags ifl monstflags 0 add monstflags 65536 ifvarand monstflags 1 xorvar monstflags 1
			seta[].hitag 0
		}
		ife team 0 { add maxkills 1 ifl sprite[].lotag 5 ifg sprite[].lotag userdef[].player_skill sub maxkills 1 }
	break
	
	case ARMEDF
		sizeat 21 20 // 42 40
		ife VOLUME 0 ife attmode 2 nullop else
		set NEWENEMIES NO
		ifg sprite[].lotag 4 
		{
			ifg sprite[].lotag 9
				geta[].lotag SPRITELOTAG
			seta[].lotag 0
		}
		ife sprite[].extra 1
		{
			set initsprite sprite[].picnum
			geta[].hitag team seta[].hitag 0 cactor TEAMSPAWNER cstat 32768
		}
		ifn sprite[].xvel 0 geta[].xvel droptile ifg sprite[].shade 1 ife VOLUME 4 geta[].shade mlevel
		ifg sprite[].owner 0 // deprecated
		{
			geta[].owner monstflags ifvarand monstflags 1 xorvar monstflags 1
			seta[].owner -1
		}
		ifn sprite[].hitag 0
		{
			geta[].hitag monstflags ifl monstflags 0 add monstflags 65536 ifvarand monstflags 1 xorvar monstflags 1
			seta[].hitag 0
		}
	break
	
	case LIZELITE
		sizeat 23 23
		ife VOLUME 0 ife attmode 2 nullop else
		set NEWENEMIES NO
		ifg sprite[].lotag 4 
		{
			ifg sprite[].lotag 9
				geta[].lotag SPRITELOTAG
			seta[].lotag 0
		}
		ife sprite[].extra 2 { set team 1 seta[].extra -1 } else ife sprite[].extra 1
		{
			set initsprite sprite[].picnum
			geta[].hitag team seta[].hitag 0 cactor TEAMSPAWNER cstat 32768
		}
		ifn sprite[].xvel 0 geta[].xvel droptile ifg sprite[].shade 1 ife VOLUME 4 geta[].shade mlevel
		ifg sprite[].owner 0 // deprecated
		{
			geta[].owner monstflags ifvarand monstflags 1 xorvar monstflags 1
			seta[].owner -1
		}
		ifn sprite[].hitag 0
		{
			geta[].hitag monstflags ifl monstflags 0 add monstflags 65536 ifvarand monstflags 1 xorvar monstflags 1
			seta[].hitag 0
		}
		ife team 0 { add maxkills 1 ifl sprite[].lotag 5 ifg sprite[].lotag userdef[].player_skill sub maxkills 1 }
	break
	
	case MANDOFETT
	ife visited[LEVEL] 0
	{
		sizeat 26 24
		ife VOLUME 0 ife attmode 2 nullop else
		set NEWENEMIES NO
		ifg sprite[].lotag 4 
		{
			ifg sprite[].lotag 9
				geta[].lotag SPRITELOTAG
			seta[].lotag 0
		}
		ife sprite[].extra 1
		{
			set initsprite sprite[].picnum
			geta[].hitag team seta[].hitag 0 cactor TEAMSPAWNER cstat 32768
		}
		ifn sprite[].xvel 0 geta[].xvel droptile ifg sprite[].shade 1 ife VOLUME 4 geta[].shade mlevel
		ifg sprite[].owner 0 // deprecated
		{
			geta[].owner monstflags ifvarand monstflags 1 xorvar monstflags 1
			seta[].owner -1
		}
		ifspritepal 3 { geta[].hitag initflags seta[].hitag 0 }
		else
		ifn sprite[].hitag 0
		{
			geta[].hitag monstflags ifl monstflags 0 add monstflags 65536 ifvarand monstflags 1 xorvar monstflags 1
			seta[].hitag 0
		}
	}
	break
	
	case SPACEBULL	
	case SPACEBULLSTAYPUT
	case SPACEBULLDUCKING
	case SPACEBULLGUARD
		sizeat 26 26
		ife VOLUME 0 ife attmode 2 nullop else
		set NEWENEMIES NO
		cstator 257
		ifg sprite[].lotag 4 
		{
			ifg sprite[].lotag 9
				geta[].lotag SPRITELOTAG
			seta[].lotag 0
		}
		ife sprite[].extra 2 { set team 1 seta[].extra -1 } else ife sprite[].extra 1
		{
			set initsprite sprite[].picnum
			geta[].hitag team seta[].hitag 0 cactor TEAMSPAWNER cstat 32768
		}
		ifn sprite[].xvel 0 geta[].xvel droptile ifg sprite[].shade 1 ife VOLUME 4 geta[].shade mlevel
		ifg sprite[].owner 0 // deprecated
		{
			geta[].owner monstflags ifvarand monstflags 1 xorvar monstflags 1
			seta[].owner -1
		}
		ifn sprite[].hitag 0
		{
			geta[].hitag monstflags ifl monstflags 0 add monstflags 65536 ifvarand monstflags 1 xorvar monstflags 1
			seta[].hitag 0
		}
		ife team 0 { add maxkills 1 ifl sprite[].lotag 5 ifg sprite[].lotag userdef[].player_skill sub maxkills 1 }
	break
	
	case SCUBATROOP
	case SCUBATROOPSIT
		sizeat 24 22
		ifactor SCUBATROOP ifinwater cstator 385
		else cstator 257
		ife VOLUME 0 ife attmode 2 nullop else
		set NEWENEMIES NO
		ifg sprite[].lotag 4 
		{
			ifg sprite[].lotag 9
				geta[].lotag SPRITELOTAG
			seta[].lotag 0
		}
		ifn sprite[].xvel 0 geta[].xvel droptile ifg sprite[].shade 1 ife VOLUME 4 geta[].shade mlevel
		ifg sprite[].owner 0 // deprecated
		{
			geta[].owner monstflags ifvarand monstflags 1 xorvar monstflags 1
			seta[].owner -1
		}
		ifn sprite[].hitag 0
		{
			geta[].hitag monstflags ifl monstflags 0 add monstflags 65536 ifvarand monstflags 1 xorvar monstflags 1
			seta[].hitag 0
		}
		ife team 0 { add maxkills 1 ifl sprite[].lotag 5 ifg sprite[].lotag userdef[].player_skill sub maxkills 1 }
	break
	
	case SHELLY
		
		ife visited[LEVEL] 0
		{
			sizeat 24 22
			clipdist 20
			ife VOLUME 0 ife attmode 2 nullop else
			set NEWENEMIES NO
			
			geta[].hitag initflags seta[].hitag 0
			ifn initflags 32767
			ifn initflags 32766
			{
				ife wesreplace 2 // wes replaces bombshell
				{
					cactor WESBOT
					ifn attmode YES
					{
						ife startmode -1 { set startmode 1 set charsel 1 } else
						{ ifvarand startmode 4 xorvar startmode 4 ifvarand charsel 4 xorvar charsel 4 }	
					}
				}
				else
				ifn attmode YES
				{
					ife startmode -1 { set startmode 1 set charsel 1 } else
					{ ifvarand startmode 2 xorvar startmode 2 ifvarand charsel 2 xorvar charsel 2 }	
				}
			}
		}
	break
	
	case DUKESTART // duke solo
		ifn sprite[].lotag 0 { geta[].lotag gametype seta[].lotag 0 }
		ifn sprite[].hitag 0 { geta[].hitag scorelimit seta[].hitag 0 }
		ifg gametype 0 { set startmode 1 set charsel 1 } else
		ifn attmode YES
		{ set startmode 1 set charsel 1 set dready 0 }
		
		ife wesreplace 1 // wes replaces duke
		{
			ifg gametype 0 { set startmode 4 set charsel 4 } else
			ifn attmode YES
			{ set startmode 4 set charsel 4 }
		}
		cstat 32768
		sizeat 0 0
		
	break
	
	case DUKEBOT
		ife visited[LEVEL] 0
		{
			sizeat 42 36
			clipdist 20
			ife VOLUME 0 ife attmode 2 nullop else
			set NEWENEMIES NO
			
			geta[].hitag initflags seta[].hitag 0
			ifn initflags 32767
			ifn initflags 32766
			{
				ife wesreplace 1 // wes replaces duke
				{
					cactor WESBOT
					ifn attmode YES
					{
						ife startmode -1 { set startmode 2 set charsel 2 } else
						{ ifvarand startmode 4 xorvar startmode 4 ifvarand charsel 4 xorvar charsel 4 }	
					}
				}
				else
				ifn attmode YES
				{
					ife startmode -1 { set startmode 2 set charsel 2 } else
					{ ifvarand startmode 1 xorvar startmode 1 ifvarand charsel 1 xorvar charsel 1 }
				}
			}
		}
	break
	
	case DEABOT
		ife visited[LEVEL] 0
		{
		geta[].hitag initflags seta[].hitag 0
		sizeat 23 21
		}
	break
	
	case WESBOT
		ife visited[LEVEL] 0
		{
		geta[].hitag initflags seta[].hitag 0
		sizeat 22 20
		}
	break
	
	case SHELLYSTART // shelly solo
		ifn sprite[].lotag 0 { geta[].lotag gametype seta[].lotag 0 }
		ifn sprite[].hitag 0 { geta[].hitag scorelimit seta[].hitag 0 }
		ifg gametype 0 { set startmode 2 set charsel 2 } else
		ifn attmode YES
		{ set startmode 2 set charsel 2 set bready 0  }
		
		ife wesreplace 2 // wes replaces bombshell
		{
			al THISACTOR
			ifg gametype 0 { set startmode 4 set charsel 4 } else
			ifn attmode YES
			{ set startmode 4 set charsel 4 }
		}
		
		cstat 32768
		
		sizeat 0 0
		
	break
	
	case WESSTART // Wes solo
	
		ifg gametype 0 { set startmode 4 set charsel 4 } else
		ifn attmode YES
		{ set startmode 4 set charsel 4 set wready 0  }
		cstat 32768
		
		sizeat 0 0
	
	break
	
	case MANDOSTART // MANDO solo
	
		ifg gametype 0 { set startmode 8 set charsel 8 } else
		ifn attmode YES
		{ set startmode 8 set charsel 8 set mready 0 }
		cstat 32768
		
		sizeat 0 0
	
	break
	
	case DEASTART // DEA solo
	
		ifg gametype 0 { set startmode 16 set charsel 16 } else
		ifn attmode YES
		{ set startmode 16 set charsel 16 set nready 0  }
		cstat 32768
		
		sizeat 0 0
	
	break
	
	case DUKEANDSHELLY // Duke plus Bombshell
		ifn sprite[].lotag 0 { geta[].lotag gametype seta[].lotag 0 }
		ifn sprite[].hitag 0 { geta[].hitag scorelimit seta[].hitag 0 }
		ifg gametype 0 { set startmode 3 set charsel 3 } else
		ifn attmode YES
		{ 
			set startmode 3 set charsel 3 
			ife sprite[].extra NO set switchmode NO
		}
		
		ife wesreplace 1 // wes replaces duke
		{
			ifn gametype 0 { set startmode 6 set charsel 6 } else
			ifn attmode YES
			{ set startmode 6 set charsel 6 }
		}
		ife wesreplace 2 // wes replaces bombshell
		{
			ifn gametype 0 { set startmode 5 set charsel 5 } else
			ifn attmode YES
			{ set startmode 5 set charsel 5 }
		}
		
		cstat 32768
		sizeat 0 0
	break
	
	case SHOOT_THIS
		cstat 256
		cstator 32768
		geta[].lotag team
		seta[].lotag 0
		set spawnprotect 0
	break
	
	case SECSPRITE1
	case SECSPRITE2
	case SECSPRITE3
	case SECSPRITE4
	case SECSPRITE5
	case SECSPRITE6
	case SECSPRITE7
	case SECSPRITE8
	case SECSPRITE9
	case WATERIMPACT
		geta[].cstat mtype
		cstat 32768
	break
	
	case GUNSTART
		cstat 32768
		geta[].lotag startguns
		ifn sprite[].hitag 0
		{
			geta[].hitag gametype
			seta[].hitag 0
		}
		ifl sprite[].shade 0 set gametype -1
	break
	
	case SMALLSTACK case BIGSTACK
		sizeat 20 16
	break
	
	case DIALOGBUB
		ifn sprite[].lotag 0
		{
			geta[].lotag SPRITELOTAG
			seta[].lotag 0
			geta[].hitag starty
			seta[].hitag 0
			geta[].extra initflags
			seta[].extra -1
			geta[].xvel mtype
			seta[].xvel 0
			geta[].yvel initsprite
			seta[].yvel 0
			geta[].zvel startx
			seta[].zvel 0
		}
	break
	
	case DEATHMUG
	case TACOS
	case SUITCASE
		geta[].extra initflags
		seta[].extra -1
	break
	
	case VRSET
		geta[].lotag SPRITELOTAG
		seta[].lotag 0
		geta[].hitag initsprite
		ifn initsprite 0 cstat 32768
		seta[].hitag 0
	break
	
	case DEANOVA
	case GUIDEDRONE
	case DEAWAIT
		geta[].lotag SPRITELOTAG
		seta[].lotag 0
		geta[].hitag droptile
		// for DEANOVA in gladiatorium, droptile is the wave she becomes active
		seta[].hitag 0
		geta[].extra initsprite
		seta[].extra -1
		ife initsprite -1 set initsprite 0
		sizeat 28 25
		cstat 32768
	break
	
	case ALIENGHOST
		cstat 32768
	break
	
	case 16620 // attrition tutorial sprite
		ife challenge YES
			cactor 14835
	break
	
	case SMOKER
		cstat 32768
		geta[].lotag SPRITELOTAG
		ife SPRITELOTAG 0 set SPRITELOTAG 30 // min delay
		seta[].lotag 0
		geta[].hitag initsprite
		ife initsprite 0 set initsprite 384 // radius
		ifn sprite[].extra -1 geta[].extra mtype // alpha
		geta[].shade botclip
		
	break
	
	case AATELEPORTER
		cstat 32768
		geta[].lotag SPRITELOTAG // pair
		seta[].lotag 0
		geta[].hitag initsprite // sound
		seta[].hitag 0
		set spriteid 0
		ifn SPRITELOTAG 0
		{
			whilevarvarn spriteid Numsprites
			{
				ifn spriteid THISACTOR
				{
					ife sprite[spriteid].lotag SPRITELOTAG set myspawner spriteid else
					ife actorvar[spriteid].SPRITELOTAG SPRITELOTAG set myspawner spriteid
				}
				add spriteid 1
			}
		}
	break
	
	case FLYCAR_SPAWNER
	cstat 32768
	geta[].lotag SPRITELOTAG
	seta[].lotag 0
	geta[].hitag countvar
	seta[].hitag 0
	break
	
	case WESCREDITS
		cstat 32768
		// set crawlfirstline 1288
		// set crawlclock totalclock
	break
	
	case LAPTOP
		geta[].lotag SPRITELOTAG
		seta[].lotag 0
		ifn SPRITELOTAG 0 cstator 256
	break
	
	case LEVELENDER
		cstat 32768
		geta[].lotag SPRITELOTAG
		seta[].lotag 0
		geta[].hitag initflags
		seta[].hitag 0
		geta[].extra initsprite
		seta[].extra -1
		geta[].pal mtype
		ife initsprite -1 set initsprite 150
	break
	
	case PORTALMANAGER
		cstat 32768
		geta[].lotag SPRITELOTAG
		seta[].lotag 0
		geta[].hitag initsprite
		seta[].hitag 0
		geta[].extra initflags
		seta[].extra -1
	break
	
	default
		ifge sprite[].picnum MINIDUKE
		ifle sprite[].picnum MINIARMLIZ
		{
			sizeat 24 24
			cstat 0
			geta[].lotag SPRITELOTAG
			seta[].lotag 0
			geta[].hitag mtype
			seta[].hitag 0
			add collectinlevel 1
			// ife mtype 0 
			// {
				// geta[].picnum picnum 
				// al picnum
				// geta[].x x al x
				// geta[].y y al y
			// }
			ifn mtype 0 cstat 32768
		}
	break
	
	
endswitch


/*
// map hacks
	ife VOLUME 0 
	{
		ife LEVEL 2 // 1
		{
			ifactor RESPAWN
			{
				ife THISACTOR 550
				{
					// extra checks
					ife sprite[].hitag PIGCOP
					ife sprite[].lotag 300
						seta[].lotag 325
				}
			}
		}
		ife LEVEL 3 // 2
		{
			ifactor MUSICANDSFX
			{
				ife THISACTOR 2
				{
					ife sprite[].lotag 91
					ife sprite[].hitag 2000
					seta[].hitag 10240
				}
				ife THISACTOR 3
				{
					ife sprite[].lotag 91
					ife sprite[].hitag 2000
					seta[].hitag 10240
				}
				ife THISACTOR 905
				{
					ife sprite[].lotag 91
					ife sprite[].hitag 2000
					seta[].hitag 6144
				}
			}
		}
	}
	ife VOLUME 3
	{
		ife LEVEL 4
		{
			ifactor RECON
			{
				ife sprite[].hitag 0
				{
					ife THISACTOR 107
					seta[].hitag 16
					
					ife THISACTOR 108
					seta[].hitag 17
					
					ife THISACTOR 652
					seta[].hitag 1
					
					ife THISACTOR 651
					seta[].hitag 4
				}
			}
		}
		ife LEVEL 11
		{
			ifactor MUSICANDSFX
			{
				ife THISACTOR 76
				seta[].lotag 231
			}
		}
	}
*/

// ifg maxkills lastmaxkills
// {
	// al THISACTOR
	// geta[].picnum picnum al picnum
	// al maxkills
	// set lastmaxkills maxkills
// }
endevent

defstate loadmap_arrive

	set shipcam -1
	set spriteid 0
	whilevarn spriteid 16384
	{
		ife sprite[spriteid].picnum LEVELPLATE2
		ife actorvar[spriteid].mtype 4
		ife actorvar[spriteid].SPRITELOTAG LAST_LEVEL
		{
			setp[].posx sprite[spriteid].x
			setp[].posy sprite[spriteid].y
			geta[spriteid].z z, sub z 8192
			setp[].posz z
			setp[].cursectnum sprite[spriteid].sectnum
			setp[].ang sprite[spriteid].ang
			setp[].oang sprite[spriteid].ang
			
			setarray loadx[LEVEL] player[].posx
			setarray loady[LEVEL] player[].posy
			setarray loadz[LEVEL] player[].posz
			
			setp[].oposx sprite[spriteid].x
			setp[].oposy sprite[spriteid].y
			setp[].oposy z
			
			setp[].knuckle_incs 0
			
			ife actorvar[spriteid].initflags 10 // track reversal
			{
				// reverse SPRITELOTAG on all MOVESHIPCAM that have them
				set TMP_B 1
				set B 1
				ifn shipcams[TMP_B] -1
				{
					whilevarn TMP_B 100
					{
						set temp shipcams[TMP_B]
						add TMP_B 1
						ife temp -1 { set B TMP_B sub B 2 set TMP_B 100 }
					}
					
					set TMP_A 1
					whilevarn B 0
					{
						set TMP_B shipcams[B]
						setav[TMP_B].SPRITELOTAG TMP_A
						
						add TMP_A 1
						sub B 1
					}
				}
				
			}
			
			set spriteid 16383
			
			
		}
		add spriteid 1
	}

ends

appendevent EVENT_ENTERLEVEL
    
	set gamespeed DEFAULTSPEED
	set prating 0
	ifvarand LOADMAP 2 state loadmap_arrive
	
	set restartatt NO
	ifn gameover YES
	set vendor_screen 0
	
	set temp NO
	ifge LEVEL MAX_EP_LEVELS set temp YES else
	ife attmode YES { set temp YES ife gameover YES break } else
	ife visited[LEVEL] 0 set temp YES
	
	ife temp YES
	{
		set secrets 0
		ifn attmode YES
		ifl LEVEL MAX_EP_LEVELS
		{
			setarray loadx[LEVEL] player[].posx
			setarray loady[LEVEL] player[].posy
			setarray loadz[LEVEL] player[].posz
		}
		setvar target 0
		ifvare init_picnums 0
		{
			setvar init_picnums 1
			whilevarvarn target NUMWALLS
			{
				getwall[target].picnum picnum
				
				ife picnum PROJECTION setw[target].picnum BLANKTEXTURE

				set B NO
				ifvare picnum COLAMACHINE set B YES
				ifvare picnum VENDMACHINE set B YES
				ifvare picnum BLUEBALLVEND set B YES
				ifvare picnum SNACKVEND set B YES
				ifvare picnum ASIANVEND set B YES
				ifvare picnum BRAWNDOVEND set B YES
				ifvare picnum REACTORVEND set B YES
				ife B YES
				{
					set B YES
					ifn wall[target].nextsector -1
					// ifl picnum BLUEBALLVEND
					{
						getw[target].nextsector mysector
						getw[target].nextwall tempb
						getw[tempb].nextsector tempc // starting sector
						ifn tempc -1
						{
							gets[mysector].floorz z
							gets[tempc].floorz z2
							sub z2 z
							ifl z2 10240 set B NO
						}
					}
					
					ife B YES
					{
						getwall[target].x x
						getwall[target].y y
						getwall[target].point2 tempb
						getwall[tempb].x x2
						getwall[tempb].y y2
						
						subvarvar x2 x
						subvarvar y2 y
						getangle angvar x2 y2

						getwall[tempb].x x2
						getwall[tempb].y y2
						
						setvarvar savx x
						setvarvar spriteid x2
						subvarvar savx spriteid
						mulvarvar savx savx
							
						setvarvar spriteid y
						setvarvar tempc y2
						subvarvar spriteid tempc
						mulvarvar spriteid spriteid
							
						addvarvar savx spriteid
						sqrt savx savx
						setvarvar xydist savx
						
						addvarvar x x2
						divvar x 2
						addvarvar y y2
						divvar y 2
						
						updatesector x y mysector // the sector of the midpoint between the walls
						getflorzofslope mysector x y z // z is top of cola machine
						setvarvar zdist z
						
						subvar angvar 512
						setvarvar x2 x
						addvar x2 64
						rotatepoint x y x2 y angvar savx y2
						set hitwall mysector
						updatesectorz savx y2 z hitwall // the sector 64 units out from midpoint in one direction
						ifvarvarn hitwall mysector ifvarn hitwall -1
						{
							getflorzofslope hitwall savx y2 tempd
							ifvarvarg tempd z 
							{
								setvarvar zdist tempd setvarvar mysector hitwall 
								setvarvar x savx setvarvar y y2
							}
						}
						else
						{
							addvar angvar 1024
							rotatepoint x y x2 y angvar savx y2
							set hitwall mysector
							updatesectorz savx y2 z hitwall
							ifvarvarn hitwall mysector ifvarn hitwall -1
							{
								getflorzofslope hitwall savx y2 tempd
								ifvarvarg tempd z
								{
									setvarvar zdist tempd setvarvar mysector hitwall 
									setvarvar x savx setvarvar y y2
								}
							}
						}
						ifvarvare zdist z // failsafe
						{
							setvarvar tempd z
							setvar zdist 10240
							rotatepoint x y x2 y angvar savx y2
							updatesectorz savx y2 tempd mysector
							ifvare mysector -1
							{
								addvar angvar 1024
								rotatepoint x y x2 y angvar savx y2
								updatesectorz savx y2 tempd mysector
							}	
						} 
						else
						{
							subvarvar zdist z
							ifvarl zdist 0 mulvar zdist -1
						}
						ifvarg zdist 8192 ifvarn mysector -1
						{
							espawn COLAMACHINE
							setactorvar[RETURN].initsprite zdist
							setactorvar[RETURN].mtype picnum
							setactor[RETURN].ang angvar
							setactor[RETURN].x savx
							setactor[RETURN].y y2
							setactor[RETURN].z tempd
							
							shiftvarr xydist 4 ifvarg xydist 255 setvar xydist 255
							setactor[RETURN].xrepeat xydist
							
							shiftvarr zdist 9 ifvarg zdist 255 setvar zdist 255
							setactor[RETURN].yrepeat zdist
							setactor[RETURN].sectnum mysector
							setactor[RETURN].cstat 32768
							setactorvar[RETURN].myspawner target
						}
					}
					
				}

				ifvare picnum 18726 setw[target].picnum 18725 // fake subway effect
				ife picnum W_TECHWALL1 setw[target].picnum 6829
				ife picnum W_TECHWALL2 setw[target].picnum 6832
				ife picnum W_TECHWALL15 setw[target].picnum 6835
				ife picnum W_TECHWALL4 setw[target].picnum 6838
				ife picnum W_TECHWALL16 setw[target].picnum 6841
				ife picnum 1140 setw[target].picnum 6631
				ife picnum 249 setw[target].picnum 6634
				ife picnum 250 setw[target].picnum 6637
				ife picnum 333 setw[target].picnum 6640
				ife picnum 334 setw[target].picnum 6643
				ife picnum 751 setw[target].picnum 6646
				ife picnum 752 setw[target].picnum 6649
				ife picnum 871 setw[target].picnum 6852
				add target 1
			}
			set target 0
			whilevarvarn target NUMSECTORS
			{
				
				ife sector[target].ceilingpicnum PROJECTION sets[target].ceilingpicnum BLANKTEXTURE
				ife sector[target].floorpicnum PROJECTION sets[target].floorpicnum BLANKTEXTURE
			
				ife sector[target].floorpicnum 18726 sets[target].floorpicnum 18725
				ife sector[target].ceilingpicnum 18726 sets[target].ceilingpicnum 18725
				ife sector[target].floorpicnum W_TECHWALL1 sets[target].floorpicnum 6829
				ife sector[target].ceilingpicnum W_TECHWALL1 sets[target].ceilingpicnum 6829
				ife sector[target].floorpicnum W_TECHWALL2 sets[target].floorpicnum 6832
				ife sector[target].ceilingpicnum W_TECHWALL2 sets[target].ceilingpicnum 6832
				ife sector[target].floorpicnum W_TECHWALL15 sets[target].floorpicnum 6835
				ife sector[target].ceilingpicnum W_TECHWALL15 sets[target].ceilingpicnum 6835
				ife sector[target].floorpicnum W_TECHWALL4 sets[target].floorpicnum 6838
				ife sector[target].ceilingpicnum W_TECHWALL4 sets[target].ceilingpicnum 6838
				ife sector[target].floorpicnum W_TECHWALL16 sets[target].floorpicnum 6841
				ife sector[target].ceilingpicnum W_TECHWALL16 sets[target].ceilingpicnum 6841
				ife sector[target].floorpicnum 1140 sets[target].floorpicnum 6631
				ife sector[target].ceilingpicnum 1140 sets[target].ceilingpicnum 6631
				ife sector[target].floorpicnum 249 sets[target].floorpicnum 6634
				ife sector[target].ceilingpicnum 249 sets[target].ceilingpicnum 6634
				ife sector[target].floorpicnum 250 sets[target].floorpicnum 6637
				ife sector[target].ceilingpicnum 250 sets[target].ceilingpicnum 6637
				ife sector[target].floorpicnum 333 sets[target].floorpicnum 6640
				ife sector[target].ceilingpicnum 333 sets[target].ceilingpicnum 6640
				ife sector[target].floorpicnum 334 sets[target].floorpicnum 6643
				ife sector[target].ceilingpicnum 334 sets[target].ceilingpicnum 6643
				ife sector[target].floorpicnum 751 sets[target].floorpicnum 6646
				ife sector[target].ceilingpicnum 751 sets[target].ceilingpicnum 6646
				ife sector[target].floorpicnum 752 sets[target].floorpicnum 6649
				ife sector[target].ceilingpicnum 752 sets[target].ceilingpicnum 6649
				ife sector[target].floorpicnum 871 sets[target].floorpicnum 6852
				ife sector[target].ceilingpicnum 871 sets[target].ceilingpicnum 6852
				add target 1
			}
			
		}
		ife gametype 0 save 7
	}
	else 
	{
		ifvarand LOADMAP 1 nullop else loadmapstate
		ife savelevel[LEVEL] YES
		{
			setp[].got_access keycards[LEVEL]
			setp[].secret_rooms secretrooms[LEVEL]
			ife VOLUME 6 ife LEVEL 12 nullop else
			{
				setp[].player_par playerpar[LEVEL]
				setp[].actors_killed actorskilled[LEVEL]
			}
			setarray savelevel[LEVEL] NO
		}
		set temp 0
		updatesectorz loadx[LEVEL] loady[LEVEL] loadz[LEVEL] temp
		ifn temp -1
		{
			setp[].posx loadx[LEVEL]
			setp[].posy loady[LEVEL]
			setp[].posz loadz[LEVEL]
			setp[].cursectnum temp
		}
	}
	ifn vrtrip 0
	{
		ife VOLUME 6 ife LEVEL 12 
		{
			
			setuserdef[].secretlevel 0
			set gametype -1
			set spriteid 0
			whilevarn spriteid 16384
			{
				ife sprite[spriteid].picnum VRSET
				ife actorvar[spriteid].SPRITELOTAG vrtrip
				{
					setp[].posx sprite[spriteid].x
					setp[].posy sprite[spriteid].y
					setp[].posz sprite[spriteid].z
					setp[].cursectnum sprite[spriteid].sectnum
					set spriteid 16383
					set osector sprite[spriteid].sectnum
					set menuoff YES
					set matchmenu NO
				}
				add spriteid 1
			}
			set vrtrip 0
			set vrscreen VR8
			set vrscreen_time -32
		}
		else
		{
			ife VOLUME 6 ife LEVEL 32 
			{
				// now set award
				ife vrtrip 27 // returning from Clear the Coast
				{
					espawn VRREWARD
					setav[RETURN].initsprite 1
				}
				else
				ife vrtrip 28 // returning from AMC Pleaser
				{
					espawn VRREWARD
					setav[RETURN].initsprite 2
				}
				else
				ife vrtrip 33 // returning from City Under Siege
				{
					espawn VRREWARD
					setav[RETURN].initsprite 3
				}
				else
				ife vrtrip 34 // returning from Polariso
				{
					espawn VRREWARD
					setav[RETURN].initsprite 4
				}
				else
				ife vrtrip 35 // returning from of pigs and men
				{
					espawn VRREWARD
					setav[RETURN].initsprite 5
				}
			}
			else
			{
				set vrscreen_time -32
				set vrscreen VR8
			}
		}
	}
	ifl LEVEL MAX_EP_LEVELS
	ifn attmode YES
	{
		set B visited[LEVEL]
		add B 1
		setarray visited[LEVEL] B
	}
	
	set B 0
	whilevarn B 4096
	{
		setarray psectvisited[B] NO
		add B 1
	}
	set botx 0 set boty 0 set botz 0
	
	set radarupdate 0
    state advance_rand

	// ife RANDOMTRACK YES
	// ife VOLUME 0 ife LEVEL 7
	// {
		// displayrandvar music_volume 3
		// ifvare music_volume 0 // episode 1
			// set temp 6
		// else
			// set temp 10
		// displayrandvarvar music_level temp

		// state apply_music
	// }
	set deaonwall -1
	set portalcam -1
	set portalview 0
	set mynavsprite -1
	set leftsidegun -1
	set rightsidegun -1
	set mybounty -1
	set mylily -1
	set leach 0
	set arrowview -1
	set TOTALSHOCKS 0
	set instasis NO
	set mynaamah -1
	set deathtime 0
	set pdown NO
	set lastsave 0
	set LAST_LEVEL -1
	set LOADMAP 0
	set clawclashtime 0
	set rage 0
	set heldobject -1
	set heldtime 0
	set babejuice 4
	set PLAYERONTHEBIKE 0
	set BIKEID -1
	// 10800 = 6 minutes
	// 12600 = 7 minutes
	// 14400 = 8 minutes
	// 16200 = 9 minutes
	// 18000 = 10 minutes
	set gametime 10800
	ife gametype CTF set gametime 14400
	ife gametype CONTROL 
	{
		ife LEVEL 15 set gametime 12600 else
		ife LEVEL 20 set gametime 16200 else
		set gametime 14400
	}
	set credits lastcredits
	ife win YES set win NO
	set bluescore 0
	set redscore 0
	set bonus_screen 0
	set unbalanced 0
	set duke_kills 0
	set shelly_kills 0
	set wes_kills 0
	set enemy1_kills 0
	set enemy2_kills 0
	set duke_deaths 0
	set shelly_deaths 0
	set wes_deaths 0
	set enemy1_deaths 0
	set enemy2_deaths 0
	set matchmenu NO
	ifn gameover YES
	setuserdef[].display_bonus_screen YES
	set subtitle_time 0
	setp[].movement_lock 0
	set secretsfound 0
	set clearrecons YES
	ife globalnofall 2 set globalnofall 1 else
	ife globalnofall 1 set globalnofall 0
	
	// failsafe for single character non-duke starts to ensure correct starting animation
	ife startmode 16 set pchar 4 else
	ife startmode 8 set pchar 3 else
	ife startmode 4 set pchar 2 else
	ife startmode 2 set pchar 1
	
	ife pchar 0 state dukeweapons else 
	ife pchar 1 state shellyweapons else
	ife pchar 2 state wesweapons else
	ife pchar 3 state mandoweapons else
	ife pchar 4 state novaweapons
	
	set jibsound -1
	set jibsound_delay 0
	
	ife attmode 1 // true attrition mode
	ifn es_type 0
	{
		set es_battery es_batterymax
		set es_hp es_hpmax[es_type]
	}
	ifn vrtrip 0 ife gametype 0 set NEWENEMIES YES
	ife VOLUME 4 ife LEVEL 1
	{
		state resetplayeramounts
		set startguns 1
		state applystartguns
	}
	ife VOLUME 6 ifg LEVEL 10 ifl LEVEL 38
	{
		ife VOLUME 6 ife LEVEL 12
		{
			setp[].jetpack_amount 0
		}
		ife LEVEL 11
		{
			set altcostume 14
			set gametype DM
		}
		ife LEVEL 13 
		{
			set gametype SURVIVAL
			set wave 1
			set spawnsleft 30
			set monleft 30
			set survivor_winner NO
		}
		ife LEVEL 16 // sith survival match start
		{
			set gametype SURVIVAL
			set wave 7
			set spawnsleft 24 // 34
			set monleft 24 // 34
			set survivor_winner NO
		}
		ife LEVEL 18 // second arena match start
		{
			set gametype SURVIVAL
			set wave 11
			set spawnsleft 30
			set monleft 30
			set survivor_winner NO
		}
		ife LEVEL 21 // littlebigmen fight
		{
			set gametype SURVIVAL
			set wave 16
			set spawnsleft 0
			set monleft 0
			set survivor_winner NO
		}
		ife LEVEL 25 // mando fett DM
		{
			set gametime DM
			set wave 20
			set gametime 14400
		}
		ife LEVEL 26 // edelheim
		{
			set gametype SURVIVAL
			set wave 21
			set spawnsleft 50
			set monleft 50
			set survivor_winner NO
		}
		ife LEVEL 30 // 2nd ancients fight
		{
			ifl ancients 3 set ancients 3
		}
		ife LEVEL 31 // 3rd ancients fight
		{
			ifl ancients 6 set ancients 6
		}
		ife LEVEL 36 set gametype 0
		ife LEVEL 37 { set gametype 0 set wave 39 }
	}
	ifn gametype 0 seta[player[].i].extra player[].max_player_health
	

endevent


state cutscene_cleanup
	stopallmusic
	ifvarn SCREENALPHA 255
			setvar SCREENALPHA 255
	ifvarn CUTSCENE_STEP 0
			setvar CUTSCENE_STEP 0
ends

onevent EVENT_PRELEVEL

	ife gameover YES break
	
	ife VOLUME 0
	ife LEVEL 30
	{
			stopallsounds
			stopallmusic
			starttrackslot 3 0 // Play BRIEFING.MID
			screensound EP4_START
			screensound EP4_START
			screensound EP4_START
			screensound EP4_START
			screensound EP4_START
			redefinequote 230 E4L1.IVF
			startcutscene 230
			stopallsounds
	}

	state cutscene_cleanup
	ifvare VOLUME 0
	{
		ifvare LEVEL 1 // HOLLYWOOD HOLOCAUST
		{
			stopallsounds
			// ADD SOME MUSIC TRACK IF NEEDED
			starttrackslot 7 4
			startscreen    // FIRST SCREEN
			screensound RPG_EXPLODE // SOUND EFFECT AT THE START OF THE SECOND SCREEN
			startscreen    // SECOND SCREEN
		}
		ifvare LEVEL 4 // TOXIC DUMP
		{
			stopallsounds
			// ADD SOME MUSIC TRACK IF NEEDED
			// starttrackslot 7 4
			startscreen    // FIRST SCREEN
		}
		ifvare LEVEL 8 // SPACEPORT
		{
			stopallsounds
			// ADD SOME MUSIC TRACK IF NEEDED
			// starttrackslot 7 4
			startscreen    // FIRST SCREEN
		}
		ifvare LEVEL 11 // FUSION STATION
		{
			stopallsounds
			// ADD SOME MUSIC TRACK IF NEEDED
			// starttrackslot 7 4
			startscreen    // FIRST SCREEN
		}
		ifvare LEVEL 16 // OVERLORD
		{
			stopallsounds
			// ADD SOME MUSIC TRACK IF NEEDED
			// starttrackslot 7 4
			startscreen    // FIRST SCREEN
		}
		ifvare LEVEL 19 // RAW MEAT
		{
			stopallsounds
			// ADD SOME MUSIC TRACK IF NEEDED
			// starttrackslot 7 4
			startscreen    // FIRST SCREEN
		}
		ifvare LEVEL 23 // MOVIE SET
		{
			stopallsounds
			// ADD SOME MUSIC TRACK IF NEEDED
			// starttrackslot 7 4
			startscreen    // FIRST SCREEN
		}
		ifvare LEVEL 27 // STADIUM
		{
			stopallsounds
			// ADD SOME MUSIC TRACK IF NEEDED
			// starttrackslot 7 4
			startscreen    // FIRST SCREEN
		}
	}

	ifvare VOLUME 4 // NEW INVASION and HTTKB
	{
		ifvare LEVEL 0
		{
			ife CUTSCENE_STEP 0 stopallsounds
			// ADD SOME MUSIC TRACK IF NEEDED
			starttrackslot 7 5
			startscreen    // TITLE SCREEN 
			startscreen    // FIRST SCREEN OF CUTSCENE
			screensound MONITOR_ACTIVE // SOUND EFFECT AT THE START OF THE SECOND SCREEN
			startscreen    // SECOND SCREEN
			screensound JIBBED_ACTOR4
			startscreen
			screensound NUKESOUND
		}
		// ifvare LEVEL 1
		// {
			// startscreen
		// }
		else ifvare LEVEL 2
			startscreen
		else ifvare LEVEL 3
			startscreen
		else ifvare LEVEL 4
			startscreen
		else ifvare LEVEL 5
			startscreen
		else ifvare LEVEL 10 // START OF HTTKB
		{
			// add sounds and music
			starttrackslot 7 5
			startscreen startscreen startscreen startscreen
		}
		else ifvare LEVEL 12 // homecoming
		{
			ife CUTSCENE_STEP 0 stopallsounds
			starttrackslot 7 13
			startscreen
			startscreen
		}
		else ife LEVEL 13 // the cathedral first visit
		{
			ife CUTSCENE_STEP 0 stopallsounds
			startscreen
			startscreen
			startscreen
		}
		else ife LEVEL 15 // the cathedral second visit
		{
			ife CUTSCENE_STEP 0 stopallsounds
			screensound GRAVES_GOOD2B
			startscreen
			stopsound GRAVES_GOOD2B
			screensound GRAVES_MISSION1
			startscreen
			stopsound GRAVES_MISSION1
			screensound GRAVES_MISSION2
			startscreen
			stopsound GRAVES_MISSION2
			screensound DEA_SPEECH
			startscreen
			stopsound DEA_SPEECH
			screensound GRAVES_REPLYDEA
			startscreen
			stopsound GRAVES_REPLYDEA
			screensound DUKE_SPEECH1
			startscreen
			stopsound DUKE_SPEECH1
		}
	}
	ifvare VOLUME 5 // DUKE IT OUT IN DC
	{
		ifvare LEVEL 0
		{
			ife CUTSCENE_STEP 0 stopallsounds
			starttrackslot 7 6
			startscreen
			startscreen
			startscreen
		}
		ifvare LEVEL 1
		{
			starttrackslot 7 6
			startscreen
		}
		ifvare LEVEL 2
		{
			starttrackslot 7 6
			startscreen
		}
		ifvare LEVEL 3
		{
			starttrackslot 7 6
			startscreen
		}
		ifvare LEVEL 4
		{
			starttrackslot 7 6
			startscreen
		}
		ifvare LEVEL 5
		{
			starttrackslot 7 6
			startscreen
		}
		ifvare LEVEL 6
		{
			starttrackslot 7 6
			startscreen
		}
		ifvare LEVEL 7
		{
			starttrackslot 7 6
			startscreen
		}
		ifvare LEVEL 8
		{
			starttrackslot 7 6
			startscreen
		}
	}
	ifvare VOLUME 6 // CARIBBEAN VACATION AND GLADIATOR
	{
		ifvare LEVEL 0
		{
			ife CUTSCENE_STEP 0 stopallsounds
			starttrackslot 7 7
			startscreen
			startscreen
			startscreen
			stopallsounds
		}
		ifvare LEVEL 1
		{
			starttrackslot 7 7
			startscreen
			stopallsounds
		}
		ifvare LEVEL 2
		{
			starttrackslot 7 7
			startscreen
			stopallsounds
		}
		ifvare LEVEL 3
		{
			starttrackslot 7 7
			startscreen
			stopallsounds
		}
		ifvare LEVEL 4
		{
			starttrackslot 7 7
			startscreen
			stopallsounds
		}
		ifvare LEVEL 5
		{
			starttrackslot 7 7
			startscreen
			stopallsounds
		}
		ifvare LEVEL 6
		{
			starttrackslot 7 7
			startscreen
			stopallsounds
		}
		ifvare LEVEL 11
		{
			
			ife CUTSCENE_STEP 0 stopallsounds
			// ADD SOME MUSIC TRACK IF NEEDED
			starttrackslot 4 3
			screensound VACA_DIE2 // dialogue for first screen
			startscreen    // TILE 10492, part 1
			screensound DUKE_CHANCE // dialogue for second screen
			startscreen    // TILE 10493, part 2
			screensound EMP_LAUGH // dialogue for third screen
			startscreen    // TILE 10494, part 3
			
			ifg CUTSCENE_SCREEN 10494
			{
				set lastclock totalclock
				add lastclock 90
				set CUTSCENE_SCREEN 12195
				starttrackslot 7 8
				startscreen // will show many screens on a timer
				stopallsounds
			}
		}
		ifvare LEVEL 16 // sith boss fight cutscene
		{
			ife CUTSCENE_STEP 0 stopallsounds
			// ADD SOME MUSIC TRACK IF NEEDED
			starttrackslot 7 12
			startscreen
		}
		ifvare LEVEL 21 // littlebigmen boss fight cutscene
		{
			ife CUTSCENE_STEP 0 stopallsounds
			// ADD SOME MUSIC TRACK IF NEEDED
			starttrackslot 7 12
			startscreen
		}
		ife LEVEL 22
		{
			ife CUTSCENE_STEP 0 stopallsounds
			// starttrackslot 7 12
			startscreen
			startscreen
			startscreen
		}
		ife LEVEL 38
		{
			ife CUTSCENE_STEP 0 stopallsounds
			starttrackslot 4 2
			startscreen
			startscreen
			startscreen
			startscreen
		}
		ifvare LEVEL 42
		{
			starttrackslot 6 45
			startscreen
		}
	}
	
	ife mirror_maps YES
	{
		state mirror
		set mirror_thismap YES
	}
	set maxkills 0
	set killcount 0
	set highrecon 0
	set collectinlevel 0
	set collectfound 0
	
endevent

appendevent EVENT_ENDLEVELSCREEN
	state cutscene_cleanup
	// ifvare VOLUME 0
	// ifvare LEVEL 2 // RED LIGHT DISTRICT
	// {
		// stopallsounds
		// startscreen
	// }
	
endevent


// advance frames 10 times per second == every 12 clock tics
// B is set to time elapsed before state is called
state deanova_talk
	ifl cutcamtarget 12272 set cutcamtarget 12272
	set tempb B
	sub tempb cutcamsound
	ifg tempb 11 // advance frame
	{
		add cutcamtarget 1
		ifg cutcamtarget 12275 set cutcamtarget 12272
		set cutcamsound B
	}
	
ends

state braccus_talk
	ifl cutcam 12266 set cutcam 12266
	set tempb B
	sub tempb cutcamtime
	ifg tempb 11 // advance frame
	{
		add cutcam 1
		ifg cutcam 12269 set cutcam 12266
		set cutcamtime B
	}
	
ends

state gladfinal_subtitles

	ife CUTSCENE_SCREEN 14817
	{
		set subtitle_numlines 3
		set subtitle_start 818
	} else
	ife CUTSCENE_SCREEN 14818
	{
		set subtitle_numlines 0
	} else
	ife CUTSCENE_SCREEN 14819
	{
		set subtitle_numlines 2
		set subtitle_start 821
	} else
	ife CUTSCENE_SCREEN 14820
	{
		ife CUTSCENE_STEP 0
		{
			set subtitle_numlines 2
			set subtitle_start 823
		}
		else
		{
			set subtitle_numlines 3
			set subtitle_start 825
		}
	} else
	ife CUTSCENE_SCREEN 14821
	{
		set subtitle_numlines 1
		set subtitle_start 828
	} else
	ife CUTSCENE_SCREEN 14822
	{
		set subtitle_numlines 4
		set subtitle_start 829
	} else
	ife CUTSCENE_SCREEN 14823
	{
		state display_textcrawl
		ife crawlclock NO { set RETURN 1 set cutmash 6 set cutend 0 }
		// else set cutmash 0
		break
	}
	
	set temp subtitle_numlines
	set y 26
	set orientation 0
	set temp subtitle_numlines
	whilevarn temp 0
	{
		rotatesprite 160 y 65536 0 BLACKBAR 0 0 0 0 0 xdim ydim
		sub y 7
		sub temp 1
	}
	set temp subtitle_numlines
	set y 26
	set B subtitle_start
	add B subtitle_numlines
	sub B 1
	set temp subtitle_numlines
	whilevarn temp 0
	{
		gametextz NEWFONTSTART 320 y B 0 23 orientation 0 0 xdim ydim 16384
		sub y 7
		sub B 1
		sub temp 1
	}

ends

onevent EVENT_SCREEN

	set z 65536
	ifn midscreen NO
	{
		ifge totalclock cutend set RETURN 1 else 
		{
			ife RETURN 1
			{
				add cutmash 1
				ife CUTSCENE_SCREEN 14829 sub crawltopy 20480
			}	
			ifl cutmash 6 set RETURN 0
		}
		ifge midscreen 14817 ifle midscreen 14823
		{
			set temp cutstart
			add temp 100
			ifl totalclock temp set RETURN 0
		}
		ife midscreen 20479
		{
			set temp cutstart
			add temp 400
			ifl totalclock temp set RETURN 0
		}
	
		ife RETURN 1 { set midscreen NO set cutmash 0 }
		ife midscreen PROTON_DEATHCUT
		{
			set temp totalclock
			shiftl temp 4
			sin CUTSCENE_SCREEN temp
			shiftvarr CUTSCENE_SCREEN 13
			add CUTSCENE_SCREEN midscreen
			ifl CUTSCENE_SCREEN 6807 set CUTSCENE_SCREEN 6807
			ifg CUTSCENE_SCREEN 6809 set CUTSCENE_SCREEN 6809
		}
		else ifn midscreen NO set CUTSCENE_SCREEN midscreen
		
		ifvarg SCREENALPHA 0    // QUICK FADEOUT
		{
			screenpal 0 0 0 SCREENALPHA
			subvar SCREENALPHA 5
		}
		else
		screenpal 0 0 0 0
		set orientation 1024
		
		ife CUTSCENE_SCREEN HELLOSHELLY { set z 32768 set orientation 2 } else 
		ife CUTSCENE_SCREEN 14829 { set z 32768 set orientation 2 } else
		ifge CUTSCENE_SCREEN 14817 ifle CUTSCENE_SCREEN 17823 set z 32768 else
		ife CUTSCENE_SCREEN 20479 set z 32768 else
		ife attmid 4 set z 32768 else
		set z 65536
		
		rotatesprite 160 100 z 0 CUTSCENE_SCREEN 0 0 orientation 0 0 xdim ydim
		
		ifge CUTSCENE_SCREEN 14817 ifle CUTSCENE_SCREEN 14823
		state gladfinal_subtitles
		
		ife CUTSCENE_SCREEN 14829
		{
			state display_textcrawl
			ife crawlclock NO { set RETURN 1 set cutmash 6 set cutend 0 }
			else set cutmash 0
			break
		}
		
		ife midscreen 16880
		{
			set temp cutend
			sub temp totalclock
			ifg temp 1880 set cutmash 0
			
			set y 180
			gametextz NEWFONTSTART 320 y 1149 0 fontpal 0 0 0 xdim ydim 20480
			add y 8
			gametextz NEWFONTSTART 320 y 1150 0 fontpal 0 0 0 xdim ydim 20480	
		}
		else
		ife midscreen 16881
		{
			set y 180
			gametextz NEWFONTSTART 320 y 1151 0 fontpal 0 0 0 xdim ydim 20480
			add y 8
			gametextz NEWFONTSTART 320 y 1152 0 fontpal 0 0 0 xdim ydim 20480	
			add y 8
			gametextz NEWFONTSTART 320 y 1153 0 fontpal 0 0 0 xdim ydim 20480
		}
		else
		ife midscreen 16882
		{
			set y 180
			ife attbeaten 1
			{
				gametextz NEWFONTSTART 320 y 1171 0 fontpal 0 0 0 xdim ydim 20480
				add y 8
				gametextz NEWFONTSTART 320 y 1172 0 fontpal 0 0 0 xdim ydim 20480	
				add y 8
				gametextz NEWFONTSTART 320 y 1173 0 fontpal 0 0 0 xdim ydim 20480
			}
			else
			ife attbeaten 2
			{
				gametextz NEWFONTSTART 320 y 1168 0 fontpal 0 0 0 xdim ydim 20480
				add y 8
				gametextz NEWFONTSTART 320 y 1169 0 fontpal 0 0 0 xdim ydim 20480	
				add y 8
				gametextz NEWFONTSTART 320 y 1170 0 fontpal 0 0 0 xdim ydim 20480
			}
			else
			ife attbeaten 3
			{
				gametextz NEWFONTSTART 320 y 1177 0 fontpal 0 0 0 xdim ydim 20480
				add y 8
				gametextz NEWFONTSTART 320 y 1178 0 fontpal 0 0 0 xdim ydim 20480	
				add y 8
				gametextz NEWFONTSTART 320 y 1179 0 fontpal 0 0 0 xdim ydim 20480
			}
			else
			ife attbeaten 4
			{
				gametextz NEWFONTSTART 320 y 1186 0 fontpal 0 0 0 xdim ydim 20480
				add y 8
				gametextz NEWFONTSTART 320 y 1187 0 fontpal 0 0 0 xdim ydim 20480	
				add y 8
				gametextz NEWFONTSTART 320 y 1188 0 fontpal 0 0 0 xdim ydim 20480
			}
			else
			{
				gametextz NEWFONTSTART 320 y 1174 0 fontpal 0 0 0 xdim ydim 20480
				add y 8
				gametextz NEWFONTSTART 320 y 1175 0 fontpal 0 0 0 xdim ydim 20480	
				add y 8
				gametextz NEWFONTSTART 320 y 1176 0 fontpal 0 0 0 xdim ydim 20480
			}
		}
		
		ife midscreen PROTON_DEATHCUT
		{
			set pal cutmash add pal 10
			gametext STARTALPHANUM 320 195 165 0 pal 0 0 0 xdim ydim
		}
		break
	}
	
	ifvare RETURN 0
	{
		ifvarg SCREENALPHA 0    // QUICK FADEOUT
		{
			screenpal 0 0 0 SCREENALPHA
			subvar SCREENALPHA 5
		}
	}
	else ifvare RETURN 1
			setvar SCREENALPHA 255
			
	ifvare VOLUME 0
	{
		ifvare LEVEL 1
		{
			ifvare CUTSCENE_STEP 0    // FIRST SCREEN
			{
				setvar CUTSCENE_SCREEN 6844

				ifvare RETURN 1     // IF THE PLAYER USES ANY KEY TO SKIP THE SCENE
						setvar CUTSCENE_STEP 1     // CHANGE TO THE NEXT SCREEN
			}
			else ifvare CUTSCENE_STEP 1   // SECOND SCREEN
			{
				setvar CUTSCENE_SCREEN 6845
				ifvare RETURN 1     // IF THE PLAYER USES ANY KEY TO SKIP THE SCENE
						setvar CUTSCENE_STEP 2     // CHANGE TO THE NEXT SCREEN
			}
		}
		ifvare LEVEL 4
		{
			setvar CUTSCENE_SCREEN 6846

		}
		ifvare LEVEL 8
		{
			setvar CUTSCENE_SCREEN 6847
		}
		ifvare LEVEL 11
		{
			setvar CUTSCENE_SCREEN 6848

		}
		ifvare LEVEL 16
		{
			setvar CUTSCENE_SCREEN 6849
		}
		ifvare LEVEL 19 // RAW MEAT
		{
			setvar CUTSCENE_SCREEN 6850
		}
		ifvare LEVEL 23 // MOVIE SET
		{
			setvar CUTSCENE_SCREEN 6873
		}
		ifvare LEVEL 27 // STADIUM
		{
			setvar CUTSCENE_SCREEN 6851
		}
	}

	ifvare VOLUME 4
	{
		ifvare LEVEL 0
		{
			ifvare CUTSCENE_STEP 0
			{
				setvar CUTSCENE_SCREEN 10486

				ifvare RETURN 1     // IF THE PLAYER USES ANY KEY TO SKIP THE SCENE
						setvar CUTSCENE_STEP 1     // CHANGE TO THE NEXT SCREEN
			}
			else
			ifvare CUTSCENE_STEP 1
			{
				setvar CUTSCENE_SCREEN 6909

				ifvare RETURN 1     // IF THE PLAYER USES ANY KEY TO SKIP THE SCENE
						setvar CUTSCENE_STEP 2     // CHANGE TO THE NEXT SCREEN
			}
			else ifvare CUTSCENE_STEP 2
			{
				setvar CUTSCENE_SCREEN 6910
				ife RETURN 1
						setvar CUTSCENE_STEP 3

			}
			else ifvare CUTSCENE_STEP 3   // THIRD SCREEN
			{
				setvar CUTSCENE_SCREEN 6911

			}
		} else
		ifvare LEVEL 2
		{
			setvar CUTSCENE_SCREEN 7576
			set z 32768
		} else
		ifvare LEVEL 3
		{
			setvar CUTSCENE_SCREEN 7577
			set z 32768
		} else
		ifvare LEVEL 4
		{
			setvar CUTSCENE_SCREEN 7578
			set z 32768
		} else
		ifvare LEVEL 5
		{
			setvar CUTSCENE_SCREEN 7579
			set z 32768
		} else
		ifvare LEVEL 10
		{
			ifvare CUTSCENE_STEP 0
			{
				setvar CUTSCENE_SCREEN 14830
				set z 32768

				ifvare RETURN 1     // IF THE PLAYER USES ANY KEY TO SKIP THE SCENE
						setvar CUTSCENE_STEP 1     // CHANGE TO THE NEXT SCREEN
			}
			else
			ifvare CUTSCENE_STEP 1
			{
				setvar CUTSCENE_SCREEN 14831
				set z 32768

				ifvare RETURN 1     // IF THE PLAYER USES ANY KEY TO SKIP THE SCENE
						setvar CUTSCENE_STEP 2     // CHANGE TO THE NEXT SCREEN
			}
			else ifvare CUTSCENE_STEP 2
			{
				setvar CUTSCENE_SCREEN 14832
				set z 32768
				ife RETURN 1
						setvar CUTSCENE_STEP 3

			}
			else ifvare CUTSCENE_STEP 3   // THIRD SCREEN
			{
				setvar CUTSCENE_SCREEN 14833
				set z 32768
			}
		}
		else
		ifvare LEVEL 12
		{
			ifvare CUTSCENE_STEP 0
			{
				set z 32768
				setvar CUTSCENE_SCREEN 18750
				
				ife RETURN 1
					set CUTSCENE_STEP 1
			}
			else ife CUTSCENE_STEP 1
			{
				set z 32768
				set CUTSCENE_SCREEN 18751
			}
		}
		else
		ifvare LEVEL 13
		{
			ifvare CUTSCENE_STEP 0
			{
				set z 32768
				setvar CUTSCENE_SCREEN 18752
				
				ife RETURN 1
					set CUTSCENE_STEP 1
			}
			else ife CUTSCENE_STEP 1
			{
				set z 32768
				set CUTSCENE_SCREEN 18753
				ife RETURN 1
					set CUTSCENE_STEP 2
			}
			else ife CUTSCENE_STEP 2
			{
				set z 32768
				set CUTSCENE_SCREEN 18754
			}
		}
		else
		ife LEVEL 15
		{
			ifvare CUTSCENE_STEP 0
			{
				set z 32768
				setvar CUTSCENE_SCREEN 18755
				
				ife RETURN 1
					set CUTSCENE_STEP 1
			}
			else ife CUTSCENE_STEP 1
			{
				set z 32768
				set CUTSCENE_SCREEN 18756
				
				ife RETURN 1
					set CUTSCENE_STEP 2
			}
			else ife CUTSCENE_STEP 2
			{
				set z 32768
				set CUTSCENE_SCREEN 18757
				
				ife RETURN 1
					set CUTSCENE_STEP 3
			}
			else ife CUTSCENE_STEP 3
			{
				set z 32768
				set CUTSCENE_SCREEN 18758
				// dea speech
				
				ife RETURN 1
					set CUTSCENE_STEP 4
			}
			else ife CUTSCENE_STEP 4
			{
				set z 32768
				set CUTSCENE_SCREEN 18758
				ife RETURN 1
					set CUTSCENE_STEP 5
			}
			else ife CUTSCENE_STEP 5
			{
				set z 32768
				set CUTSCENE_SCREEN 18759
			}
		}
	}
	ifvare VOLUME 5
	{
		ifvare LEVEL 0
		{
			ifvare CUTSCENE_STEP 0
			{
				setvar CUTSCENE_SCREEN 10488
				
				ifvare RETURN 1     // IF THE PLAYER USES ANY KEY TO SKIP THE SCENE
						setvar CUTSCENE_STEP 1     // CHANGE TO THE NEXT SCREEN
			}
			else
			ifvare CUTSCENE_STEP 1
			{
				setvar CUTSCENE_SCREEN 10489

				ifvare RETURN 1     // IF THE PLAYER USES ANY KEY TO SKIP THE SCENE
						setvar CUTSCENE_STEP 2     // CHANGE TO THE NEXT SCREEN
			}
			else
			ifvare CUTSCENE_STEP 2
			{
				setvar CUTSCENE_SCREEN 10490

			}
		}
		ifvare LEVEL 1
		{
			setvar CUTSCENE_SCREEN 7652
			set z 32768
		}
		ifvare LEVEL 2
		{
			setvar CUTSCENE_SCREEN 7653
			set z 32768
		}
		ifvare LEVEL 3
		{
			setvar CUTSCENE_SCREEN 7654
			set z 32768
		}
		ifvare LEVEL 4
		{
			setvar CUTSCENE_SCREEN 7655
			set z 32768
		}
		ifvare LEVEL 5
		{
			setvar CUTSCENE_SCREEN 7656
			set z 32768
		}
		ifvare LEVEL 6
		{
			setvar CUTSCENE_SCREEN 7657
			set z 32768
		}
		ifvare LEVEL 7
		{
			setvar CUTSCENE_SCREEN 7658
			set z 32768
		}
		ifvare LEVEL 8
		{
			setvar CUTSCENE_SCREEN 7659
			set z 32768
		}
	}
	ifvare VOLUME 6
	{
		ifvare LEVEL 0
		{
			ifvare CUTSCENE_STEP 0
			{
				setvar CUTSCENE_SCREEN 7661
				
				ifvare RETURN 1     // IF THE PLAYER USES ANY KEY TO SKIP THE SCENE
						setvar CUTSCENE_STEP 1     // CHANGE TO THE NEXT SCREEN
			}
			else
			ifvare CUTSCENE_STEP 1
			{
				setvar CUTSCENE_SCREEN 7662

				ifvare RETURN 1     // IF THE PLAYER USES ANY KEY TO SKIP THE SCENE
						setvar CUTSCENE_STEP 2     // CHANGE TO THE NEXT SCREEN
			}
			else
			ifvare CUTSCENE_STEP 2
			{
				setvar CUTSCENE_SCREEN 7663
				ifvare RETURN 1
					setvar CUTSCENE_STEP 3
			}
		}
		ifvare LEVEL 1
		{
			setvar CUTSCENE_SCREEN 12154
		}
		ifvare LEVEL 2
		{
			setvar CUTSCENE_SCREEN 12155
		}
		ifvare LEVEL 3
		{
			setvar CUTSCENE_SCREEN 12156
		}
		ifvare LEVEL 4
		{
			setvar CUTSCENE_SCREEN 12157
		}
		ifvare LEVEL 5
		{
			setvar CUTSCENE_SCREEN 12158
		}
		ifvare LEVEL 6
		{
			setvar CUTSCENE_SCREEN 12159
		}
		ifvare LEVEL 11 // GLADIATOR START
		{
			
			ifg CUTSCENE_SCREEN 10494
			{
				set temp totalclock
				sub temp lastclock
				ife CUTSCENE_SCREEN 12243 sub temp 120
				ifg CUTSCENE_SCREEN 12220 ifl CUTSCENE_SCREEN 12225 add temp 15
				ifg temp 30 
				{ 
					set lastclock totalclock 
					add CUTSCENE_SCREEN 1 
					ife CUTSCENE_SCREEN 12196 screensound INSERT_SSHELL
					ife CUTSCENE_SCREEN 12199 screensound GUNPICKUP
					ife CUTSCENE_SCREEN 12201 screensound ENDSEQVOL2SND3
					ife CUTSCENE_SCREEN 12204 screensound ENDSEQVOL2SND5
					ife CUTSCENE_SCREEN 12208 screensound BODYSEARCH
					ife CUTSCENE_SCREEN 12213 screensound BODYSEARCH
					ife CUTSCENE_SCREEN 12217 screensound DEAGLE_CLIPIN
					ife CUTSCENE_SCREEN 12221 screensound DEAGLE_SLIDE
					ife CUTSCENE_SCREEN 12225 screensound HOLSTER
					ife CUTSCENE_SCREEN 12232 screensound SHOTGUN_COCK
					ifg CUTSCENE_SCREEN 12243 set RETURN 1 
				}
			}
			else
			{
				set z 32768
				ifvare CUTSCENE_STEP 0
				{
					setvar CUTSCENE_SCREEN 10492
					
					ifvare RETURN 1     // IF THE PLAYER USES ANY KEY TO SKIP THE SCENE
							setvar CUTSCENE_STEP 1     // CHANGE TO THE NEXT SCREEN
				}
				else
				ifvare CUTSCENE_STEP 1
				{
					setvar CUTSCENE_SCREEN 10493

					ifvare RETURN 1     // IF THE PLAYER USES ANY KEY TO SKIP THE SCENE
							setvar CUTSCENE_STEP 2     // CHANGE TO THE NEXT SCREEN
				}
				else
				ifvare CUTSCENE_STEP 2
				{
					setvar CUTSCENE_SCREEN 10494
					ifvare RETURN 1
					{
						setvar CUTSCENE_STEP 3
						setvar CUTSCENE_SCREEN 12195
					}
				}
			}
			
		}
		ife LEVEL 16 // sith cutscene
		{
			ifvare CUTSCENE_STEP 0
			{
				screensound CUTSCENE_1STBOSS
				set CUTSCENE_STEP 1
				set lastclock totalclock // lastclock is time of cutscene start
				// we will borrow some vars for this scene
				set cutcam 12266 // 0 no braccus, 1 braccus quiet, 12266-9 braccus talk
				set cutcamtarget 0 // 0 no deanova, 1 deanova quiet, 12272-5 deanova talk
				
				set cutcamtime 0 // braccus animation timer
				set cutcamsound 0 // deanova animation timer
				
				set cutcamchannel -1 // set to a picnum if a pic is displayed in the middle
			}
			rotatesprite 160 100 32768 0 12265 0 0 1024 0 0 xdim ydim
			
			
				
			set B totalclock
			sub B lastclock // B is now elapsed time; 120 == one second
			// timestamp list
			// fragathon logo 0-1560, tile 12277
			// duke+bombshell pic 1560-2640
			// gun banned pic 2640-3120
			// siths pic 3120-5040
			// ppv poster pic 5040+
			// braccus quiet 5400-6024
			// deanova talking 5460-5988
			// braccus talking 6024-7116
			// deanova talking 7200-8412
			// braccus talking 8520-8808
			// deanova talking 8880-9720
			// braccus talking 9768-11868
			// deanova talking 11892-12456
			// braccus talking 12540-13680
			// deanova talking 13740-14940
			// braccus talking 15060-16020
			// deanova talking 16080-16836
			// braccus talking 16932-19680
			
			ifle B 1560 set cutcamchannel 12277 else
			ifle B 2640 set cutcamchannel 12278 else
			ifle B 3120 set cutcamchannel 12279 else
			ifle B 5040 set cutcamchannel 12280 else
			set cutcamchannel PPVSITH
			
			ifn cutcamchannel -1
				rotatesprite 160 100 32768 0 cutcamchannel 0 0 2 0 0 xdim ydim
			
			ifge B 17400 set cutcamtarget 0 else
			ifge B 16837 ifle B 17399 set cutcamtarget 1 else
			ifge B 16080 ifle B 16836 state deanova_talk else
			ifge B 14941 ifle B 16079 set cutcamtarget 1 else
			ifge B 13740 ifle B 14940 state deanova_talk else
			ifge B 12457 ifle B 13739 set cutcamtarget 1 else
			ifge B 11892 ifle B 12456 state deanova_talk else
			ifge B 9721 ifle B 11891 set cutcamtarget 1 else
			ifge B 8880 ifle B 9720 state deanova_talk else
			ifge B 8413 ifle B 8879 set cutcamtarget 1 else
			ifge B 7200 ifle B 8412 state deanova_talk else
			ifge B 5989 ifle B 7199 set cutcamtarget 1 else
			ifge B 5460 ifle B 5988 state deanova_talk
			
			ifg B 19700 set cutcam 0 else
			ifge B 19681 ifle B 19699 set cutcam 1 else
			ifge B 16932 ifle B 19680 state braccus_talk else
			ifge B 16021 ifle B 16931 set cutcam 1 else
			ifge B 15060 ifle B 16020 state braccus_talk else
			ifge B 13681 ifle B 15059 set cutcam 1 else
			ifge B 12540 ifle B 13680 state braccus_talk else
			ifge B 11869 ifle B 12539 set cutcam 1 else
			ifge B 9768 ifle B 11868 state braccus_talk else
			ifge B 8809 ifle B 9767 set cutcam 1 else
			ifge B 8520 ifle B 8808 state braccus_talk else
			ifge B 7116 ifle B 8519 set cutcam 1 else
			ifge B 6024 ifle B 7116 state braccus_talk else
			ifge B 5401 ifle B 6023 set cutcam 1 else
			ifge B 0 ifle B 5400 state braccus_talk
			ifg B 20000 set RETURN 1
			
			ife cutcam 1 // braccus idle
				rotatesprite 30 172 24576 0 12266 0 0 2 0 0 xdim ydim
			else ifg cutcam 1
			{
				// braccus talking frame
				rotatesprite 30 172 24576 0 cutcam 0 0 2 0 0 xdim ydim
			}
			
			ife cutcamtarget 1 // deanova idle
				rotatesprite 290 28 24576 0 12272 0 0 2 0 0 xdim ydim
			else ifg cutcamtarget 1
			{
				// animate deanova
				rotatesprite 290 28 24576 0 cutcamtarget 0 0 2 0 0 xdim ydim
			}

			ifvare RETURN 1 stopallsounds
			break
		}
		
		ife LEVEL 21 // littlebigmen cutscene
		{
			ifvare CUTSCENE_STEP 0
			{
				screensound LBM_INTRO
				set CUTSCENE_STEP 1
				set lastclock totalclock // lastclock is time of cutscene start
				// we will borrow some vars for this scene
				set cutcam 12266 // 0 no braccus, 1 braccus quiet, 12266-9 braccus talk
				
				set cutcamtime 0 // braccus animation timer
				
				set cutcamchannel -1 // set to a picnum if a pic is displayed in the middle
			}
			rotatesprite 160 100 32768 0 14706 0 0 1024 0 0 xdim ydim
	
			set B totalclock
			sub B lastclock // B is now elapsed time; 120 == one second
			// timestamp list
			// 40 emperor starts talking
			// 480-1200 fragathon tile 14702
			// 1200-1860 team earth pic 12278
			// 1860-2880 LBM pic 14703
			// 2880-5040 PPV pic PPVLITMEN
			// 4920 braccus stops talking
			
			ifge B 480 
			{
				ifle B 1200 set cutcamchannel 14702 else
				ifle B 1860 set cutcamchannel 12278 else
				ifle B 2880 set cutcamchannel 14703 else
				ifle B 5040 set cutcamchannel PPVLITMEN else
				set cutcamchannel -1
			}
			else
			set cutcamchannel -1
			
			ifn cutcamchannel -1
				rotatesprite 160 80 32768 0 cutcamchannel 0 0 2 0 0 xdim ydim
			
			ifg B 4920 set cutcam 1 else
			ifge B 40 state braccus_talk else
			set cutcam 0
			
			ifg B 5040 set RETURN 1
			
			ife cutcam 1 // braccus idle
				rotatesprite 30 172 24576 0 12266 0 0 2 0 0 xdim ydim
			else ifg cutcam 1
			{
				// braccus talking frame
				rotatesprite 30 172 24576 0 cutcam 0 0 2 0 0 xdim ydim
			}
			
			ifvare RETURN 1 stopallsounds
			break
		}
		
		ife LEVEL 22
		{
			set CUTSCENE_SCREEN 10495
			set z 32768
			ifvare CUTSCENE_STEP 0 { screensound BRAC_MAND1 setvar CUTSCENE_STEP 1 }
			ifvare CUTSCENE_STEP 1
			{
				set subtitle_start 614
				set subtitle_numlines 5
				
				ifvare RETURN 1
				{
					setvar CUTSCENE_STEP 2 
					stopsound BRAC_MAND1
					screensound BRAC_MAND2
				}
			}
			else
			ifvare CUTSCENE_STEP 2
			{
				set subtitle_start 619
				set subtitle_numlines 5

				ifvare RETURN 1
				{
					setvar CUTSCENE_STEP 3  
					stopsound BRAC_MAND2
					screensound BRAC_MAND3
				}
			}
			else
			ifvare CUTSCENE_STEP 3
			{
				set subtitle_start 624
				set subtitle_numlines 4
				ifvare RETURN 1 stopsound BRAC_MAND3
			}
			
		}
		ife LEVEL 38
		{
			set z 32768
			ifvare CUTSCENE_STEP 0
			{
				setvar CUTSCENE_SCREEN 14824
				
				ifvare RETURN 1     // IF THE PLAYER USES ANY KEY TO SKIP THE SCENE
						setvar CUTSCENE_STEP 1     // CHANGE TO THE NEXT SCREEN
			}
			else
			ifvare CUTSCENE_STEP 1
			{
				setvar CUTSCENE_SCREEN 14825

				ifvare RETURN 1     // IF THE PLAYER USES ANY KEY TO SKIP THE SCENE
						setvar CUTSCENE_STEP 2     // CHANGE TO THE NEXT SCREEN
			}
			else
			ifvare CUTSCENE_STEP 2
			{
				setvar CUTSCENE_SCREEN 14826
				ifvare RETURN 1
				{
					setvar CUTSCENE_STEP 3
					setvar CUTSCENE_SCREEN 14827
				}
			}
			
		}
		ife LEVEL 42
		{
			setvar CUTSCENE_SCREEN 14828
			set z 32768
		}
	}
	rotatesprite 160 100 z 0 CUTSCENE_SCREEN 0 0 0 0 0 xdim ydim
	// additional text
	ife CUTSCENE_SCREEN 10488
		gametextz STARTALPHANUM 320 190 232 0 0 0 0 0 xdim ydim 32768
	
	switch CUTSCENE_SCREEN
	case  10492
		set y 170
		gametextz NEWFONTSTART 30 y 469 0 fontpal 0 0 0 xdim ydim 16384
		add y 7
		gametextz NEWFONTSTART 30 y 470 0 fontpal 0 0 0 xdim ydim 16384
		add y 10
		gametextz NEWFONTSTART 30 y 471 0 12 0 0 0 xdim ydim 16384
	break
	case 10493
		set y 170
		gametextz NEWFONTSTART 30 y 472 0 fontpal 0 0 0 xdim ydim 16384
		add y 7
		gametextz NEWFONTSTART 30 y 473 0 fontpal 0 0 0 xdim ydim 16384
		add y 10
		gametextz NEWFONTSTART 30 y 474 0 12 0 0 0 xdim ydim 16384
	break
	case 10494
		set y 170
		gametextz NEWFONTSTART 30 y 475 0 2 0 0 0 xdim ydim 16384
		add y 7
		gametextz NEWFONTSTART 30 y 476 0 2 0 0 0 xdim ydim 16384
		add y 7
		gametextz NEWFONTSTART 30 y 477 0 2 0 0 0 xdim ydim 16384
		add y 7
		gametextz NEWFONTSTART 30 y 478 0 2 0 0 0 xdim ydim 16384
	break
	case 10495
		set temp subtitle_numlines
		set y 194
		set orientation 0
		set temp subtitle_numlines
		whilevarn temp 0
		{
			rotatesprite 160 y 65536 0 BLACKBAR 0 0 0 0 0 xdim ydim
			sub y 7
			sub temp 1
		}
		set temp subtitle_numlines
		set y 192
		set B subtitle_start
		add B subtitle_numlines
		sub B 1
		set temp subtitle_numlines
		whilevarn temp 0
		{
			gametextz NEWFONTSTART 320 y B 0 fontpal orientation 0 0 xdim ydim 16384
			sub y 7
			sub B 1
			sub temp 1
		}
	break
	case 18755
		gametextz NEWFONTSTART 320 180 1612 0 12 0 0 0 xdim ydim 16384
	break
	case 18756
		set subtitle_numlines 7
		set y 196
		set subtitle_start 1613
		set B subtitle_start
		add B subtitle_numlines
		sub B 1
		set temp subtitle_numlines
		whilevarn temp 0
		{
			gametextz NEWFONTSTART 320 y B 0 12 0 0 0 xdim ydim 14336
			sub y 6
			sub B 1
			sub temp 1
		}
	break
	case 18757
		set subtitle_numlines 6
		set y 196
		set subtitle_start 1620
		set B subtitle_start
		add B subtitle_numlines
		sub B 1
		set temp subtitle_numlines
		whilevarn temp 0
		{
			gametextz NEWFONTSTART 320 y B 0 12 0 0 0 xdim ydim 15360
			sub y 7
			sub B 1
			sub temp 1
		}
	break
		
	case 18758
		set y 196
		ife CUTSCENE_STEP 3
		set subtitle_numlines 6
		else
		{
			set subtitle_numlines 4
			set y 182
		}
		
		ife CUTSCENE_STEP 3
		set subtitle_start 1626
		else
		set subtitle_start 1632
		set B subtitle_start
		add B subtitle_numlines
		sub B 1
		set temp subtitle_numlines
		whilevarn temp 0
		{
			gametextz NEWFONTSTART 320 y B 0 12 0 0 0 xdim ydim 15360
			sub y 7
			sub B 1
			sub temp 1
		}
	break
	
	case 18759
		set subtitle_numlines 6
		set y 196
		set subtitle_start 1636
		set B subtitle_start
		add B subtitle_numlines
		sub B 1
		set temp subtitle_numlines
		whilevarn temp 0
		{
			gametextz NEWFONTSTART 320 y B 0 12 0 0 0 xdim ydim 15360
			sub y 7
			sub B 1
			sub temp 1
		}
	break
	
	default break
	endswitch
	
endevent

